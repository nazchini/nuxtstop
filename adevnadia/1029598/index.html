<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Implementing advanced usePrevious hook with React useRef</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Implementing advanced usePrevious hook with React useRef</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/javascript" class="tag" data-v-70afb46a>
          #javascript
        </a><a href="/nuxtstop/t/webdev" class="tag" data-v-70afb46a>
          #webdev
        </a><a href="/nuxtstop/t/react" class="tag" data-v-70afb46a>
          #react
        </a><a href="/nuxtstop/t/tutorial" class="tag" data-v-70afb46a>
          #tutorial
        </a></div> <!----> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            9
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            3
          </span></div> <time data-v-70afb46a>Mar 21</time></div></header> <div class="content" data-v-70afb46a><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--eL33wDfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yet8usut4kqyyhxssjpy.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eL33wDfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yet8usut4kqyyhxssjpy.png" alt="Image description" loading="lazy" width="880" height="563"></a></p>

<p>After Context, ref is probably the most mysterious part of React. We almost got used to the ref attribute on our components, but not everyone is aware, that its usage is not limited to passing it back and forth between components and attaching it to the DOM nodes. We actually can store data there! And even implement things like <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">usePrevious hook</a> to get the previous state or props or any other value.</p>

<p>By the way, if you ever used that hook in the way that is written in React docs, have you investigated how it actually works? And what value it returns and why? The result might surprise you 😉</p>

<p>So this is exactly what I want to do in this article: take a look at ref and how it works when it’s not attached to a DOM node; investigate how <code>usePrevious</code> works and show why it’s not always a good idea to use it as-is; implement a more advanced version of the hook as a bonus 🙂</p>

<p>Ready to join in?</p>

<h2>
  <a name="first-of-all-what-is-ref" href="#first-of-all-what-is-ref">
  </a>
  First of all, what is ref?
</h2>

<p>Let’s remember some basics first, to understand it fully.</p>

<p>Imagine you need to store and manipulate some data in a component. Normally, we have two options: either put it in a variable or in the state. In a variable you’d put something that needs to be re-calculated on every re-render, like any intermediate value that depends on a prop value:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">price</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">discount</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nx">price</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">&lt;></span>Discount: <span class="si">{</span><span class="nx">discount</span><span class="si">}</span><span class="p">&lt;/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Creating a new variable or changing that variable won’t cause <code>Form</code> component to re-render.</p>

<p>In the state, we usually put values that need to be saved between re-renders, typically coming from users interacting with our UI:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">input</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=></span> <span class="nx">setName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Changing the state will cause the <code>Form</code> component to re-render itself.</p>

<p>There is, however, a third, lesser-known option: ref. It merges the behaviour of those two: it’s essentially a variable that doesn’t cause components to re-render, but its value is preserved between re-renders.</p>

<p>Let’s just implement a counter (I promise, it’s the first and the last counter example in this blog) to illustrate all those three behaviours.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">counter</span> <span class="o">=</span> <span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">></span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
      Counter value: <span class="si">{</span><span class="nx">counter</span><span class="si">}</span>
    <span class="p">&lt;/></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This is not going to work of course. In our <code>console.log</code> we’ll see the updated counter value, but the value rendered on the screen is not going to change - variables don’t cause re-renders, so our render output will never be updated.</p>

<p>State, on the other hand, will work as expected: that’s exactly what state is for.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">counter</span><span class="p">,</span> <span class="nx">setCounter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">setCounter</span><span class="p">(</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">></span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
      Counter value: <span class="si">{</span><span class="nx">counter</span><span class="si">}</span>
    <span class="p">&lt;/></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now the interesting part: the same with ref.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// set ref's initial value, same as state</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="c1">// ref.current is where our counter value is stored</span>
    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">></span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
      Counter value: <span class="si">{</span><span class="nx">ref</span><span class="p">.</span><span class="nx">curent</span><span class="si">}</span>
    <span class="p">&lt;/></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This is also not going to work. <em>Almost</em>. With every click on the button the value in the ref changes, but changing ref value <strong>doesn’t cause re-render</strong>, so the render output again is not updated. But! If something else causes a render cycle after that, render output will be updated with the latest value from the <code>ref.current</code>. For example, if I add both of the counters to the same function:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">stateCounter</span><span class="p">,</span> <span class="nx">setStateCounter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=></span> <span class="nx">setStateCounter</span><span class="p">(</span><span class="nx">stateCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">></span>update state counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
          <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">></span>
        update ref counter
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
      State counter value: <span class="si">{</span><span class="nx">stateCounter</span><span class="si">}</span>
      Ref counter value: <span class="si">{</span><span class="nx">ref</span><span class="p">.</span><span class="nx">curent</span><span class="si">}</span>
    <span class="p">&lt;/></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This will lead to an interesting effect: every time you click on the “update ref counter” button nothing visible happens. But if after that you click the “update state counter” button, the render output will be updated with both of the values. Play around with it in <a href="https://codesandbox.io/s/use-ref-intro-q0tmws?file=/src/App.tsx">the codesandbox.</a></p>

<p>Counter is obviously not the best use of refs. There is, however, a very interesting use case for them, that is even recommended in React docs themselves: to implement a hook usePrevious that returns <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">previous state or props</a>. Let’s implement it next!</p>

<h2>
  <a name="useprevious-hook-from-react-docs" href="#useprevious-hook-from-react-docs">
  </a>
  usePrevious hook from React docs
</h2>

<p>Before jumping into re-inventing the wheel, let’s see what <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">the docs</a> have to offer:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">usePrevious</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">();</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Seems simple enough. Now, before diving into how it actually works, let’s first try it out on a simple form.</p>

<p>We’ll have a settings page, where you need to type in your name and select a price for your future product. And at the bottom of the page, I’ll have a simple “show price change” component, that will show the current selected price, and whether this price increased or decreased compared to the previous value - this is where I’m going to use the <code>usePrevious</code> hook.</p>

<p>Let’s start with implementing the form with price only since it’s the most important part of our functionality.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">Page</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">price</span><span class="p">,</span> <span class="nx">setPrice</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onPriceChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=></span> <span class="nx">setPrice</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">select</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onPriceChange</span><span class="si">}</span><span class="p">></span>
        <span class="si">{</span><span class="nx">prices</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">price</span><span class="p">)</span> <span class="o">=></span> <span class="p">(&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span><span class="p">></span><span class="si">{</span><span class="nx">price</span><span class="si">}</span>$<span class="p">&lt;/</span><span class="nt">option</span><span class="p">>))</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">select</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">Price</span> <span class="na">price</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And the price component:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">price</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">prevPrice</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nx">prevPrice</span> <span class="o">&&</span> <span class="nx">prevPrice</span> <span class="o">&lt;</span> <span class="nx">price</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">😡</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">😊</span><span class="dl">'</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>
      Current price: <span class="si">{</span><span class="nx">price</span><span class="si">}</span>; <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/></span>
      Previous price: <span class="si">{</span><span class="nx">prevPrice</span><span class="si">}</span> <span class="si">{</span><span class="nx">icon</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Works like a charm, thank you React docs! See <a href="https://codesandbox.io/s/use-previous-hook-standard-only-price-jo61bm?file=/src/App.tsx">the codesandbox</a>.</p>

<p>Now the final small step: add the name input field to the form, to complete the functionality.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Page</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=></span> <span class="nx">setName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

  <span class="c1">// the rest of the code is the same</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="p">=</span><span class="s">"text"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="err">!--</span> <span class="na">the</span> <span class="na">rest</span> <span class="na">is</span> <span class="na">the</span> <span class="na">same</span> <span class="err">--</span><span class="p">></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  );
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Works like a charm as well? No! 🙀 When I’m selecting the price, everything works as before. But as soon as I start typing in the name input - the value in the <code>Price</code> component resets itself to the latest selected value, instead of the previous. See <a href="https://codesandbox.io/s/use-previous-hook-standard-0muql2?file=/src/App.tsx">the codesandbox</a>.</p>

<p>But why? 🤔</p>

<p>Now it’s time to take a closer look at the implementation of <code>usePrevious</code>, remember how ref behaves, and how React lifecycle and re-renders works.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">usePrevious</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">();</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>First, during the initial render of the <code>Price</code> component, we call our <code>usePrevious</code> hook. In there we create ref with an empty value. After that, we immediately return the value of the created ref, which in this case will be <code>null</code> (which is intentional, there isn't a previous value on the initial render). After the initial render finishes, <code>useEffect</code> is triggered, in which we update the <code>ref.current</code> with the value we passed to the hook. And, since it’s a ref, not state, the value just “sits” there mutated, without causing the hook to re-render itself and as a result without its consumer component getting the latest ref value.</p>

<p>If it’s difficult to imagine from the text, here is some visual aid:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Mx0hPC3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w6trl59cm86lddbff8qq.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Mx0hPC3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w6trl59cm86lddbff8qq.png" alt="Image description" loading="lazy" width="880" height="815"></a></p>

<p>So what happens then when I start typing in the name fields? The parent <code>Form</code> component updates its state → triggers re-renders of its children → <code>Price</code> component starts its re-render → calls <code>usePrevious</code> hook with the same price value (we changed only name) → hook returns the <em>updated</em> value that we mutated during the previous render cycle → render finishes, <code>useEffect</code> is triggered, done. On the pic before we’ll have values <code>300</code> transitioning to <code>300</code>. And that will cause the value rendered in the <code>Price</code> component to be updated.</p>

<p>So what this hook in its current implementation does, is it returns a value <strong>from the previous render cycle</strong>. There are, of course, use cases for using it that way. Maybe you just need to trigger some data fetch when the value changes, and what happens after multiple re-renders doesn’t really matter. But if you want to show the “previous” value in the UI anywhere, a much more reliable approach here would be for the hook to return the <em>actual</em> previous value.</p>

<p>Let’s implement exactly that.</p>

<h2>
  <a name="useprevious-hook-to-return-the-actual-previous-value" href="#useprevious-hook-to-return-the-actual-previous-value">
  </a>
  usePrevious hook to return the actual previous value
</h2>

<p>In order to do that, we just need to save in ref both values - previous and current. And switch them only when the value actually changes. And here again where ref could come in handy:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// initialise the ref with previous and current values</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">({</span>
    <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="na">prev</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

  <span class="c1">// if the value passed into hook doesn't match what we store as "current"</span>
  <span class="c1">// move the "current" to the "previous"</span>
  <span class="c1">// and store the passed value as "current"</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
      <span class="na">prev</span><span class="p">:</span> <span class="nx">current</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// return the previous value only</span>
  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Implementation even became slightly simpler: we got rid of the mind-boggling magic of relying on <code>useEffect</code> and just accept a value, do an if statement, and return a value. And no glitches in the UI anymore! Check it out in <a href="https://codesandbox.io/s/use-previous-hook-persistent-fgdd0o?file=/src/App.tsx">the codesandbox</a>.</p>

<p>Now, the big question: do we <em>really</em> need refs here? Can’t we just implement exactly the same thing with the state and not resort to escape hatches (which ref actually is)? Well, technically yes, we can, the code will be pretty much the same:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span>
    <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="na">prev</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setState</span><span class="p">({</span>
      <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
      <span class="na">prev</span><span class="p">:</span> <span class="nx">current</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>There is one problem with this: every time the value changes it will trigger state update, which in turn will trigger re-render of the “host” component. This will result in the <code>Price</code> component being re-rendered <strong>twice</strong> every time the price prop changes - the first time because of the actual prop change, and the second - because of the state update in the hook. Doesn’t really matter for our small form, but as a generic solution that is meant to be used anywhere - not a good idea. See <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-state-6i3vi3?file=/src/hooks.tsx">the code here</a>, change the price value to see the double re-render.</p>

<h2>
  <a name="useprevious-hook-deal-with-objects-properly" href="#useprevious-hook-deal-with-objects-properly">
  </a>
  usePrevious hook: deal with objects properly
</h2>

<p>Last polish to the hook left: what will happen if I try to pass an object there? For example all the props?<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// with the current implementation only primitive values are supported</span>
  <span class="kd">const</span> <span class="nx">prevProps</span> <span class="o">=</span> <span class="nx">usePreviousPersistent</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The glitch, unfortunately, <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-props-5xvixj">will return</a>: we’re doing the shallow comparison here: <code>(value !== current)</code>, so the <code>if</code> check will always return <code>true</code>. To fix this, we can just introduce the <a href="https://lodash.com/docs/4.17.15#isEqual">deep equality</a> comparison instead.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">import</span> <span class="nx">isEqual</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/isEqual</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Personally, I’m not a huge fan of this solution: on big data sets it can become slow, plus depending on an external library (or implementing deep equality by myself) in a hook like that seems less than optimal.</p>

<p>Another way, since hooks are just functions and can accept any arguments, is to introduce a “matcher” function. Something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">isEqualFunc</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isEqualFunc</span> <span class="p">?</span> <span class="o">!</span><span class="nx">isEqualFunc</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">:</span> <span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>That way we still can use the hook without the function - it will fallback to the shallow comparison. And also now have the ability to provide a way for the hook to compare the values:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">prevPrice</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span>
    <span class="nx">price</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=></span> <span class="nx">prev</span><span class="p">.</span><span class="nx">price</span> <span class="o">===</span> <span class="nx">current</span><span class="p">.</span><span class="nx">price</span>
  <span class="p">);</span>
  <span class="p">...</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>See the <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-matcher-hujqez?file=/src/hooks.tsx">codesandbox</a>.</p>

<p>It might not look that useful for props, but imagine a huge object of some data from external sources there. Typically it will have some sort of id. So instead of the slow deep comparison as in the example before, you can just do this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">prevData</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span><span class="nx">price</span><span class="p">,</span> <span class="p">(</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=></span> <span class="nx">prev</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">current</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>That is all for today. Hope you found the article useful, able to use refs more confidently and use both variations of <code>usePrevious</code> hooks with the full understanding of the expected result ✌🏼.</p>

<p>...</p>

<p>Originally published at <a href="https://www.developerway.com">https://www.developerway.com</a>. The website has more articles like this 😉</p>

<p><a href="https://www.developerway.com">Subscribe to the newsletter</a>, <a href="https://www.linkedin.com/in/adevnadia/">connect on LinkedIn</a> or <a href="https://twitter.com/adevnadia">follow on Twitter</a> to get notified as soon as the next article comes out.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/adevnadia/implementing-advanced-useprevious-hook-with-react-useref-185l" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,n,a,e){return e.type_of="article",e.id=1029598,e.title="Implementing advanced usePrevious hook with React useRef",e.description="After Context, ref is probably the most mysterious part of React. We almost got used to the ref...",e.readable_publish_date="Mar 21",e.slug="implementing-advanced-useprevious-hook-with-react-useref-185l",e.path="/adevnadia/implementing-advanced-useprevious-hook-with-react-useref-185l",e.url="https://dev.to/adevnadia/implementing-advanced-useprevious-hook-with-react-useref-185l",e.comments_count=3,e.public_reactions_count=9,e.collection_id=s,e.published_timestamp=n,e.positive_reactions_count=9,e.cover_image=s,e.social_image="https://dev.to/social_previews/article/1029598.png",e.canonical_url="https://www.developerway.com/posts/implementing-advanced-use-previous-hook",e.created_at=n,e.edited_at="2022-03-21T12:07:38Z",e.crossposted_at=s,e.published_at=n,e.last_comment_at="2022-03-28T12:18:28Z",e.reading_time_minutes=9,e.tag_list="javascript, webdev, react, tutorial",e.tags=["javascript","webdev","react","tutorial"],e.body_html='<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--eL33wDfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yet8usut4kqyyhxssjpy.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eL33wDfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yet8usut4kqyyhxssjpy.png" alt="Image description" loading="lazy" width="880" height="563"></a></p>\n\n<p>After Context, ref is probably the most mysterious part of React. We almost got used to the ref attribute on our components, but not everyone is aware, that its usage is not limited to passing it back and forth between components and attaching it to the DOM nodes. We actually can store data there! And even implement things like <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">usePrevious hook</a> to get the previous state or props or any other value.</p>\n\n<p>By the way, if you ever used that hook in the way that is written in React docs, have you investigated how it actually works? And what value it returns and why? The result might surprise you 😉</p>\n\n<p>So this is exactly what I want to do in this article: take a look at ref and how it works when it’s not attached to a DOM node; investigate how <code>usePrevious</code> works and show why it’s not always a good idea to use it as-is; implement a more advanced version of the hook as a bonus 🙂</p>\n\n<p>Ready to join in?</p>\n\n<h2>\n  <a name="first-of-all-what-is-ref" href="#first-of-all-what-is-ref">\n  </a>\n  First of all, what is ref?\n</h2>\n\n<p>Let’s remember some basics first, to understand it fully.</p>\n\n<p>Imagine you need to store and manipulate some data in a component. Normally, we have two options: either put it in a variable or in the state. In a variable you’d put something that needs to be re-calculated on every re-render, like any intermediate value that depends on a prop value:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">price</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">discount</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nx">price</span><span class="p">;</span>\n\n  <span class="k">return</span> <span class="p">&lt;&gt;</span>Discount: <span class="si">{</span><span class="nx">discount</span><span class="si">}</span><span class="p">&lt;/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Creating a new variable or changing that variable won’t cause <code>Form</code> component to re-render.</p>\n\n<p>In the state, we usually put values that need to be saved between re-renders, typically coming from users interacting with our UI:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">();</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">input</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Changing the state will cause the <code>Form</code> component to re-render itself.</p>\n\n<p>There is, however, a third, lesser-known option: ref. It merges the behaviour of those two: it’s essentially a variable that doesn’t cause components to re-render, but its value is preserved between re-renders.</p>\n\n<p>Let’s just implement a counter (I promise, it’s the first and the last counter example in this blog) to illustrate all those three behaviours.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">counter</span> <span class="o">=</span> <span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">);</span>\n  <span class="p">};</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">&gt;</span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n      Counter value: <span class="si">{</span><span class="nx">counter</span><span class="si">}</span>\n    <span class="p">&lt;/&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This is not going to work of course. In our <code>console.log</code> we’ll see the updated counter value, but the value rendered on the screen is not going to change - variables don’t cause re-renders, so our render output will never be updated.</p>\n\n<p>State, on the other hand, will work as expected: that’s exactly what state is for.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">counter</span><span class="p">,</span> <span class="nx">setCounter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">setCounter</span><span class="p">(</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>\n  <span class="p">};</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">&gt;</span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n      Counter value: <span class="si">{</span><span class="nx">counter</span><span class="si">}</span>\n    <span class="p">&lt;/&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now the interesting part: the same with ref.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// set ref\'s initial value, same as state</span>\n  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="c1">// ref.current is where our counter value is stored</span>\n    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n  <span class="p">};</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">&gt;</span>click to update counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n      Counter value: <span class="si">{</span><span class="nx">ref</span><span class="p">.</span><span class="nx">curent</span><span class="si">}</span>\n    <span class="p">&lt;/&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This is also not going to work. <em>Almost</em>. With every click on the button the value in the ref changes, but changing ref value <strong>doesn’t cause re-render</strong>, so the render output again is not updated. But! If something else causes a render cycle after that, render output will be updated with the latest value from the <code>ref.current</code>. For example, if I add both of the counters to the same function:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">stateCounter</span><span class="p">,</span> <span class="nx">setStateCounter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setStateCounter</span><span class="p">(</span><span class="nx">stateCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>update state counter<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span>\n        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span><span class="si">}</span>\n      <span class="p">&gt;</span>\n        update ref counter\n      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n      State counter value: <span class="si">{</span><span class="nx">stateCounter</span><span class="si">}</span>\n      Ref counter value: <span class="si">{</span><span class="nx">ref</span><span class="p">.</span><span class="nx">curent</span><span class="si">}</span>\n    <span class="p">&lt;/&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This will lead to an interesting effect: every time you click on the “update ref counter” button nothing visible happens. But if after that you click the “update state counter” button, the render output will be updated with both of the values. Play around with it in <a href="https://codesandbox.io/s/use-ref-intro-q0tmws?file=/src/App.tsx">the codesandbox.</a></p>\n\n<p>Counter is obviously not the best use of refs. There is, however, a very interesting use case for them, that is even recommended in React docs themselves: to implement a hook usePrevious that returns <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">previous state or props</a>. Let’s implement it next!</p>\n\n<h2>\n  <a name="useprevious-hook-from-react-docs" href="#useprevious-hook-from-react-docs">\n  </a>\n  usePrevious hook from React docs\n</h2>\n\n<p>Before jumping into re-inventing the wheel, let’s see what <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">the docs</a> have to offer:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">usePrevious</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">();</span>\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>\n  <span class="p">});</span>\n  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Seems simple enough. Now, before diving into how it actually works, let’s first try it out on a simple form.</p>\n\n<p>We’ll have a settings page, where you need to type in your name and select a price for your future product. And at the bottom of the page, I’ll have a simple “show price change” component, that will show the current selected price, and whether this price increased or decreased compared to the previous value - this is where I’m going to use the <code>usePrevious</code> hook.</p>\n\n<p>Let’s start with implementing the form with price only since it’s the most important part of our functionality.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">];</span>\n\n<span class="kd">const</span> <span class="nx">Page</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">price</span><span class="p">,</span> <span class="nx">setPrice</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">onPriceChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setPrice</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">select</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onPriceChange</span><span class="si">}</span><span class="p">&gt;</span>\n        <span class="si">{</span><span class="nx">prices</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">price</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span>$<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;))</span><span class="si">}</span>\n      <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">Price</span> <span class="na">price</span><span class="p">=</span><span class="si">{</span><span class="nx">price</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And the price component:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">price</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">prevPrice</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>\n  <span class="kd">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nx">prevPrice</span> <span class="o">&amp;&amp;</span> <span class="nx">prevPrice</span> <span class="o">&lt;</span> <span class="nx">price</span> <span class="p">?</span> <span class="dl">\'</span><span class="s1">😡</span><span class="dl">\'</span> <span class="p">:</span> <span class="dl">\'</span><span class="s1">😊</span><span class="dl">\'</span><span class="p">;</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>\n      Current price: <span class="si">{</span><span class="nx">price</span><span class="si">}</span>; <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>\n      Previous price: <span class="si">{</span><span class="nx">prevPrice</span><span class="si">}</span> <span class="si">{</span><span class="nx">icon</span><span class="si">}</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Works like a charm, thank you React docs! See <a href="https://codesandbox.io/s/use-previous-hook-standard-only-price-jo61bm?file=/src/App.tsx">the codesandbox</a>.</p>\n\n<p>Now the final small step: add the name input field to the form, to complete the functionality.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Page</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>\n\n  <span class="c1">// the rest of the code is the same</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="p">=</span><span class="s">"text"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="err">!--</span> <span class="na">the</span> <span class="na">rest</span> <span class="na">is</span> <span class="na">the</span> <span class="na">same</span> <span class="err">--</span><span class="p">&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  );\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Works like a charm as well? No! 🙀 When I’m selecting the price, everything works as before. But as soon as I start typing in the name input - the value in the <code>Price</code> component resets itself to the latest selected value, instead of the previous. See <a href="https://codesandbox.io/s/use-previous-hook-standard-0muql2?file=/src/App.tsx">the codesandbox</a>.</p>\n\n<p>But why? 🤔</p>\n\n<p>Now it’s time to take a closer look at the implementation of <code>usePrevious</code>, remember how ref behaves, and how React lifecycle and re-renders works.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">usePrevious</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">();</span>\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>\n  <span class="p">});</span>\n  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>First, during the initial render of the <code>Price</code> component, we call our <code>usePrevious</code> hook. In there we create ref with an empty value. After that, we immediately return the value of the created ref, which in this case will be <code>null</code> (which is intentional, there isn\'t a previous value on the initial render). After the initial render finishes, <code>useEffect</code> is triggered, in which we update the <code>ref.current</code> with the value we passed to the hook. And, since it’s a ref, not state, the value just “sits” there mutated, without causing the hook to re-render itself and as a result without its consumer component getting the latest ref value.</p>\n\n<p>If it’s difficult to imagine from the text, here is some visual aid:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Mx0hPC3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w6trl59cm86lddbff8qq.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Mx0hPC3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w6trl59cm86lddbff8qq.png" alt="Image description" loading="lazy" width="880" height="815"></a></p>\n\n<p>So what happens then when I start typing in the name fields? The parent <code>Form</code> component updates its state → triggers re-renders of its children → <code>Price</code> component starts its re-render → calls <code>usePrevious</code> hook with the same price value (we changed only name) → hook returns the <em>updated</em> value that we mutated during the previous render cycle → render finishes, <code>useEffect</code> is triggered, done. On the pic before we’ll have values <code>300</code> transitioning to <code>300</code>. And that will cause the value rendered in the <code>Price</code> component to be updated.</p>\n\n<p>So what this hook in its current implementation does, is it returns a value <strong>from the previous render cycle</strong>. There are, of course, use cases for using it that way. Maybe you just need to trigger some data fetch when the value changes, and what happens after multiple re-renders doesn’t really matter. But if you want to show the “previous” value in the UI anywhere, a much more reliable approach here would be for the hook to return the <em>actual</em> previous value.</p>\n\n<p>Let’s implement exactly that.</p>\n\n<h2>\n  <a name="useprevious-hook-to-return-the-actual-previous-value" href="#useprevious-hook-to-return-the-actual-previous-value">\n  </a>\n  usePrevious hook to return the actual previous value\n</h2>\n\n<p>In order to do that, we just need to save in ref both values - previous and current. And switch them only when the value actually changes. And here again where ref could come in handy:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// initialise the ref with previous and current values</span>\n  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">({</span>\n    <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>\n    <span class="na">prev</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>\n  <span class="p">});</span>\n\n  <span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>\n\n  <span class="c1">// if the value passed into hook doesn\'t match what we store as "current"</span>\n  <span class="c1">// move the "current" to the "previous"</span>\n  <span class="c1">// and store the passed value as "current"</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>\n      <span class="na">prev</span><span class="p">:</span> <span class="nx">current</span><span class="p">,</span>\n    <span class="p">};</span>\n  <span class="p">}</span>\n\n  <span class="c1">// return the previous value only</span>\n  <span class="k">return</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Implementation even became slightly simpler: we got rid of the mind-boggling magic of relying on <code>useEffect</code> and just accept a value, do an if statement, and return a value. And no glitches in the UI anymore! Check it out in <a href="https://codesandbox.io/s/use-previous-hook-persistent-fgdd0o?file=/src/App.tsx">the codesandbox</a>.</p>\n\n<p>Now, the big question: do we <em>really</em> need refs here? Can’t we just implement exactly the same thing with the state and not resort to escape hatches (which ref actually is)? Well, technically yes, we can, the code will be pretty much the same:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span>\n    <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>\n    <span class="na">prev</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>\n  <span class="p">});</span>\n\n  <span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">setState</span><span class="p">({</span>\n      <span class="na">value</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>\n      <span class="na">prev</span><span class="p">:</span> <span class="nx">current</span><span class="p">,</span>\n    <span class="p">});</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>There is one problem with this: every time the value changes it will trigger state update, which in turn will trigger re-render of the “host” component. This will result in the <code>Price</code> component being re-rendered <strong>twice</strong> every time the price prop changes - the first time because of the actual prop change, and the second - because of the state update in the hook. Doesn’t really matter for our small form, but as a generic solution that is meant to be used anywhere - not a good idea. See <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-state-6i3vi3?file=/src/hooks.tsx">the code here</a>, change the price value to see the double re-render.</p>\n\n<h2>\n  <a name="useprevious-hook-deal-with-objects-properly" href="#useprevious-hook-deal-with-objects-properly">\n  </a>\n  usePrevious hook: deal with objects properly\n</h2>\n\n<p>Last polish to the hook left: what will happen if I try to pass an object there? For example all the props?<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// with the current implementation only primitive values are supported</span>\n  <span class="kd">const</span> <span class="nx">prevProps</span> <span class="o">=</span> <span class="nx">usePreviousPersistent</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>\n  <span class="p">...</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The glitch, unfortunately, <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-props-5xvixj">will return</a>: we’re doing the shallow comparison here: <code>(value !== current)</code>, so the <code>if</code> check will always return <code>true</code>. To fix this, we can just introduce the <a href="https://lodash.com/docs/4.17.15#isEqual">deep equality</a> comparison instead.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">import</span> <span class="nx">isEqual</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">lodash/isEqual</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">))</span> <span class="p">{</span>\n    <span class="p">...</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Personally, I’m not a huge fan of this solution: on big data sets it can become slow, plus depending on an external library (or implementing deep equality by myself) in a hook like that seems less than optimal.</p>\n\n<p>Another way, since hooks are just functions and can accept any arguments, is to introduce a “matcher” function. Something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">usePreviousPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">isEqualFunc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">isEqualFunc</span> <span class="p">?</span> <span class="o">!</span><span class="nx">isEqualFunc</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">:</span> <span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>\n    <span class="p">...</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>That way we still can use the hook without the function - it will fallback to the shallow comparison. And also now have the ability to provide a way for the hook to compare the values:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">Price</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">prevPrice</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span>\n    <span class="nx">price</span><span class="p">,</span>\n    <span class="p">(</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prev</span><span class="p">.</span><span class="nx">price</span> <span class="o">===</span> <span class="nx">current</span><span class="p">.</span><span class="nx">price</span>\n  <span class="p">);</span>\n  <span class="p">...</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>See the <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-matcher-hujqez?file=/src/hooks.tsx">codesandbox</a>.</p>\n\n<p>It might not look that useful for props, but imagine a huge object of some data from external sources there. Typically it will have some sort of id. So instead of the slow deep comparison as in the example before, you can just do this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">prevData</span> <span class="o">=</span> <span class="nx">usePrevious</span><span class="p">(</span><span class="nx">price</span><span class="p">,</span> <span class="p">(</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prev</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">current</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>That is all for today. Hope you found the article useful, able to use refs more confidently and use both variations of <code>usePrevious</code> hooks with the full understanding of the expected result ✌🏼.</p>\n\n<p>...</p>\n\n<p>Originally published at <a href="https://www.developerway.com">https://www.developerway.com</a>. The website has more articles like this 😉</p>\n\n<p><a href="https://www.developerway.com">Subscribe to the newsletter</a>, <a href="https://www.linkedin.com/in/adevnadia/">connect on LinkedIn</a> or <a href="https://twitter.com/adevnadia">follow on Twitter</a> to get notified as soon as the next article comes out.</p>\n\n',e.body_markdown='\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yet8usut4kqyyhxssjpy.png)\n\nAfter Context, ref is probably the most mysterious part of React. We almost got used to the ref attribute on our components, but not everyone is aware, that its usage is not limited to passing it back and forth between components and attaching it to the DOM nodes. We actually can store data there! And even implement things like <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">usePrevious hook</a> to get the previous state or props or any other value.\n\nBy the way, if you ever used that hook in the way that is written in React docs, have you investigated how it actually works? And what value it returns and why? The result might surprise you 😉\n\nSo this is exactly what I want to do in this article: take a look at ref and how it works when it’s not attached to a DOM node; investigate how `usePrevious` works and show why it’s not always a good idea to use it as-is; implement a more advanced version of the hook as a bonus 🙂\n\nReady to join in?\n\n## First of all, what is ref?\n\nLet’s remember some basics first, to understand it fully.\n\nImagine you need to store and manipulate some data in a component. Normally, we have two options: either put it in a variable or in the state. In a variable you’d put something that needs to be re-calculated on every re-render, like any intermediate value that depends on a prop value:\n\n```tsx\nconst Form = ({ price }) => {\n  const discount = 0.1 * price;\n\n  return <>Discount: {discount}</>;\n};\n```\n\nCreating a new variable or changing that variable won’t cause `Form` component to re-render.\n\nIn the state, we usually put values that need to be saved between re-renders, typically coming from users interacting with our UI:\n\n```tsx\nconst Form = () => {\n  const [name, setName] = useState();\n\n  return <input value={name} onChange={(e) => setName(e.target.value)} />;\n};\n```\n\nChanging the state will cause the `Form` component to re-render itself.\n\nThere is, however, a third, lesser-known option: ref. It merges the behaviour of those two: it’s essentially a variable that doesn’t cause components to re-render, but its value is preserved between re-renders.\n\nLet’s just implement a counter (I promise, it’s the first and the last counter example in this blog) to illustrate all those three behaviours.\n\n```tsx\nconst Counter = () => {\n  let counter = 0;\n\n  const onClick = () => {\n    counter = counter + 1;\n    console.log(counter);\n  };\n\n  return (\n    <>\n      <button onClick={onClick}>click to update counter</button>\n      Counter value: {counter}\n    </>\n  );\n};\n```\n\nThis is not going to work of course. In our `console.log` we’ll see the updated counter value, but the value rendered on the screen is not going to change - variables don’t cause re-renders, so our render output will never be updated.\n\nState, on the other hand, will work as expected: that’s exactly what state is for.\n\n```tsx\nconst Counter = () => {\n  const [counter, setCounter] = useState(0);\n\n  const onClick = () => {\n    setCounter(counter + 1);\n  };\n\n  return (\n    <>\n      <button onClick={onClick}>click to update counter</button>\n      Counter value: {counter}\n    </>\n  );\n};\n```\n\nNow the interesting part: the same with ref.\n\n```tsx\nconst Counter = () => {\n  // set ref\'s initial value, same as state\n  const ref = useRef(0);\n\n  const onClick = () => {\n    // ref.current is where our counter value is stored\n    ref.current = ref.current + 1;\n  };\n\n  return (\n    <>\n      <button onClick={onClick}>click to update counter</button>\n      Counter value: {ref.curent}\n    </>\n  );\n};\n```\n\nThis is also not going to work. _Almost_. With every click on the button the value in the ref changes, but changing ref value **doesn’t cause re-render**, so the render output again is not updated. But! If something else causes a render cycle after that, render output will be updated with the latest value from the `ref.current`. For example, if I add both of the counters to the same function:\n\n```tsx\nconst Counter = () => {\n  const ref = useRef(0);\n  const [stateCounter, setStateCounter] = useState(0);\n\n  return (\n    <>\n      <button onClick={() => setStateCounter(stateCounter + 1)}>update state counter</button>\n      <button\n        onClick={() => {\n          ref.current = ref.current + 1;\n        }}\n      >\n        update ref counter\n      </button>\n      State counter value: {stateCounter}\n      Ref counter value: {ref.curent}\n    </>\n  );\n};\n```\n\nThis will lead to an interesting effect: every time you click on the “update ref counter” button nothing visible happens. But if after that you click the “update state counter” button, the render output will be updated with both of the values. Play around with it in <a href="https://codesandbox.io/s/use-ref-intro-q0tmws?file=/src/App.tsx">the codesandbox.</a>\n\nCounter is obviously not the best use of refs. There is, however, a very interesting use case for them, that is even recommended in React docs themselves: to implement a hook usePrevious that returns <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">previous state or props</a>. Let’s implement it next!\n\n## usePrevious hook from React docs\n\nBefore jumping into re-inventing the wheel, let’s see what <a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state">the docs</a> have to offer:\n\n```tsx\nconst usePrevious = (value) => {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n};\n```\n\nSeems simple enough. Now, before diving into how it actually works, let’s first try it out on a simple form.\n\nWe’ll have a settings page, where you need to type in your name and select a price for your future product. And at the bottom of the page, I’ll have a simple “show price change” component, that will show the current selected price, and whether this price increased or decreased compared to the previous value - this is where I’m going to use the `usePrevious` hook.\n\nLet’s start with implementing the form with price only since it’s the most important part of our functionality.\n\n```tsx\nconst prices = [100, 200, 300, 400, 500, 600, 700];\n\nconst Page = () => {\n  const [price, setPrice] = useState(100);\n\n  const onPriceChange = (e) => setPrice(Number(e.target.value));\n\n  return (\n    <>\n      <select value={price} onChange={onPriceChange}>\n        {prices.map((price) => (<option value={price}>{price}$</option>))}\n      </select>\n      <Price price={price} />\n    </div>\n  );\n}\n```\n\nAnd the price component:\n\n```tsx\nexport const Price = ({ price }) => {\n  const prevPrice = usePrevious(price);\n  const icon = prevPrice && prevPrice < price ? \'😡\' : \'😊\';\n\n  return (\n    <div>\n      Current price: {price}; <br />\n      Previous price: {prevPrice} {icon}\n    </div>\n  );\n};\n```\n\nWorks like a charm, thank you React docs! See <a href="https://codesandbox.io/s/use-previous-hook-standard-only-price-jo61bm?file=/src/App.tsx">the codesandbox</a>.\n\nNow the final small step: add the name input field to the form, to complete the functionality.\n\n```tsx\nconst Page = () => {\n  const [name, setName] = useState("");\n\n  const onNameChange = (e) => setName(e.target.value);\n\n  // the rest of the code is the same\n\n  return (\n    <>\n      <input type="text" value={name} onChange={onNameChange} />\n      \x3c!-- the rest is the same --\x3e\n    </div>\n  );\n}\n```\n\nWorks like a charm as well? No! 🙀 When I’m selecting the price, everything works as before. But as soon as I start typing in the name input - the value in the `Price` component resets itself to the latest selected value, instead of the previous. See <a href="https://codesandbox.io/s/use-previous-hook-standard-0muql2?file=/src/App.tsx">the codesandbox</a>.\n\nBut why? 🤔\n\nNow it’s time to take a closer look at the implementation of `usePrevious`, remember how ref behaves, and how React lifecycle and re-renders works.\n\n```tsx\nconst usePrevious = (value) => {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n};\n```\n\nFirst, during the initial render of the `Price` component, we call our `usePrevious` hook. In there we create ref with an empty value. After that, we immediately return the value of the created ref, which in this case will be `null` (which is intentional, there isn\'t a previous value on the initial render). After the initial render finishes, `useEffect` is triggered, in which we update the `ref.current` with the value we passed to the hook. And, since it’s a ref, not state, the value just “sits” there mutated, without causing the hook to re-render itself and as a result without its consumer component getting the latest ref value.\n\nIf it’s difficult to imagine from the text, here is some visual aid:\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w6trl59cm86lddbff8qq.png)\n\nSo what happens then when I start typing in the name fields? The parent `Form` component updates its state → triggers re-renders of its children → `Price` component starts its re-render → calls `usePrevious` hook with the same price value (we changed only name) → hook returns the _updated_ value that we mutated during the previous render cycle → render finishes, `useEffect` is triggered, done. On the pic before we’ll have values `300` transitioning to `300`. And that will cause the value rendered in the `Price` component to be updated.\n\nSo what this hook in its current implementation does, is it returns a value **from the previous render cycle**. There are, of course, use cases for using it that way. Maybe you just need to trigger some data fetch when the value changes, and what happens after multiple re-renders doesn’t really matter. But if you want to show the “previous” value in the UI anywhere, a much more reliable approach here would be for the hook to return the _actual_ previous value.\n\nLet’s implement exactly that.\n\n## usePrevious hook to return the actual previous value\n\nIn order to do that, we just need to save in ref both values - previous and current. And switch them only when the value actually changes. And here again where ref could come in handy:\n\n```tsx\nexport const usePreviousPersistent = (value) => {\n  // initialise the ref with previous and current values\n  const ref = useRef({\n    value: value,\n    prev: null,\n  });\n\n  const current = ref.current.value;\n\n  // if the value passed into hook doesn\'t match what we store as "current"\n  // move the "current" to the "previous"\n  // and store the passed value as "current"\n  if (value !== current) {\n    ref.current = {\n      value: value,\n      prev: current,\n    };\n  }\n\n  // return the previous value only\n  return ref.current.prev;\n};\n```\n\nImplementation even became slightly simpler: we got rid of the mind-boggling magic of relying on `useEffect` and just accept a value, do an if statement, and return a value. And no glitches in the UI anymore! Check it out in <a href="https://codesandbox.io/s/use-previous-hook-persistent-fgdd0o?file=/src/App.tsx">the codesandbox</a>.\n\nNow, the big question: do we _really_ need refs here? Can’t we just implement exactly the same thing with the state and not resort to escape hatches (which ref actually is)? Well, technically yes, we can, the code will be pretty much the same:\n\n```tsx\nexport const usePreviousPersistent = (value) => {\n  const [state, setState] = useState({\n    value: value,\n    prev: null,\n  });\n\n  const current = state.value;\n\n  if (value !== current) {\n    setState({\n      value: value,\n      prev: current,\n    });\n  }\n\n  return state.prev;\n};\n```\n\nThere is one problem with this: every time the value changes it will trigger state update, which in turn will trigger re-render of the “host” component. This will result in the `Price` component being re-rendered **twice** every time the price prop changes - the first time because of the actual prop change, and the second - because of the state update in the hook. Doesn’t really matter for our small form, but as a generic solution that is meant to be used anywhere - not a good idea. See <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-state-6i3vi3?file=/src/hooks.tsx">the code here</a>, change the price value to see the double re-render.\n\n## usePrevious hook: deal with objects properly\n\nLast polish to the hook left: what will happen if I try to pass an object there? For example all the props?\n\n```tsx\nexport const Price = (props) => {\n  // with the current implementation only primitive values are supported\n  const prevProps = usePreviousPersistent(props);\n  ...\n};\n```\n\nThe glitch, unfortunately, <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-props-5xvixj">will return</a>: we’re doing the shallow comparison here: `(value !== current)`, so the `if` check will always return `true`. To fix this, we can just introduce the <a href="https://lodash.com/docs/4.17.15#isEqual">deep equality</a> comparison instead.\n\n```tsx\nimport isEqual from \'lodash/isEqual\';\n\nexport const usePreviousPersistent = (value) => {\n  ...\n  if (!isEqual(value, current)) {\n    ...\n  }\n\n  return state.prev;\n};\n```\n\nPersonally, I’m not a huge fan of this solution: on big data sets it can become slow, plus depending on an external library (or implementing deep equality by myself) in a hook like that seems less than optimal.\n\nAnother way, since hooks are just functions and can accept any arguments, is to introduce a “matcher” function. Something like this:\n\n```tsx\nexport const usePreviousPersistent = (value, isEqualFunc) => {\n  ...\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\n    ...\n  }\n\n  return state.prev;\n};\n```\n\nThat way we still can use the hook without the function - it will fallback to the shallow comparison. And also now have the ability to provide a way for the hook to compare the values:\n\n```tsx\nexport const Price = (props) => {\n  const prevPrice = usePrevious(\n    price,\n    (prev, current) => prev.price === current.price\n  );\n  ...\n};\n```\n\nSee the <a href="https://codesandbox.io/s/use-previous-hook-persistent-with-matcher-hujqez?file=/src/hooks.tsx">codesandbox</a>.\n\nIt might not look that useful for props, but imagine a huge object of some data from external sources there. Typically it will have some sort of id. So instead of the slow deep comparison as in the example before, you can just do this:\n\n```tsx\nconst prevData = usePrevious(price, (prev, current) => prev.id === current.id);\n```\n\nThat is all for today. Hope you found the article useful, able to use refs more confidently and use both variations of `usePrevious` hooks with the full understanding of the expected result ✌🏼.\n\n...\n\nOriginally published at [https://www.developerway.com](https://www.developerway.com). The website has more articles like this 😉\n\n[Subscribe to the newsletter](https://www.developerway.com), [connect on LinkedIn](https://www.linkedin.com/in/adevnadia/) or [follow on Twitter](https://twitter.com/adevnadia) to get notified as soon as the next article comes out.\n',e.user={name:"Nadia Makarevich",username:a,twitter_username:a,github_username:a,website_url:"https://www.developerway.com",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--JnKvtJkQ--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/762035/1f7fe6e4-1e60-4c01-80cc-532142263682.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--j3FZXwJO--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/762035/1f7fe6e4-1e60-4c01-80cc-532142263682.jpg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:e}},error:s,state:{currentArticle:e},serverRendered:!0,routePath:"/adevnadia/1029598",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"2022-03-21T11:58:09Z","adevnadia",{})</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
