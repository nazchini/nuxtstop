<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>How to write performant React apps with Context</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>How to write performant React apps with Context</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/javascript" class="tag" data-v-70afb46a>
          #javascript
        </a><a href="/nuxtstop/t/webdev" class="tag" data-v-70afb46a>
          #webdev
        </a><a href="/nuxtstop/t/react" class="tag" data-v-70afb46a>
          #react
        </a><a href="/nuxtstop/t/performance" class="tag" data-v-70afb46a>
          #performance
        </a></div> <!----> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            125
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            9
          </span></div> <time data-v-70afb46a>Feb 7</time></div></header> <div class="content" data-v-70afb46a><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Ld_VANeu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g0swfc2sdhxd2lcrtv09.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Ld_VANeu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g0swfc2sdhxd2lcrtv09.png" alt="Image description" loading="lazy" width="880" height="563"></a></p>

<p>It‚Äôs impossible to have a conversation on <a href="https://www.developerway.com/posts/how-to-write-performant-react-code">how to write performant React code</a> without having an article or two on Context. And it‚Äôs such a controversial topic! There are so many prejudices and rumours surrounding it. Context is evil! React re-renders everything for no reason when you use Context! Sometimes I have a feeling that developers treat Context like it‚Äôs a magic gremlin, that randomly and spontaneously re-renders the entire app for its own amusement.</p>

<p>In this article I do not intend to convince anyone that we should ditch our beloved state management libraries in favour of Context. They exist for a reason. The main goal here is to de-mystify Context and provide a few interesting coding patterns, that could help minimise Context-related re-renders and improve your React apps performance. And as a nice bonus, the code will look cleaner and more understandable as a result.</p>

<p>Let‚Äôs start the investigation with implementing some real-life app, and see where this will take us.</p>

<h2>
  <a name="lets-implement-a-form-in-react" href="#lets-implement-a-form-in-react">
  </a>
  Let‚Äôs implement a form in React
</h2>

<p>Our form is going to be quite complicated, it would consist, to begin with, from:</p>

<ul>
<li>a ‚ÄúPersonal info‚Äú section, where people can set some personal information, i.e name, email, etc</li>
<li>a ‚ÄúValue calculation‚Äú section where people can set their currency preferences, their preferred discount, add some coupons, etc</li>
<li>the selected discount should be highlighted in the Personal section in a form of an emoji (don‚Äôt ask, the designer has a weird sense of humour)</li>
<li>an ‚ÄúActions‚Äù section with action buttons (i.e. ‚ÄúSave‚Äù, ‚ÄúReset‚Äù, etc)</li>
</ul>

<p>The ‚Äúdesign‚Äù looks like this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--nBArMm2S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s8z7z29pvg37pb8f4kvm.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nBArMm2S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s8z7z29pvg37pb8f4kvm.png" alt="Image description" loading="lazy" width="880" height="650"></a></p>

<p>To make things more interesting, we‚Äôre also going to pretend that ‚Äúselect country‚Äù and ‚Äúdragging bar‚Äù components are ‚Äúexternal‚Äù libraries that we installed as a package. So we can only use them through API, but have no influence on what‚Äôs inside. And we‚Äôre going to use the ‚Äúslow‚Äù version of the countries select, that we implemented in the <a href="https://www.developerway.com/posts/how-to-write-performant-react-code">previous performance investigation</a>.</p>

<p>Now it‚Äôs time to write some code. Let‚Äôs start with the components structure of the app. I know this form will quickly become quite complicated, so I want to separate it into smaller, more contained components right away.</p>

<p>At the root I‚Äôll have my main <code>Form</code> component, which will render the three required sections:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;></span>
      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="p">/></span>
    <span class="p">&lt;/></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>‚ÄúPersonal info‚Äù section will then render three more components: the discount emoji, input for the name and countries select<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">PersonalInfoSection</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Personal information"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">DiscountSituation</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">NameFormComponent</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">SelectCountryFormComponent</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>All three of them will contain the actual logic of those components (the code of them will be below), and the <code>Section</code> just encapsulates some styles.</p>

<p>‚ÄúValue calculation‚Äù section will have just one component (for now), the discount bar:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">ValueCalculationSection</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Value calculation"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">DiscountFormComponent</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And ‚ÄúActions‚Äù section will have just one button for now as well: the save button with onSave callback.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">ActionsSection</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onSave</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=></span> <span class="k">void</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Actions"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">></span>Save form<span class="p">&lt;/</span><span class="nt">button</span><span class="p">></span>
    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now the interesting part: we need to make this form interactive. Considering that we have a single ‚ÄúSave‚Äù button for the entire form, and different sections would need data from other sections, the natural place for the state management is at the root, in the <code>Form</code> component. We‚Äôll have 3 pieces of data there: Name, Country and Discount, a way to set all three of them, and a way to ‚Äúsave‚Äù it:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>
  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">></span><span class="p">(</span><span class="nx">defaultState</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="c1">// send the request to the backend here</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="c1">// the rest as before</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And now we need to pass the relevant data and callbacks to the components that need it. In our <code>PersonalInfoSection</code>:</p>

<ul>
<li>the <code>DiscountSituation</code> component should be able to show the emoji based on <code>discount</code> value.</li>
<li>the <code>NameFormComponent</code> should be able to control <code>name</code> value</li>
<li>the <code>SelectCountryFormComponent</code> should be able to set the selected <code>country</code>
</li>
</ul>

<p>Considering that those components are not rendered in <code>Form</code> directly, but are children of <code>PersonalInfoSection</code>, time to do some prop drilling üòä</p>

<p><code>DiscountSituation</code> will accept <code>discount</code> as a prop:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">DiscountSituation</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">discount</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// some code to calculate the situation based on discount</span>
  <span class="kd">const</span> <span class="nx">discountSituation</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>Your discount situation: <span class="si">{</span><span class="nx">discountSituation</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><code>NameFormComponent</code> will accept <code>name</code> and <code>onChange</code> callback:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">NameFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onChange</span><span class="p">,</span> <span class="nx">name</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span> <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>
      Type your name here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=></span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><code>SelectCountryFormComponent</code> will accept <code>onChange</code> callback:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onChange</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And our <code>PersonalInfoSection</code> would have to pass all of them from its parent <code>Form</code> component to its children:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">PersonalInfoSection</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">onNameChange</span><span class="p">,</span>
  <span class="nx">onCountryChange</span><span class="p">,</span>
  <span class="nx">discount</span><span class="p">,</span>
  <span class="nx">name</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Personal information"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">DiscountSituation</span> <span class="na">discount</span><span class="p">=</span><span class="si">{</span><span class="nx">discount</span><span class="si">}</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">NameFormComponent</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="na">name</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">SelectCountryFormComponent</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And the same story with <code>ValueCalculationSection</code>: it needs to pass <code>onDiscountChange</code> and <code>discount</code> value from <code>Form</code> component to its child:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">ValueCalculationsSection</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onDiscountChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">ValueCalculationsSection render</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Value calculation"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">DiscountFormComponent</span> <span class="na">onDiscountChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onDiscountChange</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And the <code>DiscountFormComponent</code> just uses the ‚Äúexternal‚Äù library <code>DraggingBar</code> to render the bar and catch the changes via the callback it gives:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">DiscountFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onDiscountChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">DiscountFormComponent render</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>
      Please select your discount here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">DraggingBar</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="nx">onDiscountChange</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And, the render of our <code>Form</code> component would look like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="na">onNameChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="na">onCountryChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">discount</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="si">}</span> <span class="na">name</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="na">onDiscountChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onDiscountChange</span><span class="si">}</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="na">onSave</span><span class="p">=</span><span class="si">{</span><span class="nx">onSave</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Quite a bit of code, but finally done üòÖ Want to take a look at the result? <a href="https://codesandbox.io/s/form-initial-implementation-uxw8v?file=/src/App.tsx">See the codesandbox.</a></p>

<p>Unfortunately, the result is much worst than you‚Äôd expect from a composition of a few components and a simple state üòï Try to type your name in the input, or drag the blue bar - both of them are lagging even on a fast laptop. With CPU throttling they are basically unusable. So, what happened?</p>

<h3>
  <a name="the-form-performance-investigation" href="#the-form-performance-investigation">
  </a>
  The form performance investigation
</h3>

<p>First of all, let‚Äôs take a look at the console output there. If I type a single key in the <code>Name</code> input, I‚Äôll see:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Form render
PersonalInfoSection render
Section render
Discount situation render
NameFormComponent render
SelectCountryFormComponent render
ValueCalculationsSection render
Section render
DiscountFormComponent render
ActionsSection render
Section render
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Every single component in our form re-renders on every keystroke! And the same situation is with the dragging - on every mouse move the entire form and all its components re-renders themselves. And we already know, that our <code>SelectCountryFormComponent</code> is very slow, and there is nothing we can do with its performance. So the only thing that we can do here, is to make sure it doesn‚Äôt re-render on every keypress or mouse move.</p>

<p>And, as we know, components will re-render when:</p>

<ul>
<li>state of a component changed</li>
<li>parent component re-renders</li>
</ul>

<p>And this is exactly what is happening here: when the value in an input changes, we propagate this value up to the root <code>Form</code> component through our chain of callbacks, where we change the root state, which triggers re-render of the <code>Form</code> component, which then cascades down to every child and child of a child of this component (i.e. all of them).</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--PIqsj0FU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hwv1xauvlekjdcz5xet5.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--PIqsj0FU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hwv1xauvlekjdcz5xet5.png" alt="Image description" loading="lazy" width="880" height="690"></a></p>

<p>To fix it, we could, of course, sprinkle some <code>useMemo</code> and <code>useCallback</code> in strategic places and call it a day. But that just brushes the problem under the rug, not actually solving it. When in the future we introduce another slow component, the story will repeat itself. Not to mention that it will make the code much more complicated and harder to maintain. In the ideal world, when I type something in the <code>Name</code> component, I want only the <code>NameFormComponent</code> and components that actually use the <code>name</code> value to re-render, the rest should just sit idle there and wait for their turn to be interactive.</p>

<p>And React actually gives us a perfect tool to do that - <code>Context</code>!</p>

<h2>
  <a name="adding-context-to-the-form" href="#adding-context-to-the-form">
  </a>
  Adding Context to the form
</h2>

<p>As per <a href="https://reactjs.org/docs/context.html">React docs</a>, context provides a way to pass data through the component tree without having to pass props down manually at every level. If, for example, we extract our Form state into Context, we can get rid of all the props we‚Äôve been passing through intermediate sections like <code>PersonalInfoSection</code> and use state directly in the <code>NameFormComponent</code> and <code>DiscountFormComponent</code>. The data flow then would look something like this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qiwlhi9U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kor40ni5vn1d477pom81.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qiwlhi9U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kor40ni5vn1d477pom81.png" alt="Image description" loading="lazy" width="880" height="668"></a></p>

<p>To achieve this, first we‚Äôre creating the <code>Context</code> itself, which will have our state and the API to manage this state (i.e. our callbacks):<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>
  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">Context</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">;</span>
  <span class="nl">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="na">price</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">FormContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">Context</span><span class="p">);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Then we should move all the state logic, that we had in <code>Form</code>, in the <code>FormDataProvider</code> component, and attach the state and callbacks to the newly created <code>Context</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
      <span class="c1">// send the request to the backend here</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">,</span>
      <span class="nx">onSave</span><span class="p">,</span>
      <span class="nx">onDiscountChange</span><span class="p">,</span>
      <span class="nx">onNameChange</span><span class="p">,</span>
      <span class="nx">onCountryChange</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">state</span><span class="p">]);</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">FormContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">value</span><span class="si">}</span><span class="p">></span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Then expose the hook for other components to use this Context without accessing it directly:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormState</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormContext</span><span class="p">);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And wrap our <code>Form</code> component into the <code>FormDataProvider</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">FormDataProvider</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">Form</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nc">FormDataProvider</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>After that, we can get rid of <strong>all the props</strong> throughout the app, and use the required data and callbacks directly in the components where it‚Äôs needed via <code>useFormState</code> hook.</p>

<p>For example, our root <code>Form</code> component will turn into just this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// no more props anywhere!</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And <code>NameFormComponent</code> will be able to access all the data like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">NameFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// accessing the data directly right where it's needed!</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">state</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormState</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">onValueChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">e</span><span class="p">:</span> <span class="nx">ChangeEvent</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">></span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">onNameChange</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>
      Type your name here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/></span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onValueChange</span><span class="si">}</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span> <span class="p">/></span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Take a look at the full code in <a href="https://codesandbox.io/s/form-implementation-with-context-2-3wd2i?file=/src/App.tsx">this codesandbox</a>. Don‚Äôt forget to appreciate how clean it looks now when there is no more mess of props everywhere!</p>

<h3>
  <a name="what-about-the-performance-of-the-new-form" href="#what-about-the-performance-of-the-new-form">
  </a>
  What about the performance of the new form?
</h3>

<p>From the performance perspective we‚Äôre still not there yet: typing the name and dragging the bar is still lagging. But if I start typing in the <code>NameFormComponent</code>, in the console I will now see this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Discount situation render
NameFormComponent render
SelectCountryFormComponent render
DiscountFormComponent render
ActionsSection render
Section render
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Half of the components now don‚Äôt re-render, including our parent <code>Form</code> component. This is happening because of how Context works: when a Context value changes, <strong>every consumer of this context will re-render</strong>, regardless of whether they use the changed value or not. But also, those components that are bypassed by Context won‚Äôt be re-rendering at all. Our re-renders flow now looks like this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ecEVpgNh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qzccab5jgttb0wk8bul6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ecEVpgNh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qzccab5jgttb0wk8bul6.png" alt="Image description" loading="lazy" width="880" height="756"></a></p>

<p>And now, if we look closely at our components implementation, in particular <code>SelectCountryComponent</code>, which is the wrapper around the slow ‚Äúexternal‚Äù component, we‚Äôll see that it doesn‚Äôt actually use the <code>state</code> itself. All it needs is the <code>onCountryChange</code> callback:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormState</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">SelectCountryFormComponent render</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And this gives us an opportunity to try out a really cool trick: we can split the <code>state</code> part and the <code>API</code> part under our <code>FormDataProvider</code>.</p>

<h2>
  <a name="splitting-the-state-and-the-api" href="#splitting-the-state-and-the-api">
  </a>
  Splitting the state and the API
</h2>

<p>Basically, what we want to do here is to decompose our ‚Äúmonolith‚Äù state into two ‚Äúmicrostates‚Äù üòÖ.</p>

<p>Instead of one context that has everything we‚Äôd need 2 contexts, one for data, one for API:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>
  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">API</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="na">price</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=></span> <span class="k">void</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">FormDataContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">FormAPIContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">API</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">API</span><span class="p">);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Instead of one context provider in our <code>FormDataProvider</code> component, we‚Äôd again have two, where we‚Äôd pass our state directly to the <code>FormDataContext.Provider</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="c1">// state logic</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">api</span><span class="si">}</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">FormDataContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="si">}</span><span class="p">></span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormDataContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
    <span class="p">&lt;/</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And now the most interesting part, the <code>api</code> value.</p>

<p>If we just leave it as it was before, the whole ‚Äúdecomposition‚Äù idea is not going to work because we still would have to rely on the <code>state</code> as a dependency in the <code>useMemo</code> hook:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="c1">// this is why we still need state here - in order to update it</span>
    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="c1">// all other callbacks</span>

  <span class="k">return</span> <span class="p">{</span> <span class="nx">onSave</span><span class="p">,</span> <span class="nx">onDiscountChange</span><span class="p">,</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">onCountryChange</span> <span class="p">};</span>
  <span class="c1">// still have state as a dependency</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">state</span><span class="p">]);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This will result in the <code>api</code> value changing with every state update, which would lead to the <code>FormAPIContext</code> triggering re-renders on every state update, which would make our split useless. We want our <code>api</code> to stay constant regardless of the <code>state</code>, so that consumers of this provider don't re-render.</p>

<p>Fortunately, there is another neat trick that we can apply here: we can extract our state into a reducer and instead of calling <code>setState</code> in the callback we would just trigger a reducer action.</p>

<p>First, create actions and reducer itself:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">Actions</span> <span class="o">=</span>
  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateName</span><span class="dl">'</span><span class="p">;</span> <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span>
  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateCountry</span><span class="dl">'</span><span class="p">;</span> <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span> <span class="p">}</span>
  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateDiscount</span><span class="dl">'</span><span class="p">;</span> <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">};</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Actions</span><span class="p">):</span> <span class="nx">State</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateName</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">name</span> <span class="p">};</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateDiscount</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">discount</span> <span class="p">};</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateCountry</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">country</span> <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Use reducer instead of <code>useState</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">FormProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="p">{}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And migrate our <code>api</code> to <code>dispatch</code> instead of <code>setState</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="c1">// send the request to the backend here</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateDiscount</span><span class="dl">'</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateName</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateCountry</span><span class="dl">'</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">{</span> <span class="nx">onSave</span><span class="p">,</span> <span class="nx">onDiscountChange</span><span class="p">,</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">onCountryChange</span> <span class="p">};</span>
  <span class="c1">// no more dependency on state! The api value will stay the same</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And the final step: don‚Äôt forget to migrate all the components that used <code>useFormState</code> to <code>useFormData</code> and <code>useFormAPI</code>. For example, our <code>SelectCountryFormComponent</code> will use <code>onCountryChange</code> from the <code>useFormAPI</code> hook, and will never re-render on the state change.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Take a look at the full implementation in <a href="https://codesandbox.io/s/form-implementation-split-api-2-g9q3e?file=/src/App.tsx">this codesandbox.</a> The typing and dragging bar are blazing fast now, and the only console output we‚Äôd see when we type something is this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Discount situation render
NameFormComponent render
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Only two components, since only those two use the actual state data. üéâ</p>

<h2>
  <a name="splitting-state-even-further" href="#splitting-state-even-further">
  </a>
  Splitting state even further
</h2>

<p>Now, people with good design eyes or just careful readers might notice that I cheated a little bit. We don‚Äôt pass the selected country to our ‚Äúexternal‚Äù <code>SelectCountry</code> component, and it's stuck on the very first item in the list. In reality, the selected ‚Äúlilac‚Äù color should move to the country you click on. And the component actually allows us to pass it via <code>activeCountry</code>. Technically, I can do it as simple as that:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">country</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormData</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">activeCountry</span><span class="p">=</span><span class="si">{</span><span class="nx">country</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>There is one problem with it though - as soon as I use <code>useFormData</code> hook in a component, it will start re-rendering with the state changes, same as <code>NameFormComponent</code>. Which in our case means we‚Äôll be back to the laggy experience on typing and dragging.</p>

<p>But now, since we already know how to split the data between different providers, nothing stops us from taking this to the next level and just splitting the rest of the state as well. Moar providers! üòÖ</p>

<p>Instead of one unified context for <code>State</code> we‚Äôll have three now:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">FormNameContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">FormCountryContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">country</span><span class="dl">'</span><span class="p">]</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">country</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">FormDiscountContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">discount</span><span class="dl">'</span><span class="p">]</span><span class="o">></span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">'</span><span class="s1">discount</span><span class="dl">'</span><span class="p">]);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Three state providers:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="p">&lt;</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">api</span><span class="si">}</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nc">FormNameContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nc">FormCountryContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">country</span><span class="si">}</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nc">FormDiscountContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="si">}</span><span class="p">></span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormDiscountContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
    <span class="p">&lt;/</span><span class="nc">FormCountryContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
  <span class="p">&lt;/</span><span class="nc">FormNameContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
<span class="p">&lt;/</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">></span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And three hooks to use the state:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormName</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormNameContext</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormCountry</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormCountryContext</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormDiscount</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormDiscountContext</span><span class="p">);</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And now in our <code>SelectCountryFormComponent</code> we can use <code>useFormCountry</code> hook, and it will not be re-rendering on any changes other than country itself:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">country</span> <span class="o">=</span> <span class="nx">useFormCountry</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">activeCountry</span><span class="p">=</span><span class="si">{</span><span class="nx">country</span><span class="si">}</span> <span class="p">/>;</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Check this out <a href="https://codesandbox.io/s/form-implementation-split-api-and-state-0tvq0?file=/src/App.tsx">in codesandbox</a>: it‚Äôs still fast, and country is selectable. And the only thing we‚Äôll see in console output when we type something in the name input is:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>NameFormComponent render
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h2>
  <a name="bonus-external-state-management" href="#bonus-external-state-management">
  </a>
  Bonus: external state management
</h2>

<p>Now, the question of whether this form‚Äôs state should‚Äôve been implemented with some state management library right away might cross some of your minds. And you‚Äôre maybe right. After all, if we look closely at the code, we just re-invented the wheel and implemented a rudimentary state management library, with selectors-like functionality for the state and separate actions to change that state.</p>

<p>But now you have <em>a choice</em>. Context is not a mystery anymore, with those techniques you can easily write performant apps with just pure Context if there is a need, and if you want to transition to any other framework, you can do it with minimal changes to the code. State management framework <strong>doesn‚Äôt really matter</strong> when you design your apps with Context in mind.</p>

<p>We might as well move it to the good old Redux right now. The only things we‚Äôd need to do are: get rid of Context and Providers, convert React reducer to Redux store, and convert our hooks to use Redux selectors and dispatch.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">((</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateName</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateCountry</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">updateDiscount</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store</span><span class="p">=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">></span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">>;</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormDiscount</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=></span> <span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormCountry</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=></span> <span class="nx">state</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormName</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=></span> <span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormAPI</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">useDispatch</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateCountry</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">});</span>
    <span class="p">},</span>
    <span class="na">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateDiscount</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">}),</span>
    <span class="na">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=></span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">updateName</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">}),</span>
    <span class="na">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=></span> <span class="p">{},</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Everything else stays the same and works exactly as we designed. <a href="https://codesandbox.io/s/form-implementation-redux-2-t5w30?file=/src/form-api.tsx">See the codesandbox.</a></p>

<p>That is all for today, hope now <code>Context</code> is not the source of mysterious spontaneous re-renders in your app, but a solid tool in your arsenal of writing performant React code ‚úåüèº</p>

<p>...</p>

<p>Originally published at <a href="https://www.developerway.com">https://www.developerway.com</a>. The website has more articles like this üòâ</p>

<p><a href="https://www.developerway.com">Subscribe to the newsletter</a>, <a href="https://www.linkedin.com/in/adevnadia/">connect on LinkedIn</a> or <a href="https://twitter.com/adevnadia">follow on Twitter</a> to get notified as soon as the next article comes out.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/adevnadia/how-to-write-performant-react-apps-with-context-24cp" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,n,a,p){return p.type_of="article",p.id=981465,p.title="How to write performant React apps with Context",p.description="It‚Äôs impossible to have a conversation on how to write performant React code without having an...",p.readable_publish_date="Feb 7",p.slug="how-to-write-performant-react-apps-with-context-24cp",p.path="/adevnadia/how-to-write-performant-react-apps-with-context-24cp",p.url="https://dev.to/adevnadia/how-to-write-performant-react-apps-with-context-24cp",p.comments_count=9,p.public_reactions_count=125,p.collection_id=s,p.published_timestamp=n,p.positive_reactions_count=125,p.cover_image=s,p.social_image="https://dev.to/social_previews/article/981465.png",p.canonical_url="https://www.developerway.com/posts/how-to-write-performant-react-apps-with-context",p.created_at=n,p.edited_at="2022-02-18T14:44:38Z",p.crossposted_at=s,p.published_at=n,p.last_comment_at="2022-04-16T11:28:25Z",p.reading_time_minutes=13,p.tag_list="javascript, webdev, react, performance",p.tags=["javascript","webdev","react","performance"],p.body_html='<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Ld_VANeu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g0swfc2sdhxd2lcrtv09.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Ld_VANeu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g0swfc2sdhxd2lcrtv09.png" alt="Image description" loading="lazy" width="880" height="563"></a></p>\n\n<p>It‚Äôs impossible to have a conversation on <a href="https://www.developerway.com/posts/how-to-write-performant-react-code">how to write performant React code</a> without having an article or two on Context. And it‚Äôs such a controversial topic! There are so many prejudices and rumours surrounding it. Context is evil! React re-renders everything for no reason when you use Context! Sometimes I have a feeling that developers treat Context like it‚Äôs a magic gremlin, that randomly and spontaneously re-renders the entire app for its own amusement.</p>\n\n<p>In this article I do not intend to convince anyone that we should ditch our beloved state management libraries in favour of Context. They exist for a reason. The main goal here is to de-mystify Context and provide a few interesting coding patterns, that could help minimise Context-related re-renders and improve your React apps performance. And as a nice bonus, the code will look cleaner and more understandable as a result.</p>\n\n<p>Let‚Äôs start the investigation with implementing some real-life app, and see where this will take us.</p>\n\n<h2>\n  <a name="lets-implement-a-form-in-react" href="#lets-implement-a-form-in-react">\n  </a>\n  Let‚Äôs implement a form in React\n</h2>\n\n<p>Our form is going to be quite complicated, it would consist, to begin with, from:</p>\n\n<ul>\n<li>a ‚ÄúPersonal info‚Äú section, where people can set some personal information, i.e name, email, etc</li>\n<li>a ‚ÄúValue calculation‚Äú section where people can set their currency preferences, their preferred discount, add some coupons, etc</li>\n<li>the selected discount should be highlighted in the Personal section in a form of an emoji (don‚Äôt ask, the designer has a weird sense of humour)</li>\n<li>an ‚ÄúActions‚Äù section with action buttons (i.e. ‚ÄúSave‚Äù, ‚ÄúReset‚Äù, etc)</li>\n</ul>\n\n<p>The ‚Äúdesign‚Äù looks like this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--nBArMm2S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s8z7z29pvg37pb8f4kvm.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nBArMm2S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s8z7z29pvg37pb8f4kvm.png" alt="Image description" loading="lazy" width="880" height="650"></a></p>\n\n<p>To make things more interesting, we‚Äôre also going to pretend that ‚Äúselect country‚Äù and ‚Äúdragging bar‚Äù components are ‚Äúexternal‚Äù libraries that we installed as a package. So we can only use them through API, but have no influence on what‚Äôs inside. And we‚Äôre going to use the ‚Äúslow‚Äù version of the countries select, that we implemented in the <a href="https://www.developerway.com/posts/how-to-write-performant-react-code">previous performance investigation</a>.</p>\n\n<p>Now it‚Äôs time to write some code. Let‚Äôs start with the components structure of the app. I know this form will quickly become quite complicated, so I want to separate it into smaller, more contained components right away.</p>\n\n<p>At the root I‚Äôll have my main <code>Form</code> component, which will render the three required sections:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;&gt;</span>\n      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>‚ÄúPersonal info‚Äù section will then render three more components: the discount emoji, input for the name and countries select<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">PersonalInfoSection</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Personal information"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">DiscountSituation</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">NameFormComponent</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">SelectCountryFormComponent</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>All three of them will contain the actual logic of those components (the code of them will be below), and the <code>Section</code> just encapsulates some styles.</p>\n\n<p>‚ÄúValue calculation‚Äù section will have just one component (for now), the discount bar:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">ValueCalculationSection</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Value calculation"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">DiscountFormComponent</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And ‚ÄúActions‚Äù section will have just one button for now as well: the save button with onSave callback.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">ActionsSection</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onSave</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Actions"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClick</span><span class="si">}</span><span class="p">&gt;</span>Save form<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now the interesting part: we need to make this form interactive. Considering that we have a single ‚ÄúSave‚Äù button for the entire form, and different sections would need data from other sections, the natural place for the state management is at the root, in the <code>Form</code> component. We‚Äôll have 3 pieces of data there: Name, Country and Discount, a way to set all three of them, and a way to ‚Äúsave‚Äù it:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>\n  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">defaultState</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="c1">// send the request to the backend here</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="c1">// the rest as before</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And now we need to pass the relevant data and callbacks to the components that need it. In our <code>PersonalInfoSection</code>:</p>\n\n<ul>\n<li>the <code>DiscountSituation</code> component should be able to show the emoji based on <code>discount</code> value.</li>\n<li>the <code>NameFormComponent</code> should be able to control <code>name</code> value</li>\n<li>the <code>SelectCountryFormComponent</code> should be able to set the selected <code>country</code>\n</li>\n</ul>\n\n<p>Considering that those components are not rendered in <code>Form</code> directly, but are children of <code>PersonalInfoSection</code>, time to do some prop drilling üòä</p>\n\n<p><code>DiscountSituation</code> will accept <code>discount</code> as a prop:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">DiscountSituation</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">discount</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// some code to calculate the situation based on discount</span>\n  <span class="kd">const</span> <span class="nx">discountSituation</span> <span class="o">=</span> <span class="p">...;</span>\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Your discount situation: <span class="si">{</span><span class="nx">discountSituation</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>NameFormComponent</code> will accept <code>name</code> and <code>onChange</code> callback:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">NameFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onChange</span><span class="p">,</span> <span class="nx">name</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span> <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>\n      Type your name here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>SelectCountryFormComponent</code> will accept <code>onChange</code> callback:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onChange</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And our <code>PersonalInfoSection</code> would have to pass all of them from its parent <code>Form</code> component to its children:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">PersonalInfoSection</span> <span class="o">=</span> <span class="p">({</span>\n  <span class="nx">onNameChange</span><span class="p">,</span>\n  <span class="nx">onCountryChange</span><span class="p">,</span>\n  <span class="nx">discount</span><span class="p">,</span>\n  <span class="nx">name</span><span class="p">,</span>\n<span class="p">}:</span> <span class="p">{</span>\n  <span class="nl">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n  <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Personal information"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">DiscountSituation</span> <span class="na">discount</span><span class="p">=</span><span class="si">{</span><span class="nx">discount</span><span class="si">}</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">NameFormComponent</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="na">name</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">SelectCountryFormComponent</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And the same story with <code>ValueCalculationSection</code>: it needs to pass <code>onDiscountChange</code> and <code>discount</code> value from <code>Form</code> component to its child:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">ValueCalculationsSection</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onDiscountChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">\'</span><span class="s1">ValueCalculationsSection render</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">Section</span> <span class="na">title</span><span class="p">=</span><span class="s">"Value calculation"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">DiscountFormComponent</span> <span class="na">onDiscountChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onDiscountChange</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">Section</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And the <code>DiscountFormComponent</code> just uses the ‚Äúexternal‚Äù library <code>DraggingBar</code> to render the bar and catch the changes via the callback it gives:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">DiscountFormComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onDiscountChange</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">\'</span><span class="s1">DiscountFormComponent render</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>\n      Please select your discount here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">DraggingBar</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">onDiscountChange</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And, the render of our <code>Form</code> component would look like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="na">onNameChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onNameChange</span><span class="si">}</span> <span class="na">onCountryChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">discount</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="si">}</span> <span class="na">name</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="na">onDiscountChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onDiscountChange</span><span class="si">}</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="na">onSave</span><span class="p">=</span><span class="si">{</span><span class="nx">onSave</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Quite a bit of code, but finally done üòÖ Want to take a look at the result? <a href="https://codesandbox.io/s/form-initial-implementation-uxw8v?file=/src/App.tsx">See the codesandbox.</a></p>\n\n<p>Unfortunately, the result is much worst than you‚Äôd expect from a composition of a few components and a simple state üòï Try to type your name in the input, or drag the blue bar - both of them are lagging even on a fast laptop. With CPU throttling they are basically unusable. So, what happened?</p>\n\n<h3>\n  <a name="the-form-performance-investigation" href="#the-form-performance-investigation">\n  </a>\n  The form performance investigation\n</h3>\n\n<p>First of all, let‚Äôs take a look at the console output there. If I type a single key in the <code>Name</code> input, I‚Äôll see:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Form render\nPersonalInfoSection render\nSection render\nDiscount situation render\nNameFormComponent render\nSelectCountryFormComponent render\nValueCalculationsSection render\nSection render\nDiscountFormComponent render\nActionsSection render\nSection render\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Every single component in our form re-renders on every keystroke! And the same situation is with the dragging - on every mouse move the entire form and all its components re-renders themselves. And we already know, that our <code>SelectCountryFormComponent</code> is very slow, and there is nothing we can do with its performance. So the only thing that we can do here, is to make sure it doesn‚Äôt re-render on every keypress or mouse move.</p>\n\n<p>And, as we know, components will re-render when:</p>\n\n<ul>\n<li>state of a component changed</li>\n<li>parent component re-renders</li>\n</ul>\n\n<p>And this is exactly what is happening here: when the value in an input changes, we propagate this value up to the root <code>Form</code> component through our chain of callbacks, where we change the root state, which triggers re-render of the <code>Form</code> component, which then cascades down to every child and child of a child of this component (i.e. all of them).</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--PIqsj0FU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hwv1xauvlekjdcz5xet5.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--PIqsj0FU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hwv1xauvlekjdcz5xet5.png" alt="Image description" loading="lazy" width="880" height="690"></a></p>\n\n<p>To fix it, we could, of course, sprinkle some <code>useMemo</code> and <code>useCallback</code> in strategic places and call it a day. But that just brushes the problem under the rug, not actually solving it. When in the future we introduce another slow component, the story will repeat itself. Not to mention that it will make the code much more complicated and harder to maintain. In the ideal world, when I type something in the <code>Name</code> component, I want only the <code>NameFormComponent</code> and components that actually use the <code>name</code> value to re-render, the rest should just sit idle there and wait for their turn to be interactive.</p>\n\n<p>And React actually gives us a perfect tool to do that - <code>Context</code>!</p>\n\n<h2>\n  <a name="adding-context-to-the-form" href="#adding-context-to-the-form">\n  </a>\n  Adding Context to the form\n</h2>\n\n<p>As per <a href="https://reactjs.org/docs/context.html">React docs</a>, context provides a way to pass data through the component tree without having to pass props down manually at every level. If, for example, we extract our Form state into Context, we can get rid of all the props we‚Äôve been passing through intermediate sections like <code>PersonalInfoSection</code> and use state directly in the <code>NameFormComponent</code> and <code>DiscountFormComponent</code>. The data flow then would look something like this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qiwlhi9U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kor40ni5vn1d477pom81.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qiwlhi9U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kor40ni5vn1d477pom81.png" alt="Image description" loading="lazy" width="880" height="668"></a></p>\n\n<p>To achieve this, first we‚Äôre creating the <code>Context</code> itself, which will have our state and the API to manage this state (i.e. our callbacks):<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>\n  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">};</span>\n\n<span class="kd">type</span> <span class="nx">Context</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">;</span>\n  <span class="nl">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="na">price</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">FormContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">Context</span><span class="p">);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Then we should move all the state logic, that we had in <code>Form</code>, in the <code>FormDataProvider</code> component, and attach the state and callbacks to the newly created <code>Context</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>\n\n  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="c1">// send the request to the backend here</span>\n    <span class="p">};</span>\n\n    <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>\n    <span class="p">};</span>\n\n    <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>\n    <span class="p">};</span>\n\n    <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>\n    <span class="p">};</span>\n\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">state</span><span class="p">,</span>\n      <span class="nx">onSave</span><span class="p">,</span>\n      <span class="nx">onDiscountChange</span><span class="p">,</span>\n      <span class="nx">onNameChange</span><span class="p">,</span>\n      <span class="nx">onCountryChange</span><span class="p">,</span>\n    <span class="p">};</span>\n  <span class="p">},</span> <span class="p">[</span><span class="nx">state</span><span class="p">]);</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">FormContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">value</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Then expose the hook for other components to use this Context without accessing it directly:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormState</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormContext</span><span class="p">);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And wrap our <code>Form</code> component into the <code>FormDataProvider</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">FormDataProvider</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">Form</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">FormDataProvider</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>After that, we can get rid of <strong>all the props</strong> throughout the app, and use the required data and callbacks directly in the components where it‚Äôs needed via <code>useFormState</code> hook.</p>\n\n<p>For example, our root <code>Form</code> component will turn into just this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// no more props anywhere!</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">PersonalInfoSection</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ValueCalculationsSection</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nc">ActionsSection</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And <code>NameFormComponent</code> will be able to access all the data like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">NameFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// accessing the data directly right where it\'s needed!</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">state</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormState</span><span class="p">();</span>\n\n  <span class="kd">const</span> <span class="nx">onValueChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">e</span><span class="p">:</span> <span class="nx">ChangeEvent</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">onNameChange</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>\n  <span class="p">};</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>\n      Type your name here: <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>\n      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onValueChange</span><span class="si">}</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span> <span class="p">/&gt;</span>\n    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Take a look at the full code in <a href="https://codesandbox.io/s/form-implementation-with-context-2-3wd2i?file=/src/App.tsx">this codesandbox</a>. Don‚Äôt forget to appreciate how clean it looks now when there is no more mess of props everywhere!</p>\n\n<h3>\n  <a name="what-about-the-performance-of-the-new-form" href="#what-about-the-performance-of-the-new-form">\n  </a>\n  What about the performance of the new form?\n</h3>\n\n<p>From the performance perspective we‚Äôre still not there yet: typing the name and dragging the bar is still lagging. But if I start typing in the <code>NameFormComponent</code>, in the console I will now see this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Discount situation render\nNameFormComponent render\nSelectCountryFormComponent render\nDiscountFormComponent render\nActionsSection render\nSection render\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Half of the components now don‚Äôt re-render, including our parent <code>Form</code> component. This is happening because of how Context works: when a Context value changes, <strong>every consumer of this context will re-render</strong>, regardless of whether they use the changed value or not. But also, those components that are bypassed by Context won‚Äôt be re-rendering at all. Our re-renders flow now looks like this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ecEVpgNh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qzccab5jgttb0wk8bul6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ecEVpgNh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qzccab5jgttb0wk8bul6.png" alt="Image description" loading="lazy" width="880" height="756"></a></p>\n\n<p>And now, if we look closely at our components implementation, in particular <code>SelectCountryComponent</code>, which is the wrapper around the slow ‚Äúexternal‚Äù component, we‚Äôll see that it doesn‚Äôt actually use the <code>state</code> itself. All it needs is the <code>onCountryChange</code> callback:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormState</span><span class="p">();</span>\n  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">\'</span><span class="s1">SelectCountryFormComponent render</span><span class="dl">\'</span><span class="p">);</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And this gives us an opportunity to try out a really cool trick: we can split the <code>state</code> part and the <code>API</code> part under our <code>FormDataProvider</code>.</p>\n\n<h2>\n  <a name="splitting-the-state-and-the-api" href="#splitting-the-state-and-the-api">\n  </a>\n  Splitting the state and the API\n</h2>\n\n<p>Basically, what we want to do here is to decompose our ‚Äúmonolith‚Äù state into two ‚Äúmicrostates‚Äù üòÖ.</p>\n\n<p>Instead of one context that has everything we‚Äôd need 2 contexts, one for data, one for API:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">;</span>\n  <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">};</span>\n\n<span class="kd">type</span> <span class="nx">API</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="na">price</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nl">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">FormDataContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>\n<span class="kd">const</span> <span class="nx">FormAPIContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">API</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">API</span><span class="p">);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Instead of one context provider in our <code>FormDataProvider</code> component, we‚Äôd again have two, where we‚Äôd pass our state directly to the <code>FormDataContext.Provider</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// state logic</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="p">&lt;</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">api</span><span class="si">}</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">FormDataContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormDataContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n  <span class="p">);</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And now the most interesting part, the <code>api</code> value.</p>\n\n<p>If we just leave it as it was before, the whole ‚Äúdecomposition‚Äù idea is not going to work because we still would have to rely on the <code>state</code> as a dependency in the <code>useMemo</code> hook:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="c1">// this is why we still need state here - in order to update it</span>\n    <span class="nx">setState</span><span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="c1">// all other callbacks</span>\n\n  <span class="k">return</span> <span class="p">{</span> <span class="nx">onSave</span><span class="p">,</span> <span class="nx">onDiscountChange</span><span class="p">,</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">onCountryChange</span> <span class="p">};</span>\n  <span class="c1">// still have state as a dependency</span>\n<span class="p">},</span> <span class="p">[</span><span class="nx">state</span><span class="p">]);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This will result in the <code>api</code> value changing with every state update, which would lead to the <code>FormAPIContext</code> triggering re-renders on every state update, which would make our split useless. We want our <code>api</code> to stay constant regardless of the <code>state</code>, so that consumers of this provider don\'t re-render.</p>\n\n<p>Fortunately, there is another neat trick that we can apply here: we can extract our state into a reducer and instead of calling <code>setState</code> in the callback we would just trigger a reducer action.</p>\n\n<p>First, create actions and reducer itself:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">type</span> <span class="nx">Actions</span> <span class="o">=</span>\n  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateName</span><span class="dl">\'</span><span class="p">;</span> <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span>\n  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateCountry</span><span class="dl">\'</span><span class="p">;</span> <span class="nl">country</span><span class="p">:</span> <span class="nx">Country</span> <span class="p">}</span>\n  <span class="o">|</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateDiscount</span><span class="dl">\'</span><span class="p">;</span> <span class="nl">discount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Actions</span><span class="p">):</span> <span class="nx">State</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateName</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">name</span> <span class="p">};</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateDiscount</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">discount</span> <span class="p">};</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateCountry</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">country</span> <span class="p">};</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Use reducer instead of <code>useState</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">FormProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="p">{}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">);</span>\n  <span class="c1">// ...</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And migrate our <code>api</code> to <code>dispatch</code> instead of <code>setState</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">onSave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="c1">// send the request to the backend here</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onDiscountChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">discount</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateDiscount</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">discount</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onNameChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateName</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="kd">const</span> <span class="nx">onCountryChange</span> <span class="o">=</span> <span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">Country</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateCountry</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">country</span> <span class="p">});</span>\n  <span class="p">};</span>\n\n  <span class="k">return</span> <span class="p">{</span> <span class="nx">onSave</span><span class="p">,</span> <span class="nx">onDiscountChange</span><span class="p">,</span> <span class="nx">onNameChange</span><span class="p">,</span> <span class="nx">onCountryChange</span> <span class="p">};</span>\n  <span class="c1">// no more dependency on state! The api value will stay the same</span>\n<span class="p">},</span> <span class="p">[]);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And the final step: don‚Äôt forget to migrate all the components that used <code>useFormState</code> to <code>useFormData</code> and <code>useFormAPI</code>. For example, our <code>SelectCountryFormComponent</code> will use <code>onCountryChange</code> from the <code>useFormAPI</code> hook, and will never re-render on the state change.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Take a look at the full implementation in <a href="https://codesandbox.io/s/form-implementation-split-api-2-g9q3e?file=/src/App.tsx">this codesandbox.</a> The typing and dragging bar are blazing fast now, and the only console output we‚Äôd see when we type something is this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Discount situation render\nNameFormComponent render\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Only two components, since only those two use the actual state data. üéâ</p>\n\n<h2>\n  <a name="splitting-state-even-further" href="#splitting-state-even-further">\n  </a>\n  Splitting state even further\n</h2>\n\n<p>Now, people with good design eyes or just careful readers might notice that I cheated a little bit. We don‚Äôt pass the selected country to our ‚Äúexternal‚Äù <code>SelectCountry</code> component, and it\'s stuck on the very first item in the list. In reality, the selected ‚Äúlilac‚Äù color should move to the country you click on. And the component actually allows us to pass it via <code>activeCountry</code>. Technically, I can do it as simple as that:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">country</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormData</span><span class="p">();</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">activeCountry</span><span class="p">=</span><span class="si">{</span><span class="nx">country</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>There is one problem with it though - as soon as I use <code>useFormData</code> hook in a component, it will start re-rendering with the state changes, same as <code>NameFormComponent</code>. Which in our case means we‚Äôll be back to the laggy experience on typing and dragging.</p>\n\n<p>But now, since we already know how to split the data between different providers, nothing stops us from taking this to the next level and just splitting the rest of the state as well. Moar providers! üòÖ</p>\n\n<p>Instead of one unified context for <code>State</code> we‚Äôll have three now:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">FormNameContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">]</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">]);</span>\n<span class="kd">const</span> <span class="nx">FormCountryContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">country</span><span class="dl">\'</span><span class="p">]</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">country</span><span class="dl">\'</span><span class="p">]);</span>\n<span class="kd">const</span> <span class="nx">FormDiscountContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">discount</span><span class="dl">\'</span><span class="p">]</span><span class="o">&gt;</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">[</span><span class="dl">\'</span><span class="s1">discount</span><span class="dl">\'</span><span class="p">]);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Three state providers:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="p">&lt;</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">api</span><span class="si">}</span><span class="p">&gt;</span>\n  <span class="p">&lt;</span><span class="nc">FormNameContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&gt;</span>\n    <span class="p">&lt;</span><span class="nc">FormCountryContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">country</span><span class="si">}</span><span class="p">&gt;</span>\n      <span class="p">&lt;</span><span class="nc">FormDiscountContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">FormDiscountContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n    <span class="p">&lt;/</span><span class="nc">FormCountryContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n  <span class="p">&lt;/</span><span class="nc">FormNameContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n<span class="p">&lt;/</span><span class="nc">FormAPIContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And three hooks to use the state:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormName</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormNameContext</span><span class="p">);</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormCountry</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormCountryContext</span><span class="p">);</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormDiscount</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">FormDiscountContext</span><span class="p">);</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And now in our <code>SelectCountryFormComponent</code> we can use <code>useFormCountry</code> hook, and it will not be re-rendering on any changes other than country itself:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SelectCountryFormComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">onCountryChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useFormAPI</span><span class="p">();</span>\n  <span class="kd">const</span> <span class="nx">country</span> <span class="o">=</span> <span class="nx">useFormCountry</span><span class="p">();</span>\n\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">SelectCountry</span> <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onCountryChange</span><span class="si">}</span> <span class="na">activeCountry</span><span class="p">=</span><span class="si">{</span><span class="nx">country</span><span class="si">}</span> <span class="p">/&gt;;</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Check this out <a href="https://codesandbox.io/s/form-implementation-split-api-and-state-0tvq0?file=/src/App.tsx">in codesandbox</a>: it‚Äôs still fast, and country is selectable. And the only thing we‚Äôll see in console output when we type something in the name input is:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>NameFormComponent render\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name="bonus-external-state-management" href="#bonus-external-state-management">\n  </a>\n  Bonus: external state management\n</h2>\n\n<p>Now, the question of whether this form‚Äôs state should‚Äôve been implemented with some state management library right away might cross some of your minds. And you‚Äôre maybe right. After all, if we look closely at the code, we just re-invented the wheel and implemented a rudimentary state management library, with selectors-like functionality for the state and separate actions to change that state.</p>\n\n<p>But now you have <em>a choice</em>. Context is not a mystery anymore, with those techniques you can easily write performant apps with just pure Context if there is a need, and if you want to transition to any other framework, you can do it with minimal changes to the code. State management framework <strong>doesn‚Äôt really matter</strong> when you design your apps with Context in mind.</p>\n\n<p>We might as well move it to the good old Redux right now. The only things we‚Äôd need to do are: get rid of Context and Providers, convert React reducer to Redux store, and convert our hooks to use Redux selectors and dispatch.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight tsx"><code><span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">((</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateName</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateCountry</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>\n    <span class="k">case</span> <span class="dl">\'</span><span class="s1">updateDiscount</span><span class="dl">\'</span><span class="p">:</span>\n      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span> <span class="p">};</span>\n    <span class="nl">default</span><span class="p">:</span>\n      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">});</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">FormDataProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store</span><span class="p">=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;;</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormDiscount</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">discount</span><span class="p">);</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormCountry</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormName</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">useFormAPI</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">useDispatch</span><span class="p">();</span>\n\n  <span class="k">return</span> <span class="p">{</span>\n    <span class="na">onCountryChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateCountry</span><span class="dl">\'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">});</span>\n    <span class="p">},</span>\n    <span class="na">onDiscountChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateDiscount</span><span class="dl">\'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">}),</span>\n    <span class="na">onNameChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">updateName</span><span class="dl">\'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span> <span class="p">}),</span>\n    <span class="na">onSave</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>\n  <span class="p">};</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Everything else stays the same and works exactly as we designed. <a href="https://codesandbox.io/s/form-implementation-redux-2-t5w30?file=/src/form-api.tsx">See the codesandbox.</a></p>\n\n<p>That is all for today, hope now <code>Context</code> is not the source of mysterious spontaneous re-renders in your app, but a solid tool in your arsenal of writing performant React code ‚úåüèº</p>\n\n<p>...</p>\n\n<p>Originally published at <a href="https://www.developerway.com">https://www.developerway.com</a>. The website has more articles like this üòâ</p>\n\n<p><a href="https://www.developerway.com">Subscribe to the newsletter</a>, <a href="https://www.linkedin.com/in/adevnadia/">connect on LinkedIn</a> or <a href="https://twitter.com/adevnadia">follow on Twitter</a> to get notified as soon as the next article comes out.</p>\n\n',p.body_markdown="\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g0swfc2sdhxd2lcrtv09.png)\n\nIt‚Äôs impossible to have a conversation on <a href=\"https://www.developerway.com/posts/how-to-write-performant-react-code\">how to write performant React code</a> without having an article or two on Context. And it‚Äôs such a controversial topic! There are so many prejudices and rumours surrounding it. Context is evil! React re-renders everything for no reason when you use Context! Sometimes I have a feeling that developers treat Context like it‚Äôs a magic gremlin, that randomly and spontaneously re-renders the entire app for its own amusement.\n\nIn this article I do not intend to convince anyone that we should ditch our beloved state management libraries in favour of Context. They exist for a reason. The main goal here is to de-mystify Context and provide a few interesting coding patterns, that could help minimise Context-related re-renders and improve your React apps performance. And as a nice bonus, the code will look cleaner and more understandable as a result.\n\nLet‚Äôs start the investigation with implementing some real-life app, and see where this will take us.\n\n## Let‚Äôs implement a form in React\n\nOur form is going to be quite complicated, it would consist, to begin with, from:\n\n- a ‚ÄúPersonal info‚Äú section, where people can set some personal information, i.e name, email, etc\n- a ‚ÄúValue calculation‚Äú section where people can set their currency preferences, their preferred discount, add some coupons, etc\n- the selected discount should be highlighted in the Personal section in a form of an emoji (don‚Äôt ask, the designer has a weird sense of humour)\n- an ‚ÄúActions‚Äù section with action buttons (i.e. ‚ÄúSave‚Äù, ‚ÄúReset‚Äù, etc)\n\nThe ‚Äúdesign‚Äù looks like this:\n\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s8z7z29pvg37pb8f4kvm.png)\n\nTo make things more interesting, we‚Äôre also going to pretend that ‚Äúselect country‚Äù and ‚Äúdragging bar‚Äù components are ‚Äúexternal‚Äù libraries that we installed as a package. So we can only use them through API, but have no influence on what‚Äôs inside. And we‚Äôre going to use the ‚Äúslow‚Äù version of the countries select, that we implemented in the <a href=\"https://www.developerway.com/posts/how-to-write-performant-react-code\">previous performance investigation</a>.\n\nNow it‚Äôs time to write some code. Let‚Äôs start with the components structure of the app. I know this form will quickly become quite complicated, so I want to separate it into smaller, more contained components right away.\n\nAt the root I‚Äôll have my main `Form` component, which will render the three required sections:\n\n```tsx\nconst Form = () => {\n  return (\n    <>\n      <PersonalInfoSection />\n      <ValueCalculationsSection />\n      <ActionsSection />\n    </>\n  );\n};\n```\n\n‚ÄúPersonal info‚Äù section will then render three more components: the discount emoji, input for the name and countries select\n\n```tsx\nconst PersonalInfoSection = () => {\n  return (\n    <Section title=\"Personal information\">\n      <DiscountSituation />\n      <NameFormComponent />\n      <SelectCountryFormComponent />\n    </Section>\n  );\n};\n```\n\nAll three of them will contain the actual logic of those components (the code of them will be below), and the `Section` just encapsulates some styles.\n\n‚ÄúValue calculation‚Äù section will have just one component (for now), the discount bar:\n\n```tsx\nconst ValueCalculationSection = () => {\n  return (\n    <Section title=\"Value calculation\">\n      <DiscountFormComponent />\n    </Section>\n  );\n};\n```\n\nAnd ‚ÄúActions‚Äù section will have just one button for now as well: the save button with onSave callback.\n\n```tsx\nconst ActionsSection = ({ onSave }: { onSave: () => void }) => {\n  return (\n    <Section title=\"Actions\">\n      <button onClick={onClick}>Save form</button>\n    </Section>\n  );\n};\n```\n\nNow the interesting part: we need to make this form interactive. Considering that we have a single ‚ÄúSave‚Äù button for the entire form, and different sections would need data from other sections, the natural place for the state management is at the root, in the `Form` component. We‚Äôll have 3 pieces of data there: Name, Country and Discount, a way to set all three of them, and a way to ‚Äúsave‚Äù it:\n\n```tsx\ntype State = {\n  name: string;\n  country: Country;\n  discount: number;\n};\n\nconst Form = () => {\n  const [state, setState] = useState<State>(defaultState as State);\n\n  const onSave = () => {\n    // send the request to the backend here\n  };\n\n  const onDiscountChange = (discount: number) => {\n    setState({ ...state, discount });\n  };\n\n  const onNameChange = (name: string) => {\n    setState({ ...state, name });\n  };\n\n  const onCountryChange = (country: Country) => {\n    setState({ ...state, country });\n  };\n\n  // the rest as before\n};\n```\n\nAnd now we need to pass the relevant data and callbacks to the components that need it. In our `PersonalInfoSection`:\n\n- the `DiscountSituation` component should be able to show the emoji based on `discount` value.\n- the `NameFormComponent` should be able to control `name` value\n- the `SelectCountryFormComponent` should be able to set the selected `country`\n\nConsidering that those components are not rendered in `Form` directly, but are children of `PersonalInfoSection`, time to do some prop drilling üòä\n\n`DiscountSituation` will accept `discount` as a prop:\n\n```tsx\nexport const DiscountSituation = ({ discount }: { discount: number }) => {\n  // some code to calculate the situation based on discount\n  const discountSituation = ...;\n  return <div>Your discount situation: {discountSituation}</div>;\n};\n```\n\n`NameFormComponent` will accept `name` and `onChange` callback:\n\n```tsx\nexport const NameFormComponent = ({ onChange, name }: { onChange: (val: string) => void; name: string }) => {\n  return (\n    <div>\n      Type your name here: <br />\n      <input onChange={() => onChange(e.target.value)} value={name} />\n    </div>\n  );\n};\n```\n\n`SelectCountryFormComponent` will accept `onChange` callback:\n\n```tsx\nexport const SelectCountryFormComponent = ({ onChange }: { onChange: (country: Country) => void }) => {\n  return <SelectCountry onChange={onChange} />;\n};\n```\n\nAnd our `PersonalInfoSection` would have to pass all of them from its parent `Form` component to its children:\n\n```tsx\nexport const PersonalInfoSection = ({\n  onNameChange,\n  onCountryChange,\n  discount,\n  name,\n}: {\n  onNameChange: (name: string) => void;\n  onCountryChange: (name: Country) => void;\n  discount: number;\n  name: string;\n}) => {\n  return (\n    <Section title=\"Personal information\">\n      <DiscountSituation discount={discount} />\n      <NameFormComponent onChange={onNameChange} name={name} />\n      <SelectCountryFormComponent onChange={onCountryChange} />\n    </Section>\n  );\n};\n```\n\nAnd the same story with `ValueCalculationSection`: it needs to pass `onDiscountChange` and `discount` value from `Form` component to its child:\n\n```tsx\nexport const ValueCalculationsSection = ({ onDiscountChange }: { onDiscountChange: (val: number) => void }) => {\n  console.info('ValueCalculationsSection render');\n  return (\n    <Section title=\"Value calculation\">\n      <DiscountFormComponent onDiscountChange={onDiscountChange} />\n    </Section>\n  );\n};\n```\n\nAnd the `DiscountFormComponent` just uses the ‚Äúexternal‚Äù library `DraggingBar` to render the bar and catch the changes via the callback it gives:\n\n```tsx\nexport const DiscountFormComponent = ({ onDiscountChange }: { onDiscountChange: (value: number) => void }) => {\n  console.info('DiscountFormComponent render');\n  return (\n    <div>\n      Please select your discount here: <br />\n      <DraggingBar onChange={(value: number) => onDiscountChange(value)} />\n    </div>\n  );\n};\n```\n\nAnd, the render of our `Form` component would look like this:\n\n```tsx\nconst Form = () => {\n  return (\n    <div>\n      <PersonalInfoSection onNameChange={onNameChange} onCountryChange={onCountryChange} discount={state.discount} name={state.name} />\n      <ValueCalculationsSection onDiscountChange={onDiscountChange} />\n      <ActionsSection onSave={onSave} />\n    </div>\n  );\n};\n```\n\nQuite a bit of code, but finally done üòÖ Want to take a look at the result? <a href=\"https://codesandbox.io/s/form-initial-implementation-uxw8v?file=/src/App.tsx\">See the codesandbox.</a>\n\nUnfortunately, the result is much worst than you‚Äôd expect from a composition of a few components and a simple state üòï Try to type your name in the input, or drag the blue bar - both of them are lagging even on a fast laptop. With CPU throttling they are basically unusable. So, what happened?\n\n### The form performance investigation\n\nFirst of all, let‚Äôs take a look at the console output there. If I type a single key in the `Name` input, I‚Äôll see:\n\n```\nForm render\nPersonalInfoSection render\nSection render\nDiscount situation render\nNameFormComponent render\nSelectCountryFormComponent render\nValueCalculationsSection render\nSection render\nDiscountFormComponent render\nActionsSection render\nSection render\n```\n\nEvery single component in our form re-renders on every keystroke! And the same situation is with the dragging - on every mouse move the entire form and all its components re-renders themselves. And we already know, that our `SelectCountryFormComponent` is very slow, and there is nothing we can do with its performance. So the only thing that we can do here, is to make sure it doesn‚Äôt re-render on every keypress or mouse move.\n\nAnd, as we know, components will re-render when:\n\n- state of a component changed\n- parent component re-renders\n\nAnd this is exactly what is happening here: when the value in an input changes, we propagate this value up to the root `Form` component through our chain of callbacks, where we change the root state, which triggers re-render of the `Form` component, which then cascades down to every child and child of a child of this component (i.e. all of them).\n\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hwv1xauvlekjdcz5xet5.png)\n\nTo fix it, we could, of course, sprinkle some `useMemo` and `useCallback` in strategic places and call it a day. But that just brushes the problem under the rug, not actually solving it. When in the future we introduce another slow component, the story will repeat itself. Not to mention that it will make the code much more complicated and harder to maintain. In the ideal world, when I type something in the `Name` component, I want only the `NameFormComponent` and components that actually use the `name` value to re-render, the rest should just sit idle there and wait for their turn to be interactive.\n\nAnd React actually gives us a perfect tool to do that - `Context`!\n\n## Adding Context to the form\n\nAs per <a href=\"https://reactjs.org/docs/context.html\">React docs</a>, context provides a way to pass data through the component tree without having to pass props down manually at every level. If, for example, we extract our Form state into Context, we can get rid of all the props we‚Äôve been passing through intermediate sections like `PersonalInfoSection` and use state directly in the `NameFormComponent` and `DiscountFormComponent`. The data flow then would look something like this:\n\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kor40ni5vn1d477pom81.png)\n\nTo achieve this, first we‚Äôre creating the `Context` itself, which will have our state and the API to manage this state (i.e. our callbacks):\n\n```tsx\ntype State = {\n  name: string;\n  country: Country;\n  discount: number;\n};\n\ntype Context = {\n  state: State;\n  onNameChange: (name: string) => void;\n  onCountryChange: (name: Country) => void;\n  onDiscountChange: (price: number) => void;\n  onSave: () => void;\n};\n\nconst FormContext = createContext<Context>({} as Context);\n```\n\nThen we should move all the state logic, that we had in `Form`, in the `FormDataProvider` component, and attach the state and callbacks to the newly created `Context`:\n\n```tsx\nexport const FormDataProvider = ({ children }: { children: ReactNode }) => {\n  const [state, setState] = useState<State>({} as State);\n\n  const value = useMemo(() => {\n    const onSave = () => {\n      // send the request to the backend here\n    };\n\n    const onDiscountChange = (discount: number) => {\n      setState({ ...state, discount });\n    };\n\n    const onNameChange = (name: string) => {\n      setState({ ...state, name });\n    };\n\n    const onCountryChange = (country: Country) => {\n      setState({ ...state, country });\n    };\n\n    return {\n      state,\n      onSave,\n      onDiscountChange,\n      onNameChange,\n      onCountryChange,\n    };\n  }, [state]);\n\n  return <FormContext.Provider value={value}>{children}</FormContext.Provider>;\n};\n```\n\nThen expose the hook for other components to use this Context without accessing it directly:\n\n```tsx\nexport const useFormState = () => useContext(FormContext);\n```\n\nAnd wrap our `Form` component into the `FormDataProvider`:\n\n```tsx\nexport default function App() {\n  return (\n    <FormDataProvider>\n      <Form />\n    </FormDataProvider>\n  );\n}\n```\n\nAfter that, we can get rid of **all the props** throughout the app, and use the required data and callbacks directly in the components where it‚Äôs needed via `useFormState` hook.\n\nFor example, our root `Form` component will turn into just this:\n\n```tsx\nconst Form = () => {\n  // no more props anywhere!\n  return (\n    <div className=\"App\">\n      <PersonalInfoSection />\n      <ValueCalculationsSection />\n      <ActionsSection />\n    </div>\n  );\n};\n```\n\nAnd `NameFormComponent` will be able to access all the data like this:\n\n```tsx\nexport const NameFormComponent = () => {\n  // accessing the data directly right where it's needed!\n  const { onNameChange, state } = useFormState();\n\n  const onValueChange = (e: ChangeEvent<HTMLInputElement>) => {\n    onNameChange(e.target.value);\n  };\n\n  return (\n    <div>\n      Type your name here: <br />\n      <input onChange={onValueChange} value={state.name} />\n    </div>\n  );\n};\n```\n\nTake a look at the full code in <a href=\"https://codesandbox.io/s/form-implementation-with-context-2-3wd2i?file=/src/App.tsx\">this codesandbox</a>. Don‚Äôt forget to appreciate how clean it looks now when there is no more mess of props everywhere!\n\n### What about the performance of the new form?\n\nFrom the performance perspective we‚Äôre still not there yet: typing the name and dragging the bar is still lagging. But if I start typing in the `NameFormComponent`, in the console I will now see this:\n\n```\nDiscount situation render\nNameFormComponent render\nSelectCountryFormComponent render\nDiscountFormComponent render\nActionsSection render\nSection render\n```\n\nHalf of the components now don‚Äôt re-render, including our parent `Form` component. This is happening because of how Context works: when a Context value changes, **every consumer of this context will re-render**, regardless of whether they use the changed value or not. But also, those components that are bypassed by Context won‚Äôt be re-rendering at all. Our re-renders flow now looks like this:\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qzccab5jgttb0wk8bul6.png)\n\n\nAnd now, if we look closely at our components implementation, in particular `SelectCountryComponent`, which is the wrapper around the slow ‚Äúexternal‚Äù component, we‚Äôll see that it doesn‚Äôt actually use the `state` itself. All it needs is the `onCountryChange` callback:\n\n```tsx\nexport const SelectCountryFormComponent = () => {\n  const { onCountryChange } = useFormState();\n  console.info('SelectCountryFormComponent render');\n\n  return <SelectCountry onChange={onCountryChange} />;\n};\n```\n\nAnd this gives us an opportunity to try out a really cool trick: we can split the `state` part and the `API` part under our `FormDataProvider`.\n\n## Splitting the state and the API\n\nBasically, what we want to do here is to decompose our ‚Äúmonolith‚Äù state into two ‚Äúmicrostates‚Äù üòÖ.\n\nInstead of one context that has everything we‚Äôd need 2 contexts, one for data, one for API:\n\n```tsx\ntype State = {\n  name: string;\n  country: Country;\n  discount: number;\n};\n\ntype API = {\n  onNameChange: (name: string) => void;\n  onCountryChange: (name: Country) => void;\n  onDiscountChange: (price: number) => void;\n  onSave: () => void;\n};\n\nconst FormDataContext = createContext<State>({} as State);\nconst FormAPIContext = createContext<API>({} as API);\n```\n\nInstead of one context provider in our `FormDataProvider` component, we‚Äôd again have two, where we‚Äôd pass our state directly to the `FormDataContext.Provider`:\n\n```tsx\nconst FormDataProvider = () => {\n  // state logic\n\n  return (\n    <FormAPIContext.Provider value={api}>\n      <FormDataContext.Provider value={state}>{children}</FormDataContext.Provider>\n    </FormAPIContext.Provider>\n  );\n};\n```\n\nAnd now the most interesting part, the `api` value.\n\nIf we just leave it as it was before, the whole ‚Äúdecomposition‚Äù idea is not going to work because we still would have to rely on the `state` as a dependency in the `useMemo` hook:\n\n```tsx\nconst api = useMemo(() => {\n  const onDiscountChange = (discount: number) => {\n    // this is why we still need state here - in order to update it\n    setState({ ...state, discount });\n  };\n\n  // all other callbacks\n\n  return { onSave, onDiscountChange, onNameChange, onCountryChange };\n  // still have state as a dependency\n}, [state]);\n```\n\nThis will result in the `api` value changing with every state update, which would lead to the `FormAPIContext` triggering re-renders on every state update, which would make our split useless. We want our `api` to stay constant regardless of the `state`, so that consumers of this provider don't re-render.\n\nFortunately, there is another neat trick that we can apply here: we can extract our state into a reducer and instead of calling `setState` in the callback we would just trigger a reducer action.\n\nFirst, create actions and reducer itself:\n\n```tsx\ntype Actions =\n  | { type: 'updateName'; name: string }\n  | { type: 'updateCountry'; country: Country }\n  | { type: 'updateDiscount'; discount: number };\n\nconst reducer = (state: State, action: Actions): State => {\n  switch (action.type) {\n    case 'updateName':\n      return { ...state, name: action.name };\n    case 'updateDiscount':\n      return { ...state, discount: action.discount };\n    case 'updateCountry':\n      return { ...state, country: action.country };\n  }\n};\n```\n\nUse reducer instead of `useState`:\n\n```tsx\nexport const FormProvider = ({ children }: { children: ReactNode }) => {\n  const [state, dispatch] = useReducer(reducer, {} as State);\n  // ...\n};\n```\n\nAnd migrate our `api` to `dispatch` instead of `setState`:\n\n```tsx\nconst api = useMemo(() => {\n  const onSave = () => {\n    // send the request to the backend here\n  };\n\n  const onDiscountChange = (discount: number) => {\n    dispatch({ type: 'updateDiscount', discount });\n  };\n\n  const onNameChange = (name: string) => {\n    dispatch({ type: 'updateName', name });\n  };\n\n  const onCountryChange = (country: Country) => {\n    dispatch({ type: 'updateCountry', country });\n  };\n\n  return { onSave, onDiscountChange, onNameChange, onCountryChange };\n  // no more dependency on state! The api value will stay the same\n}, []);\n```\n\nAnd the final step: don‚Äôt forget to migrate all the components that used `useFormState` to `useFormData` and `useFormAPI`. For example, our `SelectCountryFormComponent` will use `onCountryChange` from the `useFormAPI` hook, and will never re-render on the state change.\n\n```tsx\nexport const SelectCountryFormComponent = () => {\n  const { onCountryChange } = useFormAPI();\n\n  return <SelectCountry onChange={onCountryChange} />;\n};\n```\n\nTake a look at the full implementation in <a href=\"https://codesandbox.io/s/form-implementation-split-api-2-g9q3e?file=/src/App.tsx\">this codesandbox.</a> The typing and dragging bar are blazing fast now, and the only console output we‚Äôd see when we type something is this:\n\n```\nDiscount situation render\nNameFormComponent render\n```\n\nOnly two components, since only those two use the actual state data. üéâ\n\n## Splitting state even further\n\nNow, people with good design eyes or just careful readers might notice that I cheated a little bit. We don‚Äôt pass the selected country to our ‚Äúexternal‚Äù `SelectCountry` component, and it's stuck on the very first item in the list. In reality, the selected ‚Äúlilac‚Äù color should move to the country you click on. And the component actually allows us to pass it via `activeCountry`. Technically, I can do it as simple as that:\n\n```tsx\nexport const SelectCountryFormComponent = () => {\n  const { onCountryChange } = useFormAPI();\n  const { country } = useFormData();\n\n  return <SelectCountry onChange={onCountryChange} activeCountry={country} />;\n};\n```\n\nThere is one problem with it though - as soon as I use `useFormData` hook in a component, it will start re-rendering with the state changes, same as `NameFormComponent`. Which in our case means we‚Äôll be back to the laggy experience on typing and dragging.\n\nBut now, since we already know how to split the data between different providers, nothing stops us from taking this to the next level and just splitting the rest of the state as well. Moar providers! üòÖ\n\nInstead of one unified context for `State` we‚Äôll have three now:\n\n```tsx\nconst FormNameContext = createContext<State['name']>({} as State['name']);\nconst FormCountryContext = createContext<State['country']>({} as State['country']);\nconst FormDiscountContext = createContext<State['discount']>({} as State['discount']);\n```\n\nThree state providers:\n\n```tsx\n<FormAPIContext.Provider value={api}>\n  <FormNameContext.Provider value={state.name}>\n    <FormCountryContext.Provider value={state.country}>\n      <FormDiscountContext.Provider value={state.discount}>{children}</FormDiscountContext.Provider>\n    </FormCountryContext.Provider>\n  </FormNameContext.Provider>\n</FormAPIContext.Provider>\n```\n\nAnd three hooks to use the state:\n\n```tsx\nexport const useFormName = () => useContext(FormNameContext);\nexport const useFormCountry = () => useContext(FormCountryContext);\nexport const useFormDiscount = () => useContext(FormDiscountContext);\n```\n\nAnd now in our `SelectCountryFormComponent` we can use `useFormCountry` hook, and it will not be re-rendering on any changes other than country itself:\n\n```tsx\nexport const SelectCountryFormComponent = () => {\n  const { onCountryChange } = useFormAPI();\n  const country = useFormCountry();\n\n  return <SelectCountry onChange={onCountryChange} activeCountry={country} />;\n};\n```\n\nCheck this out <a href=\"https://codesandbox.io/s/form-implementation-split-api-and-state-0tvq0?file=/src/App.tsx\">in codesandbox</a>: it‚Äôs still fast, and country is selectable. And the only thing we‚Äôll see in console output when we type something in the name input is:\n\n```\nNameFormComponent render\n```\n\n## Bonus: external state management\n\nNow, the question of whether this form‚Äôs state should‚Äôve been implemented with some state management library right away might cross some of your minds. And you‚Äôre maybe right. After all, if we look closely at the code, we just re-invented the wheel and implemented a rudimentary state management library, with selectors-like functionality for the state and separate actions to change that state.\n\nBut now you have _a choice_. Context is not a mystery anymore, with those techniques you can easily write performant apps with just pure Context if there is a need, and if you want to transition to any other framework, you can do it with minimal changes to the code. State management framework **doesn‚Äôt really matter** when you design your apps with Context in mind.\n\nWe might as well move it to the good old Redux right now. The only things we‚Äôd need to do are: get rid of Context and Providers, convert React reducer to Redux store, and convert our hooks to use Redux selectors and dispatch.\n\n```tsx\nconst store = createStore((state = {}, action) => {\n  switch (action.type) {\n    case 'updateName':\n      return { ...state, name: action.payload };\n    case 'updateCountry':\n      return { ...state, country: action.payload };\n    case 'updateDiscount':\n      return { ...state, discount: action.payload };\n    default:\n      return state;\n  }\n});\n\nexport const FormDataProvider = ({ children }: { children: ReactNode }) => {\n  return <Provider store={store}>{children}</Provider>;\n};\n\nexport const useFormDiscount = () => useSelector((state) => state.discount);\nexport const useFormCountry = () => useSelector((state) => state.country);\nexport const useFormName = () => useSelector((state) => state.name);\n\nexport const useFormAPI = () => {\n  const dispatch = useDispatch();\n\n  return {\n    onCountryChange: (value) => {\n      dispatch({ type: 'updateCountry', payload: value });\n    },\n    onDiscountChange: (value) => dispatch({ type: 'updateDiscount', payload: value }),\n    onNameChange: (value) => dispatch({ type: 'updateName', payload: value }),\n    onSave: () => {},\n  };\n};\n```\n\nEverything else stays the same and works exactly as we designed. <a href=\"https://codesandbox.io/s/form-implementation-redux-2-t5w30?file=/src/form-api.tsx\">See the codesandbox.</a>\n\nThat is all for today, hope now `Context` is not the source of mysterious spontaneous re-renders in your app, but a solid tool in your arsenal of writing performant React code ‚úåüèº\n\n...\n\nOriginally published at [https://www.developerway.com](https://www.developerway.com). The website has more articles like this üòâ\n\n[Subscribe to the newsletter](https://www.developerway.com), [connect on LinkedIn](https://www.linkedin.com/in/adevnadia/) or [follow on Twitter](https://twitter.com/adevnadia) to get notified as soon as the next article comes out.\n",p.user={name:"Nadia Makarevich",username:a,twitter_username:a,github_username:a,website_url:"https://www.developerway.com",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--JnKvtJkQ--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/762035/1f7fe6e4-1e60-4c01-80cc-532142263682.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--j3FZXwJO--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/762035/1f7fe6e4-1e60-4c01-80cc-532142263682.jpg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:p}},error:s,state:{currentArticle:p},serverRendered:!0,routePath:"/adevnadia/981465",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"2022-02-07T13:01:13Z","adevnadia",{})</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
