<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>DMS Configuration for Oracle to RDS migration</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>DMS Configuration for Oracle to RDS migration</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/aws" class="tag" data-v-70afb46a>
          #aws
        </a><a href="/nuxtstop/t/rds" class="tag" data-v-70afb46a>
          #rds
        </a><a href="/nuxtstop/t/database" class="tag" data-v-70afb46a>
          #database
        </a><a href="/nuxtstop/t/migration" class="tag" data-v-70afb46a>
          #migration
        </a></div> <!----> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            4
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Jun 13 '21</time></div></header> <div class="content" data-v-70afb46a><p><strong>Introduction</strong></p>

<p>The following will help you setup Oracle to RDS database migration.</p>

<p><strong>Goals</strong></p>

<ul>
<li>The following guide will help bootstrap your customers Oracle On Premise → RDS migrations, Oracle RDS → Oracle RDS migrations, etc.</li>
</ul>

<p><strong>Details</strong></p>

<p>DMS consists of 3 main components</p>

<ol>
<li>An instance that does all the heavy lifting
Endpoints, for target and source databases</li>
<li>A task that describes the loading and replication activities</li>
<li>Tasks are where the bulk of the effort is in tuning the replication and load activities.</li>
</ol>

<p>There are 3 types of tasks</p>

<ol>
<li>Full Load</li>
<li>Replication (CDC)</li>
<li>Full load and replication</li>
</ol>

<ul>
<li><p>Source databases are expected to take a 2–5% hit in resource consumption during the full load and sync operations, for a database of any reasonable size expect to be pushing about 20Mbps worth of traffic consistently during replication operations. Full load operations will use considerably higher bandwidth.</p></li>
<li><p>For tables with a primary key we will only enable supplemental logging on the column that contains the primary key, for tables with no primary key then we need it enabled it on all columns. If you have particularly busy Oracle schema, this will cause an impact to your performance. Careful of your potential resource contention issues.</p></li>
</ul>

<p><strong>Getting Setup</strong></p>

<p><strong>VPC configuration</strong></p>

<ul>
<li>Don’t use FQDN. Just use the primary IP address of your RDS (Target) and your on premise over Direct Connect Oracle server. AWS have confirmed that custom DNS servers do not work, the resources created by DMS do not inherit custom DNS configuration.</li>
</ul>

<p>Source Database/Schema Preparation (On Premise)</p>

<ul>
<li><p>You need to create a user and grant them some pretty heavy permissions on both the Source and Target database instances.</p></li>
<li><p>You can find the AWS provided permissions <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html">here</a>; or use the script below to help setup your DMS user on the source Oracle DB.</p></li>
</ul>

<p><strong>Outcomes</strong></p>

<ul>
<li>Correct Permissions for DMS user to replicate data</li>
<li>Enable archive logging if its not already enabled, and explain the archive log destination id</li>
<li>Find the tables with a primary key and list them, then create your alter statement around that list</li>
<li>Find the tables without a primary key, then create your alter statement around that list</li>
</ul>

<p>If you know there are tables in the schema that don’t need to move, it is a good idea to identify those now.</p>

<p>For execution; I use SQL Developer or SQL Plus depending on what I need to do and my connectivity options.</p>

<p>If you are setting up RDS Oracle to RDS Oracle migrations the Source preparation is slightly different.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>-- ON SOURCE DB (NON RDS) (as SYSDBA)
-- DMS onnection attitrubtes addSupplementalLogging=Y;readTableSpaceName=true;archivedLogDestId=1;exposeViews=true
-- other attributes
-- https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html
CREATE user DMS identified by &lt;PASSWORD> default tablespace DATA temporary tablespace DATA_TEMP;
-- Change the above to whatever tablespaces you have configured
Grant CREATE session to DMS;
Grant ALTER ANY TABLE to DMS; 
Grant EXECUTE on dbms_crypto to DMS;
Grant SELECT on ALL_VIEWS to DMS;
Grant SELECT ANY TABLE to DMS;
Grant SELECT ANY TRANSACTION to DMS;
Grant SELECT on V_$ARCHIVED_LOG to DMS;
Grant SELECT on V_$LOG to DMS;
Grant SELECT on V_$LOGFILE to DMS;
Grant SELECT on V_$DATABASE to DMS;
Grant SELECT on V_$THREAD to DMS;
Grant SELECT on V_$PARAMETER to DMS;
Grant SELECT on V_$NLS_PARAMETERS to DMS;
Grant SELECT on V_$TIMEZONE_NAMES to DMS;
Grant SELECT on V_$TRANSACTION to DMS;
Grant SELECT on ALL_INDEXES to DMS;
Grant SELECT on ALL_OBJECTS to DMS;
Grant SELECT on DBA_OBJECTS to DMS; 
Grant SELECT on ALL_TABLES to DMS;
Grant SELECT on ALL_USERS to DMS;
Grant SELECT on ALL_CATALOG to DMS;
Grant SELECT on ALL_CONSTRAINTS to DMS;
Grant SELECT on ALL_CONS_COLUMNS to DMS;
Grant SELECT on ALL_TAB_COLS to DMS;
Grant SELECT on ALL_IND_COLUMNS to DMS;
Grant SELECT on ALL_LOG_GROUPS to DMS;
Grant SELECT on SYS.DBA_REGISTRY to DMS;
Grant SELECT on SYS.OBJ$ to DMS;
Grant SELECT on DBA_TABLESPACES to DMS;
Grant SELECT on ALL_TAB_PARTITIONS to DMS;
Grant SELECT on ALL_ENCRYPTED_COLUMNS to DMS;
Grant SELECT on V_$LOGMNR_LOGS to DMS;
Grant SELECT on V_$LOGMNR_CONTENTS to DMS;
Grant LOGMINING TO DMS;
Grant EXECUTE ON dbms_logmnr TO DMS;
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>-- Ensure archive logging is enabled and if its not, here is how to enable it (CAUTION. This turns off the database if "shutdown immediate" wasn't clear enough.)<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>shutdown immediate;
startup mount;
alter database archivelog;
alter database open;
select dest_id,dest_name, status, destination from v$archive_dest;  
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>-- find tables which have a primary key.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>select at.TABLE_NAME
from all_tables at
where not exists (select 1
from all_constraints ac
where ac.owner = at.owner
and ac.table_name = at.table_name
and ac.constraint_type = 'P')
and at.owner = '&lt;SCHEMA>';
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>-- This will list the tables with a primary key, you can then construct your supplemental logging statement based on the column which has the primay key.<br>
-- ALTER TABLE  ADD SUPPLEMENTAL LOG DATA (PRIMARY KEY) COLUMNS<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SELECT DISTINCT (a.table_name)
FROM ALL_CONS_COLUMNS A
JOIN ALL_CONSTRAINTS C
ON A.CONSTRAINT_NAME = C.CONSTRAINT_NAME
WHERE
C.CONSTRAINT_TYPE not in('P')
and a.owner ='&lt;SCHEMA>';
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>-- This will list all the tables without a primary key, these tables need supplemental logging on all columns. <br>
-- If you run the following and then execute all statements generated, ensure that supplemental logging is enabled on ALL TABLES and COLUMNS.<br>
-- Which will cause a greater performance hit. YMMV.<br>
-- select 'ALTER TABLE '||table_name||' ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;' from all_tables where owner = ''</p>

<p><strong>Target Preparation (RDS)</strong></p>

<ul>
<li>If you have tablespaces with specific block sizes (4k, 8k, 16, etc) then you need to setup your RDS parameter group to allow for caching according to the size of those table spaces. Example below.
</li>
</ul>
<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>ParameterGroup:
      Properties:
        Description: saa-oracle-requirements
        Family: oracle-ee-12.1
        Parameters:
          db_4k_cache_size: '61440'
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p>You can find the required AWS provided permissions <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html">here</a>; or use the following to help setup your schema user on the target RDS Oracle DB.</p>

<p><strong>Outcomes:</strong></p>

<ul>
<li>Correct permissions for  user to ingest data</li>
<li>Create some tables spaces
</li>
</ul>
<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>-- ON TARGET RDS DATABASE 
 -- connection attitrubtes n/a
 -- other attributes n/a
 -- Use the name of the schema you want to import below.
 create user SCHEMA identified by &lt;PASSWORD>;
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$ARCHIVED_LOG','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOG','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGFILE','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$DATABASE','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$THREAD','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$PARAMETER','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$NLS_PARAMETERS','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$TIMEZONE_NAMES','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$TRANSACTION','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('DBA_REGISTRY','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('OBJ$','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_ENCRYPTED_COLUMNS','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGMNR_LOGS','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGMNR_CONTENTS','SCHEMA','SELECT');
 exec rdsadmin.rdsadmin_util.grant_sys_object('DBMS_LOGMNR','SCHEMA','EXECUTE');
 exec rdsadmin.rdsadmin_util.grant_sys_object('DBMS_CRYTPO', 'SCHEMA','EXECUTE');
 grant SELECT ANY TRANSACTION to SCHEMA;
 grant SELECT on V$NLS_PARAMETERS to SCHEMA;
 grant SELECT on V$TIMEZONE_NAMES to SCHEMA;
 grant SELECT on ALL_INDEXES to SCHEMA;
 grant SELECT on ALL_OBJECTS to SCHEMA;
 grant SELECT on DBA_OBJECTS to SCHEMA;
 grant SELECT on ALL_TABLES to SCHEMA;
 grant SELECT on ALL_USERS to SCHEMA;
 grant SELECT on ALL_CATALOG to SCHEMA;
 grant SELECT on ALL_CONSTRAINTS to SCHEMA;
 grant SELECT on ALL_CONS_COLUMNS to SCHEMA;
 grant SELECT on ALL_TAB_COLS to SCHEMA;
 grant SELECT on ALL_IND_COLUMNS to SCHEMA;
 grant DROP ANY TABLE to SCHEMA;
 grant SELECT ANY TABLE to SCHEMA;
 grant INSERT ANY TABLE to SCHEMA;
 grant UPDATE ANY TABLE to SCHEMA;
 grant CREATE ANY TABLE to SCHEMA;
 grant CREATE ANY VIEW to SCHEMA;
 grant DROP ANY VIEW to SCHEMA;
 grant CREATE ANY PROCEDURE to SCHEMA;
 grant ALTER ANY PROCEDURE to SCHEMA;
 grant DROP ANY PROCEDURE to SCHEMA;
 grant CREATE ANY SEQUENCE to SCHEMA;
 grant CREATE ANY TABLESPACE to SCHEMA;
 grant CREATE ANY TABLE to SCHEMA;
 grant ALTER ANY SEQUENCE to SCHEMA;
 grant DROP ANY SEQUENCE to SCHEMA
 grant select on DBA_USERS to SCHEMA;
 grant select on DBA_TAB_PRIVS to SCHEMA;
 grant select on DBA_OBJECTS to SCHEMA;
 grant select on DBA_SYNONYMS to SCHEMA;
 grant select on DBA_SEQUENCES to SCHEMA;
 grant select on DBA_TYPES to SCHEMA;
 grant select on DBA_INDEXES to SCHEMA;
 grant select on DBA_TABLES to SCHEMA;
 grant select on DBA_TRIGGERS to SCHEMA;
 grant UNLIMITED TABLESPACE to SCHEMA;
 grant CREATE SESSION to SCHEMA;
 grant DROP ANY TABLE to SCHEMA;
 grant ALTER ANY TABLE to SCHEMA;
 grant CREATE ANY INDEX to SCHEMA;
 grant LOCK ANY TABLE to SCHEMA;
 create tablespace DATA;
 create tablespace DATA_4k blocksize 4K;
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p><strong>Replication Instances</strong></p>

<p>[<a href="https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-instance.html">https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-instance.html</a>]</p>

<ul>
<li><p>Provision a well sized replication instance, recommend “r” class instances due to memory optimization.</p></li>
<li><p>If this is for production, make it multi-AZ. Give the instance roughly 150% of the storage for your database.</p></li>
</ul>

<p><strong>Endpoint Creation</strong></p>

<p><em>Source</em></p>

<ul>
<li><p>Remember to use the IP address, not FQDN.</p></li>
<li><p>Remember to add the extra connection attributes from the SQL file above.</p></li>
</ul>

<p><em>Target</em></p>

<ul>
<li><p>Again, IP address not FQDN.</p></li>
<li><p>No additional connection attributes should be necessary, unless you need to disable useDirectPathFullLoad. See the documentation for why you might want to do that..</p></li>
</ul>

<p>[<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html</a>]</p>

<p><strong>Tasks</strong></p>

<p>Right. You are finally ready to start debugging replication. Good luck and godspeed.</p>

<p><strong>Don’t use the AWS Console for creating or modifying tasks.</strong> Use the CLI if you’re doing this manually. Half the options are hidden in the console.</p>

<p>I highly recommend that you do this schema by schema, with a separate task for each schema you need to migrate. It will make debugging a lot easier.</p>

<p>Also note, global stored procs and triggers aren’t coming with us. Drop these to SQL and manually create them after you finish the full load operation. Schema level indexes, views, etc should come with us. Table level constraints will as well. If you are having issues with triggers etc, I would recommend that you again drop these to SQL and apply them before the full load, then disable the trigger and enable it after full load is complete. I have included some actions in the debugging section that will help.</p>

<p><strong>What do you want to import?</strong></p>

<p>You’ll need to construct a json file which has the an include statement and ordered list of the schema tables you want to import.</p>

<p>I don’t recommend using a wildcard (%) and then excluding the tables you don’t want, and the reason for this is during debugging if you have a problematic table you can just remove that section from your configuration, drop the table from the target and try again or create a separate task just for that table while you debug the issue.</p>

<p>More information here: [<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.html</a>]</p>

<p>ImportTables.json<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>{
    "rules": [{
            "rule-type": "selection",
            "rule-id": "1", // unique
            "rule-name": "1", // unique 
            "object-locator": {
                "schema-name": "&lt;SCHEMA>",
                "table-name": "TABLE_NAME_ACCEPTS_WILDCARDS_%"
            },
            "rule-action": "include"
        }
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Task Config</strong><br>
Next you need to configure the task.</p>

<p>There are a few things we want to change from the defaults, otherwise I will leave the investigation of each individual option up to you.</p>

<p>[<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TaskSettings.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TaskSettings.html</a>]</p>

<ol>
<li>Only truncate tables that exist, so we keep the metadata. We do this if we have to create any tables in advance, because dropping the table will remove metadata and we just want to clear the contents.</li>
<li>Logging — We want detailed debug logs, or at least debug logs. The defaults don’t give you a lot to work with.</li>
</ol>

<p>TaskConfig.json<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>{
    "TargetMetadata": {
        "TargetSchema": "&lt;SCHEMA>",      // the schema name we want to import to.
        "SupportLobs": true,
        "FullLobMode": true,
        "LobChunkSize": 64,
        "LimitedSizeLobMode": false,
        "LobMaxSize": 0,
        "LoadMaxFileSize": 0,
        "ParallelLoadThreads": 0,
        "ParallelLoadBufferSize": 0,
        "BatchApplyEnabled": true,
        "TaskRecoveryTableEnabled": true
    },
    "FullLoadSettings": {
        "TargetTablePrepMode": "TRUNCATE_BEFORE_LOAD", // this one. 
        "CreatePkAfterFullLoad": false,
        "StopTaskCachedChangesApplied": false,
        "StopTaskCachedChangesNotApplied": false,
        "MaxFullLoadSubTasks": 8,
        "TransactionConsistencyTimeout": 600,
        "CommitRate": 10000
    },
    "Logging": {                    // This is where we change the severity of the logging information. 
        "EnableLogging": true,
        "LogComponents": [{
                "Id": "SOURCE_UNLOAD",
                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"
            },
            {
                "Id": "TARGET_LOAD",
                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"
            },
            {
                "Id": "SOURCE_CAPTURE",
                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"
            },
            {
                "Id": "TARGET_APPLY",
                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"
            }, {
                "Id": "TASK_MANAGER",
                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"
            }
        ],
        "CloudWatchLogGroup": "",
        "CloudWatchLogStream": ""
    },
    "ControlTablesSettings": {
        "historyTimeslotInMinutes": 5,
        "ControlSchema": "",
        "HistoryTimeslotInMinutes": 5,
        "HistoryTableEnabled": true,
        "SuspendedTablesTableEnabled": true,
        "StatusTableEnabled": true
    },
    "StreamBufferSettings": {
        "StreamBufferCount": 3,
        "StreamBufferSizeInMB": 8,
        "CtrlStreamBufferSizeInMB": 5
    },
    "ChangeProcessingDdlHandlingPolicy": {
        "HandleSourceTableDropped": true,
        "HandleSourceTableTruncated": true,
        "HandleSourceTableAltered": true
    },
    "ErrorBehavior": {
        "DataErrorPolicy": "LOG_ERROR",
        "DataTruncationErrorPolicy": "LOG_ERROR",
        "DataErrorEscalationPolicy": "SUSPEND_TABLE",
        "DataErrorEscalationCount": 0,
        "TableErrorPolicy": "SUSPEND_TABLE",
        "TableErrorEscalationPolicy": "STOP_TASK",
        "TableErrorEscalationCount": 0,
        "RecoverableErrorCount": -1,
        "RecoverableErrorInterval": 5,
        "RecoverableErrorThrottling": true,
        "RecoverableErrorThrottlingMax": 1800,
        "ApplyErrorDeletePolicy": "IGNORE_RECORD",
        "ApplyErrorInsertPolicy": "LOG_ERROR",
        "ApplyErrorUpdatePolicy": "LOG_ERROR",
        "ApplyErrorEscalationPolicy": "LOG_ERROR",
        "ApplyErrorEscalationCount": 0,
        "ApplyErrorFailOnTruncationDdl": false,
        "FullLoadIgnoreConflicts": true,
        "FailOnTransactionConsistencyBreached": false,
        "FailOnNoTablesCaptured": false
    },
    "ChangeProcessingTuning": {
        "BatchApplyPreserveTransaction": true,
        "BatchApplyTimeoutMin": 1,
        "BatchApplyTimeoutMax": 30,
        "BatchApplyMemoryLimit": 500,
        "BatchSplitSize": 0,
        "MinTransactionSize": 1000,
        "CommitTimeout": 1,
        "MemoryLimitTotal": 1024,
        "MemoryKeepTime": 60,
        "StatementCacheSize": 50
    },
    "ValidationSettings": {
        "EnableValidation": true,
        "ValidationMode": "ROW_LEVEL",
        "ThreadCount": 5,
        "PartitionSize": 10000,
        "FailureMaxCount": 10000,
        "RecordFailureDelayInMinutes": 5,
        "RecordSuspendDelayInMinutes": 30,
        "MaxKeyColumnSize": 8096,
        "TableFailureMaxCount": 1000,
        "ValidationOnly": false,
        "HandleCollationDiff": false,
        "RecordFailureDelayLimitInMinutes": 0
    }
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now you can create and run the task. [<a href="https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-task.html">https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-task.html</a>]<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>aws dms create-replication-task --replication-task-identifier &lt;value> \
 --source-endpoint-arn &lt;value> \ 
 --target-endpoint-arn &lt;value> \ 
 --replication-instance-arn &lt;value> \ 
 --migration-type full-load-and-cdc \ 
 --table-mappings ImportTables.json \
 --replication-task-settings TaskConfig.json
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Debugging</strong><br>
If you followed the above initial setup, configuration issues should be minimal.</p>

<p>Cloudwatch logs are enabled for DMS and in the above setup we configured them to be at detailed debug level, this should give you an accurate error message in CloudWatch when a table import misbehaves.</p>

<p>Unfortunately this is where things begin to fall into the realms of DBA territory… but essentially read the logs, weaponise google search, get the DBA guy to help you out. It’s not impossible and in nonproduction you basically get unlimited retries.</p>

<p><strong>Suggestions</strong></p>

<ul>
<li>Multiple, smaller replication task over 1 all inclusive replication task. This will increase your throughput so be mindful of any resource constraints. However, this makes it easier to debug.</li>
<li>I used 3 tasks, 1 for the majority of tables and 2 smaller jobs for misc tables or tables that were identified as troublesome during our nonproduction DMS migrations. Order your imports.</li>
<li>If you have a table that isn’t importing properly due to a constraint or trigger, disable those on the target during full load and then once that is complete, enable them for CDC replication.</li>
<li>Constraints can be turned on and off.
</li>
</ul>
<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>declare
begin
for c1 in (select y1.table_name, y1.constraint_name from user_constraints y1, user_tables x1 where x1.table_name = y1.table_name order by y1.r_constraint_name nulls last) loop
    begin
        dbms_output.put_line('alter table '||c1.table_name||' disable constraint '||c1.constraint_name || ';');
        execute immediate  ('alter table '||c1.table_name||' disable constraint '||c1.constraint_name);
    end;
end loop;

-- uncomment to truncate the table after disabling the constraint.
-- for t1 in (select table_name from user_tables) loop
--     begin
--         dbms_output.put_line('truncate table '||t1.table_name || ';');   
--         execute immediate ('truncate table '||t1.table_name);
--     end;
-- end loop;

for c2 in (select y2.table_name, y2.constraint_name from user_constraints y2, user_tables x2 where x2.table_name = y2.table_name order by y2.r_constraint_name nulls first) loop
    begin
        dbms_output.put_line('alter table '||c2.table_name||' enable constraint '||c2.constraint_name || ';');       
        execute immediate ('alter table '||c2.table_name||' enable constraint '||c2.constraint_name);
    end;
end loop;
end;
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p><strong>Disable/Enable Triggers</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>CREATE OR REPLACE PROCEDURE ALTER_ALL_TRIGGERS(status VARCHAR2) IS
  CURSOR c_tr IS (SELECT 'ALTER TRIGGER ' || trigger_name AS stmnt FROM user_triggers);
BEGIN
  IF status NOT IN ('ENABLE', 'enable', 'DISABLE', 'disable') THEN
    DBMS_OUTPUT.PUT_LINE('ONLY ''ENABLEDISABLE'' ACCEPTED AS PARAMETERS');
    RAISE VALUE_ERROR;
  END IF;
  FOR tr IN c_tr LOOP
    EXECUTE IMMEDIATE tr.stmnt || ' ' || status;
  END LOOP;
END;
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>





<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>EXEC ALTER_ALL_TRIGGERS('DISABLE');
EXEC ALTER_ALL_TRIGGERS('ENABLE');
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<ul>
<li>Use the table statics tab to check out the progress of the DMS task. From here you can also drop a table and reload its data. This can be a useful tool for small tables where validation fails and you make a change but don’t want to restart the whole task.</li>
<li>Read the logs. They will often write out the SQL that failed which you can then replay to debug.</li>
<li>Finally if all else is failing, remember that dropping an entire table to SQL and manually importing it isn’t the end of the world (depending of course on number of rows). Just exclude it from your TableImport.json and move on.</li>
</ul>

<p><strong>Validation</strong></p>

<p>After successful Full load and CDC has kicked off, your tasks will take a status of “Load Complete, replication ongoing”.</p>

<p>AWS DMS runs its own validation to ensure that the tables are aligned, which will throw a status of “TableError” in table statistics and “Error” on Tasks screen.</p>

<p>It is now time to get the Application team and DBA to check the schema and table data. You can also run your own validation steps, write some SQL and do a spot check across both databases. The simplest test is of course, if the application works and passes regression testing on the new database.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/aklm10barca/dms-configuration-for-oracle-to-rds-migration-1gfm" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(t,n,e,a,o,i){return e.type_of="article",e.id=727102,e.title="DMS Configuration for Oracle to RDS migration",e.description="Introduction  The following will help you setup Oracle to RDS database migration.  Goals   The...",e.readable_publish_date="Jun 13 '21",e.slug="dms-configuration-for-oracle-to-rds-migration-1gfm",e.path="/aws-builders/dms-configuration-for-oracle-to-rds-migration-1gfm",e.url=a,e.comments_count=0,e.public_reactions_count=4,e.collection_id=t,e.published_timestamp=n,e.positive_reactions_count=4,e.cover_image=t,e.social_image="https://dev.to/social_previews/article/727102.png",e.canonical_url=a,e.created_at=n,e.edited_at="2021-07-05T03:30:35Z",e.crossposted_at=t,e.published_at=n,e.last_comment_at=n,e.reading_time_minutes=11,e.tag_list="aws, rds, database, migration",e.tags=["aws","rds","database","migration"],e.body_html='<p><strong>Introduction</strong></p>\n\n<p>The following will help you setup Oracle to RDS database migration.</p>\n\n<p><strong>Goals</strong></p>\n\n<ul>\n<li>The following guide will help bootstrap your customers Oracle On Premise → RDS migrations, Oracle RDS → Oracle RDS migrations, etc.</li>\n</ul>\n\n<p><strong>Details</strong></p>\n\n<p>DMS consists of 3 main components</p>\n\n<ol>\n<li>An instance that does all the heavy lifting\nEndpoints, for target and source databases</li>\n<li>A task that describes the loading and replication activities</li>\n<li>Tasks are where the bulk of the effort is in tuning the replication and load activities.</li>\n</ol>\n\n<p>There are 3 types of tasks</p>\n\n<ol>\n<li>Full Load</li>\n<li>Replication (CDC)</li>\n<li>Full load and replication</li>\n</ol>\n\n<ul>\n<li><p>Source databases are expected to take a 2–5% hit in resource consumption during the full load and sync operations, for a database of any reasonable size expect to be pushing about 20Mbps worth of traffic consistently during replication operations. Full load operations will use considerably higher bandwidth.</p></li>\n<li><p>For tables with a primary key we will only enable supplemental logging on the column that contains the primary key, for tables with no primary key then we need it enabled it on all columns. If you have particularly busy Oracle schema, this will cause an impact to your performance. Careful of your potential resource contention issues.</p></li>\n</ul>\n\n<p><strong>Getting Setup</strong></p>\n\n<p><strong>VPC configuration</strong></p>\n\n<ul>\n<li>Don’t use FQDN. Just use the primary IP address of your RDS (Target) and your on premise over Direct Connect Oracle server. AWS have confirmed that custom DNS servers do not work, the resources created by DMS do not inherit custom DNS configuration.</li>\n</ul>\n\n<p>Source Database/Schema Preparation (On Premise)</p>\n\n<ul>\n<li><p>You need to create a user and grant them some pretty heavy permissions on both the Source and Target database instances.</p></li>\n<li><p>You can find the AWS provided permissions <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html">here</a>; or use the script below to help setup your DMS user on the source Oracle DB.</p></li>\n</ul>\n\n<p><strong>Outcomes</strong></p>\n\n<ul>\n<li>Correct Permissions for DMS user to replicate data</li>\n<li>Enable archive logging if its not already enabled, and explain the archive log destination id</li>\n<li>Find the tables with a primary key and list them, then create your alter statement around that list</li>\n<li>Find the tables without a primary key, then create your alter statement around that list</li>\n</ul>\n\n<p>If you know there are tables in the schema that don’t need to move, it is a good idea to identify those now.</p>\n\n<p>For execution; I use SQL Developer or SQL Plus depending on what I need to do and my connectivity options.</p>\n\n<p>If you are setting up RDS Oracle to RDS Oracle migrations the Source preparation is slightly different.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>-- ON SOURCE DB (NON RDS) (as SYSDBA)\n-- DMS onnection attitrubtes addSupplementalLogging=Y;readTableSpaceName=true;archivedLogDestId=1;exposeViews=true\n-- other attributes\n-- https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html\nCREATE user DMS identified by &lt;PASSWORD&gt; default tablespace DATA temporary tablespace DATA_TEMP;\n-- Change the above to whatever tablespaces you have configured\nGrant CREATE session to DMS;\nGrant ALTER ANY TABLE to DMS; \nGrant EXECUTE on dbms_crypto to DMS;\nGrant SELECT on ALL_VIEWS to DMS;\nGrant SELECT ANY TABLE to DMS;\nGrant SELECT ANY TRANSACTION to DMS;\nGrant SELECT on V_$ARCHIVED_LOG to DMS;\nGrant SELECT on V_$LOG to DMS;\nGrant SELECT on V_$LOGFILE to DMS;\nGrant SELECT on V_$DATABASE to DMS;\nGrant SELECT on V_$THREAD to DMS;\nGrant SELECT on V_$PARAMETER to DMS;\nGrant SELECT on V_$NLS_PARAMETERS to DMS;\nGrant SELECT on V_$TIMEZONE_NAMES to DMS;\nGrant SELECT on V_$TRANSACTION to DMS;\nGrant SELECT on ALL_INDEXES to DMS;\nGrant SELECT on ALL_OBJECTS to DMS;\nGrant SELECT on DBA_OBJECTS to DMS; \nGrant SELECT on ALL_TABLES to DMS;\nGrant SELECT on ALL_USERS to DMS;\nGrant SELECT on ALL_CATALOG to DMS;\nGrant SELECT on ALL_CONSTRAINTS to DMS;\nGrant SELECT on ALL_CONS_COLUMNS to DMS;\nGrant SELECT on ALL_TAB_COLS to DMS;\nGrant SELECT on ALL_IND_COLUMNS to DMS;\nGrant SELECT on ALL_LOG_GROUPS to DMS;\nGrant SELECT on SYS.DBA_REGISTRY to DMS;\nGrant SELECT on SYS.OBJ$ to DMS;\nGrant SELECT on DBA_TABLESPACES to DMS;\nGrant SELECT on ALL_TAB_PARTITIONS to DMS;\nGrant SELECT on ALL_ENCRYPTED_COLUMNS to DMS;\nGrant SELECT on V_$LOGMNR_LOGS to DMS;\nGrant SELECT on V_$LOGMNR_CONTENTS to DMS;\nGrant LOGMINING TO DMS;\nGrant EXECUTE ON dbms_logmnr TO DMS;\nALTER DATABASE ADD SUPPLEMENTAL LOG DATA;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>-- Ensure archive logging is enabled and if its not, here is how to enable it (CAUTION. This turns off the database if "shutdown immediate" wasn\'t clear enough.)<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>shutdown immediate;\nstartup mount;\nalter database archivelog;\nalter database open;\nselect dest_id,dest_name, status, destination from v$archive_dest;  \n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>-- find tables which have a primary key.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>select at.TABLE_NAME\nfrom all_tables at\nwhere not exists (select 1\nfrom all_constraints ac\nwhere ac.owner = at.owner\nand ac.table_name = at.table_name\nand ac.constraint_type = \'P\')\nand at.owner = \'&lt;SCHEMA&gt;\';\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>-- This will list the tables with a primary key, you can then construct your supplemental logging statement based on the column which has the primay key.<br>\n-- ALTER TABLE  ADD SUPPLEMENTAL LOG DATA (PRIMARY KEY) COLUMNS<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>SELECT DISTINCT (a.table_name)\nFROM ALL_CONS_COLUMNS A\nJOIN ALL_CONSTRAINTS C\nON A.CONSTRAINT_NAME = C.CONSTRAINT_NAME\nWHERE\nC.CONSTRAINT_TYPE not in(\'P\')\nand a.owner =\'&lt;SCHEMA&gt;\';\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>-- This will list all the tables without a primary key, these tables need supplemental logging on all columns. <br>\n-- If you run the following and then execute all statements generated, ensure that supplemental logging is enabled on ALL TABLES and COLUMNS.<br>\n-- Which will cause a greater performance hit. YMMV.<br>\n-- select \'ALTER TABLE \'||table_name||\' ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;\' from all_tables where owner = \'\'</p>\n\n<p><strong>Target Preparation (RDS)</strong></p>\n\n<ul>\n<li>If you have tablespaces with specific block sizes (4k, 8k, 16, etc) then you need to setup your RDS parameter group to allow for caching according to the size of those table spaces. Example below.\n</li>\n</ul>\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>ParameterGroup:\n      Properties:\n        Description: saa-oracle-requirements\n        Family: oracle-ee-12.1\n        Parameters:\n          db_4k_cache_size: \'61440\'\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p>You can find the required AWS provided permissions <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html">here</a>; or use the following to help setup your schema user on the target RDS Oracle DB.</p>\n\n<p><strong>Outcomes:</strong></p>\n\n<ul>\n<li>Correct permissions for  user to ingest data</li>\n<li>Create some tables spaces\n</li>\n</ul>\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>-- ON TARGET RDS DATABASE \n -- connection attitrubtes n/a\n -- other attributes n/a\n -- Use the name of the schema you want to import below.\n create user SCHEMA identified by &lt;PASSWORD&gt;;\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$ARCHIVED_LOG\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOG\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGFILE\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$DATABASE\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$THREAD\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$PARAMETER\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$NLS_PARAMETERS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$TIMEZONE_NAMES\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$TRANSACTION\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBA_REGISTRY\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'OBJ$\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'ALL_ENCRYPTED_COLUMNS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGMNR_LOGS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGMNR_CONTENTS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBMS_LOGMNR\',\'SCHEMA\',\'EXECUTE\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBMS_CRYTPO\', \'SCHEMA\',\'EXECUTE\');\n grant SELECT ANY TRANSACTION to SCHEMA;\n grant SELECT on V$NLS_PARAMETERS to SCHEMA;\n grant SELECT on V$TIMEZONE_NAMES to SCHEMA;\n grant SELECT on ALL_INDEXES to SCHEMA;\n grant SELECT on ALL_OBJECTS to SCHEMA;\n grant SELECT on DBA_OBJECTS to SCHEMA;\n grant SELECT on ALL_TABLES to SCHEMA;\n grant SELECT on ALL_USERS to SCHEMA;\n grant SELECT on ALL_CATALOG to SCHEMA;\n grant SELECT on ALL_CONSTRAINTS to SCHEMA;\n grant SELECT on ALL_CONS_COLUMNS to SCHEMA;\n grant SELECT on ALL_TAB_COLS to SCHEMA;\n grant SELECT on ALL_IND_COLUMNS to SCHEMA;\n grant DROP ANY TABLE to SCHEMA;\n grant SELECT ANY TABLE to SCHEMA;\n grant INSERT ANY TABLE to SCHEMA;\n grant UPDATE ANY TABLE to SCHEMA;\n grant CREATE ANY TABLE to SCHEMA;\n grant CREATE ANY VIEW to SCHEMA;\n grant DROP ANY VIEW to SCHEMA;\n grant CREATE ANY PROCEDURE to SCHEMA;\n grant ALTER ANY PROCEDURE to SCHEMA;\n grant DROP ANY PROCEDURE to SCHEMA;\n grant CREATE ANY SEQUENCE to SCHEMA;\n grant CREATE ANY TABLESPACE to SCHEMA;\n grant CREATE ANY TABLE to SCHEMA;\n grant ALTER ANY SEQUENCE to SCHEMA;\n grant DROP ANY SEQUENCE to SCHEMA\n grant select on DBA_USERS to SCHEMA;\n grant select on DBA_TAB_PRIVS to SCHEMA;\n grant select on DBA_OBJECTS to SCHEMA;\n grant select on DBA_SYNONYMS to SCHEMA;\n grant select on DBA_SEQUENCES to SCHEMA;\n grant select on DBA_TYPES to SCHEMA;\n grant select on DBA_INDEXES to SCHEMA;\n grant select on DBA_TABLES to SCHEMA;\n grant select on DBA_TRIGGERS to SCHEMA;\n grant UNLIMITED TABLESPACE to SCHEMA;\n grant CREATE SESSION to SCHEMA;\n grant DROP ANY TABLE to SCHEMA;\n grant ALTER ANY TABLE to SCHEMA;\n grant CREATE ANY INDEX to SCHEMA;\n grant LOCK ANY TABLE to SCHEMA;\n create tablespace DATA;\n create tablespace DATA_4k blocksize 4K;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p><strong>Replication Instances</strong></p>\n\n<p>[<a href="https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-instance.html">https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-instance.html</a>]</p>\n\n<ul>\n<li><p>Provision a well sized replication instance, recommend “r” class instances due to memory optimization.</p></li>\n<li><p>If this is for production, make it multi-AZ. Give the instance roughly 150% of the storage for your database.</p></li>\n</ul>\n\n<p><strong>Endpoint Creation</strong></p>\n\n<p><em>Source</em></p>\n\n<ul>\n<li><p>Remember to use the IP address, not FQDN.</p></li>\n<li><p>Remember to add the extra connection attributes from the SQL file above.</p></li>\n</ul>\n\n<p><em>Target</em></p>\n\n<ul>\n<li><p>Again, IP address not FQDN.</p></li>\n<li><p>No additional connection attributes should be necessary, unless you need to disable useDirectPathFullLoad. See the documentation for why you might want to do that..</p></li>\n</ul>\n\n<p>[<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html</a>]</p>\n\n<p><strong>Tasks</strong></p>\n\n<p>Right. You are finally ready to start debugging replication. Good luck and godspeed.</p>\n\n<p><strong>Don’t use the AWS Console for creating or modifying tasks.</strong> Use the CLI if you’re doing this manually. Half the options are hidden in the console.</p>\n\n<p>I highly recommend that you do this schema by schema, with a separate task for each schema you need to migrate. It will make debugging a lot easier.</p>\n\n<p>Also note, global stored procs and triggers aren’t coming with us. Drop these to SQL and manually create them after you finish the full load operation. Schema level indexes, views, etc should come with us. Table level constraints will as well. If you are having issues with triggers etc, I would recommend that you again drop these to SQL and apply them before the full load, then disable the trigger and enable it after full load is complete. I have included some actions in the debugging section that will help.</p>\n\n<p><strong>What do you want to import?</strong></p>\n\n<p>You’ll need to construct a json file which has the an include statement and ordered list of the schema tables you want to import.</p>\n\n<p>I don’t recommend using a wildcard (%) and then excluding the tables you don’t want, and the reason for this is during debugging if you have a problematic table you can just remove that section from your configuration, drop the table from the target and try again or create a separate task just for that table while you debug the issue.</p>\n\n<p>More information here: [<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.html</a>]</p>\n\n<p>ImportTables.json<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>{\n    "rules": [{\n            "rule-type": "selection",\n            "rule-id": "1", // unique\n            "rule-name": "1", // unique \n            "object-locator": {\n                "schema-name": "&lt;SCHEMA&gt;",\n                "table-name": "TABLE_NAME_ACCEPTS_WILDCARDS_%"\n            },\n            "rule-action": "include"\n        }\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Task Config</strong><br>\nNext you need to configure the task.</p>\n\n<p>There are a few things we want to change from the defaults, otherwise I will leave the investigation of each individual option up to you.</p>\n\n<p>[<a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TaskSettings.html">https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TaskSettings.html</a>]</p>\n\n<ol>\n<li>Only truncate tables that exist, so we keep the metadata. We do this if we have to create any tables in advance, because dropping the table will remove metadata and we just want to clear the contents.</li>\n<li>Logging — We want detailed debug logs, or at least debug logs. The defaults don’t give you a lot to work with.</li>\n</ol>\n\n<p>TaskConfig.json<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>{\n    "TargetMetadata": {\n        "TargetSchema": "&lt;SCHEMA&gt;",      // the schema name we want to import to.\n        "SupportLobs": true,\n        "FullLobMode": true,\n        "LobChunkSize": 64,\n        "LimitedSizeLobMode": false,\n        "LobMaxSize": 0,\n        "LoadMaxFileSize": 0,\n        "ParallelLoadThreads": 0,\n        "ParallelLoadBufferSize": 0,\n        "BatchApplyEnabled": true,\n        "TaskRecoveryTableEnabled": true\n    },\n    "FullLoadSettings": {\n        "TargetTablePrepMode": "TRUNCATE_BEFORE_LOAD", // this one. \n        "CreatePkAfterFullLoad": false,\n        "StopTaskCachedChangesApplied": false,\n        "StopTaskCachedChangesNotApplied": false,\n        "MaxFullLoadSubTasks": 8,\n        "TransactionConsistencyTimeout": 600,\n        "CommitRate": 10000\n    },\n    "Logging": {                    // This is where we change the severity of the logging information. \n        "EnableLogging": true,\n        "LogComponents": [{\n                "Id": "SOURCE_UNLOAD",\n                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n            },\n            {\n                "Id": "TARGET_LOAD",\n                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n            },\n            {\n                "Id": "SOURCE_CAPTURE",\n                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n            },\n            {\n                "Id": "TARGET_APPLY",\n                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n            }, {\n                "Id": "TASK_MANAGER",\n                "Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n            }\n        ],\n        "CloudWatchLogGroup": "",\n        "CloudWatchLogStream": ""\n    },\n    "ControlTablesSettings": {\n        "historyTimeslotInMinutes": 5,\n        "ControlSchema": "",\n        "HistoryTimeslotInMinutes": 5,\n        "HistoryTableEnabled": true,\n        "SuspendedTablesTableEnabled": true,\n        "StatusTableEnabled": true\n    },\n    "StreamBufferSettings": {\n        "StreamBufferCount": 3,\n        "StreamBufferSizeInMB": 8,\n        "CtrlStreamBufferSizeInMB": 5\n    },\n    "ChangeProcessingDdlHandlingPolicy": {\n        "HandleSourceTableDropped": true,\n        "HandleSourceTableTruncated": true,\n        "HandleSourceTableAltered": true\n    },\n    "ErrorBehavior": {\n        "DataErrorPolicy": "LOG_ERROR",\n        "DataTruncationErrorPolicy": "LOG_ERROR",\n        "DataErrorEscalationPolicy": "SUSPEND_TABLE",\n        "DataErrorEscalationCount": 0,\n        "TableErrorPolicy": "SUSPEND_TABLE",\n        "TableErrorEscalationPolicy": "STOP_TASK",\n        "TableErrorEscalationCount": 0,\n        "RecoverableErrorCount": -1,\n        "RecoverableErrorInterval": 5,\n        "RecoverableErrorThrottling": true,\n        "RecoverableErrorThrottlingMax": 1800,\n        "ApplyErrorDeletePolicy": "IGNORE_RECORD",\n        "ApplyErrorInsertPolicy": "LOG_ERROR",\n        "ApplyErrorUpdatePolicy": "LOG_ERROR",\n        "ApplyErrorEscalationPolicy": "LOG_ERROR",\n        "ApplyErrorEscalationCount": 0,\n        "ApplyErrorFailOnTruncationDdl": false,\n        "FullLoadIgnoreConflicts": true,\n        "FailOnTransactionConsistencyBreached": false,\n        "FailOnNoTablesCaptured": false\n    },\n    "ChangeProcessingTuning": {\n        "BatchApplyPreserveTransaction": true,\n        "BatchApplyTimeoutMin": 1,\n        "BatchApplyTimeoutMax": 30,\n        "BatchApplyMemoryLimit": 500,\n        "BatchSplitSize": 0,\n        "MinTransactionSize": 1000,\n        "CommitTimeout": 1,\n        "MemoryLimitTotal": 1024,\n        "MemoryKeepTime": 60,\n        "StatementCacheSize": 50\n    },\n    "ValidationSettings": {\n        "EnableValidation": true,\n        "ValidationMode": "ROW_LEVEL",\n        "ThreadCount": 5,\n        "PartitionSize": 10000,\n        "FailureMaxCount": 10000,\n        "RecordFailureDelayInMinutes": 5,\n        "RecordSuspendDelayInMinutes": 30,\n        "MaxKeyColumnSize": 8096,\n        "TableFailureMaxCount": 1000,\n        "ValidationOnly": false,\n        "HandleCollationDiff": false,\n        "RecordFailureDelayLimitInMinutes": 0\n    }\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now you can create and run the task. [<a href="https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-task.html">https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-task.html</a>]<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>aws dms create-replication-task --replication-task-identifier &lt;value&gt; \\\n --source-endpoint-arn &lt;value&gt; \\ \n --target-endpoint-arn &lt;value&gt; \\ \n --replication-instance-arn &lt;value&gt; \\ \n --migration-type full-load-and-cdc \\ \n --table-mappings ImportTables.json \\\n --replication-task-settings TaskConfig.json\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Debugging</strong><br>\nIf you followed the above initial setup, configuration issues should be minimal.</p>\n\n<p>Cloudwatch logs are enabled for DMS and in the above setup we configured them to be at detailed debug level, this should give you an accurate error message in CloudWatch when a table import misbehaves.</p>\n\n<p>Unfortunately this is where things begin to fall into the realms of DBA territory… but essentially read the logs, weaponise google search, get the DBA guy to help you out. It’s not impossible and in nonproduction you basically get unlimited retries.</p>\n\n<p><strong>Suggestions</strong></p>\n\n<ul>\n<li>Multiple, smaller replication task over 1 all inclusive replication task. This will increase your throughput so be mindful of any resource constraints. However, this makes it easier to debug.</li>\n<li>I used 3 tasks, 1 for the majority of tables and 2 smaller jobs for misc tables or tables that were identified as troublesome during our nonproduction DMS migrations. Order your imports.</li>\n<li>If you have a table that isn’t importing properly due to a constraint or trigger, disable those on the target during full load and then once that is complete, enable them for CDC replication.</li>\n<li>Constraints can be turned on and off.\n</li>\n</ul>\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>declare\nbegin\nfor c1 in (select y1.table_name, y1.constraint_name from user_constraints y1, user_tables x1 where x1.table_name = y1.table_name order by y1.r_constraint_name nulls last) loop\n    begin\n        dbms_output.put_line(\'alter table \'||c1.table_name||\' disable constraint \'||c1.constraint_name || \';\');\n        execute immediate  (\'alter table \'||c1.table_name||\' disable constraint \'||c1.constraint_name);\n    end;\nend loop;\n\n-- uncomment to truncate the table after disabling the constraint.\n-- for t1 in (select table_name from user_tables) loop\n--     begin\n--         dbms_output.put_line(\'truncate table \'||t1.table_name || \';\');   \n--         execute immediate (\'truncate table \'||t1.table_name);\n--     end;\n-- end loop;\n\nfor c2 in (select y2.table_name, y2.constraint_name from user_constraints y2, user_tables x2 where x2.table_name = y2.table_name order by y2.r_constraint_name nulls first) loop\n    begin\n        dbms_output.put_line(\'alter table \'||c2.table_name||\' enable constraint \'||c2.constraint_name || \';\');       \n        execute immediate (\'alter table \'||c2.table_name||\' enable constraint \'||c2.constraint_name);\n    end;\nend loop;\nend;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p><strong>Disable/Enable Triggers</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>CREATE OR REPLACE PROCEDURE ALTER_ALL_TRIGGERS(status VARCHAR2) IS\n  CURSOR c_tr IS (SELECT \'ALTER TRIGGER \' || trigger_name AS stmnt FROM user_triggers);\nBEGIN\n  IF status NOT IN (\'ENABLE\', \'enable\', \'DISABLE\', \'disable\') THEN\n    DBMS_OUTPUT.PUT_LINE(\'ONLY \'\'ENABLEDISABLE\'\' ACCEPTED AS PARAMETERS\');\n    RAISE VALUE_ERROR;\n  END IF;\n  FOR tr IN c_tr LOOP\n    EXECUTE IMMEDIATE tr.stmnt || \' \' || status;\n  END LOOP;\nEND;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>EXEC ALTER_ALL_TRIGGERS(\'DISABLE\');\nEXEC ALTER_ALL_TRIGGERS(\'ENABLE\');\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<ul>\n<li>Use the table statics tab to check out the progress of the DMS task. From here you can also drop a table and reload its data. This can be a useful tool for small tables where validation fails and you make a change but don’t want to restart the whole task.</li>\n<li>Read the logs. They will often write out the SQL that failed which you can then replay to debug.</li>\n<li>Finally if all else is failing, remember that dropping an entire table to SQL and manually importing it isn’t the end of the world (depending of course on number of rows). Just exclude it from your TableImport.json and move on.</li>\n</ul>\n\n<p><strong>Validation</strong></p>\n\n<p>After successful Full load and CDC has kicked off, your tasks will take a status of “Load Complete, replication ongoing”.</p>\n\n<p>AWS DMS runs its own validation to ensure that the tables are aligned, which will throw a status of “TableError” in table statistics and “Error” on Tasks screen.</p>\n\n<p>It is now time to get the Application team and DBA to check the schema and table data. You can also run your own validation steps, write some SQL and do a spot check across both databases. The simplest test is of course, if the application works and passes regression testing on the new database.</p>\n\n',e.body_markdown='**Introduction**\n\nThe following will help you setup Oracle to RDS database migration.\n\n**Goals**\n\n* The following guide will help bootstrap your customers Oracle On Premise → RDS migrations, Oracle RDS → Oracle RDS migrations, etc.\n\n**Details**\n\nDMS consists of 3 main components\n\n1. An instance that does all the heavy lifting\nEndpoints, for target and source databases\n2. A task that describes the loading and replication activities\n3. Tasks are where the bulk of the effort is in tuning the replication and load activities.\n\nThere are 3 types of tasks\n\n1. Full Load\n2. Replication (CDC)\n3. Full load and replication\n\n* Source databases are expected to take a 2–5% hit in resource consumption during the full load and sync operations, for a database of any reasonable size expect to be pushing about 20Mbps worth of traffic consistently during replication operations. Full load operations will use considerably higher bandwidth.\n\n* For tables with a primary key we will only enable supplemental logging on the column that contains the primary key, for tables with no primary key then we need it enabled it on all columns. If you have particularly busy Oracle schema, this will cause an impact to your performance. Careful of your potential resource contention issues.\n\n**Getting Setup**\n\n**VPC configuration**\n\n* Don’t use FQDN. Just use the primary IP address of your RDS (Target) and your on premise over Direct Connect Oracle server. AWS have confirmed that custom DNS servers do not work, the resources created by DMS do not inherit custom DNS configuration.\n\nSource Database/Schema Preparation (On Premise)\n\n* You need to create a user and grant them some pretty heavy permissions on both the Source and Target database instances.\n\n* You can find the AWS provided permissions [here](https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html); or use the script below to help setup your DMS user on the source Oracle DB.\n\n**Outcomes**\n\n* Correct Permissions for DMS user to replicate data\n* Enable archive logging if its not already enabled, and explain the archive log destination id\n* Find the tables with a primary key and list them, then create your alter statement around that list\n* Find the tables without a primary key, then create your alter statement around that list\n\nIf you know there are tables in the schema that don’t need to move, it is a good idea to identify those now.\n\nFor execution; I use SQL Developer or SQL Plus depending on what I need to do and my connectivity options.\n\nIf you are setting up RDS Oracle to RDS Oracle migrations the Source preparation is slightly different.\n```\n-- ON SOURCE DB (NON RDS) (as SYSDBA)\n-- DMS onnection attitrubtes addSupplementalLogging=Y;readTableSpaceName=true;archivedLogDestId=1;exposeViews=true\n-- other attributes\n-- https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.Oracle.html\nCREATE user DMS identified by <PASSWORD> default tablespace DATA temporary tablespace DATA_TEMP;\n-- Change the above to whatever tablespaces you have configured\nGrant CREATE session to DMS;\nGrant ALTER ANY TABLE to DMS; \nGrant EXECUTE on dbms_crypto to DMS;\nGrant SELECT on ALL_VIEWS to DMS;\nGrant SELECT ANY TABLE to DMS;\nGrant SELECT ANY TRANSACTION to DMS;\nGrant SELECT on V_$ARCHIVED_LOG to DMS;\nGrant SELECT on V_$LOG to DMS;\nGrant SELECT on V_$LOGFILE to DMS;\nGrant SELECT on V_$DATABASE to DMS;\nGrant SELECT on V_$THREAD to DMS;\nGrant SELECT on V_$PARAMETER to DMS;\nGrant SELECT on V_$NLS_PARAMETERS to DMS;\nGrant SELECT on V_$TIMEZONE_NAMES to DMS;\nGrant SELECT on V_$TRANSACTION to DMS;\nGrant SELECT on ALL_INDEXES to DMS;\nGrant SELECT on ALL_OBJECTS to DMS;\nGrant SELECT on DBA_OBJECTS to DMS; \nGrant SELECT on ALL_TABLES to DMS;\nGrant SELECT on ALL_USERS to DMS;\nGrant SELECT on ALL_CATALOG to DMS;\nGrant SELECT on ALL_CONSTRAINTS to DMS;\nGrant SELECT on ALL_CONS_COLUMNS to DMS;\nGrant SELECT on ALL_TAB_COLS to DMS;\nGrant SELECT on ALL_IND_COLUMNS to DMS;\nGrant SELECT on ALL_LOG_GROUPS to DMS;\nGrant SELECT on SYS.DBA_REGISTRY to DMS;\nGrant SELECT on SYS.OBJ$ to DMS;\nGrant SELECT on DBA_TABLESPACES to DMS;\nGrant SELECT on ALL_TAB_PARTITIONS to DMS;\nGrant SELECT on ALL_ENCRYPTED_COLUMNS to DMS;\nGrant SELECT on V_$LOGMNR_LOGS to DMS;\nGrant SELECT on V_$LOGMNR_CONTENTS to DMS;\nGrant LOGMINING TO DMS;\nGrant EXECUTE ON dbms_logmnr TO DMS;\nALTER DATABASE ADD SUPPLEMENTAL LOG DATA;\n```\n\n-- Ensure archive logging is enabled and if its not, here is how to enable it (CAUTION. This turns off the database if "shutdown immediate" wasn\'t clear enough.) \n```\nshutdown immediate;\nstartup mount;\nalter database archivelog;\nalter database open;\nselect dest_id,dest_name, status, destination from v$archive_dest;  \n```\n\n-- find tables which have a primary key.\n```\nselect at.TABLE_NAME\nfrom all_tables at\nwhere not exists (select 1\nfrom all_constraints ac\nwhere ac.owner = at.owner\nand ac.table_name = at.table_name\nand ac.constraint_type = \'P\')\nand at.owner = \'<SCHEMA>\';\n```\n-- This will list the tables with a primary key, you can then construct your supplemental logging statement based on the column which has the primay key.\n-- ALTER TABLE <table_name> ADD SUPPLEMENTAL LOG DATA (PRIMARY KEY) COLUMNS\n```\nSELECT DISTINCT (a.table_name)\nFROM ALL_CONS_COLUMNS A\nJOIN ALL_CONSTRAINTS C\nON A.CONSTRAINT_NAME = C.CONSTRAINT_NAME\nWHERE\nC.CONSTRAINT_TYPE not in(\'P\')\nand a.owner =\'<SCHEMA>\';\n```\n-- This will list all the tables without a primary key, these tables need supplemental logging on all columns. \n-- If you run the following and then execute all statements generated, ensure that supplemental logging is enabled on ALL TABLES and COLUMNS.\n-- Which will cause a greater performance hit. YMMV.\n-- select \'ALTER TABLE \'||table_name||\' ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;\' from all_tables where owner = \'<SCHEMA>\'\n\n**Target Preparation (RDS)**\n\n* If you have tablespaces with specific block sizes (4k, 8k, 16, etc) then you need to setup your RDS parameter group to allow for caching according to the size of those table spaces. Example below.\n```\nParameterGroup:\n      Properties:\n        Description: saa-oracle-requirements\n        Family: oracle-ee-12.1\n        Parameters:\n          db_4k_cache_size: \'61440\'\n```\nYou can find the required AWS provided permissions [here](https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html); or use the following to help setup your schema user on the target RDS Oracle DB.\n\n**Outcomes:**\n\n* Correct permissions for <SCHEMA> user to ingest data\n* Create some tables spaces\n```\n-- ON TARGET RDS DATABASE \n -- connection attitrubtes n/a\n -- other attributes n/a\n -- Use the name of the schema you want to import below.\n create user SCHEMA identified by <PASSWORD>;\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$ARCHIVED_LOG\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOG\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGFILE\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$DATABASE\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$THREAD\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$PARAMETER\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$NLS_PARAMETERS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$TIMEZONE_NAMES\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$TRANSACTION\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBA_REGISTRY\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'OBJ$\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'ALL_ENCRYPTED_COLUMNS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGMNR_LOGS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'V_$LOGMNR_CONTENTS\',\'SCHEMA\',\'SELECT\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBMS_LOGMNR\',\'SCHEMA\',\'EXECUTE\');\n exec rdsadmin.rdsadmin_util.grant_sys_object(\'DBMS_CRYTPO\', \'SCHEMA\',\'EXECUTE\');\n grant SELECT ANY TRANSACTION to SCHEMA;\n grant SELECT on V$NLS_PARAMETERS to SCHEMA;\n grant SELECT on V$TIMEZONE_NAMES to SCHEMA;\n grant SELECT on ALL_INDEXES to SCHEMA;\n grant SELECT on ALL_OBJECTS to SCHEMA;\n grant SELECT on DBA_OBJECTS to SCHEMA;\n grant SELECT on ALL_TABLES to SCHEMA;\n grant SELECT on ALL_USERS to SCHEMA;\n grant SELECT on ALL_CATALOG to SCHEMA;\n grant SELECT on ALL_CONSTRAINTS to SCHEMA;\n grant SELECT on ALL_CONS_COLUMNS to SCHEMA;\n grant SELECT on ALL_TAB_COLS to SCHEMA;\n grant SELECT on ALL_IND_COLUMNS to SCHEMA;\n grant DROP ANY TABLE to SCHEMA;\n grant SELECT ANY TABLE to SCHEMA;\n grant INSERT ANY TABLE to SCHEMA;\n grant UPDATE ANY TABLE to SCHEMA;\n grant CREATE ANY TABLE to SCHEMA;\n grant CREATE ANY VIEW to SCHEMA;\n grant DROP ANY VIEW to SCHEMA;\n grant CREATE ANY PROCEDURE to SCHEMA;\n grant ALTER ANY PROCEDURE to SCHEMA;\n grant DROP ANY PROCEDURE to SCHEMA;\n grant CREATE ANY SEQUENCE to SCHEMA;\n grant CREATE ANY TABLESPACE to SCHEMA;\n grant CREATE ANY TABLE to SCHEMA;\n grant ALTER ANY SEQUENCE to SCHEMA;\n grant DROP ANY SEQUENCE to SCHEMA\n grant select on DBA_USERS to SCHEMA;\n grant select on DBA_TAB_PRIVS to SCHEMA;\n grant select on DBA_OBJECTS to SCHEMA;\n grant select on DBA_SYNONYMS to SCHEMA;\n grant select on DBA_SEQUENCES to SCHEMA;\n grant select on DBA_TYPES to SCHEMA;\n grant select on DBA_INDEXES to SCHEMA;\n grant select on DBA_TABLES to SCHEMA;\n grant select on DBA_TRIGGERS to SCHEMA;\n grant UNLIMITED TABLESPACE to SCHEMA;\n grant CREATE SESSION to SCHEMA;\n grant DROP ANY TABLE to SCHEMA;\n grant ALTER ANY TABLE to SCHEMA;\n grant CREATE ANY INDEX to SCHEMA;\n grant LOCK ANY TABLE to SCHEMA;\n create tablespace DATA;\n create tablespace DATA_4k blocksize 4K;\n```\n\n**Replication Instances**\n\n[https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-instance.html]\n\n* Provision a well sized replication instance, recommend “r” class instances due to memory optimization.\n\n* If this is for production, make it multi-AZ. Give the instance roughly 150% of the storage for your database.\n\n**Endpoint Creation**\n\n*Source*\n\n* Remember to use the IP address, not FQDN.\n\n* Remember to add the extra connection attributes from the SQL file above.\n\n*Target*\n\n* Again, IP address not FQDN.\n\n* No additional connection attributes should be necessary, unless you need to disable useDirectPathFullLoad. See the documentation for why you might want to do that..\n\n[https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.Oracle.html]\n\n**Tasks**\n\nRight. You are finally ready to start debugging replication. Good luck and godspeed.\n\n**Don’t use the AWS Console for creating or modifying tasks.** Use the CLI if you’re doing this manually. Half the options are hidden in the console.\n\nI highly recommend that you do this schema by schema, with a separate task for each schema you need to migrate. It will make debugging a lot easier.\n\nAlso note, global stored procs and triggers aren’t coming with us. Drop these to SQL and manually create them after you finish the full load operation. Schema level indexes, views, etc should come with us. Table level constraints will as well. If you are having issues with triggers etc, I would recommend that you again drop these to SQL and apply them before the full load, then disable the trigger and enable it after full load is complete. I have included some actions in the debugging section that will help.\n\n**What do you want to import?**\n\nYou’ll need to construct a json file which has the an include statement and ordered list of the schema tables you want to import.\n\nI don’t recommend using a wildcard (%) and then excluding the tables you don’t want, and the reason for this is during debugging if you have a problematic table you can just remove that section from your configuration, drop the table from the target and try again or create a separate task just for that table while you debug the issue.\n\nMore information here: [https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.html]\n\nImportTables.json\n```\n{\n\t"rules": [{\n\t\t\t"rule-type": "selection",\n\t\t\t"rule-id": "1", // unique\n\t\t\t"rule-name": "1", // unique \n\t\t\t"object-locator": {\n\t\t\t\t"schema-name": "<SCHEMA>",\n\t\t\t\t"table-name": "TABLE_NAME_ACCEPTS_WILDCARDS_%"\n\t\t\t},\n\t\t\t"rule-action": "include"\n\t\t}\n}\n```\n**Task Config**\nNext you need to configure the task.\n\nThere are a few things we want to change from the defaults, otherwise I will leave the investigation of each individual option up to you.\n\n[https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TaskSettings.html]\n\n1. Only truncate tables that exist, so we keep the metadata. We do this if we have to create any tables in advance, because dropping the table will remove metadata and we just want to clear the contents.\n2. Logging — We want detailed debug logs, or at least debug logs. The defaults don’t give you a lot to work with.\n\nTaskConfig.json\n```\n{\n\t"TargetMetadata": {\n\t\t"TargetSchema": "<SCHEMA>",      // the schema name we want to import to.\n\t\t"SupportLobs": true,\n\t\t"FullLobMode": true,\n\t\t"LobChunkSize": 64,\n\t\t"LimitedSizeLobMode": false,\n\t\t"LobMaxSize": 0,\n\t\t"LoadMaxFileSize": 0,\n\t\t"ParallelLoadThreads": 0,\n\t\t"ParallelLoadBufferSize": 0,\n\t\t"BatchApplyEnabled": true,\n\t\t"TaskRecoveryTableEnabled": true\n\t},\n\t"FullLoadSettings": {\n\t\t"TargetTablePrepMode": "TRUNCATE_BEFORE_LOAD", // this one. \n\t\t"CreatePkAfterFullLoad": false,\n\t\t"StopTaskCachedChangesApplied": false,\n\t\t"StopTaskCachedChangesNotApplied": false,\n\t\t"MaxFullLoadSubTasks": 8,\n\t\t"TransactionConsistencyTimeout": 600,\n\t\t"CommitRate": 10000\n\t},\n\t"Logging": { \t\t\t\t\t// This is where we change the severity of the logging information. \n\t\t"EnableLogging": true,\n\t\t"LogComponents": [{\n\t\t\t\t"Id": "SOURCE_UNLOAD",\n\t\t\t\t"Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"Id": "TARGET_LOAD",\n\t\t\t\t"Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"Id": "SOURCE_CAPTURE",\n\t\t\t\t"Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"Id": "TARGET_APPLY",\n\t\t\t\t"Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n\t\t\t}, {\n\t\t\t\t"Id": "TASK_MANAGER",\n\t\t\t\t"Severity": "LOGGER_SEVERITY_DETAILED_DEBUG"\n\t\t\t}\n\t\t],\n\t\t"CloudWatchLogGroup": "",\n\t\t"CloudWatchLogStream": ""\n\t},\n\t"ControlTablesSettings": {\n\t\t"historyTimeslotInMinutes": 5,\n\t\t"ControlSchema": "",\n\t\t"HistoryTimeslotInMinutes": 5,\n\t\t"HistoryTableEnabled": true,\n\t\t"SuspendedTablesTableEnabled": true,\n\t\t"StatusTableEnabled": true\n\t},\n\t"StreamBufferSettings": {\n\t\t"StreamBufferCount": 3,\n\t\t"StreamBufferSizeInMB": 8,\n\t\t"CtrlStreamBufferSizeInMB": 5\n\t},\n\t"ChangeProcessingDdlHandlingPolicy": {\n\t\t"HandleSourceTableDropped": true,\n\t\t"HandleSourceTableTruncated": true,\n\t\t"HandleSourceTableAltered": true\n\t},\n\t"ErrorBehavior": {\n\t\t"DataErrorPolicy": "LOG_ERROR",\n\t\t"DataTruncationErrorPolicy": "LOG_ERROR",\n\t\t"DataErrorEscalationPolicy": "SUSPEND_TABLE",\n\t\t"DataErrorEscalationCount": 0,\n\t\t"TableErrorPolicy": "SUSPEND_TABLE",\n\t\t"TableErrorEscalationPolicy": "STOP_TASK",\n\t\t"TableErrorEscalationCount": 0,\n\t\t"RecoverableErrorCount": -1,\n\t\t"RecoverableErrorInterval": 5,\n\t\t"RecoverableErrorThrottling": true,\n\t\t"RecoverableErrorThrottlingMax": 1800,\n\t\t"ApplyErrorDeletePolicy": "IGNORE_RECORD",\n\t\t"ApplyErrorInsertPolicy": "LOG_ERROR",\n\t\t"ApplyErrorUpdatePolicy": "LOG_ERROR",\n\t\t"ApplyErrorEscalationPolicy": "LOG_ERROR",\n\t\t"ApplyErrorEscalationCount": 0,\n\t\t"ApplyErrorFailOnTruncationDdl": false,\n\t\t"FullLoadIgnoreConflicts": true,\n\t\t"FailOnTransactionConsistencyBreached": false,\n\t\t"FailOnNoTablesCaptured": false\n\t},\n\t"ChangeProcessingTuning": {\n\t\t"BatchApplyPreserveTransaction": true,\n\t\t"BatchApplyTimeoutMin": 1,\n\t\t"BatchApplyTimeoutMax": 30,\n\t\t"BatchApplyMemoryLimit": 500,\n\t\t"BatchSplitSize": 0,\n\t\t"MinTransactionSize": 1000,\n\t\t"CommitTimeout": 1,\n\t\t"MemoryLimitTotal": 1024,\n\t\t"MemoryKeepTime": 60,\n\t\t"StatementCacheSize": 50\n\t},\n\t"ValidationSettings": {\n\t\t"EnableValidation": true,\n\t\t"ValidationMode": "ROW_LEVEL",\n\t\t"ThreadCount": 5,\n\t\t"PartitionSize": 10000,\n\t\t"FailureMaxCount": 10000,\n\t\t"RecordFailureDelayInMinutes": 5,\n\t\t"RecordSuspendDelayInMinutes": 30,\n\t\t"MaxKeyColumnSize": 8096,\n\t\t"TableFailureMaxCount": 1000,\n\t\t"ValidationOnly": false,\n\t\t"HandleCollationDiff": false,\n\t\t"RecordFailureDelayLimitInMinutes": 0\n\t}\n}\n```\nNow you can create and run the task. [https://docs.aws.amazon.com/cli/latest/reference/dms/create-replication-task.html]\n```\naws dms create-replication-task --replication-task-identifier <value> \\\n --source-endpoint-arn <value> \\ \n --target-endpoint-arn <value> \\ \n --replication-instance-arn <value> \\ \n --migration-type full-load-and-cdc \\ \n --table-mappings ImportTables.json \\\n --replication-task-settings TaskConfig.json\n```\n**Debugging**\nIf you followed the above initial setup, configuration issues should be minimal.\n\nCloudwatch logs are enabled for DMS and in the above setup we configured them to be at detailed debug level, this should give you an accurate error message in CloudWatch when a table import misbehaves.\n\nUnfortunately this is where things begin to fall into the realms of DBA territory… but essentially read the logs, weaponise google search, get the DBA guy to help you out. It’s not impossible and in nonproduction you basically get unlimited retries.\n\n**Suggestions**\n\n* Multiple, smaller replication task over 1 all inclusive replication task. This will increase your throughput so be mindful of any resource constraints. However, this makes it easier to debug.\n* I used 3 tasks, 1 for the majority of tables and 2 smaller jobs for misc tables or tables that were identified as troublesome during our nonproduction DMS migrations. Order your imports.\n* If you have a table that isn’t importing properly due to a constraint or trigger, disable those on the target during full load and then once that is complete, enable them for CDC replication.\n* Constraints can be turned on and off.\n```\ndeclare\nbegin\nfor c1 in (select y1.table_name, y1.constraint_name from user_constraints y1, user_tables x1 where x1.table_name = y1.table_name order by y1.r_constraint_name nulls last) loop\n    begin\n        dbms_output.put_line(\'alter table \'||c1.table_name||\' disable constraint \'||c1.constraint_name || \';\');\n        execute immediate  (\'alter table \'||c1.table_name||\' disable constraint \'||c1.constraint_name);\n    end;\nend loop;\n \n-- uncomment to truncate the table after disabling the constraint.\n-- for t1 in (select table_name from user_tables) loop\n--     begin\n--         dbms_output.put_line(\'truncate table \'||t1.table_name || \';\');   \n--         execute immediate (\'truncate table \'||t1.table_name);\n--     end;\n-- end loop;\n \nfor c2 in (select y2.table_name, y2.constraint_name from user_constraints y2, user_tables x2 where x2.table_name = y2.table_name order by y2.r_constraint_name nulls first) loop\n    begin\n        dbms_output.put_line(\'alter table \'||c2.table_name||\' enable constraint \'||c2.constraint_name || \';\');       \n        execute immediate (\'alter table \'||c2.table_name||\' enable constraint \'||c2.constraint_name);\n    end;\nend loop;\nend;\n```\n**Disable/Enable Triggers**\n```\nCREATE OR REPLACE PROCEDURE ALTER_ALL_TRIGGERS(status VARCHAR2) IS\n  CURSOR c_tr IS (SELECT \'ALTER TRIGGER \' || trigger_name AS stmnt FROM user_triggers);\nBEGIN\n  IF status NOT IN (\'ENABLE\', \'enable\', \'DISABLE\', \'disable\') THEN\n    DBMS_OUTPUT.PUT_LINE(\'ONLY \'\'ENABLEDISABLE\'\' ACCEPTED AS PARAMETERS\');\n    RAISE VALUE_ERROR;\n  END IF;\n  FOR tr IN c_tr LOOP\n    EXECUTE IMMEDIATE tr.stmnt || \' \' || status;\n  END LOOP;\nEND;\n```\n```\nEXEC ALTER_ALL_TRIGGERS(\'DISABLE\');\nEXEC ALTER_ALL_TRIGGERS(\'ENABLE\');\n```\n\n* Use the table statics tab to check out the progress of the DMS task. From here you can also drop a table and reload its data. This can be a useful tool for small tables where validation fails and you make a change but don’t want to restart the whole task.\n* Read the logs. They will often write out the SQL that failed which you can then replay to debug.\n* Finally if all else is failing, remember that dropping an entire table to SQL and manually importing it isn’t the end of the world (depending of course on number of rows). Just exclude it from your TableImport.json and move on.\n\n**Validation**\n\nAfter successful Full load and CDC has kicked off, your tasks will take a status of “Load Complete, replication ongoing”.\n\nAWS DMS runs its own validation to ensure that the tables are aligned, which will throw a status of “TableError” in table statistics and “Error” on Tasks screen.\n\nIt is now time to get the Application team and DBA to check the schema and table data. You can also run your own validation steps, write some SQL and do a spot check across both databases. The simplest test is of course, if the application works and passes regression testing on the new database.',e.user={name:"Arun Kumar",username:o,twitter_username:o,github_username:"akrockz",website_url:t,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--RXX4sxwX--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/633936/1ccdd8d2-a91c-4ff5-9b15-b0693dd8de06.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--FfBBzal6--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/633936/1ccdd8d2-a91c-4ff5-9b15-b0693dd8de06.jpeg"},e.organization={name:"AWS Community Builders ",username:i,slug:i,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--zmOZQNzv--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/2794/88da75b6-aadd-4ea1-8083-ae2dfca8be94.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--vWmcJ-ty--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/2794/88da75b6-aadd-4ea1-8083-ae2dfca8be94.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:e}},error:t,state:{currentArticle:e},serverRendered:!0,routePath:"/aklm10barca/727102",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:t}}}}(null,"2021-06-13T15:53:01Z",{},"https://dev.to/aws-builders/dms-configuration-for-oracle-to-rds-migration-1gfm","aklm10barca","aws-builders")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
