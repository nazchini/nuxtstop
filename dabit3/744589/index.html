<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>How to Build a Full Stack NFT Marketplace - V2 (2022)</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>How to Build a Full Stack NFT Marketplace - V2 (2022)</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/webdev" class="tag" data-v-70afb46a>
          #webdev
        </a><a href="/nuxtstop/t/react" class="tag" data-v-70afb46a>
          #react
        </a><a href="/nuxtstop/t/blockchain" class="tag" data-v-70afb46a>
          #blockchain
        </a><a href="/nuxtstop/t/web3" class="tag" data-v-70afb46a>
          #web3
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QqR-sGLs--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/shlpjczbt9jrcbjwybzk.jpg" alt="How to Build a Full Stack NFT Marketplace - V2 (2022)" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            1222
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            294
          </span></div> <time data-v-70afb46a>Jul 6 '21</time></div></header> <div class="content" data-v-70afb46a><h3>
  <a name="building-an-nft-marketplace-with-polygon-nextjs-tailwind-solidity-hardhat-ethersjs-and-ipfs" href="#building-an-nft-marketplace-with-polygon-nextjs-tailwind-solidity-hardhat-ethersjs-and-ipfs">
  </a>
  Building an NFT marketplace with Polygon, Next.js, Tailwind, Solidity, Hardhat, Ethers.js, and IPFS
</h3>

<blockquote>
<p>To view the video course for this tutorial, click <a href="https://www.youtube.com/watch?v=GKJBEEXUha0">here</a>. To view Version 1 of this tutorial, click <a href="https://gist.github.com/dabit3/ce61bb1593c9aeae31f2a31bcad7f5da">here</a></p>
</blockquote>

<p>In my last end to end Ethereum tutorial, <a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a> I introduced how to build a basic app on Ethereum using modern tooling like <a href="https://hardhat.org/">Hardhat</a> and <a href="https://docs.ethers.io/v5/">Ethers.js</a>.</p>

<p>In this guide you'll learn how to build, deploy, and test out a full stack NFT marketplace on Ethereum. We'll also look at how to deploy to Polygon.</p>

<p>One thing that has become apparent is how quickly Ethereum scaling solutions like <a href="https://polygon.technology/">Polygon</a>, <a href="https://developer.offchainlabs.com/docs/developer_quickstart">Arbitrum</a>, and <a href="https://optimism.io/">Optimism</a> are gaining momentum and adoption. These technologies enable developers to build the same applications they would directly on Ethereum with the added benefits of lower gas costs and faster transaction speeds among other things.</p>

<p>Because of the value proposition that these solutions offer combined with the general lack of existing content, I will be building out various example projects and tutorials for full stack applications using these various Ethereum scaling solutions, starting with this one on Polygon.</p>

<blockquote>
<p>To view the final source code for this project, visit <a href="https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/">this repo</a></p>
</blockquote>

<h3>
  <a name="prerequisites" href="#prerequisites">
  </a>
  Prerequisites
</h3>

<p>To be successful in this guide, you must have the following:</p>

<ol>
<li>Node.js version <code>16.14.0</code> or greater installed on your machine. I recommend installing Node using either <a href="https://github.com/nvm-sh/nvm">nvm</a> or <a href="https://github.com/Schniz/fnm">fnm</a>.</li>
<li>Metamask wallet extension installed as a browser extension</li>
</ol>

<h3>
  <a name="the-stack" href="#the-stack">
  </a>
  The stack
</h3>

<p>In this guide, we will build out a full stack application using:</p>

<p><strong>Web application framework</strong> - <a href="https://nextjs.org/">Next.js</a><br>
<strong>Solidity development environment</strong> - <a href="https://hardhat.org/">Hardhat</a><br>
<strong>File Storage</strong> - <a href="https://ipfs.io/">IPFS</a><br>
<strong>Ethereum Web Client Library</strong> - <a href="https://docs.ethers.io/v5/">Ethers.js</a></p>

<p>Though it will not be part of this guide (coming in a separate post), we will look at how to build a more robust API layer using <a href="https://thegraph.com/">The Graph Protocol</a> to get around limitations in the data access patterns provided by the native blockchain layer.</p>
<h3>
  <a name="about-the-project" href="#about-the-project">
  </a>
  About the project
</h3>

<p>The project that we will be building will be <strong>Metaverse Marketplace</strong> - an NFT marketplace.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--1d8ljara--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lx8avrmuwqswx9roub2g.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1d8ljara--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lx8avrmuwqswx9roub2g.png" alt="Metaverse Marketplace" loading="lazy" width="880" height="616"></a></p>

<p>When a user puts an NFT for sale, the ownership of the item will be transferred from the creator to the marketplace contract.</p>

<p>When a user purchases an NFT, the purchase price will be transferred from the buyer to the seller and the item will be transferred from the marketplace to the buyer.</p>

<p>The marketplace owner will be able to set a listing fee. This fee will be taken from the seller and transferred to the contract owner upon completion of any sale, enabling the owner of the marketplace to earn recurring revenue from any sale transacted in the marketplace.</p>

<p>The marketplace logic will consist of just one smart contract:</p>

<p><strong>NFT Marketplace Contract</strong> - <a href="https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a">this</a> contract allows users to mint NFTs and list them in a marketplace.</p>

<p>I believe this is a good project because the tools, techniques, and ideas we will be working with lay the foundation for many other types of applications on this stack â€“ dealing with things like payments, commissions, and transfers of ownership on the contract level as well as how a client-side application would use this smart contract to build a performant and nice-looking user interface.</p>

<p>In addition to the smart contract, I'll also show you how to build a subgraph to make the querying of data from the smart contract more flexible and efficient. As you will see, creating views on data sets and enabling various and performant data access patterns is hard to do directly from a smart contract. <a href="https://thegraph.com/">The Graph</a> makes this much easier.</p>
<h3>
  <a name="about-polygon" href="#about-polygon">
  </a>
  About Polygon
</h3>

<p>From <a href="https://polygon.technology/">the docs</a>:</p>

<p><strong><em>"Polygon is a protocol and a framework for building and connecting Ethereum-compatible blockchain networks. Aggregating scalable solutions on Ethereum supporting a multi-chain Ethereum ecosystem."</em></strong></p>

<p><a href="https://twitter.com/ChainLinkGod/status/1405688790241316864">Polygon is about 10x faster than Ethereum & yet transactions are more than 10x cheaper</a>. </p>

<p>Ok cool, but what does all that mean?</p>

<p>To me it means that <em>I can use the same knowledge, tools, and technologies I have been using to build apps on Ethereum to build apps that are faster and cheaper for users</em>, providing not only a better user experience but also opening the door for many types of applications that just would not be feasible to be built directly on Ethereum.</p>

<p>As mentioned before, there are many other Ethereum scaling solutions such as <a href="https://developer.offchainlabs.com/docs/developer_quickstart">Arbitrum</a>and <a href="https://optimism.io/">Optimism</a> that are also in a similar space. Most of these <a href="https://ethereum.org/en/developers/docs/scaling/">scaling solutions</a> have technical differences and fall into various categories like <a href="https://ethereum.org/en/developers/docs/scaling/sidechains/">sidechains</a> , <a href="https://ethereum.org/en/developers/docs/scaling/layer-2-rollups/">layer 2s</a>, and <a href="https://ethereum.org/en/developers/docs/scaling/state-channels/">state channels</a>.</p>

<p>Polygon <a href="https://cointelegraph.com/news/matic-rebrands-to-polygon-in-pursuit-of-polkadot-on-ethereum-strategy">recently rebranded from Matic</a> so you will also see the word <strong>Matic</strong> used interchangeably when referring to various parts of their ecosystem because the name still is being used in various places, like their token and network names.</p>

<p>To learn more about Polygon, check out <a href="https://medium.com/coinmonks/polygon-matic-could-it-win-the-eth-scaling-race-2c8b4e9baf51">this post</a> as well as their documentation <a href="https://docs.matic.network/docs/develop/getting-started">here</a>.</p>

<p>Now that we have an overview of the project and related technologies, let's start building!</p>
<h2>
  <a name="project-setup" href="#project-setup">
  </a>
  Project setup
</h2>

<p>To get started, we'll create a new Next.js app. To do so, open your terminal. Create or change into a new empty directory and run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx create-next-app nft-marketplace
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, change into the new directory and install the dependencies using a package manager like <code>npm</code>, <code>yarn</code>, or <code>pnpm</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nb">cd </span>nft-marketplace

npm <span class="nb">install </span>ethers hardhat @nomiclabs/hardhat-waffle <span class="se">\</span>
ethereum-waffle chai @nomiclabs/hardhat-ethers <span class="se">\</span>
web3modal @openzeppelin/contracts ipfs-http-client <span class="se">\</span>
axios
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="setting-up-tailwind-css" href="#setting-up-tailwind-css">
  </a>
  Setting up Tailwind CSS
</h3>

<p>We'll be using <a href="https://tailwindcss.com/">Tailwind CSS</a> for styling, we we will set that up in this step.</p>

<p>Tailwind is a utility-first CSS framework that makes it easy to add styling and create good looking websites without a lot of work.</p>

<p>Next, install the Tailwind dependencies:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm <span class="nb">install</span> <span class="nt">-D</span> tailwindcss@latest postcss@latest autoprefixer@latest
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, we will create the configuration files needed for Tailwind to work with Next.js (<code>tailwind.config.js</code> and <code>postcss.config.js</code>) by running the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx tailwindcss init <span class="nt">-p</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, configure your template <code>content</code> paths in <strong>tailwind.config.js</strong>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* tailwind.config.js */</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">content</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">"</span><span class="s2">./pages/**/*.{js,ts,jsx,tsx}</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">./components/**/*.{js,ts,jsx,tsx}</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">theme</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">extend</span><span class="p">:</span> <span class="p">{},</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Finally, delete the code in <strong>styles/globals.css</strong> and update it with the following:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight css"><code><span class="k">@tailwind</span> <span class="n">base</span><span class="p">;</span>
<span class="k">@tailwind</span> <span class="n">components</span><span class="p">;</span>
<span class="k">@tailwind</span> <span class="n">utilities</span><span class="p">;</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="configuring-hardhat" href="#configuring-hardhat">
  </a>
  Configuring Hardhat
</h3>

<p>Next, initialize a new Hardhat development environment from the root of your project:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat

? What <span class="k">do </span>you want to <span class="k">do</span>? Create a basic sample project
? Hardhat project root: &lt;Choose default path>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>If you get an error referencing your <strong>README.md</strong>, delete <strong>README.md</strong> and run <code>npx hardhat</code> again.</p>
</blockquote>

<p>Now you should see the following files and folders created for you in your root directory:</p>

<p><strong>hardhat.config.js</strong> - The entirety of your Hardhat setup (i.e. your config, plugins, and custom tasks) is contained in this file.<br>
<strong>scripts</strong> - A folder containing a script named sample-script.js that will deploy your smart contract when executed<br>
<strong>test</strong> - A folder containing an example testing script<br>
<strong>contracts</strong> - A folder holding an example Solidity smart contract</p>

<p>Next, update the configuration at <strong>hardhat.config.js</strong> with the following:</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/9c4af9adeb3384e9ae3271181bce0f96">here</a><br>
</p>


</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* hardhat.config.js */</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@nomiclabs/hardhat-waffle</span><span class="dl">"</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">defaultNetwork</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">networks</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">hardhat</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">chainId</span><span class="p">:</span> <span class="mi">1337</span>
    <span class="p">},</span>
<span class="c1">//  unused configuration commented out for now</span>
<span class="c1">//  mumbai: {</span>
<span class="c1">//    url: "https://rpc-mumbai.maticvigil.com",</span>
<span class="c1">//    accounts: [process.env.privateKey]</span>
<span class="c1">//  }</span>
  <span class="p">},</span>
  <span class="na">solidity</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.8.4</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">settings</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">optimizer</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">runs</span><span class="p">:</span> <span class="mi">200</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In this configuration, we've configured the local Hardhat development environment as well as the <a href="https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet"><strong>Mumbai testnet</strong></a> (commented out for now). </p>

<p>You can read more about both Matic networks <a href="https://docs.matic.network/docs/develop/network-details/network/">here</a>.</p>

<h3>
  <a name="smart-contract" href="#smart-contract">
  </a>
  Smart Contract
</h3>

<p>Next, we'll create our smart contract!</p>

<p>In this file I'll do my best to comment within the code everything that is going on.</p>

<p>Create a new file in the <strong>contracts</strong> directory named <strong>NFTMarketplace.sol</strong>. Here, add the following code:</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight solidity"><code><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"@openzeppelin/contracts/utils/Counters.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"hardhat/console.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">NFTMarketplace</span> <span class="k">is</span> <span class="n">ERC721URIStorage</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">Counters</span> <span class="k">for</span> <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span><span class="p">;</span>
    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_tokenIds</span><span class="p">;</span>
    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_itemsSold</span><span class="p">;</span>

    <span class="kt">uint256</span> <span class="n">listingPrice</span> <span class="o">=</span> <span class="mf">0.025</span> <span class="kc">ether</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">payable</span> <span class="n">owner</span><span class="p">;</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=></span> <span class="n">MarketItem</span><span class="p">)</span> <span class="k">private</span> <span class="n">idToMarketItem</span><span class="p">;</span>

    <span class="k">struct</span> <span class="n">MarketItem</span> <span class="p">{</span>
      <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">;</span>
      <span class="kt">address</span> <span class="k">payable</span> <span class="n">seller</span><span class="p">;</span>
      <span class="kt">address</span> <span class="k">payable</span> <span class="n">owner</span><span class="p">;</span>
      <span class="kt">uint256</span> <span class="n">price</span><span class="p">;</span>
      <span class="kt">bool</span> <span class="n">sold</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">event</span> <span class="n">MarketItemCreated</span> <span class="p">(</span>
      <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>
      <span class="kt">address</span> <span class="n">seller</span><span class="p">,</span>
      <span class="kt">address</span> <span class="n">owner</span><span class="p">,</span>
      <span class="kt">uint256</span> <span class="n">price</span><span class="p">,</span>
      <span class="kt">bool</span> <span class="n">sold</span>
    <span class="p">);</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="n">ERC721</span><span class="p">(</span><span class="s">"Metaverse Tokens"</span><span class="p">,</span> <span class="s">"METT"</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Updates the listing price of the contract */</span>
    <span class="k">function</span> <span class="n">updateListingPrice</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_listingPrice</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Only marketplace owner can update listing price."</span><span class="p">);</span>
      <span class="n">listingPrice</span> <span class="o">=</span> <span class="n">_listingPrice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Returns the listing price of the contract */</span>
    <span class="k">function</span> <span class="n">getListingPrice</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">listingPrice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Mints a token and lists it in the marketplace */</span>
    <span class="k">function</span> <span class="n">createToken</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">tokenURI</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">price</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">_tokenIds</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>
      <span class="kt">uint256</span> <span class="n">newTokenId</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>

      <span class="n">_mint</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">newTokenId</span><span class="p">);</span>
      <span class="n">_setTokenURI</span><span class="p">(</span><span class="n">newTokenId</span><span class="p">,</span> <span class="n">tokenURI</span><span class="p">);</span>
      <span class="n">createMarketItem</span><span class="p">(</span><span class="n">newTokenId</span><span class="p">,</span> <span class="n">price</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">newTokenId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">createMarketItem</span><span class="p">(</span>
      <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
      <span class="kt">uint256</span> <span class="n">price</span>
    <span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">price</span> <span class="o">></span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Price must be at least 1 wei"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">listingPrice</span><span class="p">,</span> <span class="s">"Price must be equal to listing price"</span><span class="p">);</span>

      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">]</span> <span class="o">=</span>  <span class="n">MarketItem</span><span class="p">(</span>
        <span class="n">tokenId</span><span class="p">,</span>
        <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">),</span>
        <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)),</span>
        <span class="n">price</span><span class="p">,</span>
        <span class="nb">false</span>
      <span class="p">);</span>

      <span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">);</span>
      <span class="k">emit</span> <span class="n">MarketItemCreated</span><span class="p">(</span>
        <span class="n">tokenId</span><span class="p">,</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
        <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span>
        <span class="n">price</span><span class="p">,</span>
        <span class="nb">false</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* allows someone to resell a token they have purchased */</span>
    <span class="k">function</span> <span class="n">resellToken</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">price</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Only item owner can perform this operation"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">listingPrice</span><span class="p">,</span> <span class="s">"Price must be equal to listing price"</span><span class="p">);</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">sold</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span><span class="p">;</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
      <span class="n">_itemsSold</span><span class="p">.</span><span class="n">decrement</span><span class="p">();</span>

      <span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Creates the sale of a marketplace item */</span>
    <span class="cm">/* Transfers ownership of the item, as well as funds between parties */</span>
    <span class="k">function</span> <span class="n">createMarketSale</span><span class="p">(</span>
      <span class="kt">uint256</span> <span class="n">tokenId</span>
      <span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">price</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">price</span><span class="p">;</span>
      <span class="kt">address</span> <span class="n">seller</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span><span class="p">;</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">price</span><span class="p">,</span> <span class="s">"Please submit the asking price in order to complete the purchase"</span><span class="p">);</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">sold</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
      <span class="n">_itemsSold</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>
      <span class="n">_transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>
      <span class="k">payable</span><span class="p">(</span><span class="n">owner</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">listingPrice</span><span class="p">);</span>
      <span class="k">payable</span><span class="p">(</span><span class="n">seller</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Returns all unsold market items */</span>
    <span class="k">function</span> <span class="n">fetchMarketItems</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
      <span class="kt">uint</span> <span class="n">unsoldItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="o">-</span> <span class="n">_itemsSold</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">unsoldItemCount</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">itemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">))</span> <span class="p">{</span>
          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>
          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>
          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Returns only items that a user has purchased */</span>
    <span class="k">function</span> <span class="n">fetchMyNFTs</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">totalItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">itemCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>
          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>
          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Returns only items a user has listed */</span>
    <span class="k">function</span> <span class="n">fetchItemsListed</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">totalItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">seller</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">itemCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">seller</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>
          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>
          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In this contract we are inheriting from the <a href="https://eips.ethereum.org/EIPS/eip-721">ERC721 standard</a> implemented by <a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc721">OpenZepplin</a></p>

<p>Now the smart contract code and environment is complete and we can try testing it out.</p>

<p>To do so, we can create a local test to run through much of the functionality, like minting a token, putting it up for sale, selling it to a user, and querying for tokens.</p>

<p>To create the test, open <strong>test/sample-test.js</strong> and update it with the following code:</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/8d41d27c60b4f16b105bd2479013c172">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* test/sample-test.js */</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarket</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should create and execute market sales</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* deploy the marketplace */</span>
    <span class="kd">const</span> <span class="nx">NFTMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarketplace</span><span class="dl">"</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">nftMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">deploy</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>

    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>
    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">auctionPrice</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>

    <span class="cm">/* create two tokens */</span>
    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.mytokenlocation.com</span><span class="dl">"</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>
    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.mytokenlocation2.com</span><span class="dl">"</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">_</span><span class="p">,</span> <span class="nx">buyerAddress</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">()</span>

    <span class="cm">/* execute sale of token to another user */</span>
    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">buyerAddress</span><span class="p">).</span><span class="nx">createMarketSale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">auctionPrice</span> <span class="p">})</span>

    <span class="cm">/* resell a token */</span>
    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">buyerAddress</span><span class="p">).</span><span class="nx">resellToken</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>

    <span class="cm">/* query for and return the unsold items */</span>
    <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">fetchMarketItems</span><span class="p">()</span>
    <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=></span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">price</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>
        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>
        <span class="nx">tokenUri</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">item</span>
    <span class="p">}))</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">items: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, run the test from your command line:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat <span class="nb">test</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>If the test runs successfully, it should log out an array containing the two marketplace items.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KFwdsMsl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cewr5c4nkwudh8xd5etd.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KFwdsMsl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cewr5c4nkwudh8xd5etd.png" alt="Running the test" loading="lazy" width="880" height="680"></a></p>

<h2>
  <a name="building-the-front-end" href="#building-the-front-end">
  </a>
  Building the front end
</h2>

<p>Now that the smart contract is working and ready to go, we can start building out the UI.</p>

<p>The first thing we might think about is setting up a layout so that we can enable some navigation that will persist across all pages.</p>

<p>To set this up, open <strong>pages/_app.js</strong> and update it with the following code:</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/1c747a13b4da549272ddcc113b1b9c96">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/_app.js */</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">../styles/globals.css</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/link</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">MyApp</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border-b p-6</span><span class="dl">"</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-4xl font-bold</span><span class="dl">"</span><span class="o">></span><span class="nx">Metaverse</span> <span class="nx">Marketplace</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex mt-4</span><span class="dl">"</span><span class="o">></span>
          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-4 text-pink-500</span><span class="dl">"</span><span class="o">></span>
              <span class="nx">Home</span>
            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/create-nft</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">></span>
              <span class="nx">Sell</span> <span class="nx">NFT</span>
            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/my-nfts</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">></span>
              <span class="nx">My</span> <span class="nx">NFTs</span>
            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/dashboard</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">></span>
              <span class="nx">Dashboard</span>
            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/nav</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="sr">/</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">MyApp</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The navigation has links for the home route as well as a page to sell an NFT, view the NFTs you have purchased, and a dashboard to see the NFTs you've listed.</p>

<h4>
  <a name="querying-the-contract-for-marketplace-items" href="#querying-the-contract-for-marketplace-items">
  </a>
  Querying the contract for marketplace items
</h4>

<p>The next page we'll update is <strong>pages/index.js</strong>. This is the main entry-point of the app, and will be the view where we query for the NFTs for sale and render them to the screen.</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/f24480130555e3d505156aea3e2024a4">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">marketplaceAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">not-loaded</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">loadNFTs</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* create a generic provider and query for unsold market items */</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchMarketItems</span><span class="p">()</span>

    <span class="cm">/*
    *  map over items returned from smart contract and format 
    *  them as well as fetch their token metadata
    */</span>
    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=></span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenUri</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">price</span><span class="p">,</span>
        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>
        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>
        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">description</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">item</span>
    <span class="p">}))</span>
    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span><span class="p">)</span> 
  <span class="p">}</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">buyNft</span><span class="p">(</span><span class="nx">nft</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* needs the user to sign the transaction, so will use Web3Provider and sign it */</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>

    <span class="cm">/* user will be prompted to pay the asking proces to complete the transaction */</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>   
    <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createMarketSale</span><span class="p">(</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">value</span><span class="p">:</span> <span class="nx">price</span>
    <span class="p">})</span>
    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>
    <span class="nx">loadNFTs</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span> <span class="o">&&</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">px-20 py-10 text-3xl</span><span class="dl">"</span><span class="o">></span><span class="nx">No</span> <span class="nx">items</span> <span class="k">in</span> <span class="nx">marketplace</span><span class="o">&lt;</span><span class="sr">/h1></span><span class="err">)
</span>  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">px-4</span><span class="dl">"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">maxWidth</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1600px</span><span class="dl">'</span> <span class="p">}}</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">></span>
          <span class="p">{</span>
            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=></span> <span class="p">(</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="sr">/</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">64px</span><span class="dl">'</span> <span class="p">}}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-semibold</span><span class="dl">"</span><span class="o">></span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">70px</span><span class="dl">'</span><span class="p">,</span> <span class="na">overflow</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span> <span class="p">}}</span><span class="o">></span>
                    <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-gray-400</span><span class="dl">"</span><span class="o">></span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">></span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">ETH</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=></span> <span class="nx">buyNft</span><span class="p">(</span><span class="nx">nft</span><span class="p">)}</span><span class="o">></span><span class="nx">Buy</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>            <span class="p">))</span>
          <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When the page loads, we query the smart contract for any NFTs that are still for sale and render them to the screen along with metadata about the items and a button for purchasing them.</p>

<h4>
  <a name="creating-and-listing-nfts" href="#creating-and-listing-nfts">
  </a>
  Creating and listing NFTs
</h4>

<p>Next, let's create the page that allows users to create and list NFTs.</p>

<p>There are a few things happening in this page:</p>

<ol>
<li>The user is able to upload and save files to IPFS</li>
<li>The user is able to create a new NFT</li>
<li>The user is able to set metadata and price of item and list it for sale on the marketplace</li>
</ol>

<p>After the user creates and lists an item, they are re-routed to the main page to view all of the items for sale.</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/20068fb7938f51e1411c8257bfe4fc9d">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/create-nft.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="k">as</span> <span class="nx">ipfsHttpClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ipfs-http-client</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">ipfsHttpClient</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">'</span><span class="p">)</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">marketplaceAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">CreateItem</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">fileUrl</span><span class="p">,</span> <span class="nx">setFileUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">formInput</span><span class="p">,</span> <span class="nx">updateFormInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span> <span class="na">price</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="dl">''</span> <span class="p">})</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* upload image to IPFS */</span>
    <span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="nx">file</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="na">progress</span><span class="p">:</span> <span class="p">(</span><span class="nx">prog</span><span class="p">)</span> <span class="o">=></span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`received: </span><span class="p">${</span><span class="nx">prog</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">)</span>
      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://ipfs.infura.io/ipfs/</span><span class="p">${</span><span class="nx">added</span><span class="p">.</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span>
      <span class="nx">setFileUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error uploading file: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
    <span class="p">}</span>  
  <span class="p">}</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">uploadToIPFS</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="nx">price</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">formInput</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span> <span class="o">||</span> <span class="o">!</span><span class="nx">description</span> <span class="o">||</span> <span class="o">!</span><span class="nx">price</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fileUrl</span><span class="p">)</span> <span class="k">return</span>
    <span class="cm">/* first, upload metadata to IPFS */</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="nx">name</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="nx">fileUrl</span>
    <span class="p">})</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://ipfs.infura.io/ipfs/</span><span class="p">${</span><span class="nx">added</span><span class="p">.</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span>
      <span class="cm">/* after metadata is uploaded to IPFS, return the URL to use it in the transaction */</span>
      <span class="k">return</span> <span class="nx">url</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error uploading file: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
    <span class="p">}</span>  
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">listNFTForSale</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">uploadToIPFS</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>

    <span class="cm">/* create the NFT */</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">formInput</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>
    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">price</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>
    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>

    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">w-1/2 flex flex-col pb-12</span><span class="dl">"</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">input</span> 
          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Name</span><span class="dl">"</span>
          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-8 border rounded p-4</span><span class="dl">"</span>
          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=></span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="sr">/</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="nx">textarea</span>
          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Description</span><span class="dl">"</span>
          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>
          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=></span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="sr">/</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="nx">input</span>
          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Price in Eth</span><span class="dl">"</span>
          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>
          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=></span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">price</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="sr">/</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="nx">input</span>
          <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span>
          <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset</span><span class="dl">"</span>
          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">my-4</span><span class="dl">"</span>
          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onChange</span><span class="p">}</span>
        <span class="sr">/</span><span class="err">>
</span>        <span class="p">{</span>
          <span class="nx">fileUrl</span> <span class="o">&&</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded mt-4</span><span class="dl">"</span> <span class="nx">width</span><span class="o">=</span><span class="dl">"</span><span class="s2">350</span><span class="dl">"</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">fileUrl</span><span class="p">}</span> <span class="sr">/</span><span class="err">>
</span>          <span class="p">)</span>
        <span class="p">}</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">listNFTForSale</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg</span><span class="dl">"</span><span class="o">></span>
          <span class="nx">Create</span> <span class="nx">NFT</span>
        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h4>
  <a name="viewing-only-the-nfts-purchased-by-the-user" href="#viewing-only-the-nfts-purchased-by-the-user">
  </a>
  Viewing only the NFTs purchased by the user
</h4>

<p>In the <strong>NFTMarketplace.sol</strong> smart contract, we created a function named <code>fetchMyNFTs</code> that only returns the NFTs owned by the user.</p>

<p>In <strong>pages/my-nfts.js</strong>, we will use that function to fetch and render them.</p>

<p>This functionality is different than the query main <strong>pages/index.js</strong> page because we need to ask the user for their address and use it in the contract, so the user will have to sign the transaction for it to be able to fetch them properly.</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/bc8f091b2c200311439cbf6997320c2b">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/my-nfts.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">marketplaceAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">MyAssets</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">not-loaded</span><span class="dl">'</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">loadNFTs</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>
      <span class="na">network</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mainnet</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">marketplaceContract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">marketplaceContract</span><span class="p">.</span><span class="nx">fetchMyNFTs</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=></span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">tokenURI</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">marketplaceContract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenURI</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">price</span><span class="p">,</span>
        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>
        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>
        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>
        <span class="nx">tokenURI</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">item</span>
    <span class="p">}))</span>
    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span><span class="p">)</span> 
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">listNFT</span><span class="p">(</span><span class="nx">nft</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`/resell-nft?id=</span><span class="p">${</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">}</span><span class="s2">&tokenURI=</span><span class="p">${</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span> <span class="o">&&</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">py-10 px-20 text-3xl</span><span class="dl">"</span><span class="o">></span><span class="nx">No</span> <span class="nx">NFTs</span> <span class="nx">owned</span><span class="o">&lt;</span><span class="sr">/h1></span><span class="err">)
</span>  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">></span>
          <span class="p">{</span>
            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=></span> <span class="p">(</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded</span><span class="dl">"</span> <span class="o">/></span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">></span><span class="nx">Price</span> <span class="o">-</span> <span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">Eth</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=></span> <span class="nx">listNFT</span><span class="p">(</span><span class="nx">nft</span><span class="p">)}</span><span class="o">></span><span class="nx">List</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>            <span class="p">))</span>
          <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h4>
  <a name="dashboard" href="#dashboard">
  </a>
  Dashboard
</h4>

<p>The next page we will be creating is the dashboard that will allow users to view all of the items they have listed.</p>

<p>This page will be using the <code>fetchItemsListed</code> function from the <strong>NFTMarketplace.sol</strong> smart contract which returns only the items that match the address of the user making the function call.</p>

<p>Create a new file called <strong>dashboard.js</strong> in the <strong>pages</strong> directory with the following code:</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/68993c17eb4cbb1c2b6c8e9ced176a01">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/dashboard.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">marketplaceAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">CreatorDashboard</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">not-loaded</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">loadNFTs</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>
      <span class="na">network</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mainnet</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchItemsListed</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=></span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenUri</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">price</span><span class="p">,</span>
        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>
        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>
        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">item</span>
    <span class="p">}))</span>

    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span><span class="p">)</span> 
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">loaded</span><span class="dl">'</span> <span class="o">&&</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">py-10 px-20 text-3xl</span><span class="dl">"</span><span class="o">></span><span class="nx">No</span> <span class="nx">NFTs</span> <span class="nx">listed</span><span class="o">&lt;</span><span class="sr">/h1></span><span class="err">)
</span>  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl py-2</span><span class="dl">"</span><span class="o">></span><span class="nx">Items</span> <span class="nx">Listed</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">></span>
          <span class="p">{</span>
            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=></span> <span class="p">(</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded</span><span class="dl">"</span> <span class="o">/></span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">></span><span class="nx">Price</span> <span class="o">-</span> <span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">Eth</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>            <span class="p">))</span>
          <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h4>
  <a name="reselling-a-token" href="#reselling-a-token">
  </a>
  Reselling a token
</h4>

<p>The final page we will be creating will allow users to resell an NFT they've purchased from someone else.</p>

<p>This page will be using the <code>resellToken</code> function from the <strong>NFTMarketplace.sol</strong> smart contract.</p>

<blockquote>
<p>View the gist <a href="https://gist.github.com/dabit3/d73a69da9c05cc31ecabfcfe68effc2d">here</a><br>
</p>
</blockquote>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/resell-nft.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">marketplaceAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">ResellNFT</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">formInput</span><span class="p">,</span> <span class="nx">updateFormInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span> <span class="na">price</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="dl">''</span> <span class="p">})</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">tokenURI</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">image</span><span class="p">,</span> <span class="nx">price</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">formInput</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">fetchNFT</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">id</span><span class="p">])</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchNFT</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tokenURI</span><span class="p">)</span> <span class="k">return</span>
    <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenURI</span><span class="p">)</span>
    <span class="nx">updateFormInput</span><span class="p">(</span><span class="nx">state</span> <span class="o">=></span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span> <span class="p">}))</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">listNFTForSale</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">price</span><span class="p">)</span> <span class="k">return</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">priceFormatted</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">formInput</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ether</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>

    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">resellToken</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">priceFormatted</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>
    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>

    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">w-1/2 flex flex-col pb-12</span><span class="dl">"</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">input</span>
          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Price in Eth</span><span class="dl">"</span>
          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>
          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=></span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">price</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="sr">/</span><span class="err">>
</span>        <span class="p">{</span>
          <span class="nx">image</span> <span class="o">&&</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded mt-4</span><span class="dl">"</span> <span class="nx">width</span><span class="o">=</span><span class="dl">"</span><span class="s2">350</span><span class="dl">"</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">image</span><span class="p">}</span> <span class="sr">/</span><span class="err">>
</span>          <span class="p">)</span>
        <span class="p">}</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">listNFTForSale</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg</span><span class="dl">"</span><span class="o">></span>
          <span class="nx">List</span> <span class="nx">NFT</span>
        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="running-the-project" href="#running-the-project">
  </a>
  Running the project
</h3>

<p>To run the project, we will need to have a deploy script to deploy the smart contracts to the blockchain network.</p>

<h4>
  <a name="deploying-the-contracts-to-a-local-network" href="#deploying-the-contracts-to-a-local-network">
  </a>
  Deploying the contracts to a local network
</h4>

<p>When we created the project, Hardhat created an example deployment script at <strong>scripts/sample-script.js</strong>.</p>

<p>To make the purpose of this script more clear, update the name of <strong>scripts/sample-script.js</strong> to <strong>scripts/deploy.js</strong>.</p>

<p>Next, update <strong>scripts/deploy.js</strong> with the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">hre</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">NFTMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hre</span><span class="p">.</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarketplace</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">nftMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">deploy</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">nftMarketplace deployed to:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">./config.js</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`
  export const marketplaceAddress = "</span><span class="p">${</span><span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"
  `</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=></span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This script will deploy the contract to the blockchain network and create a file named <strong>config.js</strong> that will hold the address of the smart contract after it's been deployed.</p>

<p>We will first test this on a local network, then deploy it to the <a href="https://docs.matic.network/docs/develop/network-details/network/">Mumbai testnet</a>.</p>

<p>To spin up a local network, open your terminal and run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat node
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This should create a local network with 20 accounts.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--TtesD9Zt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s1spai8459exh7looei7.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--TtesD9Zt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s1spai8459exh7looei7.png" alt="Hardhat node" loading="lazy" width="827" height="501"></a></p>

<p>Next, keep the node running and open a separate terminal window to deploy the contract.</p>

<p>In a separate window, run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> localhost
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When the deployment is complete, the CLI should print out the address of the contract that was deployed:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--rtSdHuIs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6fk3mb7gz46b2rl4upte.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--rtSdHuIs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6fk3mb7gz46b2rl4upte.png" alt="Contract address" loading="lazy" width="880" height="81"></a></p>

<p>You should also see the <strong>config.js</strong> file populated with this smart contract address.</p>

<h4>
  <a name="importing-accounts-into-metamask" href="#importing-accounts-into-metamask">
  </a>
  Importing accounts into MetaMask
</h4>

<p>You can import the accounts created by the node into your Metamask wallet to try out in the app.</p>

<p>Each of these accounts is seeded with 10000 ETH.</p>

<p>To import one of these accounts, first switch your MetaMask wallet network to Localhost 8545.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--XUoFYips--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cgcicglserwmyx6vrexy.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XUoFYips--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cgcicglserwmyx6vrexy.jpeg" alt="Localhost Network" loading="lazy" width="880" height="731"></a></p>

<p>Next, in MetaMask click on <strong>Import Account</strong> from the accounts menu:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--_qpxmPp_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/04rv5hdn8s2f7tkslpru.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_qpxmPp_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/04rv5hdn8s2f7tkslpru.jpeg" alt="MetaMask import account" loading="lazy" width="880" height="731"></a></p>

<p>Copy then paste one of the <strong>Private Keys</strong> logged out by the CLI and click <strong>Import</strong>. Once the account is imported, you should see some the Eth in the account:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--2jJBZC6x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xc5y4xa9htjymncovo2o.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--2jJBZC6x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xc5y4xa9htjymncovo2o.jpeg" alt="MetaMask account" loading="lazy" width="880" height="731"></a></p>

<p>I'd suggest doing this with 2 or 3 accounts so that you have the ability to test out the various functionality between users.</p>

<h4>
  <a name="running-the-app" href="#running-the-app">
  </a>
  Running the app
</h4>

<p>Now we can test out the app!</p>

<p>To start the app, run the following command in your CLI:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm run dev
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>To test everything out, try listing an item for sale, then switching to another account and purchasing it.</p>

<h2>
  <a name="deploying-to-polygon" href="#deploying-to-polygon">
  </a>
  Deploying to Polygon
</h2>

<p>Now that we have the project up and running and tested locally, let's deploy to Polygon. We'll start by deploying to <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai</a>, the Polygon test network.</p>

<p>The first thing we will need to do is save one of our <strong>private keys</strong> from our wallet as an environment variable.</p>

<p>To get the private key, you can use one of the private keys given to you by Hardhat or you can export them directly from MetaMask.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" alt="Private keys" loading="lazy" width="880" height="532"></a></p>

<p>If you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">privateKey</span><span class="o">=</span><span class="s2">"your-private-key"</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.</p>
</blockquote>

<h3>
  <a name="configuring-the-network" href="#configuring-the-network">
  </a>
  Configuring the network
</h3>

<p>Next, we need to switch from the local test network to the <a href="https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet">Mumbai Testnet</a>.</p>

<p>To do so, we need to create and set the network configuration.</p>

<p>First, open MetaMask and click on <strong>Settings</strong>.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" alt="MetaMask settings" loading="lazy" width="477" height="643"></a></p>

<p>Next, click on <strong>Networks</strong> and then <strong>Add Network</strong>:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" alt="New Network" loading="lazy" width="880" height="558"></a></p>

<p>Here, we will add the following configurations for the Mumbai test network as listed <a href="https://docs.polygon.technology/docs/develop/network-details/network/">here</a>:</p>

<p>Network Name: <strong>Mumbai TestNet</strong><br>
New RPC URL: <strong><a href="https://rpc-mumbai.maticvigil.com">https://rpc-mumbai.maticvigil.com</a></strong><br>
Chain ID: <strong>80001</strong><br>
Currency Symbol: <strong>Matic</strong></p>

<p>Save this, then you should be able to switch to and use the new network!</p>

<p>Finally, you will need some testnet Matic tokens in order to interact with the applications.</p>

<p>To get these, you can visit the <a href="https://faucet.matic.network/">Matic Faucet</a>, inputting the address of the wallets that you would like to request the tokens.</p>
<h3>
  <a name="deploying-to-the-matic-polygon-network" href="#deploying-to-the-matic-polygon-network">
  </a>
  Deploying to the Matic / Polygon network
</h3>

<p>Now that you have some Matic tokens, you can deploy to the Polygon network!</p>

<p>To do so, be sure that the address associated with the private key you are deploying your contract with has received some Matic tokens in order to pay the gas fees for the transaction.</p>

<p>Also, be sure to uncomment the <code>mumbai</code> configuration in <strong>hardhat.config.js</strong>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code>    <span class="nx">mumbai</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mumbai.maticvigil.com</span><span class="dl">"</span><span class="p">,</span>
      <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">]</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>To deploy to Matic, run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> mumbai
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>If you run a deployment error, the public RPC may be congested. In production, it's recommended to use an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, <a href="https://www.quicknode.com/">Quicknode</a>, or <a href="https://datahub.figment.io/">Figment DataHub</a>.</p>
</blockquote>

<p>Once the contracts have been deployed, update the <code>loadNFTs</code> function call in <strong>pages/index.js</strong> to include the new RPC endpoint:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>

<span class="cm">/* old provider */</span>
<span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>

<span class="cm">/* new provider */</span>
<span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://rpc-mumbai.maticvigil.com</span><span class="dl">"</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You should now be able to update the contract addresses in your project and test on the new network ðŸŽ‰!<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm run dev
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>If you run into an error, the contract address printed out to the console by hardhat could be incorrect due to a bug I've run into recently. You can get the correct contract addresses by visiting <a href="https://mumbai.polygonscan.com/">https://mumbai.polygonscan.com/</a> and pasting in the address from which the contracts were deployed to see the most recent transactions and getting the contract addresses from the transaction data.</p>
</blockquote>

<h4>
  <a name="deploying-to-mainnet" href="#deploying-to-mainnet">
  </a>
  Deploying to Mainnet
</h4>

<p>To deploy to the main Matic / Polygon network, you can use the same steps we set up for the Mumbai test network.</p>

<p>The main difference is that you'll need to use an endpoint for Matic as well as import the network into your MetaMask wallet as listed <a href="https://docs.matic.network/docs/develop/network-details/network/">here</a>.</p>

<p>An example update in your project to make this happen might look like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* hardhat.config.js */</span>

<span class="cm">/* adding Matic main network config to existing config */</span>
<span class="p">...</span>
<span class="nx">matic</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mainnet.maticvigil.com</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">privateKey</span><span class="p">]</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Public RPCs like the one listed above may have traffic or rate-limits depending on usage. You can sign up for a dedicated free RPC URL using services like Infura, MaticVigil, QuickNode, Alchemy, Chainstack, or Ankr.</p>

<p>For example, using something like Infura:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">url</span><span class="p">:</span> <span class="s2">`https://polygon-mainnet.infura.io/v3/</span><span class="p">${</span><span class="nx">infuraId</span><span class="p">}</span><span class="s2">`</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>To view the final source code for this project, visit <a href="https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/">this repo</a></p>
</blockquote>

<h3>
  <a name="next-steps" href="#next-steps">
  </a>
  Next steps
</h3>

<p>Congratulations! You've deployed a non-trivial app to Polygon.</p>

<p>The coolest thing about working with solutions like Polygon is how little extra work or learning I had to do compared to building directly on Ethereum. Almost all of the APIs and tooling in these layer 2's and sidechains remain the same, making any skills transferable across various platforms like Polygon. </p>

<p>For the next steps, I'd suggest porting over the queries implemented in this app using <a href="https://thegraph.com/">The Graph</a>. The Graph will open up many more data access patterns including things like pagination, filtering, and sorting which are necessary for any real-world application.</p>

<p>I will also be publishing a tutorial showing how to use Polygon with The Graph in the coming weeks.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,a,n,p,e,t){return n.type_of="article",n.id=744589,n.title="How to Build a Full Stack NFT Marketplace - V2 (2022)",n.description="Building an NFT marketplace with Next.js, Tailwind, Solidity, and Polygon",n.readable_publish_date="Jul 6 '21",n.slug="building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb",n.path="/edge-and-node/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb",n.url=p,n.comments_count=294,n.public_reactions_count=1222,n.collection_id=s,n.published_timestamp=e,n.positive_reactions_count=1222,n.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--QqR-sGLs--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/shlpjczbt9jrcbjwybzk.jpg",n.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--TXmettmx--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/shlpjczbt9jrcbjwybzk.jpg",n.canonical_url=p,n.created_at="2021-06-30T23:39:13Z",n.edited_at="2022-03-11T17:07:33Z",n.crossposted_at=s,n.published_at=e,n.last_comment_at="2022-06-11T11:34:04Z",n.reading_time_minutes=22,n.tag_list="webdev, react, blockchain, web3",n.tags=["webdev","react","blockchain","web3"],n.body_html='<h3>\n  <a name="building-an-nft-marketplace-with-polygon-nextjs-tailwind-solidity-hardhat-ethersjs-and-ipfs" href="#building-an-nft-marketplace-with-polygon-nextjs-tailwind-solidity-hardhat-ethersjs-and-ipfs">\n  </a>\n  Building an NFT marketplace with Polygon, Next.js, Tailwind, Solidity, Hardhat, Ethers.js, and IPFS\n</h3>\n\n<blockquote>\n<p>To view the video course for this tutorial, click <a href="https://www.youtube.com/watch?v=GKJBEEXUha0">here</a>. To view Version 1 of this tutorial, click <a href="https://gist.github.com/dabit3/ce61bb1593c9aeae31f2a31bcad7f5da">here</a></p>\n</blockquote>\n\n<p>In my last end to end Ethereum tutorial, <a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a> I introduced how to build a basic app on Ethereum using modern tooling like <a href="https://hardhat.org/">Hardhat</a> and <a href="https://docs.ethers.io/v5/">Ethers.js</a>.</p>\n\n<p>In this guide you\'ll learn how to build, deploy, and test out a full stack NFT marketplace on Ethereum. We\'ll also look at how to deploy to Polygon.</p>\n\n<p>One thing that has become apparent is how quickly Ethereum scaling solutions like <a href="https://polygon.technology/">Polygon</a>, <a href="https://developer.offchainlabs.com/docs/developer_quickstart">Arbitrum</a>, and <a href="https://optimism.io/">Optimism</a> are gaining momentum and adoption. These technologies enable developers to build the same applications they would directly on Ethereum with the added benefits of lower gas costs and faster transaction speeds among other things.</p>\n\n<p>Because of the value proposition that these solutions offer combined with the general lack of existing content, I will be building out various example projects and tutorials for full stack applications using these various Ethereum scaling solutions, starting with this one on Polygon.</p>\n\n<blockquote>\n<p>To view the final source code for this project, visit <a href="https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/">this repo</a></p>\n</blockquote>\n\n<h3>\n  <a name="prerequisites" href="#prerequisites">\n  </a>\n  Prerequisites\n</h3>\n\n<p>To be successful in this guide, you must have the following:</p>\n\n<ol>\n<li>Node.js version <code>16.14.0</code> or greater installed on your machine. I recommend installing Node using either <a href="https://github.com/nvm-sh/nvm">nvm</a> or <a href="https://github.com/Schniz/fnm">fnm</a>.</li>\n<li>Metamask wallet extension installed as a browser extension</li>\n</ol>\n\n<h3>\n  <a name="the-stack" href="#the-stack">\n  </a>\n  The stack\n</h3>\n\n<p>In this guide, we will build out a full stack application using:</p>\n\n<p><strong>Web application framework</strong> - <a href="https://nextjs.org/">Next.js</a><br>\n<strong>Solidity development environment</strong> - <a href="https://hardhat.org/">Hardhat</a><br>\n<strong>File Storage</strong> - <a href="https://ipfs.io/">IPFS</a><br>\n<strong>Ethereum Web Client Library</strong> - <a href="https://docs.ethers.io/v5/">Ethers.js</a></p>\n\n<p>Though it will not be part of this guide (coming in a separate post), we will look at how to build a more robust API layer using <a href="https://thegraph.com/">The Graph Protocol</a> to get around limitations in the data access patterns provided by the native blockchain layer.</p>\n<h3>\n  <a name="about-the-project" href="#about-the-project">\n  </a>\n  About the project\n</h3>\n\n<p>The project that we will be building will be <strong>Metaverse Marketplace</strong> - an NFT marketplace.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--1d8ljara--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lx8avrmuwqswx9roub2g.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1d8ljara--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lx8avrmuwqswx9roub2g.png" alt="Metaverse Marketplace" loading="lazy" width="880" height="616"></a></p>\n\n<p>When a user puts an NFT for sale, the ownership of the item will be transferred from the creator to the marketplace contract.</p>\n\n<p>When a user purchases an NFT, the purchase price will be transferred from the buyer to the seller and the item will be transferred from the marketplace to the buyer.</p>\n\n<p>The marketplace owner will be able to set a listing fee. This fee will be taken from the seller and transferred to the contract owner upon completion of any sale, enabling the owner of the marketplace to earn recurring revenue from any sale transacted in the marketplace.</p>\n\n<p>The marketplace logic will consist of just one smart contract:</p>\n\n<p><strong>NFT Marketplace Contract</strong> - <a href="https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a">this</a> contract allows users to mint NFTs and list them in a marketplace.</p>\n\n<p>I believe this is a good project because the tools, techniques, and ideas we will be working with lay the foundation for many other types of applications on this stack â€“ dealing with things like payments, commissions, and transfers of ownership on the contract level as well as how a client-side application would use this smart contract to build a performant and nice-looking user interface.</p>\n\n<p>In addition to the smart contract, I\'ll also show you how to build a subgraph to make the querying of data from the smart contract more flexible and efficient. As you will see, creating views on data sets and enabling various and performant data access patterns is hard to do directly from a smart contract. <a href="https://thegraph.com/">The Graph</a> makes this much easier.</p>\n<h3>\n  <a name="about-polygon" href="#about-polygon">\n  </a>\n  About Polygon\n</h3>\n\n<p>From <a href="https://polygon.technology/">the docs</a>:</p>\n\n<p><strong><em>"Polygon is a protocol and a framework for building and connecting Ethereum-compatible blockchain networks. Aggregating scalable solutions on Ethereum supporting a multi-chain Ethereum ecosystem."</em></strong></p>\n\n<p><a href="https://twitter.com/ChainLinkGod/status/1405688790241316864">Polygon is about 10x faster than Ethereum &amp; yet transactions are more than 10x cheaper</a>. </p>\n\n<p>Ok cool, but what does all that mean?</p>\n\n<p>To me it means that <em>I can use the same knowledge, tools, and technologies I have been using to build apps on Ethereum to build apps that are faster and cheaper for users</em>, providing not only a better user experience but also opening the door for many types of applications that just would not be feasible to be built directly on Ethereum.</p>\n\n<p>As mentioned before, there are many other Ethereum scaling solutions such as <a href="https://developer.offchainlabs.com/docs/developer_quickstart">Arbitrum</a>and <a href="https://optimism.io/">Optimism</a> that are also in a similar space. Most of these <a href="https://ethereum.org/en/developers/docs/scaling/">scaling solutions</a> have technical differences and fall into various categories like <a href="https://ethereum.org/en/developers/docs/scaling/sidechains/">sidechains</a> , <a href="https://ethereum.org/en/developers/docs/scaling/layer-2-rollups/">layer 2s</a>, and <a href="https://ethereum.org/en/developers/docs/scaling/state-channels/">state channels</a>.</p>\n\n<p>Polygon <a href="https://cointelegraph.com/news/matic-rebrands-to-polygon-in-pursuit-of-polkadot-on-ethereum-strategy">recently rebranded from Matic</a> so you will also see the word <strong>Matic</strong> used interchangeably when referring to various parts of their ecosystem because the name still is being used in various places, like their token and network names.</p>\n\n<p>To learn more about Polygon, check out <a href="https://medium.com/coinmonks/polygon-matic-could-it-win-the-eth-scaling-race-2c8b4e9baf51">this post</a> as well as their documentation <a href="https://docs.matic.network/docs/develop/getting-started">here</a>.</p>\n\n<p>Now that we have an overview of the project and related technologies, let\'s start building!</p>\n<h2>\n  <a name="project-setup" href="#project-setup">\n  </a>\n  Project setup\n</h2>\n\n<p>To get started, we\'ll create a new Next.js app. To do so, open your terminal. Create or change into a new empty directory and run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx create-next-app nft-marketplace\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, change into the new directory and install the dependencies using a package manager like <code>npm</code>, <code>yarn</code>, or <code>pnpm</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nb">cd </span>nft-marketplace\n\nnpm <span class="nb">install </span>ethers hardhat @nomiclabs/hardhat-waffle <span class="se">\\</span>\nethereum-waffle chai @nomiclabs/hardhat-ethers <span class="se">\\</span>\nweb3modal @openzeppelin/contracts ipfs-http-client <span class="se">\\</span>\naxios\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="setting-up-tailwind-css" href="#setting-up-tailwind-css">\n  </a>\n  Setting up Tailwind CSS\n</h3>\n\n<p>We\'ll be using <a href="https://tailwindcss.com/">Tailwind CSS</a> for styling, we we will set that up in this step.</p>\n\n<p>Tailwind is a utility-first CSS framework that makes it easy to add styling and create good looking websites without a lot of work.</p>\n\n<p>Next, install the Tailwind dependencies:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm <span class="nb">install</span> <span class="nt">-D</span> tailwindcss@latest postcss@latest autoprefixer@latest\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, we will create the configuration files needed for Tailwind to work with Next.js (<code>tailwind.config.js</code> and <code>postcss.config.js</code>) by running the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx tailwindcss init <span class="nt">-p</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, configure your template <code>content</code> paths in <strong>tailwind.config.js</strong>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* tailwind.config.js */</span>\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">content</span><span class="p">:</span> <span class="p">[</span>\n    <span class="dl">"</span><span class="s2">./pages/**/*.{js,ts,jsx,tsx}</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">./components/**/*.{js,ts,jsx,tsx}</span><span class="dl">"</span><span class="p">,</span>\n  <span class="p">],</span>\n  <span class="na">theme</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">extend</span><span class="p">:</span> <span class="p">{},</span>\n  <span class="p">},</span>\n  <span class="na">plugins</span><span class="p">:</span> <span class="p">[],</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Finally, delete the code in <strong>styles/globals.css</strong> and update it with the following:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight css"><code><span class="k">@tailwind</span> <span class="n">base</span><span class="p">;</span>\n<span class="k">@tailwind</span> <span class="n">components</span><span class="p">;</span>\n<span class="k">@tailwind</span> <span class="n">utilities</span><span class="p">;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="configuring-hardhat" href="#configuring-hardhat">\n  </a>\n  Configuring Hardhat\n</h3>\n\n<p>Next, initialize a new Hardhat development environment from the root of your project:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat\n\n? What <span class="k">do </span>you want to <span class="k">do</span>? Create a basic sample project\n? Hardhat project root: &lt;Choose default path&gt;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>If you get an error referencing your <strong>README.md</strong>, delete <strong>README.md</strong> and run <code>npx hardhat</code> again.</p>\n</blockquote>\n\n<p>Now you should see the following files and folders created for you in your root directory:</p>\n\n<p><strong>hardhat.config.js</strong> - The entirety of your Hardhat setup (i.e. your config, plugins, and custom tasks) is contained in this file.<br>\n<strong>scripts</strong> - A folder containing a script named sample-script.js that will deploy your smart contract when executed<br>\n<strong>test</strong> - A folder containing an example testing script<br>\n<strong>contracts</strong> - A folder holding an example Solidity smart contract</p>\n\n<p>Next, update the configuration at <strong>hardhat.config.js</strong> with the following:</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/9c4af9adeb3384e9ae3271181bce0f96">here</a><br>\n</p>\n\n\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* hardhat.config.js */</span>\n<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@nomiclabs/hardhat-waffle</span><span class="dl">"</span><span class="p">)</span>\n\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">defaultNetwork</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">,</span>\n  <span class="na">networks</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">hardhat</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">chainId</span><span class="p">:</span> <span class="mi">1337</span>\n    <span class="p">},</span>\n<span class="c1">//  unused configuration commented out for now</span>\n<span class="c1">//  mumbai: {</span>\n<span class="c1">//    url: "https://rpc-mumbai.maticvigil.com",</span>\n<span class="c1">//    accounts: [process.env.privateKey]</span>\n<span class="c1">//  }</span>\n  <span class="p">},</span>\n  <span class="na">solidity</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.8.4</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">settings</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">optimizer</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="na">runs</span><span class="p">:</span> <span class="mi">200</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In this configuration, we\'ve configured the local Hardhat development environment as well as the <a href="https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet"><strong>Mumbai testnet</strong></a> (commented out for now). </p>\n\n<p>You can read more about both Matic networks <a href="https://docs.matic.network/docs/develop/network-details/network/">here</a>.</p>\n\n<h3>\n  <a name="smart-contract" href="#smart-contract">\n  </a>\n  Smart Contract\n</h3>\n\n<p>Next, we\'ll create our smart contract!</p>\n\n<p>In this file I\'ll do my best to comment within the code everything that is going on.</p>\n\n<p>Create a new file in the <strong>contracts</strong> directory named <strong>NFTMarketplace.sol</strong>. Here, add the following code:</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight solidity"><code><span class="c1">// SPDX-License-Identifier: MIT\n</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>\n\n<span class="k">import</span> <span class="s">"@openzeppelin/contracts/utils/Counters.sol"</span><span class="p">;</span>\n<span class="k">import</span> <span class="s">"@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol"</span><span class="p">;</span>\n<span class="k">import</span> <span class="s">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span><span class="p">;</span>\n\n<span class="k">import</span> <span class="s">"hardhat/console.sol"</span><span class="p">;</span>\n\n<span class="k">contract</span> <span class="n">NFTMarketplace</span> <span class="k">is</span> <span class="n">ERC721URIStorage</span> <span class="p">{</span>\n    <span class="k">using</span> <span class="n">Counters</span> <span class="k">for</span> <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span><span class="p">;</span>\n    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_tokenIds</span><span class="p">;</span>\n    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_itemsSold</span><span class="p">;</span>\n\n    <span class="kt">uint256</span> <span class="n">listingPrice</span> <span class="o">=</span> <span class="mf">0.025</span> <span class="kc">ether</span><span class="p">;</span>\n    <span class="kt">address</span> <span class="k">payable</span> <span class="n">owner</span><span class="p">;</span>\n\n    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="n">MarketItem</span><span class="p">)</span> <span class="k">private</span> <span class="n">idToMarketItem</span><span class="p">;</span>\n\n    <span class="k">struct</span> <span class="n">MarketItem</span> <span class="p">{</span>\n      <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">;</span>\n      <span class="kt">address</span> <span class="k">payable</span> <span class="n">seller</span><span class="p">;</span>\n      <span class="kt">address</span> <span class="k">payable</span> <span class="n">owner</span><span class="p">;</span>\n      <span class="kt">uint256</span> <span class="n">price</span><span class="p">;</span>\n      <span class="kt">bool</span> <span class="n">sold</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="k">event</span> <span class="n">MarketItemCreated</span> <span class="p">(</span>\n      <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>\n      <span class="kt">address</span> <span class="n">seller</span><span class="p">,</span>\n      <span class="kt">address</span> <span class="n">owner</span><span class="p">,</span>\n      <span class="kt">uint256</span> <span class="n">price</span><span class="p">,</span>\n      <span class="kt">bool</span> <span class="n">sold</span>\n    <span class="p">);</span>\n\n    <span class="k">constructor</span><span class="p">()</span> <span class="n">ERC721</span><span class="p">(</span><span class="s">"Metaverse Tokens"</span><span class="p">,</span> <span class="s">"METT"</span><span class="p">)</span> <span class="p">{</span>\n      <span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Updates the listing price of the contract */</span>\n    <span class="k">function</span> <span class="n">updateListingPrice</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_listingPrice</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Only marketplace owner can update listing price."</span><span class="p">);</span>\n      <span class="n">listingPrice</span> <span class="o">=</span> <span class="n">_listingPrice</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Returns the listing price of the contract */</span>\n    <span class="k">function</span> <span class="n">getListingPrice</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="n">listingPrice</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Mints a token and lists it in the marketplace */</span>\n    <span class="k">function</span> <span class="n">createToken</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">tokenURI</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">price</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>\n      <span class="n">_tokenIds</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>\n      <span class="kt">uint256</span> <span class="n">newTokenId</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n\n      <span class="n">_mint</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">newTokenId</span><span class="p">);</span>\n      <span class="n">_setTokenURI</span><span class="p">(</span><span class="n">newTokenId</span><span class="p">,</span> <span class="n">tokenURI</span><span class="p">);</span>\n      <span class="n">createMarketItem</span><span class="p">(</span><span class="n">newTokenId</span><span class="p">,</span> <span class="n">price</span><span class="p">);</span>\n      <span class="k">return</span> <span class="n">newTokenId</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="k">function</span> <span class="n">createMarketItem</span><span class="p">(</span>\n      <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>\n      <span class="kt">uint256</span> <span class="n">price</span>\n    <span class="p">)</span> <span class="k">private</span> <span class="p">{</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Price must be at least 1 wei"</span><span class="p">);</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">listingPrice</span><span class="p">,</span> <span class="s">"Price must be equal to listing price"</span><span class="p">);</span>\n\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">]</span> <span class="o">=</span>  <span class="n">MarketItem</span><span class="p">(</span>\n        <span class="n">tokenId</span><span class="p">,</span>\n        <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">),</span>\n        <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)),</span>\n        <span class="n">price</span><span class="p">,</span>\n        <span class="nb">false</span>\n      <span class="p">);</span>\n\n      <span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">);</span>\n      <span class="k">emit</span> <span class="n">MarketItemCreated</span><span class="p">(</span>\n        <span class="n">tokenId</span><span class="p">,</span>\n        <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>\n        <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span>\n        <span class="n">price</span><span class="p">,</span>\n        <span class="nb">false</span>\n      <span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* allows someone to resell a token they have purchased */</span>\n    <span class="k">function</span> <span class="n">resellToken</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">price</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Only item owner can perform this operation"</span><span class="p">);</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">listingPrice</span><span class="p">,</span> <span class="s">"Price must be equal to listing price"</span><span class="p">);</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">sold</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span><span class="p">;</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>\n      <span class="n">_itemsSold</span><span class="p">.</span><span class="n">decrement</span><span class="p">();</span>\n\n      <span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Creates the sale of a marketplace item */</span>\n    <span class="cm">/* Transfers ownership of the item, as well as funds between parties */</span>\n    <span class="k">function</span> <span class="n">createMarketSale</span><span class="p">(</span>\n      <span class="kt">uint256</span> <span class="n">tokenId</span>\n      <span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>\n      <span class="kt">uint</span> <span class="n">price</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">price</span><span class="p">;</span>\n      <span class="kt">address</span> <span class="n">seller</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span><span class="p">;</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">price</span><span class="p">,</span> <span class="s">"Please submit the asking price in order to complete the purchase"</span><span class="p">);</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">sold</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>\n      <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">tokenId</span><span class="p">].</span><span class="n">seller</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>\n      <span class="n">_itemsSold</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>\n      <span class="n">_transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>\n      <span class="k">payable</span><span class="p">(</span><span class="n">owner</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">listingPrice</span><span class="p">);</span>\n      <span class="k">payable</span><span class="p">(</span><span class="n">seller</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Returns all unsold market items */</span>\n    <span class="k">function</span> <span class="n">fetchMarketItems</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n      <span class="kt">uint</span> <span class="n">unsoldItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="o">-</span> <span class="n">_itemsSold</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">unsoldItemCount</span><span class="p">);</span>\n      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">itemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">))</span> <span class="p">{</span>\n          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>\n          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>\n          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Returns only items that a user has purchased */</span>\n    <span class="k">function</span> <span class="n">fetchMyNFTs</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kt">uint</span> <span class="n">totalItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>\n          <span class="n">itemCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n\n      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>\n      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>\n          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>\n          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>\n          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* Returns only items a user has listed */</span>\n    <span class="k">function</span> <span class="n">fetchItemsListed</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kt">uint</span> <span class="n">totalItemCount</span> <span class="o">=</span> <span class="n">_tokenIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n      <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n      <span class="kt">uint</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">seller</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>\n          <span class="n">itemCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n\n      <span class="n">MarketItem</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarketItem</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>\n      <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalItemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">idToMarketItem</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">seller</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>\n          <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n          <span class="n">MarketItem</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToMarketItem</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>\n          <span class="n">items</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>\n          <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="n">items</span><span class="p">;</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In this contract we are inheriting from the <a href="https://eips.ethereum.org/EIPS/eip-721">ERC721 standard</a> implemented by <a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc721">OpenZepplin</a></p>\n\n<p>Now the smart contract code and environment is complete and we can try testing it out.</p>\n\n<p>To do so, we can create a local test to run through much of the functionality, like minting a token, putting it up for sale, selling it to a user, and querying for tokens.</p>\n\n<p>To create the test, open <strong>test/sample-test.js</strong> and update it with the following code:</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/8d41d27c60b4f16b105bd2479013c172">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* test/sample-test.js */</span>\n<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarket</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>\n  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should create and execute market sales</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>\n    <span class="cm">/* deploy the marketplace */</span>\n    <span class="kd">const</span> <span class="nx">NFTMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarketplace</span><span class="dl">"</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">nftMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">deploy</span><span class="p">()</span>\n    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>\n\n    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>\n    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">auctionPrice</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="dl">\'</span><span class="s1">1</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n\n    <span class="cm">/* create two tokens */</span>\n    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.mytokenlocation.com</span><span class="dl">"</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>\n    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.mytokenlocation2.com</span><span class="dl">"</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>\n\n    <span class="kd">const</span> <span class="p">[</span><span class="nx">_</span><span class="p">,</span> <span class="nx">buyerAddress</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">()</span>\n\n    <span class="cm">/* execute sale of token to another user */</span>\n    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">buyerAddress</span><span class="p">).</span><span class="nx">createMarketSale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">auctionPrice</span> <span class="p">})</span>\n\n    <span class="cm">/* resell a token */</span>\n    <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">buyerAddress</span><span class="p">).</span><span class="nx">resellToken</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">auctionPrice</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>\n\n    <span class="cm">/* query for and return the unsold items */</span>\n    <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">fetchMarketItems</span><span class="p">()</span>\n    <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="na">price</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>\n        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>\n        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>\n        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>\n        <span class="nx">tokenUri</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="nx">item</span>\n    <span class="p">}))</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">items: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span>\n  <span class="p">})</span>\n<span class="p">})</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, run the test from your command line:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat <span class="nb">test</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>If the test runs successfully, it should log out an array containing the two marketplace items.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KFwdsMsl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cewr5c4nkwudh8xd5etd.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KFwdsMsl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cewr5c4nkwudh8xd5etd.png" alt="Running the test" loading="lazy" width="880" height="680"></a></p>\n\n<h2>\n  <a name="building-the-front-end" href="#building-the-front-end">\n  </a>\n  Building the front end\n</h2>\n\n<p>Now that the smart contract is working and ready to go, we can start building out the UI.</p>\n\n<p>The first thing we might think about is setting up a layout so that we can enable some navigation that will persist across all pages.</p>\n\n<p>To set this up, open <strong>pages/_app.js</strong> and update it with the following code:</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/1c747a13b4da549272ddcc113b1b9c96">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/_app.js */</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">../styles/globals.css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/link</span><span class="dl">\'</span>\n\n<span class="kd">function</span> <span class="nx">MyApp</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">})</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border-b p-6</span><span class="dl">"</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-4xl font-bold</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Metaverse</span> <span class="nx">Marketplace</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex mt-4</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-4 text-pink-500</span><span class="dl">"</span><span class="o">&gt;</span>\n              <span class="nx">Home</span>\n            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/create-nft</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">&gt;</span>\n              <span class="nx">Sell</span> <span class="nx">NFT</span>\n            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/my-nfts</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">&gt;</span>\n              <span class="nx">My</span> <span class="nx">NFTs</span>\n            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/dashboard</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mr-6 text-pink-500</span><span class="dl">"</span><span class="o">&gt;</span>\n              <span class="nx">Dashboard</span>\n            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/nav</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">MyApp</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The navigation has links for the home route as well as a page to sell an NFT, view the NFTs you have purchased, and a dashboard to see the NFTs you\'ve listed.</p>\n\n<h4>\n  <a name="querying-the-contract-for-marketplace-items" href="#querying-the-contract-for-marketplace-items">\n  </a>\n  Querying the contract for marketplace items\n</h4>\n\n<p>The next page we\'ll update is <strong>pages/index.js</strong>. This is the main entry-point of the app, and will be the view where we query for the NFTs for sale and render them to the screen.</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/f24480130555e3d505156aea3e2024a4">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">marketplaceAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">not-loaded</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">loadNFTs</span><span class="p">()</span>\n  <span class="p">},</span> <span class="p">[])</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>\n    <span class="cm">/* create a generic provider and query for unsold market items */</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchMarketItems</span><span class="p">()</span>\n\n    <span class="cm">/*\n    *  map over items returned from smart contract and format \n    *  them as well as fetch their token metadata\n    */</span>\n    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenUri</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="nx">price</span><span class="p">,</span>\n        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>\n        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>\n        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>\n        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>\n        <span class="na">name</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>\n        <span class="na">description</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="nx">item</span>\n    <span class="p">}))</span>\n    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>\n    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span><span class="p">)</span> \n  <span class="p">}</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">buyNft</span><span class="p">(</span><span class="nx">nft</span><span class="p">)</span> <span class="p">{</span>\n    <span class="cm">/* needs the user to sign the transaction, so will use Web3Provider and sign it */</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n\n    <span class="cm">/* user will be prompted to pay the asking proces to complete the transaction */</span>\n    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>   \n    <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createMarketSale</span><span class="p">(</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">,</span> <span class="p">{</span>\n      <span class="na">value</span><span class="p">:</span> <span class="nx">price</span>\n    <span class="p">})</span>\n    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>\n    <span class="nx">loadNFTs</span><span class="p">()</span>\n  <span class="p">}</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">px-20 py-10 text-3xl</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">items</span> <span class="k">in</span> <span class="nx">marketplace</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span><span class="err">)\n</span>  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">px-4</span><span class="dl">"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">maxWidth</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">1600px</span><span class="dl">\'</span> <span class="p">}}</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="p">{</span>\n            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>\n              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">height</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">64px</span><span class="dl">\'</span> <span class="p">}}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-semibold</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">height</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">70px</span><span class="dl">\'</span><span class="p">,</span> <span class="na">overflow</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">hidden</span><span class="dl">\'</span> <span class="p">}}</span><span class="o">&gt;</span>\n                    <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-gray-400</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">ETH</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">buyNft</span><span class="p">(</span><span class="nx">nft</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">Buy</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>            <span class="p">))</span>\n          <span class="p">}</span>\n        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When the page loads, we query the smart contract for any NFTs that are still for sale and render them to the screen along with metadata about the items and a button for purchasing them.</p>\n\n<h4>\n  <a name="creating-and-listing-nfts" href="#creating-and-listing-nfts">\n  </a>\n  Creating and listing NFTs\n</h4>\n\n<p>Next, let\'s create the page that allows users to create and list NFTs.</p>\n\n<p>There are a few things happening in this page:</p>\n\n<ol>\n<li>The user is able to upload and save files to IPFS</li>\n<li>The user is able to create a new NFT</li>\n<li>The user is able to set metadata and price of item and list it for sale on the marketplace</li>\n</ol>\n\n<p>After the user creates and lists an item, they are re-routed to the main page to view all of the items for sale.</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/20068fb7938f51e1411c8257bfe4fc9d">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/create-nft.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="k">as</span> <span class="nx">ipfsHttpClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ipfs-http-client</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n\n<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">ipfsHttpClient</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">marketplaceAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">CreateItem</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">fileUrl</span><span class="p">,</span> <span class="nx">setFileUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">formInput</span><span class="p">,</span> <span class="nx">updateFormInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span> <span class="na">price</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="dl">\'\'</span> <span class="p">})</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n    <span class="cm">/* upload image to IPFS */</span>\n    <span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>\n        <span class="nx">file</span><span class="p">,</span>\n        <span class="p">{</span>\n          <span class="na">progress</span><span class="p">:</span> <span class="p">(</span><span class="nx">prog</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`received: </span><span class="p">${</span><span class="nx">prog</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>\n        <span class="p">}</span>\n      <span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://ipfs.infura.io/ipfs/</span><span class="p">${</span><span class="nx">added</span><span class="p">.</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span>\n      <span class="nx">setFileUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Error uploading file: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>\n    <span class="p">}</span>  \n  <span class="p">}</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">uploadToIPFS</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="nx">price</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">formInput</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span> <span class="o">||</span> <span class="o">!</span><span class="nx">description</span> <span class="o">||</span> <span class="o">!</span><span class="nx">price</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fileUrl</span><span class="p">)</span> <span class="k">return</span>\n    <span class="cm">/* first, upload metadata to IPFS */</span>\n    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>\n      <span class="nx">name</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="nx">fileUrl</span>\n    <span class="p">})</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://ipfs.infura.io/ipfs/</span><span class="p">${</span><span class="nx">added</span><span class="p">.</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span>\n      <span class="cm">/* after metadata is uploaded to IPFS, return the URL to use it in the transaction */</span>\n      <span class="k">return</span> <span class="nx">url</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Error uploading file: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>\n    <span class="p">}</span>  \n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">listNFTForSale</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">uploadToIPFS</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n\n    <span class="cm">/* create the NFT */</span>\n    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">formInput</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="kd">let</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>\n    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>\n    <span class="kd">let</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createToken</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">price</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>\n    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>\n\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">w-1/2 flex flex-col pb-12</span><span class="dl">"</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">input</span> \n          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Name</span><span class="dl">"</span>\n          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-8 border rounded p-4</span><span class="dl">"</span>\n          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>\n        <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="nx">textarea</span>\n          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Description</span><span class="dl">"</span>\n          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>\n          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>\n        <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="nx">input</span>\n          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Price in Eth</span><span class="dl">"</span>\n          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>\n          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">price</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>\n        <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="nx">input</span>\n          <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span>\n          <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset</span><span class="dl">"</span>\n          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">my-4</span><span class="dl">"</span>\n          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onChange</span><span class="p">}</span>\n        <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="p">{</span>\n          <span class="nx">fileUrl</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded mt-4</span><span class="dl">"</span> <span class="nx">width</span><span class="o">=</span><span class="dl">"</span><span class="s2">350</span><span class="dl">"</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">fileUrl</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;\n</span>          <span class="p">)</span>\n        <span class="p">}</span>\n        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">listNFTForSale</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="nx">Create</span> <span class="nx">NFT</span>\n        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h4>\n  <a name="viewing-only-the-nfts-purchased-by-the-user" href="#viewing-only-the-nfts-purchased-by-the-user">\n  </a>\n  Viewing only the NFTs purchased by the user\n</h4>\n\n<p>In the <strong>NFTMarketplace.sol</strong> smart contract, we created a function named <code>fetchMyNFTs</code> that only returns the NFTs owned by the user.</p>\n\n<p>In <strong>pages/my-nfts.js</strong>, we will use that function to fetch and render them.</p>\n\n<p>This functionality is different than the query main <strong>pages/index.js</strong> page because we need to ask the user for their address and use it in the contract, so the user will have to sign the transaction for it to be able to fetch them properly.</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/bc8f091b2c200311439cbf6997320c2b">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/my-nfts.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">marketplaceAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">MyAssets</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">not-loaded</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">loadNFTs</span><span class="p">()</span>\n  <span class="p">},</span> <span class="p">[])</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>\n      <span class="na">network</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mainnet</span><span class="dl">"</span><span class="p">,</span>\n      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="p">})</span>\n    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">marketplaceContract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">marketplaceContract</span><span class="p">.</span><span class="nx">fetchMyNFTs</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">tokenURI</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">marketplaceContract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenURI</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="nx">price</span><span class="p">,</span>\n        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>\n        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>\n        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>\n        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>\n        <span class="nx">tokenURI</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="nx">item</span>\n    <span class="p">}))</span>\n    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>\n    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span><span class="p">)</span> \n  <span class="p">}</span>\n  <span class="kd">function</span> <span class="nx">listNFT</span><span class="p">(</span><span class="nx">nft</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`/resell-nft?id=</span><span class="p">${</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">}</span><span class="s2">&amp;tokenURI=</span><span class="p">${</span><span class="nx">nft</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>\n  <span class="p">}</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">py-10 px-20 text-3xl</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">NFTs</span> <span class="nx">owned</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span><span class="err">)\n</span>  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="p">{</span>\n            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>\n              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded</span><span class="dl">"</span> <span class="o">/&gt;</span>\n                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Price</span> <span class="o">-</span> <span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">Eth</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">listNFT</span><span class="p">(</span><span class="nx">nft</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>            <span class="p">))</span>\n          <span class="p">}</span>\n        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h4>\n  <a name="dashboard" href="#dashboard">\n  </a>\n  Dashboard\n</h4>\n\n<p>The next page we will be creating is the dashboard that will allow users to view all of the items they have listed.</p>\n\n<p>This page will be using the <code>fetchItemsListed</code> function from the <strong>NFTMarketplace.sol</strong> smart contract which returns only the items that match the address of the user making the function call.</p>\n\n<p>Create a new file called <strong>dashboard.js</strong> in the <strong>pages</strong> directory with the following code:</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/68993c17eb4cbb1c2b6c8e9ced176a01">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/dashboard.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">marketplaceAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">CreatorDashboard</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">nfts</span><span class="p">,</span> <span class="nx">setNfts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([])</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">loadingState</span><span class="p">,</span> <span class="nx">setLoadingState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">not-loaded</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">loadNFTs</span><span class="p">()</span>\n  <span class="p">},</span> <span class="p">[])</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">loadNFTs</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>\n      <span class="na">network</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">mainnet</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="p">})</span>\n    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchItemsListed</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="nx">i</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">tokenUri</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">tokenURI</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenUri</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatUnits</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="nx">price</span><span class="p">,</span>\n        <span class="na">tokenId</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">tokenId</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">(),</span>\n        <span class="na">seller</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">seller</span><span class="p">,</span>\n        <span class="na">owner</span><span class="p">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">owner</span><span class="p">,</span>\n        <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>\n      <span class="p">}</span>\n      <span class="k">return</span> <span class="nx">item</span>\n    <span class="p">}))</span>\n\n    <span class="nx">setNfts</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>\n    <span class="nx">setLoadingState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span><span class="p">)</span> \n  <span class="p">}</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">loadingState</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">loaded</span><span class="dl">\'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">nfts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">py-10 px-20 text-3xl</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">NFTs</span> <span class="nx">listed</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span><span class="err">)\n</span>  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4</span><span class="dl">"</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl py-2</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Items</span> <span class="nx">Listed</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="p">{</span>\n            <span class="nx">nfts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">nft</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>\n              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">border shadow rounded-xl overflow-hidden</span><span class="dl">"</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded</span><span class="dl">"</span> <span class="o">/&gt;</span>\n                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">p-4 bg-black</span><span class="dl">"</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-2xl font-bold text-white</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Price</span> <span class="o">-</span> <span class="p">{</span><span class="nx">nft</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span> <span class="nx">Eth</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>            <span class="p">))</span>\n          <span class="p">}</span>\n        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h4>\n  <a name="reselling-a-token" href="#reselling-a-token">\n  </a>\n  Reselling a token\n</h4>\n\n<p>The final page we will be creating will allow users to resell an NFT they\'ve purchased from someone else.</p>\n\n<p>This page will be using the <code>resellToken</code> function from the <strong>NFTMarketplace.sol</strong> smart contract.</p>\n\n<blockquote>\n<p>View the gist <a href="https://gist.github.com/dabit3/d73a69da9c05cc31ecabfcfe68effc2d">here</a><br>\n</p>\n</blockquote>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/resell-nft.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">marketplaceAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">NFTMarketplace</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">ResellNFT</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">formInput</span><span class="p">,</span> <span class="nx">updateFormInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span> <span class="na">price</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="dl">\'\'</span> <span class="p">})</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">tokenURI</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">image</span><span class="p">,</span> <span class="nx">price</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">formInput</span>\n\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">fetchNFT</span><span class="p">()</span>\n  <span class="p">},</span> <span class="p">[</span><span class="nx">id</span><span class="p">])</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchNFT</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tokenURI</span><span class="p">)</span> <span class="k">return</span>\n    <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tokenURI</span><span class="p">)</span>\n    <span class="nx">updateFormInput</span><span class="p">(</span><span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span> <span class="p">}))</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">listNFTForSale</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">price</span><span class="p">)</span> <span class="k">return</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n\n    <span class="kd">const</span> <span class="nx">priceFormatted</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span><span class="nx">formInput</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">ether</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="kd">let</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">marketplaceAddress</span><span class="p">,</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n    <span class="kd">let</span> <span class="nx">listingPrice</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getListingPrice</span><span class="p">()</span>\n\n    <span class="nx">listingPrice</span> <span class="o">=</span> <span class="nx">listingPrice</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>\n    <span class="kd">let</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">resellToken</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">priceFormatted</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">listingPrice</span> <span class="p">})</span>\n    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">wait</span><span class="p">()</span>\n\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-center</span><span class="dl">"</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">w-1/2 flex flex-col pb-12</span><span class="dl">"</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">input</span>\n          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Asset Price in Eth</span><span class="dl">"</span>\n          <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 border rounded p-4</span><span class="dl">"</span>\n          <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">updateFormInput</span><span class="p">({</span> <span class="p">...</span><span class="nx">formInput</span><span class="p">,</span> <span class="na">price</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>\n        <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="p">{</span>\n          <span class="nx">image</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded mt-4</span><span class="dl">"</span> <span class="nx">width</span><span class="o">=</span><span class="dl">"</span><span class="s2">350</span><span class="dl">"</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">image</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;\n</span>          <span class="p">)</span>\n        <span class="p">}</span>\n        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">listNFTForSale</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg</span><span class="dl">"</span><span class="o">&gt;</span>\n          <span class="nx">List</span> <span class="nx">NFT</span>\n        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="running-the-project" href="#running-the-project">\n  </a>\n  Running the project\n</h3>\n\n<p>To run the project, we will need to have a deploy script to deploy the smart contracts to the blockchain network.</p>\n\n<h4>\n  <a name="deploying-the-contracts-to-a-local-network" href="#deploying-the-contracts-to-a-local-network">\n  </a>\n  Deploying the contracts to a local network\n</h4>\n\n<p>When we created the project, Hardhat created an example deployment script at <strong>scripts/sample-script.js</strong>.</p>\n\n<p>To make the purpose of this script more clear, update the name of <strong>scripts/sample-script.js</strong> to <strong>scripts/deploy.js</strong>.</p>\n\n<p>Next, update <strong>scripts/deploy.js</strong> with the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">hre</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">);</span>\n<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">fs</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">NFTMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hre</span><span class="p">.</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">NFTMarketplace</span><span class="dl">"</span><span class="p">);</span>\n  <span class="kd">const</span> <span class="nx">nftMarketplace</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NFTMarketplace</span><span class="p">.</span><span class="nx">deploy</span><span class="p">();</span>\n  <span class="k">await</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>\n  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">nftMarketplace deployed to:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>\n\n  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">\'</span><span class="s1">./config.js</span><span class="dl">\'</span><span class="p">,</span> <span class="s2">`\n  export const marketplaceAddress = "</span><span class="p">${</span><span class="nx">nftMarketplace</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"\n  `</span><span class="p">)</span>\n<span class="p">}</span>\n\n<span class="nx">main</span><span class="p">()</span>\n  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>\n  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>\n    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>\n  <span class="p">});</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This script will deploy the contract to the blockchain network and create a file named <strong>config.js</strong> that will hold the address of the smart contract after it\'s been deployed.</p>\n\n<p>We will first test this on a local network, then deploy it to the <a href="https://docs.matic.network/docs/develop/network-details/network/">Mumbai testnet</a>.</p>\n\n<p>To spin up a local network, open your terminal and run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat node\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This should create a local network with 20 accounts.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--TtesD9Zt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s1spai8459exh7looei7.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--TtesD9Zt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s1spai8459exh7looei7.png" alt="Hardhat node" loading="lazy" width="827" height="501"></a></p>\n\n<p>Next, keep the node running and open a separate terminal window to deploy the contract.</p>\n\n<p>In a separate window, run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> localhost\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When the deployment is complete, the CLI should print out the address of the contract that was deployed:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--rtSdHuIs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6fk3mb7gz46b2rl4upte.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--rtSdHuIs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6fk3mb7gz46b2rl4upte.png" alt="Contract address" loading="lazy" width="880" height="81"></a></p>\n\n<p>You should also see the <strong>config.js</strong> file populated with this smart contract address.</p>\n\n<h4>\n  <a name="importing-accounts-into-metamask" href="#importing-accounts-into-metamask">\n  </a>\n  Importing accounts into MetaMask\n</h4>\n\n<p>You can import the accounts created by the node into your Metamask wallet to try out in the app.</p>\n\n<p>Each of these accounts is seeded with 10000 ETH.</p>\n\n<p>To import one of these accounts, first switch your MetaMask wallet network to Localhost 8545.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--XUoFYips--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cgcicglserwmyx6vrexy.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XUoFYips--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cgcicglserwmyx6vrexy.jpeg" alt="Localhost Network" loading="lazy" width="880" height="731"></a></p>\n\n<p>Next, in MetaMask click on <strong>Import Account</strong> from the accounts menu:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--_qpxmPp_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/04rv5hdn8s2f7tkslpru.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_qpxmPp_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/04rv5hdn8s2f7tkslpru.jpeg" alt="MetaMask import account" loading="lazy" width="880" height="731"></a></p>\n\n<p>Copy then paste one of the <strong>Private Keys</strong> logged out by the CLI and click <strong>Import</strong>. Once the account is imported, you should see some the Eth in the account:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--2jJBZC6x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xc5y4xa9htjymncovo2o.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--2jJBZC6x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xc5y4xa9htjymncovo2o.jpeg" alt="MetaMask account" loading="lazy" width="880" height="731"></a></p>\n\n<p>I\'d suggest doing this with 2 or 3 accounts so that you have the ability to test out the various functionality between users.</p>\n\n<h4>\n  <a name="running-the-app" href="#running-the-app">\n  </a>\n  Running the app\n</h4>\n\n<p>Now we can test out the app!</p>\n\n<p>To start the app, run the following command in your CLI:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm run dev\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>To test everything out, try listing an item for sale, then switching to another account and purchasing it.</p>\n\n<h2>\n  <a name="deploying-to-polygon" href="#deploying-to-polygon">\n  </a>\n  Deploying to Polygon\n</h2>\n\n<p>Now that we have the project up and running and tested locally, let\'s deploy to Polygon. We\'ll start by deploying to <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai</a>, the Polygon test network.</p>\n\n<p>The first thing we will need to do is save one of our <strong>private keys</strong> from our wallet as an environment variable.</p>\n\n<p>To get the private key, you can use one of the private keys given to you by Hardhat or you can export them directly from MetaMask.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" alt="Private keys" loading="lazy" width="880" height="532"></a></p>\n\n<p>If you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">privateKey</span><span class="o">=</span><span class="s2">"your-private-key"</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.</p>\n</blockquote>\n\n<h3>\n  <a name="configuring-the-network" href="#configuring-the-network">\n  </a>\n  Configuring the network\n</h3>\n\n<p>Next, we need to switch from the local test network to the <a href="https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet">Mumbai Testnet</a>.</p>\n\n<p>To do so, we need to create and set the network configuration.</p>\n\n<p>First, open MetaMask and click on <strong>Settings</strong>.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" alt="MetaMask settings" loading="lazy" width="477" height="643"></a></p>\n\n<p>Next, click on <strong>Networks</strong> and then <strong>Add Network</strong>:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" alt="New Network" loading="lazy" width="880" height="558"></a></p>\n\n<p>Here, we will add the following configurations for the Mumbai test network as listed <a href="https://docs.polygon.technology/docs/develop/network-details/network/">here</a>:</p>\n\n<p>Network Name: <strong>Mumbai TestNet</strong><br>\nNew RPC URL: <strong><a href="https://rpc-mumbai.maticvigil.com">https://rpc-mumbai.maticvigil.com</a></strong><br>\nChain ID: <strong>80001</strong><br>\nCurrency Symbol: <strong>Matic</strong></p>\n\n<p>Save this, then you should be able to switch to and use the new network!</p>\n\n<p>Finally, you will need some testnet Matic tokens in order to interact with the applications.</p>\n\n<p>To get these, you can visit the <a href="https://faucet.matic.network/">Matic Faucet</a>, inputting the address of the wallets that you would like to request the tokens.</p>\n<h3>\n  <a name="deploying-to-the-matic-polygon-network" href="#deploying-to-the-matic-polygon-network">\n  </a>\n  Deploying to the Matic / Polygon network\n</h3>\n\n<p>Now that you have some Matic tokens, you can deploy to the Polygon network!</p>\n\n<p>To do so, be sure that the address associated with the private key you are deploying your contract with has received some Matic tokens in order to pay the gas fees for the transaction.</p>\n\n<p>Also, be sure to uncomment the <code>mumbai</code> configuration in <strong>hardhat.config.js</strong>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code>    <span class="nx">mumbai</span><span class="p">:</span> <span class="p">{</span>\n      <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mumbai.maticvigil.com</span><span class="dl">"</span><span class="p">,</span>\n      <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">]</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>To deploy to Matic, run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> mumbai\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>If you run a deployment error, the public RPC may be congested. In production, it\'s recommended to use an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, <a href="https://www.quicknode.com/">Quicknode</a>, or <a href="https://datahub.figment.io/">Figment DataHub</a>.</p>\n</blockquote>\n\n<p>Once the contracts have been deployed, update the <code>loadNFTs</code> function call in <strong>pages/index.js</strong> to include the new RPC endpoint:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>\n\n<span class="cm">/* old provider */</span>\n<span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>\n\n<span class="cm">/* new provider */</span>\n<span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://rpc-mumbai.maticvigil.com</span><span class="dl">"</span><span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You should now be able to update the contract addresses in your project and test on the new network ðŸŽ‰!<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm run dev\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>If you run into an error, the contract address printed out to the console by hardhat could be incorrect due to a bug I\'ve run into recently. You can get the correct contract addresses by visiting <a href="https://mumbai.polygonscan.com/">https://mumbai.polygonscan.com/</a> and pasting in the address from which the contracts were deployed to see the most recent transactions and getting the contract addresses from the transaction data.</p>\n</blockquote>\n\n<h4>\n  <a name="deploying-to-mainnet" href="#deploying-to-mainnet">\n  </a>\n  Deploying to Mainnet\n</h4>\n\n<p>To deploy to the main Matic / Polygon network, you can use the same steps we set up for the Mumbai test network.</p>\n\n<p>The main difference is that you\'ll need to use an endpoint for Matic as well as import the network into your MetaMask wallet as listed <a href="https://docs.matic.network/docs/develop/network-details/network/">here</a>.</p>\n\n<p>An example update in your project to make this happen might look like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* hardhat.config.js */</span>\n\n<span class="cm">/* adding Matic main network config to existing config */</span>\n<span class="p">...</span>\n<span class="nx">matic</span><span class="p">:</span> <span class="p">{</span>\n  <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mainnet.maticvigil.com</span><span class="dl">"</span><span class="p">,</span>\n  <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">privateKey</span><span class="p">]</span>\n<span class="p">}</span>\n<span class="p">...</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Public RPCs like the one listed above may have traffic or rate-limits depending on usage. You can sign up for a dedicated free RPC URL using services like Infura, MaticVigil, QuickNode, Alchemy, Chainstack, or Ankr.</p>\n\n<p>For example, using something like Infura:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">url</span><span class="p">:</span> <span class="s2">`https://polygon-mainnet.infura.io/v3/</span><span class="p">${</span><span class="nx">infuraId</span><span class="p">}</span><span class="s2">`</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>To view the final source code for this project, visit <a href="https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/">this repo</a></p>\n</blockquote>\n\n<h3>\n  <a name="next-steps" href="#next-steps">\n  </a>\n  Next steps\n</h3>\n\n<p>Congratulations! You\'ve deployed a non-trivial app to Polygon.</p>\n\n<p>The coolest thing about working with solutions like Polygon is how little extra work or learning I had to do compared to building directly on Ethereum. Almost all of the APIs and tooling in these layer 2\'s and sidechains remain the same, making any skills transferable across various platforms like Polygon. </p>\n\n<p>For the next steps, I\'d suggest porting over the queries implemented in this app using <a href="https://thegraph.com/">The Graph</a>. The Graph will open up many more data access patterns including things like pagination, filtering, and sorting which are necessary for any real-world application.</p>\n\n<p>I will also be publishing a tutorial showing how to use Polygon with The Graph in the coming weeks.</p>\n\n',n.body_markdown='---\ntitle: How to Build a Full Stack NFT Marketplace - V2 (2022)\npublished: true\ndescription: Building an NFT marketplace with Next.js, Tailwind, Solidity, and Polygon\ntags: webdev, react, blockchain, web3\ncover_image: https://dev-to-uploads.s3.amazonaws.com/uploads/articles/shlpjczbt9jrcbjwybzk.jpg\n---\n\n### Building an NFT marketplace with Polygon, Next.js, Tailwind, Solidity, Hardhat, Ethers.js, and IPFS\n\n> To view the video course for this tutorial, click [here](https://www.youtube.com/watch?v=GKJBEEXUha0). To view Version 1 of this tutorial, click [here](https://gist.github.com/dabit3/ce61bb1593c9aeae31f2a31bcad7f5da)\n\nIn my last end to end Ethereum tutorial, [The Complete Guide to Full Stack Ethereum Development](https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13) I introduced how to build a basic app on Ethereum using modern tooling like [Hardhat](https://hardhat.org/) and [Ethers.js](https://docs.ethers.io/v5/).\n\nIn this guide you\'ll learn how to build, deploy, and test out a full stack NFT marketplace on Ethereum. We\'ll also look at how to deploy to Polygon.\n\nOne thing that has become apparent is how quickly Ethereum scaling solutions like [Polygon](https://polygon.technology/), [Arbitrum](https://developer.offchainlabs.com/docs/developer_quickstart), and [Optimism](https://optimism.io/) are gaining momentum and adoption. These technologies enable developers to build the same applications they would directly on Ethereum with the added benefits of lower gas costs and faster transaction speeds among other things.\n\nBecause of the value proposition that these solutions offer combined with the general lack of existing content, I will be building out various example projects and tutorials for full stack applications using these various Ethereum scaling solutions, starting with this one on Polygon.\n\n> To view the final source code for this project, visit [this repo](https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/)\n\n### Prerequisites\n\nTo be successful in this guide, you must have the following:\n\n1. Node.js version `16.14.0` or greater installed on your machine. I recommend installing Node using either [nvm](https://github.com/nvm-sh/nvm) or [fnm](https://github.com/Schniz/fnm).\n2. Metamask wallet extension installed as a browser extension\n\n### The stack\n\nIn this guide, we will build out a full stack application using:\n\n__Web application framework__ - [Next.js](https://nextjs.org/)\n__Solidity development environment__ - [Hardhat](https://hardhat.org/)\n__File Storage__ - [IPFS](https://ipfs.io/)\n__Ethereum Web Client Library__ - [Ethers.js](https://docs.ethers.io/v5/)\n\nThough it will not be part of this guide (coming in a separate post), we will look at how to build a more robust API layer using [The Graph Protocol](https://thegraph.com/) to get around limitations in the data access patterns provided by the native blockchain layer.\n\n### About the project\n\nThe project that we will be building will be __Metaverse Marketplace__ - an NFT marketplace.\n\n![Metaverse Marketplace](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lx8avrmuwqswx9roub2g.png)\n\nWhen a user puts an NFT for sale, the ownership of the item will be transferred from the creator to the marketplace contract.\n\nWhen a user purchases an NFT, the purchase price will be transferred from the buyer to the seller and the item will be transferred from the marketplace to the buyer.\n\nThe marketplace owner will be able to set a listing fee. This fee will be taken from the seller and transferred to the contract owner upon completion of any sale, enabling the owner of the marketplace to earn recurring revenue from any sale transacted in the marketplace.\n\nThe marketplace logic will consist of just one smart contract:\n\n__NFT Marketplace Contract__ - [this](https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a) contract allows users to mint NFTs and list them in a marketplace.\n\nI believe this is a good project because the tools, techniques, and ideas we will be working with lay the foundation for many other types of applications on this stack â€“ dealing with things like payments, commissions, and transfers of ownership on the contract level as well as how a client-side application would use this smart contract to build a performant and nice-looking user interface.\n\nIn addition to the smart contract, I\'ll also show you how to build a subgraph to make the querying of data from the smart contract more flexible and efficient. As you will see, creating views on data sets and enabling various and performant data access patterns is hard to do directly from a smart contract. [The Graph](https://thegraph.com/) makes this much easier.\n\n### About Polygon\n\nFrom [the docs](https://polygon.technology/):\n\n___"Polygon is a protocol and a framework for building and connecting Ethereum-compatible blockchain networks. Aggregating scalable solutions on Ethereum supporting a multi-chain Ethereum ecosystem."___\n\n[Polygon is about 10x faster than Ethereum & yet transactions are more than 10x cheaper](https://twitter.com/ChainLinkGod/status/1405688790241316864). \n\nOk cool, but what does all that mean?\n\nTo me it means that _I can use the same knowledge, tools, and technologies I have been using to build apps on Ethereum to build apps that are faster and cheaper for users_, providing not only a better user experience but also opening the door for many types of applications that just would not be feasible to be built directly on Ethereum.\n\nAs mentioned before, there are many other Ethereum scaling solutions such as [Arbitrum](https://developer.offchainlabs.com/docs/developer_quickstart)and [Optimism](https://optimism.io/) that are also in a similar space. Most of these [scaling solutions](https://ethereum.org/en/developers/docs/scaling/) have technical differences and fall into various categories like [sidechains](https://ethereum.org/en/developers/docs/scaling/sidechains/) , [layer 2s](https://ethereum.org/en/developers/docs/scaling/layer-2-rollups/), and [state channels](https://ethereum.org/en/developers/docs/scaling/state-channels/).\n\nPolygon [recently rebranded from Matic](https://cointelegraph.com/news/matic-rebrands-to-polygon-in-pursuit-of-polkadot-on-ethereum-strategy) so you will also see the word __Matic__ used interchangeably when referring to various parts of their ecosystem because the name still is being used in various places, like their token and network names.\n\nTo learn more about Polygon, check out [this post](https://medium.com/coinmonks/polygon-matic-could-it-win-the-eth-scaling-race-2c8b4e9baf51) as well as their documentation [here](https://docs.matic.network/docs/develop/getting-started).\n\nNow that we have an overview of the project and related technologies, let\'s start building!\n\n## Project setup\n\nTo get started, we\'ll create a new Next.js app. To do so, open your terminal. Create or change into a new empty directory and run the following command:\n\n```sh\nnpx create-next-app nft-marketplace\n```\n\nNext, change into the new directory and install the dependencies using a package manager like `npm`, `yarn`, or `pnpm`:\n\n```sh\ncd nft-marketplace\n\nnpm install ethers hardhat @nomiclabs/hardhat-waffle \\\nethereum-waffle chai @nomiclabs/hardhat-ethers \\\nweb3modal @openzeppelin/contracts ipfs-http-client \\\naxios\n```\n\n### Setting up Tailwind CSS\n\nWe\'ll be using [Tailwind CSS](https://tailwindcss.com/) for styling, we we will set that up in this step.\n\nTailwind is a utility-first CSS framework that makes it easy to add styling and create good looking websites without a lot of work.\n\nNext, install the Tailwind dependencies:\n\n```sh\nnpm install -D tailwindcss@latest postcss@latest autoprefixer@latest\n```\n\nNext, we will create the configuration files needed for Tailwind to work with Next.js (`tailwind.config.js` and `postcss.config.js`) by running the following command:\n\n```sh\nnpx tailwindcss init -p\n```\n\nNext, configure your template `content` paths in __tailwind.config.js__:\n\n```javascript\n/* tailwind.config.js */\nmodule.exports = {\n  content: [\n    "./pages/**/*.{js,ts,jsx,tsx}",\n    "./components/**/*.{js,ts,jsx,tsx}",\n  ],\n  theme: {\n    extend: {},\n  },\n  plugins: [],\n}\n```\n\nFinally, delete the code in __styles/globals.css__ and update it with the following:\n\n```css\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n```\n\n### Configuring Hardhat\n\nNext, initialize a new Hardhat development environment from the root of your project:\n\n```sh\nnpx hardhat\n\n? What do you want to do? Create a basic sample project\n? Hardhat project root: <Choose default path>\n```\n\n> If you get an error referencing your __README.md__, delete __README.md__ and run `npx hardhat` again.\n\nNow you should see the following files and folders created for you in your root directory:\n\n__hardhat.config.js__ - The entirety of your Hardhat setup (i.e. your config, plugins, and custom tasks) is contained in this file.\n__scripts__ - A folder containing a script named sample-script.js that will deploy your smart contract when executed\n__test__ - A folder containing an example testing script\n__contracts__ - A folder holding an example Solidity smart contract\n\nNext, update the configuration at __hardhat.config.js__ with the following:\n\n> View the gist [here](https://gist.github.com/dabit3/9c4af9adeb3384e9ae3271181bce0f96)\n\n```javascript\n/* hardhat.config.js */\nrequire("@nomiclabs/hardhat-waffle")\n\nmodule.exports = {\n  defaultNetwork: "hardhat",\n  networks: {\n    hardhat: {\n      chainId: 1337\n    },\n//  unused configuration commented out for now\n//  mumbai: {\n//    url: "https://rpc-mumbai.maticvigil.com",\n//    accounts: [process.env.privateKey]\n//  }\n  },\n  solidity: {\n    version: "0.8.4",\n    settings: {\n      optimizer: {\n        enabled: true,\n        runs: 200\n      }\n    }\n  }\n}\n```\n\nIn this configuration, we\'ve configured the local Hardhat development environment as well as the [__Mumbai testnet__](https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet) (commented out for now). \n\nYou can read more about both Matic networks [here](https://docs.matic.network/docs/develop/network-details/network/).\n\n### Smart Contract\n\nNext, we\'ll create our smart contract!\n\nIn this file I\'ll do my best to comment within the code everything that is going on.\n\nCreate a new file in the __contracts__ directory named __NFTMarketplace.sol__. Here, add the following code:\n\n> View the gist [here](https://gist.github.com/dabit3/eb8866adc22bd86cabf5e6604b408e4a)\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity ^0.8.4;\n\nimport "@openzeppelin/contracts/utils/Counters.sol";\nimport "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";\nimport "@openzeppelin/contracts/token/ERC721/ERC721.sol";\n\nimport "hardhat/console.sol";\n\ncontract NFTMarketplace is ERC721URIStorage {\n    using Counters for Counters.Counter;\n    Counters.Counter private _tokenIds;\n    Counters.Counter private _itemsSold;\n\n    uint256 listingPrice = 0.025 ether;\n    address payable owner;\n\n    mapping(uint256 => MarketItem) private idToMarketItem;\n\n    struct MarketItem {\n      uint256 tokenId;\n      address payable seller;\n      address payable owner;\n      uint256 price;\n      bool sold;\n    }\n\n    event MarketItemCreated (\n      uint256 indexed tokenId,\n      address seller,\n      address owner,\n      uint256 price,\n      bool sold\n    );\n\n    constructor() ERC721("Metaverse Tokens", "METT") {\n      owner = payable(msg.sender);\n    }\n\n    /* Updates the listing price of the contract */\n    function updateListingPrice(uint _listingPrice) public payable {\n      require(owner == msg.sender, "Only marketplace owner can update listing price.");\n      listingPrice = _listingPrice;\n    }\n\n    /* Returns the listing price of the contract */\n    function getListingPrice() public view returns (uint256) {\n      return listingPrice;\n    }\n\n    /* Mints a token and lists it in the marketplace */\n    function createToken(string memory tokenURI, uint256 price) public payable returns (uint) {\n      _tokenIds.increment();\n      uint256 newTokenId = _tokenIds.current();\n\n      _mint(msg.sender, newTokenId);\n      _setTokenURI(newTokenId, tokenURI);\n      createMarketItem(newTokenId, price);\n      return newTokenId;\n    }\n\n    function createMarketItem(\n      uint256 tokenId,\n      uint256 price\n    ) private {\n      require(price > 0, "Price must be at least 1 wei");\n      require(msg.value == listingPrice, "Price must be equal to listing price");\n\n      idToMarketItem[tokenId] =  MarketItem(\n        tokenId,\n        payable(msg.sender),\n        payable(address(this)),\n        price,\n        false\n      );\n\n      _transfer(msg.sender, address(this), tokenId);\n      emit MarketItemCreated(\n        tokenId,\n        msg.sender,\n        address(this),\n        price,\n        false\n      );\n    }\n\n    /* allows someone to resell a token they have purchased */\n    function resellToken(uint256 tokenId, uint256 price) public payable {\n      require(idToMarketItem[tokenId].owner == msg.sender, "Only item owner can perform this operation");\n      require(msg.value == listingPrice, "Price must be equal to listing price");\n      idToMarketItem[tokenId].sold = false;\n      idToMarketItem[tokenId].price = price;\n      idToMarketItem[tokenId].seller = payable(msg.sender);\n      idToMarketItem[tokenId].owner = payable(address(this));\n      _itemsSold.decrement();\n\n      _transfer(msg.sender, address(this), tokenId);\n    }\n\n    /* Creates the sale of a marketplace item */\n    /* Transfers ownership of the item, as well as funds between parties */\n    function createMarketSale(\n      uint256 tokenId\n      ) public payable {\n      uint price = idToMarketItem[tokenId].price;\n      address seller = idToMarketItem[tokenId].seller;\n      require(msg.value == price, "Please submit the asking price in order to complete the purchase");\n      idToMarketItem[tokenId].owner = payable(msg.sender);\n      idToMarketItem[tokenId].sold = true;\n      idToMarketItem[tokenId].seller = payable(address(0));\n      _itemsSold.increment();\n      _transfer(address(this), msg.sender, tokenId);\n      payable(owner).transfer(listingPrice);\n      payable(seller).transfer(msg.value);\n    }\n\n    /* Returns all unsold market items */\n    function fetchMarketItems() public view returns (MarketItem[] memory) {\n      uint itemCount = _tokenIds.current();\n      uint unsoldItemCount = _tokenIds.current() - _itemsSold.current();\n      uint currentIndex = 0;\n\n      MarketItem[] memory items = new MarketItem[](unsoldItemCount);\n      for (uint i = 0; i < itemCount; i++) {\n        if (idToMarketItem[i + 1].owner == address(this)) {\n          uint currentId = i + 1;\n          MarketItem storage currentItem = idToMarketItem[currentId];\n          items[currentIndex] = currentItem;\n          currentIndex += 1;\n        }\n      }\n      return items;\n    }\n\n    /* Returns only items that a user has purchased */\n    function fetchMyNFTs() public view returns (MarketItem[] memory) {\n      uint totalItemCount = _tokenIds.current();\n      uint itemCount = 0;\n      uint currentIndex = 0;\n\n      for (uint i = 0; i < totalItemCount; i++) {\n        if (idToMarketItem[i + 1].owner == msg.sender) {\n          itemCount += 1;\n        }\n      }\n\n      MarketItem[] memory items = new MarketItem[](itemCount);\n      for (uint i = 0; i < totalItemCount; i++) {\n        if (idToMarketItem[i + 1].owner == msg.sender) {\n          uint currentId = i + 1;\n          MarketItem storage currentItem = idToMarketItem[currentId];\n          items[currentIndex] = currentItem;\n          currentIndex += 1;\n        }\n      }\n      return items;\n    }\n\n    /* Returns only items a user has listed */\n    function fetchItemsListed() public view returns (MarketItem[] memory) {\n      uint totalItemCount = _tokenIds.current();\n      uint itemCount = 0;\n      uint currentIndex = 0;\n\n      for (uint i = 0; i < totalItemCount; i++) {\n        if (idToMarketItem[i + 1].seller == msg.sender) {\n          itemCount += 1;\n        }\n      }\n\n      MarketItem[] memory items = new MarketItem[](itemCount);\n      for (uint i = 0; i < totalItemCount; i++) {\n        if (idToMarketItem[i + 1].seller == msg.sender) {\n          uint currentId = i + 1;\n          MarketItem storage currentItem = idToMarketItem[currentId];\n          items[currentIndex] = currentItem;\n          currentIndex += 1;\n        }\n      }\n      return items;\n    }\n}\n```\n\nIn this contract we are inheriting from the [ERC721 standard](https://eips.ethereum.org/EIPS/eip-721) implemented by [OpenZepplin](https://docs.openzeppelin.com/contracts/2.x/api/token/erc721)\n\nNow the smart contract code and environment is complete and we can try testing it out.\n\nTo do so, we can create a local test to run through much of the functionality, like minting a token, putting it up for sale, selling it to a user, and querying for tokens.\n\nTo create the test, open __test/sample-test.js__ and update it with the following code:\n\n> View the gist [here](https://gist.github.com/dabit3/8d41d27c60b4f16b105bd2479013c172)\n\n```javascript\n/* test/sample-test.js */\ndescribe("NFTMarket", function() {\n  it("Should create and execute market sales", async function() {\n    /* deploy the marketplace */\n    const NFTMarketplace = await ethers.getContractFactory("NFTMarketplace")\n    const nftMarketplace = await NFTMarketplace.deploy()\n    await nftMarketplace.deployed()\n\n    let listingPrice = await nftMarketplace.getListingPrice()\n    listingPrice = listingPrice.toString()\n\n    const auctionPrice = ethers.utils.parseUnits(\'1\', \'ether\')\n\n    /* create two tokens */\n    await nftMarketplace.createToken("https://www.mytokenlocation.com", auctionPrice, { value: listingPrice })\n    await nftMarketplace.createToken("https://www.mytokenlocation2.com", auctionPrice, { value: listingPrice })\n      \n    const [_, buyerAddress] = await ethers.getSigners()\n  \n    /* execute sale of token to another user */\n    await nftMarketplace.connect(buyerAddress).createMarketSale(1, { value: auctionPrice })\n\n    /* resell a token */\n    await nftMarketplace.connect(buyerAddress).resellToken(1, auctionPrice, { value: listingPrice })\n\n    /* query for and return the unsold items */\n    items = await nftMarketplace.fetchMarketItems()\n    items = await Promise.all(items.map(async i => {\n      const tokenUri = await nftMarketplace.tokenURI(i.tokenId)\n      let item = {\n        price: i.price.toString(),\n        tokenId: i.tokenId.toString(),\n        seller: i.seller,\n        owner: i.owner,\n        tokenUri\n      }\n      return item\n    }))\n    console.log(\'items: \', items)\n  })\n})\n```\n\nNext, run the test from your command line:\n\n```sh\nnpx hardhat test\n```\n\nIf the test runs successfully, it should log out an array containing the two marketplace items.\n\n![Running the test](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cewr5c4nkwudh8xd5etd.png)\n\n## Building the front end\n\nNow that the smart contract is working and ready to go, we can start building out the UI.\n\nThe first thing we might think about is setting up a layout so that we can enable some navigation that will persist across all pages.\n\nTo set this up, open __pages/_app.js__ and update it with the following code:\n\n> View the gist [here](https://gist.github.com/dabit3/1c747a13b4da549272ddcc113b1b9c96)\n\n```javascript\n/* pages/_app.js */\nimport \'../styles/globals.css\'\nimport Link from \'next/link\'\n\nfunction MyApp({ Component, pageProps }) {\n  return (\n    <div>\n      <nav className="border-b p-6">\n        <p className="text-4xl font-bold">Metaverse Marketplace</p>\n        <div className="flex mt-4">\n          <Link href="/">\n            <a className="mr-4 text-pink-500">\n              Home\n            </a>\n          </Link>\n          <Link href="/create-nft">\n            <a className="mr-6 text-pink-500">\n              Sell NFT\n            </a>\n          </Link>\n          <Link href="/my-nfts">\n            <a className="mr-6 text-pink-500">\n              My NFTs\n            </a>\n          </Link>\n          <Link href="/dashboard">\n            <a className="mr-6 text-pink-500">\n              Dashboard\n            </a>\n          </Link>\n        </div>\n      </nav>\n      <Component {...pageProps} />\n    </div>\n  )\n}\n\nexport default MyApp\n```\n\nThe navigation has links for the home route as well as a page to sell an NFT, view the NFTs you have purchased, and a dashboard to see the NFTs you\'ve listed.\n\n#### Querying the contract for marketplace items\n\nThe next page we\'ll update is __pages/index.js__. This is the main entry-point of the app, and will be the view where we query for the NFTs for sale and render them to the screen.\n\n> View the gist [here](https://gist.github.com/dabit3/f24480130555e3d505156aea3e2024a4)\n\n```javascript\n/* pages/index.js */\nimport { ethers } from \'ethers\'\nimport { useEffect, useState } from \'react\'\nimport axios from \'axios\'\nimport Web3Modal from \'web3modal\'\n\nimport {\n  marketplaceAddress\n} from \'../config\'\n\nimport NFTMarketplace from \'../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json\'\n\nexport default function Home() {\n  const [nfts, setNfts] = useState([])\n  const [loadingState, setLoadingState] = useState(\'not-loaded\')\n  useEffect(() => {\n    loadNFTs()\n  }, [])\n  async function loadNFTs() {\n    /* create a generic provider and query for unsold market items */\n    const provider = new ethers.providers.JsonRpcProvider()\n    const contract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, provider)\n    const data = await contract.fetchMarketItems()\n\n    /*\n    *  map over items returned from smart contract and format \n    *  them as well as fetch their token metadata\n    */\n    const items = await Promise.all(data.map(async i => {\n      const tokenUri = await contract.tokenURI(i.tokenId)\n      const meta = await axios.get(tokenUri)\n      let price = ethers.utils.formatUnits(i.price.toString(), \'ether\')\n      let item = {\n        price,\n        tokenId: i.tokenId.toNumber(),\n        seller: i.seller,\n        owner: i.owner,\n        image: meta.data.image,\n        name: meta.data.name,\n        description: meta.data.description,\n      }\n      return item\n    }))\n    setNfts(items)\n    setLoadingState(\'loaded\') \n  }\n  async function buyNft(nft) {\n    /* needs the user to sign the transaction, so will use Web3Provider and sign it */\n    const web3Modal = new Web3Modal()\n    const connection = await web3Modal.connect()\n    const provider = new ethers.providers.Web3Provider(connection)\n    const signer = provider.getSigner()\n    const contract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, signer)\n\n    /* user will be prompted to pay the asking proces to complete the transaction */\n    const price = ethers.utils.parseUnits(nft.price.toString(), \'ether\')   \n    const transaction = await contract.createMarketSale(nft.tokenId, {\n      value: price\n    })\n    await transaction.wait()\n    loadNFTs()\n  }\n  if (loadingState === \'loaded\' && !nfts.length) return (<h1 className="px-20 py-10 text-3xl">No items in marketplace</h1>)\n  return (\n    <div className="flex justify-center">\n      <div className="px-4" style={{ maxWidth: \'1600px\' }}>\n        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4">\n          {\n            nfts.map((nft, i) => (\n              <div key={i} className="border shadow rounded-xl overflow-hidden">\n                <img src={nft.image} />\n                <div className="p-4">\n                  <p style={{ height: \'64px\' }} className="text-2xl font-semibold">{nft.name}</p>\n                  <div style={{ height: \'70px\', overflow: \'hidden\' }}>\n                    <p className="text-gray-400">{nft.description}</p>\n                  </div>\n                </div>\n                <div className="p-4 bg-black">\n                  <p className="text-2xl font-bold text-white">{nft.price} ETH</p>\n                  <button className="mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded" onClick={() => buyNft(nft)}>Buy</button>\n                </div>\n              </div>\n            ))\n          }\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\nWhen the page loads, we query the smart contract for any NFTs that are still for sale and render them to the screen along with metadata about the items and a button for purchasing them.\n\n#### Creating and listing NFTs\n\nNext, let\'s create the page that allows users to create and list NFTs.\n\nThere are a few things happening in this page:\n\n1. The user is able to upload and save files to IPFS\n2. The user is able to create a new NFT\n3. The user is able to set metadata and price of item and list it for sale on the marketplace\n\nAfter the user creates and lists an item, they are re-routed to the main page to view all of the items for sale.\n\n> View the gist [here](https://gist.github.com/dabit3/20068fb7938f51e1411c8257bfe4fc9d)\n\n```javascript\n/* pages/create-nft.js */\nimport { useState } from \'react\'\nimport { ethers } from \'ethers\'\nimport { create as ipfsHttpClient } from \'ipfs-http-client\'\nimport { useRouter } from \'next/router\'\nimport Web3Modal from \'web3modal\'\n\nconst client = ipfsHttpClient(\'https://ipfs.infura.io:5001/api/v0\')\n\nimport {\n  marketplaceAddress\n} from \'../config\'\n\nimport NFTMarketplace from \'../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json\'\n\nexport default function CreateItem() {\n  const [fileUrl, setFileUrl] = useState(null)\n  const [formInput, updateFormInput] = useState({ price: \'\', name: \'\', description: \'\' })\n  const router = useRouter()\n\n  async function onChange(e) {\n    /* upload image to IPFS */\n    const file = e.target.files[0]\n    try {\n      const added = await client.add(\n        file,\n        {\n          progress: (prog) => console.log(`received: ${prog}`)\n        }\n      )\n      const url = `https://ipfs.infura.io/ipfs/${added.path}`\n      setFileUrl(url)\n    } catch (error) {\n      console.log(\'Error uploading file: \', error)\n    }  \n  }\n  async function uploadToIPFS() {\n    const { name, description, price } = formInput\n    if (!name || !description || !price || !fileUrl) return\n    /* first, upload metadata to IPFS */\n    const data = JSON.stringify({\n      name, description, image: fileUrl\n    })\n    try {\n      const added = await client.add(data)\n      const url = `https://ipfs.infura.io/ipfs/${added.path}`\n      /* after metadata is uploaded to IPFS, return the URL to use it in the transaction */\n      return url\n    } catch (error) {\n      console.log(\'Error uploading file: \', error)\n    }  \n  }\n\n  async function listNFTForSale() {\n    const url = await uploadToIPFS()\n    const web3Modal = new Web3Modal()\n    const connection = await web3Modal.connect()\n    const provider = new ethers.providers.Web3Provider(connection)\n    const signer = provider.getSigner()\n\n    /* create the NFT */\n    const price = ethers.utils.parseUnits(formInput.price, \'ether\')\n    let contract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, signer)\n    let listingPrice = await contract.getListingPrice()\n    listingPrice = listingPrice.toString()\n    let transaction = await contract.createToken(url, price, { value: listingPrice })\n    await transaction.wait()\n   \n    router.push(\'/\')\n  }\n\n  return (\n    <div className="flex justify-center">\n      <div className="w-1/2 flex flex-col pb-12">\n        <input \n          placeholder="Asset Name"\n          className="mt-8 border rounded p-4"\n          onChange={e => updateFormInput({ ...formInput, name: e.target.value })}\n        />\n        <textarea\n          placeholder="Asset Description"\n          className="mt-2 border rounded p-4"\n          onChange={e => updateFormInput({ ...formInput, description: e.target.value })}\n        />\n        <input\n          placeholder="Asset Price in Eth"\n          className="mt-2 border rounded p-4"\n          onChange={e => updateFormInput({ ...formInput, price: e.target.value })}\n        />\n        <input\n          type="file"\n          name="Asset"\n          className="my-4"\n          onChange={onChange}\n        />\n        {\n          fileUrl && (\n            <img className="rounded mt-4" width="350" src={fileUrl} />\n          )\n        }\n        <button onClick={listNFTForSale} className="font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg">\n          Create NFT\n        </button>\n      </div>\n    </div>\n  )\n}\n```\n\n#### Viewing only the NFTs purchased by the user\n\nIn the __NFTMarketplace.sol__ smart contract, we created a function named `fetchMyNFTs` that only returns the NFTs owned by the user.\n\nIn __pages/my-nfts.js__, we will use that function to fetch and render them.\n\nThis functionality is different than the query main __pages/index.js__ page because we need to ask the user for their address and use it in the contract, so the user will have to sign the transaction for it to be able to fetch them properly.\n\n> View the gist [here](https://gist.github.com/dabit3/bc8f091b2c200311439cbf6997320c2b)\n\n```javascript\n/* pages/my-nfts.js */\nimport { ethers } from \'ethers\'\nimport { useEffect, useState } from \'react\'\nimport axios from \'axios\'\nimport Web3Modal from \'web3modal\'\nimport { useRouter } from \'next/router\'\n\nimport {\n  marketplaceAddress\n} from \'../config\'\n\nimport NFTMarketplace from \'../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json\'\n\nexport default function MyAssets() {\n  const [nfts, setNfts] = useState([])\n  const [loadingState, setLoadingState] = useState(\'not-loaded\')\n  const router = useRouter()\n  useEffect(() => {\n    loadNFTs()\n  }, [])\n  async function loadNFTs() {\n    const web3Modal = new Web3Modal({\n      network: "mainnet",\n      cacheProvider: true,\n    })\n    const connection = await web3Modal.connect()\n    const provider = new ethers.providers.Web3Provider(connection)\n    const signer = provider.getSigner()\n\n    const marketplaceContract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, signer)\n    const data = await marketplaceContract.fetchMyNFTs()\n\n    const items = await Promise.all(data.map(async i => {\n      const tokenURI = await marketplaceContract.tokenURI(i.tokenId)\n      const meta = await axios.get(tokenURI)\n      let price = ethers.utils.formatUnits(i.price.toString(), \'ether\')\n      let item = {\n        price,\n        tokenId: i.tokenId.toNumber(),\n        seller: i.seller,\n        owner: i.owner,\n        image: meta.data.image,\n        tokenURI\n      }\n      return item\n    }))\n    setNfts(items)\n    setLoadingState(\'loaded\') \n  }\n  function listNFT(nft) {\n    router.push(`/resell-nft?id=${nft.tokenId}&tokenURI=${nft.tokenURI}`)\n  }\n  if (loadingState === \'loaded\' && !nfts.length) return (<h1 className="py-10 px-20 text-3xl">No NFTs owned</h1>)\n  return (\n    <div className="flex justify-center">\n      <div className="p-4">\n        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4">\n          {\n            nfts.map((nft, i) => (\n              <div key={i} className="border shadow rounded-xl overflow-hidden">\n                <img src={nft.image} className="rounded" />\n                <div className="p-4 bg-black">\n                  <p className="text-2xl font-bold text-white">Price - {nft.price} Eth</p>\n                  <button className="mt-4 w-full bg-pink-500 text-white font-bold py-2 px-12 rounded" onClick={() => listNFT(nft)}>List</button>\n                </div>\n              </div>\n            ))\n          }\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\n#### Dashboard\n\nThe next page we will be creating is the dashboard that will allow users to view all of the items they have listed.\n\nThis page will be using the `fetchItemsListed` function from the __NFTMarketplace.sol__ smart contract which returns only the items that match the address of the user making the function call.\n\nCreate a new file called __dashboard.js__ in the __pages__ directory with the following code:\n\n> View the gist [here](https://gist.github.com/dabit3/68993c17eb4cbb1c2b6c8e9ced176a01)\n\n```javascript\n/* pages/dashboard.js */\nimport { ethers } from \'ethers\'\nimport { useEffect, useState } from \'react\'\nimport axios from \'axios\'\nimport Web3Modal from \'web3modal\'\n\nimport {\n  marketplaceAddress\n} from \'../config\'\n\nimport NFTMarketplace from \'../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json\'\n\nexport default function CreatorDashboard() {\n  const [nfts, setNfts] = useState([])\n  const [loadingState, setLoadingState] = useState(\'not-loaded\')\n  useEffect(() => {\n    loadNFTs()\n  }, [])\n  async function loadNFTs() {\n    const web3Modal = new Web3Modal({\n      network: \'mainnet\',\n      cacheProvider: true,\n    })\n    const connection = await web3Modal.connect()\n    const provider = new ethers.providers.Web3Provider(connection)\n    const signer = provider.getSigner()\n\n    const contract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, signer)\n    const data = await contract.fetchItemsListed()\n\n    const items = await Promise.all(data.map(async i => {\n      const tokenUri = await contract.tokenURI(i.tokenId)\n      const meta = await axios.get(tokenUri)\n      let price = ethers.utils.formatUnits(i.price.toString(), \'ether\')\n      let item = {\n        price,\n        tokenId: i.tokenId.toNumber(),\n        seller: i.seller,\n        owner: i.owner,\n        image: meta.data.image,\n      }\n      return item\n    }))\n\n    setNfts(items)\n    setLoadingState(\'loaded\') \n  }\n  if (loadingState === \'loaded\' && !nfts.length) return (<h1 className="py-10 px-20 text-3xl">No NFTs listed</h1>)\n  return (\n    <div>\n      <div className="p-4">\n        <h2 className="text-2xl py-2">Items Listed</h2>\n          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 pt-4">\n          {\n            nfts.map((nft, i) => (\n              <div key={i} className="border shadow rounded-xl overflow-hidden">\n                <img src={nft.image} className="rounded" />\n                <div className="p-4 bg-black">\n                  <p className="text-2xl font-bold text-white">Price - {nft.price} Eth</p>\n                </div>\n              </div>\n            ))\n          }\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\n#### Reselling a token\n\nThe final page we will be creating will allow users to resell an NFT they\'ve purchased from someone else.\n\nThis page will be using the `resellToken` function from the __NFTMarketplace.sol__ smart contract.\n\n> View the gist [here](https://gist.github.com/dabit3/d73a69da9c05cc31ecabfcfe68effc2d)\n\n```javascript\n/* pages/resell-nft.js */\nimport { useEffect, useState } from \'react\'\nimport { ethers } from \'ethers\'\nimport { useRouter } from \'next/router\'\nimport axios from \'axios\'\nimport Web3Modal from \'web3modal\'\n\nimport {\n  marketplaceAddress\n} from \'../config\'\n\nimport NFTMarketplace from \'../artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json\'\n\nexport default function ResellNFT() {\n  const [formInput, updateFormInput] = useState({ price: \'\', image: \'\' })\n  const router = useRouter()\n  const { id, tokenURI } = router.query\n  const { image, price } = formInput\n\n  useEffect(() => {\n    fetchNFT()\n  }, [id])\n\n  async function fetchNFT() {\n    if (!tokenURI) return\n    const meta = await axios.get(tokenURI)\n    updateFormInput(state => ({ ...state, image: meta.data.image }))\n  }\n\n  async function listNFTForSale() {\n    if (!price) return\n    const web3Modal = new Web3Modal()\n    const connection = await web3Modal.connect()\n    const provider = new ethers.providers.Web3Provider(connection)\n    const signer = provider.getSigner()\n\n    const priceFormatted = ethers.utils.parseUnits(formInput.price, \'ether\')\n    let contract = new ethers.Contract(marketplaceAddress, NFTMarketplace.abi, signer)\n    let listingPrice = await contract.getListingPrice()\n\n    listingPrice = listingPrice.toString()\n    let transaction = await contract.resellToken(id, priceFormatted, { value: listingPrice })\n    await transaction.wait()\n   \n    router.push(\'/\')\n  }\n\n  return (\n    <div className="flex justify-center">\n      <div className="w-1/2 flex flex-col pb-12">\n        <input\n          placeholder="Asset Price in Eth"\n          className="mt-2 border rounded p-4"\n          onChange={e => updateFormInput({ ...formInput, price: e.target.value })}\n        />\n        {\n          image && (\n            <img className="rounded mt-4" width="350" src={image} />\n          )\n        }\n        <button onClick={listNFTForSale} className="font-bold mt-4 bg-pink-500 text-white rounded p-4 shadow-lg">\n          List NFT\n        </button>\n      </div>\n    </div>\n  )\n}\n```\n\n### Running the project\n\nTo run the project, we will need to have a deploy script to deploy the smart contracts to the blockchain network.\n\n#### Deploying the contracts to a local network\n\nWhen we created the project, Hardhat created an example deployment script at __scripts/sample-script.js__.\n\nTo make the purpose of this script more clear, update the name of __scripts/sample-script.js__ to __scripts/deploy.js__.\n\nNext, update __scripts/deploy.js__ with the following code:\n\n```javascript\nconst hre = require("hardhat");\nconst fs = require(\'fs\');\n\nasync function main() {\n  const NFTMarketplace = await hre.ethers.getContractFactory("NFTMarketplace");\n  const nftMarketplace = await NFTMarketplace.deploy();\n  await nftMarketplace.deployed();\n  console.log("nftMarketplace deployed to:", nftMarketplace.address);\n\n  fs.writeFileSync(\'./config.js\', `\n  export const marketplaceAddress = "${nftMarketplace.address}"\n  `)\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(error);\n    process.exit(1);\n  });\n```\n\nThis script will deploy the contract to the blockchain network and create a file named __config.js__ that will hold the address of the smart contract after it\'s been deployed.\n\nWe will first test this on a local network, then deploy it to the [Mumbai testnet](https://docs.matic.network/docs/develop/network-details/network/).\n\nTo spin up a local network, open your terminal and run the following command:\n\n```sh\nnpx hardhat node\n```\n\nThis should create a local network with 20 accounts.\n\n![Hardhat node](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s1spai8459exh7looei7.png)\n\n\nNext, keep the node running and open a separate terminal window to deploy the contract.\n\nIn a separate window, run the following command:\n\n```sh\nnpx hardhat run scripts/deploy.js --network localhost\n```\n\nWhen the deployment is complete, the CLI should print out the address of the contract that was deployed:\n\n![Contract address](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6fk3mb7gz46b2rl4upte.png)\n\nYou should also see the __config.js__ file populated with this smart contract address.\n\n#### Importing accounts into MetaMask\n\nYou can import the accounts created by the node into your Metamask wallet to try out in the app.\n\nEach of these accounts is seeded with 10000 ETH.\n\nTo import one of these accounts, first switch your MetaMask wallet network to Localhost 8545.\n\n![Localhost Network](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cgcicglserwmyx6vrexy.jpeg)\n\nNext, in MetaMask click on __Import Account__ from the accounts menu:\n\n![MetaMask import account](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/04rv5hdn8s2f7tkslpru.jpeg)\n\nCopy then paste one of the __Private Keys__ logged out by the CLI and click __Import__. Once the account is imported, you should see some the Eth in the account:\n\n![MetaMask account](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xc5y4xa9htjymncovo2o.jpeg)\n\nI\'d suggest doing this with 2 or 3 accounts so that you have the ability to test out the various functionality between users.\n\n#### Running the app\n\nNow we can test out the app!\n\nTo start the app, run the following command in your CLI:\n\n```sh\nnpm run dev\n```\n\nTo test everything out, try listing an item for sale, then switching to another account and purchasing it.\n\n## Deploying to Polygon\n\nNow that we have the project up and running and tested locally, let\'s deploy to Polygon. We\'ll start by deploying to [Mumbai](https://docs.polygon.technology/docs/develop/network-details/network/), the Polygon test network.\n\nThe first thing we will need to do is save one of our __private keys__ from our wallet as an environment variable.\n\nTo get the private key, you can use one of the private keys given to you by Hardhat or you can export them directly from MetaMask.\n\n![Private keys](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png)\n\nIf you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):\n\n```sh\nexport privateKey="your-private-key"\n```\n\n> Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.\n\n### Configuring the network\n\nNext, we need to switch from the local test network to the [Mumbai Testnet](https://docs.matic.network/docs/develop/network-details/network/#mumbai-testnet).\n\nTo do so, we need to create and set the network configuration.\n\nFirst, open MetaMask and click on __Settings__.\n\n![MetaMask settings](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png)\n\nNext, click on __Networks__ and then __Add Network__:\n\n![New Network](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png)\n\nHere, we will add the following configurations for the Mumbai test network as listed [here](https://docs.polygon.technology/docs/develop/network-details/network/):\n\nNetwork Name: __Mumbai TestNet__\nNew RPC URL: __https://rpc-mumbai.maticvigil.com__\nChain ID: __80001__\nCurrency Symbol: __Matic__\n\nSave this, then you should be able to switch to and use the new network!\n\nFinally, you will need some testnet Matic tokens in order to interact with the applications.\n\nTo get these, you can visit the [Matic Faucet](https://faucet.matic.network/), inputting the address of the wallets that you would like to request the tokens.\n\n### Deploying to the Matic / Polygon network\n\nNow that you have some Matic tokens, you can deploy to the Polygon network!\n\nTo do so, be sure that the address associated with the private key you are deploying your contract with has received some Matic tokens in order to pay the gas fees for the transaction.\n\nAlso, be sure to uncomment the `mumbai` configuration in __hardhat.config.js__:\n\n```javascript\n    mumbai: {\n      url: "https://rpc-mumbai.maticvigil.com",\n      accounts: [process.env.privateKey]\n    }\n```\n\nTo deploy to Matic, run the following command:\n\n```sh\nnpx hardhat run scripts/deploy.js --network mumbai\n```\n\n> If you run a deployment error, the public RPC may be congested. In production, it\'s recommended to use an RPC provider like [Infura](https://infura.io/), [Alchemy](https://www.alchemy.com/), [Quicknode](https://www.quicknode.com/), or [Figment DataHub](https://datahub.figment.io/).\n\nOnce the contracts have been deployed, update the `loadNFTs` function call in __pages/index.js__ to include the new RPC endpoint:\n\n```javascript\n/* pages/index.js */\n\n/* old provider */\nconst provider = new ethers.providers.JsonRpcProvider()\n\n/* new provider */\nconst provider = new ethers.providers.JsonRpcProvider("https://rpc-mumbai.maticvigil.com")\n```\n\nYou should now be able to update the contract addresses in your project and test on the new network ðŸŽ‰!\n\n```sh\nnpm run dev\n```\n\n> If you run into an error, the contract address printed out to the console by hardhat could be incorrect due to a bug I\'ve run into recently. You can get the correct contract addresses by visiting [https://mumbai.polygonscan.com/](https://mumbai.polygonscan.com/) and pasting in the address from which the contracts were deployed to see the most recent transactions and getting the contract addresses from the transaction data.\n\n#### Deploying to Mainnet\n\nTo deploy to the main Matic / Polygon network, you can use the same steps we set up for the Mumbai test network.\n\nThe main difference is that you\'ll need to use an endpoint for Matic as well as import the network into your MetaMask wallet as listed [here](https://docs.matic.network/docs/develop/network-details/network/).\n\nAn example update in your project to make this happen might look like this:\n\n```javascript\n/* hardhat.config.js */\n\n/* adding Matic main network config to existing config */\n...\nmatic: {\n  url: "https://rpc-mainnet.maticvigil.com",\n  accounts: [privateKey]\n}\n...\n```\n\nPublic RPCs like the one listed above may have traffic or rate-limits depending on usage. You can sign up for a dedicated free RPC URL using services like Infura, MaticVigil, QuickNode, Alchemy, Chainstack, or Ankr.\n\nFor example, using something like Infura:\n\n```javascript\nurl: `https://polygon-mainnet.infura.io/v3/${infuraId}`\n```\n\n> To view the final source code for this project, visit [this repo](https://github.com/dabit3/polygon-ethereum-nextjs-marketplace/)\n\n### Next steps\n\nCongratulations! You\'ve deployed a non-trivial app to Polygon.\n\nThe coolest thing about working with solutions like Polygon is how little extra work or learning I had to do compared to building directly on Ethereum. Almost all of the APIs and tooling in these layer 2\'s and sidechains remain the same, making any skills transferable across various platforms like Polygon. \n\nFor the next steps, I\'d suggest porting over the queries implemented in this app using [The Graph](https://thegraph.com/). The Graph will open up many more data access patterns including things like pagination, filtering, and sorting which are necessary for any real-world application.\n\nI will also be publishing a tutorial showing how to use Polygon with The Graph in the coming weeks.',n.user={name:"Nader Dabit",username:a,twitter_username:a,github_username:a,website_url:"https://mmm.page/nader.main",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--aNfZvjEi--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/126437/41231eb2-054b-4417-bc35-814e491a2d5d.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--qYNR4ugk--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/126437/41231eb2-054b-4417-bc35-814e491a2d5d.jpeg"},n.organization={name:"Edge and Node",username:t,slug:t,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--XVvCNUhC--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/5310/ea8cfcbf-e2a2-463d-a7ba-cdaf565222d8.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--xi_iSmfh--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/5310/ea8cfcbf-e2a2-463d-a7ba-cdaf565222d8.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:n}},error:s,state:{currentArticle:n},serverRendered:!0,routePath:"/dabit3/744589",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"dabit3",{},"https://dev.to/edge-and-node/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb","2021-07-06T15:14:09Z","edge-and-node")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
