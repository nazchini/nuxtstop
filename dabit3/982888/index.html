<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>The Complete Guide to Full Stack Web3 Development</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>The Complete Guide to Full Stack Web3 Development</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/web3" class="tag" data-v-70afb46a>
          #web3
        </a><a href="/nuxtstop/t/blockchain" class="tag" data-v-70afb46a>
          #blockchain
        </a><a href="/nuxtstop/t/solidity" class="tag" data-v-70afb46a>
          #solidity
        </a><a href="/nuxtstop/t/webdev" class="tag" data-v-70afb46a>
          #webdev
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--3wa8vtB8--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/maq07rzwhayt5qvwarw6.jpg" alt="The Complete Guide to Full Stack Web3 Development" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            4741
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            67
          </span></div> <time data-v-70afb46a>Feb 10</time></div></header> <div class="content" data-v-70afb46a><h2>
  <a name="building-a-full-stack-web3-app-with-nextjs-polygon-solidity-the-graph-ipfs-and-hardhat" href="#building-a-full-stack-web3-app-with-nextjs-polygon-solidity-the-graph-ipfs-and-hardhat">
  </a>
  Building a full stack web3 app with Next.js, Polygon, Solidity, The Graph, IPFS, and Hardhat
</h2>

<blockquote>
<p>The video for this tutorial is also available <a href="https://www.youtube.com/watch?v=nRMo5jjgCr4">here</a></p>
</blockquote>

<p>In this in depth tutorial you'll learn the tools, protocols, and frameworks for building full stack web3 apps, and most importantly - how to put everything together to lay the groundwork for building out any of your own ideas in the future.</p>

<blockquote>
<p>The codebase for this app is located <a href="https://github.com/dabit3/full-stack-web3">here</a></p>
</blockquote>

<p>The main network we'll be deploying to is <a href="https://polygon.technology/">Polygon</a>. I chose Polygon because of its low transaction cost, fast block times, and current network adoption.</p>

<p>That being said, we're going to be building on the <a href="https://ethereum.org/en/developers/docs/evm/">Ethereum Virtual Machine</a> (EVM), so you can apply these skills to build for dozens of other blockchain networks as well, including Ethereum, Celo, Avalanche, and many others.</p>

<p>The app we'll be building is a full stack blog as well as a content management system (CMS), meaning that you will have an open, public, and composable back end that can be transferred and reused anywhere.</p>

<p>By the end of this tutorial you should have a good understanding of the most important pieces of a modern web3 stack and how to build performant, scalable, full stack decentralized blockchain applications.</p>

<p><strong>This is the fourth guide in my "Full Stack" web3 series. Also be sure to check out:</strong></p>

<ol>
<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a></li>
<li><a href="https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb">Building a Full Stack NFT Marketplace on Ethereum with Polygon
</a></li>
<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291">The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom</a></li>
</ol>

<h3>
  <a name="the-web3-stack" href="#the-web3-stack">
  </a>
  The web3 stack
</h3>

<p><a href="https://edgeandnode.com/images/web3-stack.jpg"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--UQYhll4y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://edgeandnode.com/images/web3-stack.jpg" alt="The web3 stack" loading="lazy" width="880" height="495"></a></p>

<p>In <a href="https://edgeandnode.com/blog/defining-the-web3-stack">Defining the web3 stack</a> I wrote about my interpretation of the current state of the web3 tech stack from a developer's perspective using a combination of my own personal experience as well as research that was done over the past year on my team at <a href="https://edgeandnode.com/">Edge & Node</a>.</p>

<p>We will be using pieces of this stack for this application:</p>

<ol>
<li>Blockchain - <a href="https://polygon.technology/">Polygon</a> (with optional RPC provider)</li>
<li>Ethereum development environment - <a href="https://hardhat.org/">Hardhat</a>
</li>
<li>Front end framework - <a href="https://nextjs.org/">Next.js</a> & <a href="https://reactjs.org/">React</a>
</li>
<li>Ethereum web client library - <a href="https://docs.ethers.io/v5/">Ethers.js</a>
</li>
<li>File storage - <a href="https://ipfs.io/">IPFS</a>
</li>
<li>Indexing and querying - <a href="https://thegraph.com/en/">The Graph Protocol</a>
</li>
</ol>

<p>Learning how to use these building blocks we can build out many types of applications, so the goal with this tutorial is to show how they each work and how they all fit together.</p>

<p>Let's get started!</p>

<h3>
  <a name="prerequisites" href="#prerequisites">
  </a>
  Prerequisites
</h3>

<ul>
<li>Node.js installed on your local machine</li>
<li>MetaMask Chrome extension installed in your browser</li>
</ul>

<h2>
  <a name="project-setup" href="#project-setup">
  </a>
  Project setup
</h2>

<p>Here we will create the application boilerplates, install all of the necessary dependencies, and configure the project.</p>

<p>The code will be commented to give you insight as to what is happening, and I'll describe some of what is going on throughout the tutorial as well.</p>

<p>To get started, create a new <strong>Next.js</strong> application and change into the new directory:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>npx create-next-app web3-blog

cd web3-blog
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, change into the new directory and install the following dependencies using either <strong>npm</strong>, <strong>yarn</strong>, or <strong>pnpm</strong>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm <span class="nb">install </span>ethers hardhat @nomiclabs/hardhat-waffle <span class="se">\</span>
ethereum-waffle chai @nomiclabs/hardhat-ethers <span class="se">\</span>
web3modal @walletconnect/web3-provider <span class="se">\</span>
easymde react-markdown react-simplemde-editor <span class="se">\</span>
ipfs-http-client @emotion/css @openzeppelin/contracts
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>An overview of some of these dependencies:</p>

<p><a href="https://hardhat.org/">hardhat</a> - Ethereum development environment<br>
<a href="https://github.com/Web3Modal/web3modal">web3modal</a> - An easy-to-use library that allows users to connect their wallets to your app<br>
<a href="https://github.com/remarkjs/react-markdown">react-markdown</a> and <a href="https://github.com/sparksuite/simplemde-markdown-editor">simplemde</a> - Markdown editor and markdown renderer for the CMS<br>
<a href="https://emotion.sh/docs/introduction">@emotion/css</a> - A great CSS in JS library<br>
<a href="https://github.com/OpenZeppelin/openzeppelin-contracts">@openzeppelin/contracts</a> - Open source implementations of useful smart contract standards and functionality</p>

<p>Next, we'll initialize the local smart contract development environment.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat

? What <span class="k">do </span>you want to <span class="k">do</span>? Create a basic sample project
? Hardhat project root: &lt;Choose default path>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>If you get an error referencing your <strong>README.md</strong>, delete <strong>README.md</strong> and run <code>npx hardhat</code> again.</p>
</blockquote>

<p>This should scaffold out the basic Solidity development environment that we will use. You should see a few new files and folders created, including <strong>contracts</strong>, <strong>scripts</strong>, <strong>test</strong>, and <strong>hardhat.config.js</strong>.</p>

<p>Next, let's update the hardhat configuration at <strong>hardhat.config.js</strong>.</p>

<p>Update this file with the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@nomiclabs/hardhat-waffle</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">solidity</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.8.4</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">networks</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">hardhat</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">chainId</span><span class="p">:</span> <span class="mi">1337</span>
    <span class="p">},</span>
    <span class="c1">// mumbai: {</span>
    <span class="c1">//   url: "https://rpc-mumbai.matic.today",</span>
    <span class="c1">//   accounts: [process.env.pk]</span>
    <span class="c1">// },</span>
    <span class="c1">// polygon: {</span>
    <span class="c1">//   url: "https://polygon-rpc.com/",</span>
    <span class="c1">//   accounts: [process.env.pk]</span>
    <span class="c1">// }</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Here, we've configured the local hardhat development environment as well as set up (and commented out) the Polygon mainnet and Mumbai testnet environments that we'll be using to deploy to Polygon.</p>

<p>Next, let's add some basic global CSS that we'll be needing to style the markdown editor for the CMS.</p>

<p>Open <strong>styles/globals.css</strong> and add the following code below the existing css:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight css"><code><span class="nc">.EasyMDEContainer</span> <span class="nc">.editor-toolbar</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.EasyMDEContainer</span> <span class="nc">.CodeMirror</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.editor-preview</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.CodeMirror</span> <span class="nc">.cm-spell-error</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-url</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-comment</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-tag</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-word</span><span class="o">)</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="nb">transparent</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">pre</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#efefef</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">blockquote</span> <span class="p">{</span>
  <span class="nl">border-left</span><span class="p">:</span> <span class="m">5px</span> <span class="nb">solid</span> <span class="m">#ddd</span><span class="p">;</span>
  <span class="nl">padding-left</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">0px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, we'll create a couple of <strong>SVG</strong> files for the app images, one for the logo and one as an arrow button.</p>

<p>Create <strong><a href="https://gist.github.com/dabit3/28ab34ed85b1b1036d9b28c03fa6361b?short_path=0f62324">logo.svg</a></strong> and <strong><a href="https://gist.github.com/dabit3/06cefe57313c22082a2836065a9ec25e?short_path=6b7ad37">right-arrow.svg</a></strong> in the <strong>public</strong> folder and copy the linked SVG code into each of those files.</p>

<h2>
  <a name="the-smart-contract" href="#the-smart-contract">
  </a>
  The smart contract
</h2>

<p>Next, let's create the smart contract that will be powering our blog and CMS.</p>

<p>Create a new file in the <strong>contracts</strong> folder named <strong>Blog.sol</strong>.</p>

<p>Here, add the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight solidity"><code><span class="c1">// contracts/Blog.sol
//SPDX-License-Identifier: Unlicense
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"hardhat/console.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"@openzeppelin/contracts/utils/Counters.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Blog</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="k">public</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

    <span class="k">using</span> <span class="n">Counters</span> <span class="k">for</span> <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span><span class="p">;</span>
    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_postIds</span><span class="p">;</span>

    <span class="k">struct</span> <span class="n">Post</span> <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">id</span><span class="p">;</span>
      <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
      <span class="kt">string</span> <span class="n">content</span><span class="p">;</span>
      <span class="kt">bool</span> <span class="n">published</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* mappings can be seen as hash tables */</span>
    <span class="cm">/* here we create lookups for posts by id and posts by ipfs hash */</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=></span> <span class="n">Post</span><span class="p">)</span> <span class="k">private</span> <span class="n">idToPost</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">string</span> <span class="o">=></span> <span class="n">Post</span><span class="p">)</span> <span class="k">private</span> <span class="n">hashToPost</span><span class="p">;</span>

    <span class="cm">/* events facilitate communication between smart contractsand their user interfaces  */</span>
    <span class="cm">/* i.e. we can create listeners for events in the client and also use them in The Graph  */</span>
    <span class="k">event</span> <span class="n">PostCreated</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="n">hash</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">PostUpdated</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="n">hash</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">published</span><span class="p">);</span>

    <span class="cm">/* when the blog is deployed, give it a name */</span>
    <span class="cm">/* also set the creator as the owner of the contract */</span>
    <span class="k">constructor</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Deploying Blog with name:"</span><span class="p">,</span> <span class="n">_name</span><span class="p">);</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* updates the blog name */</span>
    <span class="k">function</span> <span class="n">updateName</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* transfers ownership of the contract to another address */</span>
    <span class="k">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* fetches an individual post by the content hash */</span>
    <span class="k">function</span> <span class="n">fetchPost</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="n">Post</span> <span class="k">memory</span><span class="p">){</span>
      <span class="k">return</span> <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="cm">/* creates a new post */</span>
    <span class="k">function</span> <span class="n">createPost</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">_postIds</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="n">postId</span> <span class="o">=</span> <span class="n">_postIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
        <span class="n">Post</span> <span class="k">storage</span> <span class="n">post</span> <span class="o">=</span> <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">];</span>
        <span class="n">post</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">postId</span><span class="p">;</span>
        <span class="n">post</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
        <span class="n">post</span><span class="p">.</span><span class="n">published</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">post</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>
        <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>
        <span class="k">emit</span> <span class="n">PostCreated</span><span class="p">(</span><span class="n">postId</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">hash</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* updates an existing post */</span>
    <span class="k">function</span> <span class="n">updatePost</span><span class="p">(</span><span class="kt">uint</span> <span class="n">postId</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">published</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">Post</span> <span class="k">storage</span> <span class="n">post</span> <span class="o">=</span>  <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">];</span>
        <span class="n">post</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
        <span class="n">post</span><span class="p">.</span><span class="n">published</span> <span class="o">=</span> <span class="n">published</span><span class="p">;</span>
        <span class="n">post</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>
        <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>
        <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>
        <span class="k">emit</span> <span class="n">PostUpdated</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">hash</span><span class="p">,</span> <span class="n">published</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* fetches all posts */</span>
    <span class="k">function</span> <span class="n">fetchPosts</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Post</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">_postIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>

        <span class="n">Post</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">itemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">Post</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToPost</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>
            <span class="n">posts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">posts</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* this modifier means only the contract owner can */</span>
    <span class="cm">/* invoke the function */</span>
    <span class="k">modifier</span> <span class="n">onlyOwner</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This contract allows the owner to create and edit posts, and for anyone to fetch posts.</p>

<blockquote>
<p>To make this smart contract permissionless, you could remove the <code>onlyOwner</code> modifier and use <a href="https://thegraph.com/en/">The Graph</a> to index and query posts by owner.</p>
</blockquote>

<p>Next, let's write a basic test to test out the most important functionality we'll be using.</p>

<p>To do so, open <strong>test/sample-test.js</strong> and update it with the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">chai</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">)</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should create a post</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="dl">"</span><span class="s2">My first post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My first post</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should edit a post</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="dl">"</span><span class="s2">My Second post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">)</span>

    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">updatePost</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">My updated post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">23456</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My updated post</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should add update the name</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>

    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">updateName</span><span class="p">(</span><span class="dl">'</span><span class="s1">My new blog</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My new blog</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, run the test by opening your terminal and running this command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat <span class="nb">test</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h2>
  <a name="deploying-the-contract" href="#deploying-the-contract">
  </a>
  Deploying the contract
</h2>

<p>Now that the contract has been written and tested, let's try to deploy it to a local test network.</p>

<p>To start the local network, open your terminal at least two separate windows. In one window, run the following script:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat node
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When we run this command, you should see a list of addresses and private keys.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JXW8vJow--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x4oxdb5n7cucibup6l2z.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JXW8vJow--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x4oxdb5n7cucibup6l2z.jpeg" alt="accounts" loading="lazy" width="880" height="530"></a></p>

<p>These are 20 test accounts and addresses created for us that we can use to deploy and test our smart contracts. Each account is also loaded up with 10,000 fake Ether. In a moment, we'll learn how to import the test account into MetaMask so that we can use it.</p>

<p>Next, we need to deploy the contract to the test network. First update the name of <strong>scripts/sample-script.js</strong> to <strong>scripts/deploy.js</strong>.</p>

<p>Next, update the file with this new deploy script:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* scripts/deploy.js */</span>
<span class="kd">const</span> <span class="nx">hre</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* these two lines deploy the contract to the network */</span>
  <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hre</span><span class="p">.</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog deployed to:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>

  <span class="cm">/* this code writes the contract addresses to a local */</span>
  <span class="cm">/* file named config.js that we can use in the app */</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">./config.js</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`
  export const contractAddress = "</span><span class="p">${</span><span class="nx">blog</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"
  export const ownerAddress = "</span><span class="p">${</span><span class="nx">blog</span><span class="p">.</span><span class="nx">signer</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"
  `</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=></span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>

</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now in a separate window (while the local network is still running) we can run the deploy script and give a flag to the CLI that we would like to deploy to our local network:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> localhost
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When the contract is deployed, you should see some output in your network terminal 🎉.</p>

<h3>
  <a name="importing-the-test-account-into-your-wallet" href="#importing-the-test-account-into-your-wallet">
  </a>
  Importing the test account into your wallet
</h3>

<p>To send transactions to the smart contract, we will need to connect our MetaMask wallet using one of the accounts created when we ran <code>npx hardhat node</code>. In the list of contracts that the CLI logs out, you should see both an <strong>Account number</strong> as well as a <strong>Private Key</strong>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>➜  react-dapp git:<span class="o">(</span>main<span class="o">)</span> npx hardhat node
Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/

Accounts
<span class="o">========</span>
Account <span class="c">#0: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 (10000 ETH)</span>
Private Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

...
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We can import this account into MetaMask in order to start using some of the fake Eth available there.</p>

<p>To do so, first open MetaMask and enable <strong>test networks</strong>:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--9eDrJ4Ml--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/06d5xd3h04th44q8plny.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--9eDrJ4Ml--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/06d5xd3h04th44q8plny.png" alt="Test Networks" loading="lazy" width="880" height="321"></a></p>

<p>Next, update the network to be Localhost 8545:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7n8kDt_o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo46g1vi1183hsixq1op.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7n8kDt_o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo46g1vi1183hsixq1op.png" alt="Choose network" loading="lazy" width="880" height="591"></a></p>

<p>Next, in MetaMask click on <strong>Import Account</strong> from the accounts menu:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--DbKbW31B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/96qsky18d9pb964u2udc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--DbKbW31B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/96qsky18d9pb964u2udc.png" alt="Import account" loading="lazy" width="880" height="596"></a></p>

<p>Copy then paste the very first <strong>Private Key</strong> logged out by the CLI and click <strong>Import</strong>. Once the account is imported, you should see the Eth in the account:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qLXLIKjf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/imccr6kdjhwwvvmbcw4f.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qLXLIKjf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/imccr6kdjhwwvvmbcw4f.jpg" alt="Imported account" loading="lazy" width="880" height="590"></a></p>

<blockquote>
<p><strong>Be sure you imported the first account in the list of accounts (Account #0) as this will be the account used by default when the contract is deployed and therefore the contract owner.</strong></p>
</blockquote>

<p>Now that we have a smart contract deployed and an account ready to use, we can start interacting with it from the Next.js app.</p>

<h2>
  <a name="the-nextjs-app" href="#the-nextjs-app">
  </a>
  The Next.js app
</h2>

<p>Next, let's write the code for the app.</p>

<p>The first thing we'll do is set up a couple of environment variables that we'll use to switch between a local testing environment, Mumbai testnet, and Polygon mainnet.</p>

<p>Create a new file named <strong>.env.local</strong> in the root of your project and add the following configuration to start with:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>ENVIRONMENT="local"
NEXT_PUBLIC_ENVIRONMENT="local"
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We will be able to switch these variables between <code>local</code>, <code>testnet</code>, and <code>mainnet</code> to switch between </p>

<p>This will allow us to reference our environment both on the client as well as the server. To learn more about how environment variables work in Next.js, check out the documentation <a href="https://nextjs.org/docs/basic-features/environment-variables">here</a>.</p>

<h3>
  <a name="contextjs" href="#contextjs">
  </a>
  context.js
</h3>

<p>Next, let's create the app <a href="https://reactjs.org/docs/context.html">context</a>. Context will give us an easy way to share state throughout the app.</p>

<p>Create a file named <strong>context.js</strong> and add the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">AccountContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="layout-and-nav" href="#layout-and-nav">
  </a>
  Layout and Nav
</h3>

<p>Next, let's open up <strong>pages/_app.js</strong>. Here we will update the code to include navigation, wallet connection, context, and some basic styling.</p>

<p>This page serves as a wrapper or layout for the rest of the app.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/__app.js */</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">../styles/globals.css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/link</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@emotion/css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">web3modal</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">WalletConnectProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@walletconnect/web3-provider</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../context.js</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ownerAddress</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">easymde/dist/easymde.min.css</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">MyApp</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">})</span> <span class="p">{</span>
  <span class="cm">/* create local state to save account information after signin */</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">account</span><span class="p">,</span> <span class="nx">setAccount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="cm">/* web3Modal configuration for enabling wallet access */</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">getWeb3Modal</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>
      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">providerOptions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">walletconnect</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">package</span><span class="p">:</span> <span class="nx">WalletConnectProvider</span><span class="p">,</span>
          <span class="na">options</span><span class="p">:</span> <span class="p">{</span> 
            <span class="na">infuraId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your-infura-id</span><span class="dl">"</span>
          <span class="p">},</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="nx">web3Modal</span>
  <span class="p">}</span>

  <span class="cm">/* the connect function uses web3 modal to connect to the user's wallet */</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getWeb3Modal</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">accounts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">listAccounts</span><span class="p">()</span>
      <span class="nx">setAccount</span><span class="p">(</span><span class="nx">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">nav</span><span class="p">}</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">header</span><span class="p">}</span><span class="o">></span>
          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span><span class="o">></span>
              <span class="o">&lt;</span><span class="nx">img</span>
                <span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">/logo.svg</span><span class="dl">'</span>
                <span class="nx">alt</span><span class="o">=</span><span class="dl">"</span><span class="s2">React Logo</span><span class="dl">"</span>
                <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">width</span><span class="p">:</span> <span class="dl">'</span><span class="s1">50px</span><span class="dl">'</span> <span class="p">}}</span>
              <span class="sr">/</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span><span class="o">></span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleContainer</span><span class="p">}</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">></span><span class="nx">Full</span> <span class="nx">Stack</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">description</span><span class="p">}</span><span class="o">></span><span class="nx">WEB3</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="p">{</span>
            <span class="o">!</span><span class="nx">account</span> <span class="o">&&</span> <span class="p">(</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonContainer</span><span class="p">}</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonStyle</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">connect</span><span class="p">}</span><span class="o">></span><span class="nx">Connect</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>            <span class="p">)</span>
          <span class="p">}</span>
          <span class="p">{</span>
            <span class="nx">account</span> <span class="o">&&</span> <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">accountInfo</span><span class="p">}</span><span class="o">></span><span class="p">{</span><span class="nx">account</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>          <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">linkContainer</span><span class="p">}</span><span class="o">></span>
          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">></span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">link</span><span class="p">}</span><span class="o">></span>
              <span class="nx">Home</span>
            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="p">{</span>
            <span class="cm">/* if the signed in user is the contract owner, we */</span>
            <span class="cm">/* show the nav link to create a new post */</span>
            <span class="p">(</span><span class="nx">account</span> <span class="o">===</span> <span class="nx">ownerAddress</span><span class="p">)</span> <span class="o">&&</span> <span class="p">(</span>
              <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/create-post</span><span class="dl">"</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">link</span><span class="p">}</span><span class="o">></span>
                  <span class="nx">Create</span> <span class="nx">Post</span>
                <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>            <span class="p">)</span>
          <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/nav</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">></span>
        <span class="o">&lt;</span><span class="nx">AccountContext</span><span class="p">.</span><span class="nx">Provider</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">account</span><span class="p">}</span><span class="o">></span>
          <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="nx">connect</span><span class="o">=</span><span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="sr">/</span><span class="err">>
</span>        <span class="o">&lt;</span><span class="sr">/AccountContext.Provider</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">accountInfo</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 100%;
  display: flex;
  flex: 1;
  justify-content: flex-end;
  font-size: 12px;
`</span>

<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  padding: 40px;
`</span>

<span class="kd">const</span> <span class="nx">linkContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  padding: 30px 60px;
  background-color: #fafafa;
`</span>

<span class="kd">const</span> <span class="nx">nav</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  background-color: white;
`</span>

<span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  display: flex;
  border-bottom: 1px solid rgba(0, 0, 0, .075);
  padding: 20px 30px;
`</span>

<span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin: 0;
  color: #999999;
`</span>

<span class="kd">const</span> <span class="nx">titleContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  display: flex;
  flex-direction: column;
  padding-left: 15px;
`</span>

<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-left: 30px;
  font-weight: 500;
  margin: 0;
`</span>

<span class="kd">const</span> <span class="nx">buttonContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 100%;
  display: flex;
  flex: 1;
  justify-content: flex-end;
`</span>

<span class="kd">const</span> <span class="nx">buttonStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  background-color: #fafafa;
  outline: none;
  border: none;
  font-size: 18px;
  padding: 16px 70px;
  border-radius: 15px;
  cursor: pointer;
  box-shadow: 7px 7px rgba(0, 0, 0, .1);
`</span>

<span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin: 0px 40px 0px 0px;
  font-size: 16px;
  font-weight: 400;
`</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">MyApp</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="entrypoint" href="#entrypoint">
  </a>
  Entrypoint
</h3>

<p>Now that we have the layout set up, let' create the entrypoint to the app.</p>

<p>This page will fetch the list of posts from the network and render the post titles in a listview. When the user clicks on a post, we will navigate them to another page for a detail view (page will be created next).<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@emotion/css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/link</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../context</span><span class="dl">'</span>

<span class="cm">/* import contract address and contract owner address */</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">ownerAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="cm">/* import Application Binary Interface (ABI) */</span>
<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* posts are fetched server side and passed in as props */</span>
  <span class="cm">/* see getServerSideProps */</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">posts</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AccountContext</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">navigate</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">/create-post</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">postList</span><span class="p">}</span><span class="o">></span>
        <span class="p">{</span>
          <span class="cm">/* map over the posts array and render a button with the post title */</span>
          <span class="nx">posts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">post</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=></span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/post/</span><span class="p">${</span><span class="nx">post</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="o">></span>
              <span class="o">&lt;</span><span class="nx">a</span><span class="o">></span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">linkStyle</span><span class="p">}</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">postTitle</span><span class="p">}</span><span class="o">></span><span class="p">{</span><span class="nx">post</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">arrowContainer</span><span class="p">}</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">img</span>
                      <span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">/right-arrow.svg</span><span class="dl">'</span>
                      <span class="nx">alt</span><span class="o">=</span><span class="dl">'</span><span class="s1">Right arrow</span><span class="dl">'</span>
                      <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">smallArrow</span><span class="p">}</span>
                    <span class="sr">/</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>              <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>          <span class="p">))</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">></span>
        <span class="p">{</span>
          <span class="p">(</span><span class="nx">account</span> <span class="o">===</span> <span class="nx">ownerAddress</span><span class="p">)</span> <span class="o">&&</span> <span class="nx">posts</span> <span class="o">&&</span> <span class="o">!</span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&&</span> <span class="p">(</span>
            <span class="cm">/* if the signed in user is the account owner, render a button */</span>
            <span class="cm">/* to create the first post */</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonStyle</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">navigate</span><span class="p">}</span><span class="o">></span>
              <span class="nx">Create</span> <span class="nx">your</span> <span class="nx">first</span> <span class="nx">post</span>
              <span class="o">&lt;</span><span class="nx">img</span>
                <span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">/right-arrow.svg</span><span class="dl">'</span>
                <span class="nx">alt</span><span class="o">=</span><span class="dl">'</span><span class="s1">Right arrow</span><span class="dl">'</span>
                <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">arrow</span><span class="p">}</span>
              <span class="sr">/</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>          <span class="p">)</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getServerSideProps</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* here we check to see the current environment variable */</span>
  <span class="cm">/* and render a provider based on the environment we're in */</span>
  <span class="kd">let</span> <span class="nx">provider</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">local</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">testnet</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">posts</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">arrowContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  display: flex;
  flex: 1;
  justify-content: flex-end;
  padding-right: 20px;
`</span>

<span class="kd">const</span> <span class="nx">postTitle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  font-size: 30px;
  font-weight: bold;
  cursor: pointer;
  margin: 0;
  padding: 20px;
`</span>

<span class="kd">const</span> <span class="nx">linkStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  border: 1px solid #ddd;
  margin-top: 20px;
  border-radius: 8px;
  display: flex;
`</span>

<span class="kd">const</span> <span class="nx">postList</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 700px;
  margin: 0 auto;
  padding-top: 50px;  
`</span>

<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  display: flex;
  justify-content: center;
`</span>

<span class="kd">const</span> <span class="nx">buttonStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 100px;
  background-color: #fafafa;
  outline: none;
  border: none;
  font-size: 44px;
  padding: 20px 70px;
  border-radius: 15px;
  cursor: pointer;
  box-shadow: 7px 7px rgba(0, 0, 0, .1);
`</span>

<span class="kd">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 35px;
  margin-left: 30px;
`</span>

<span class="kd">const</span> <span class="nx">smallArrow</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 25px;
`</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="creating-posts" href="#creating-posts">
  </a>
  Creating posts
</h3>

<p>Next, create a new file in the <strong>pages</strong> directory named <strong>create-post.js</strong>.</p>

<p>This will hold the route that will allow us to create posts and save them to the network.</p>

<p>We'll also have the option to upload and save a cover image to IPFS, with the hash of the ipfs upload anchored on chain with the rest of the most data.</p>

<p>Add the following code to this file:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/create-post.js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useRef</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span> <span class="c1">// new</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">dynamic</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/dynamic</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@emotion/css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ipfs-http-client</span><span class="dl">'</span>

<span class="cm">/* import contract address and contract owner address */</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">contractAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">'</span>

<span class="cm">/* define the ipfs endpoint */</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">'</span><span class="p">)</span>

<span class="cm">/* configure the markdown editor to be client-side import */</span>
<span class="kd">const</span> <span class="nx">SimpleMDE</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=></span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-simplemde-editor</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">''</span> <span class="p">}</span>

<span class="kd">function</span> <span class="nx">CreatePost</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* configure initial state to be used in the component */</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="nx">initialState</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">image</span><span class="p">,</span> <span class="nx">setImage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loaded</span><span class="p">,</span> <span class="nx">setLoaded</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">fileRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">content</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">post</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
      <span class="cm">/* delay rendering buttons until dynamic import is complete */</span>
      <span class="nx">setLoaded</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">500</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="kd">function</span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setPost</span><span class="p">(()</span> <span class="o">=></span> <span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">}))</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">createNewPost</span><span class="p">()</span> <span class="p">{</span>   
    <span class="cm">/* saves post to ipfs then anchors to smart contract */</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">title</span> <span class="o">||</span> <span class="o">!</span><span class="nx">content</span><span class="p">)</span> <span class="k">return</span>
    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">savePostToIpfs</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">savePost</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`/`</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePostToIpfs</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* save post metadata to ipfs */</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">post</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePost</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* anchor post to smart contract */</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">contract: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">contract</span><span class="p">)</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span>
        <span class="cm">/* optional - wait for transaction to be confirmed before rerouting */</span>
        <span class="cm">/* await provider.waitForTransaction(val.hash) */</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">val: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>    
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">triggerOnChange</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* trigger handleFileChange handler of hidden file input */</span>
    <span class="nx">fileRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">handleFileChange</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* upload cover image to ipfs and save hash to state */</span>
    <span class="kd">const</span> <span class="nx">uploadedFile</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uploadedFile</span><span class="p">)</span> <span class="k">return</span>
    <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">uploadedFile</span><span class="p">)</span>
    <span class="nx">setPost</span><span class="p">(</span><span class="nx">state</span> <span class="o">=></span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">coverImage</span><span class="p">:</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span> <span class="p">}))</span>
    <span class="nx">setImage</span><span class="p">(</span><span class="nx">uploadedFile</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">></span>
      <span class="p">{</span>
        <span class="nx">image</span> <span class="o">&&</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">image</span><span class="p">)}</span> <span class="sr">/</span><span class="err">>
</span>        <span class="p">)</span>
      <span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">input</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onChange</span><span class="p">}</span>
        <span class="nx">name</span><span class="o">=</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span>
        <span class="nx">placeholder</span><span class="o">=</span><span class="dl">'</span><span class="s1">Give it a title ...</span><span class="dl">'</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleStyle</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">>
</span>      <span class="o">&lt;</span><span class="nx">SimpleMDE</span>
        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">mdEditor</span><span class="p">}</span>
        <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">What's on your mind?</span><span class="dl">"</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span> <span class="o">=></span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="nx">value</span> <span class="p">})}</span>
      <span class="sr">/</span><span class="err">>
</span>      <span class="p">{</span>
        <span class="nx">loaded</span> <span class="o">&&</span> <span class="p">(</span>
          <span class="o">&lt;></span>
            <span class="o">&lt;</span><span class="nx">button</span>
              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span>
              <span class="nx">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span>
              <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">createNewPost</span><span class="p">}</span>
            <span class="o">></span><span class="nx">Publish</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="nx">button</span>
              <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">triggerOnChange</span><span class="p">}</span>
              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span>
            <span class="o">></span><span class="nx">Add</span> <span class="nx">cover</span> <span class="nx">image</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/</span><span class="err">>
</span>        <span class="p">)</span>
      <span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">input</span>
        <span class="nx">id</span><span class="o">=</span><span class="dl">'</span><span class="s1">selectImage</span><span class="dl">'</span>
        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">hiddenInput</span><span class="p">}</span> 
        <span class="nx">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">file</span><span class="dl">'</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileChange</span><span class="p">}</span>
        <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">fileRef</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">hiddenInput</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  display: none;
`</span>

<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  max-width: 800px;
`</span>

<span class="kd">const</span> <span class="nx">mdEditor</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 40px;
`</span>

<span class="kd">const</span> <span class="nx">titleStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 40px;
  border: none;
  outline: none;
  background-color: inherit;
  font-size: 44px;
  font-weight: 600;
  &::placeholder {
    color: #999999;
  }
`</span>

<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 800px;
  margin: 0 auto;
`</span>

<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  background-color: #fafafa;
  outline: none;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  margin-right: 10px;
  font-size: 18px;
  padding: 16px 70px;
  box-shadow: 7px 7px rgba(0, 0, 0, .1);
`</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">CreatePost</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="viewing-a-post" href="#viewing-a-post">
  </a>
  Viewing a post
</h3>

<p>Now that we have the ability to create posts, how do we navigate and view posts? We want to have the ability to view a post in a route that looks something like <code>myapp.com/post/some-post-id</code>.</p>

<p>We can do this in a couple of different ways with <a href="https://nextjs.org/docs/routing/dynamic-routes">next.js dynamic routes</a>.</p>

<p>We will be leveraging server-side data fetching using <a href="https://nextjs.org/docs/basic-features/data-fetching/get-static-paths">getStaticPaths</a> and <a href="https://nextjs.org/docs/basic-features/data-fetching/get-static-props">getStaticProps</a> which will create these pages at build time using the array of posts queried from the network.</p>

<p>To make this happen, create a new folder in the <strong>pages</strong> directory named <strong>post</strong> and a file in that folder named <strong>[id].js</strong>. There, add the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/post/[id].js */</span>
<span class="k">import</span> <span class="nx">ReactMarkdown</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-markdown</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/link</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@emotion/css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../context</span><span class="dl">'</span>

<span class="cm">/* import contract and owner addresses */</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">ownerAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../config</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">ipfsURI</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://ipfs.io/ipfs/</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Post</span><span class="p">({</span> <span class="nx">post</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AccountContext</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">isFallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
      <span class="p">{</span>
        <span class="nx">post</span> <span class="o">&&</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">></span>
            <span class="p">{</span>
              <span class="cm">/* if the owner is the user, render an edit button */</span>
              <span class="nx">ownerAddress</span> <span class="o">===</span> <span class="nx">account</span> <span class="o">&&</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">editPost</span><span class="p">}</span><span class="o">></span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/edit-post/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span><span class="o">></span>
                    <span class="o">&lt;</span><span class="nx">a</span><span class="o">></span>
                      <span class="nx">Edit</span> <span class="nx">post</span>
                    <span class="o">&lt;</span><span class="sr">/a</span><span class="err">>
</span>                  <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">>
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>              <span class="p">)</span>
            <span class="p">}</span>
            <span class="p">{</span>
              <span class="cm">/* if the post has a cover image, render it */</span>
              <span class="nx">post</span><span class="p">.</span><span class="nx">coverImage</span> <span class="o">&&</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">img</span>
                  <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span>
                  <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span>
                <span class="sr">/</span><span class="err">>
</span>              <span class="p">)</span>
            <span class="p">}</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">></span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">contentContainer</span><span class="p">}</span><span class="o">></span>
              <span class="o">&lt;</span><span class="nx">ReactMarkdown</span><span class="o">></span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/ReactMarkdown</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>        <span class="p">)</span>
      <span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getStaticPaths</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* here we fetch the posts from the network */</span>
  <span class="kd">let</span> <span class="nx">provider</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">local</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">testnet</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>

  <span class="cm">/* then we map over the posts and create a params object passing */</span>
  <span class="cm">/* the id property to getStaticProps which will run for ever post */</span>
  <span class="cm">/* in the array and generate a new page */</span>
  <span class="kd">const</span> <span class="nx">paths</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="o">=></span> <span class="p">({</span> <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span> <span class="p">}))</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">paths</span><span class="p">,</span>
    <span class="na">fallback</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getStaticProps</span><span class="p">({</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">{</span>
  <span class="cm">/* using the id property passed in through the params object */</span>
  <span class="cm">/* we can us it to fetch the data from IPFS and pass the */</span>
  <span class="cm">/* post data into the page as props */</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">params</span>
  <span class="kd">const</span> <span class="nx">ipfsUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">ipfsUrl</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">coverImage</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span><span class="s2">`</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span> <span class="o">=</span> <span class="nx">coverImage</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">post</span><span class="p">:</span> <span class="nx">data</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">editPost</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin: 20px 0px;
`</span>

<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 900px;
`</span>

<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 900px;
  margin: 0 auto;
`</span>

<span class="kd">const</span> <span class="nx">contentContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 60px;
  padding: 0px 40px;
  border-left: 1px solid #e7e7e7;
  border-right: 1px solid #e7e7e7;
  & img {
    max-width: 900px;
  }
`</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="editing-a-post" href="#editing-a-post">
  </a>
  Editing a post
</h3>

<p>The final page we need to create is a way to edit existing posts.</p>

<p>This page will carry over some functionality from both <strong>pages/create-post.js</strong> as well as <strong>pages/post/[id].js</strong>. We will be able to toggle between viewing and editing a post.</p>

<p>Create a new folder in the <strong>pages</strong> directory named <strong>edit-post</strong> and a file named <strong>[id].js</strong> there. Next, add the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="cm">/* pages/edit-post/[id].js */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">ReactMarkdown</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-markdown</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@emotion/css</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">dynamic</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/dynamic</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ethers</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ipfs-http-client</span><span class="dl">'</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">contractAddress</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../config</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">ipfsURI</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://ipfs.io/ipfs/</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">SimpleMDE</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=></span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-simplemde-editor</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>
<span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Post</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">editing</span><span class="p">,</span> <span class="nx">setEditing</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=></span> <span class="p">{</span>
    <span class="nx">fetchPost</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">id</span><span class="p">])</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchPost</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* we first fetch the individual post by ipfs hash from the network */</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span>
    <span class="kd">let</span> <span class="nx">provider</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">local</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">testnet</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPost</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">postId</span> <span class="o">=</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toNumber</span><span class="p">()</span>

    <span class="cm">/* next we fetch the IPFS metadata from the network */</span>
    <span class="kd">const</span> <span class="nx">ipfsUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">ipfsUrl</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">coverImagePath</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span><span class="s2">`</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">coverImagePath</span> <span class="o">=</span> <span class="nx">coverImagePath</span>
    <span class="p">}</span>
    <span class="cm">/* finally we append the post ID to the post data */</span>
    <span class="cm">/* we need this ID to make updates to the post */</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">postId</span><span class="p">;</span>
    <span class="nx">setPost</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePostToIpfs</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">post</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">updatePost</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">savePostToIpfs</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">updatePost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">hash</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">post</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">></span>
      <span class="p">{</span>
      <span class="cm">/* editing state will allow the user to toggle between */</span>
      <span class="cm">/*  a markdown editor and a markdown renderer */</span>
      <span class="p">}</span>
      <span class="p">{</span>
        <span class="nx">editing</span> <span class="o">&&</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
            <span class="o">&lt;</span><span class="nx">input</span>
              <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=></span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
              <span class="nx">name</span><span class="o">=</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span>
              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">'</span><span class="s1">Give it a title ...</span><span class="dl">'</span>
              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleStyle</span><span class="p">}</span>
            <span class="sr">/</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="nx">SimpleMDE</span>
              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">mdEditor</span><span class="p">}</span>
              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">What's on your mind?</span><span class="dl">"</span>
              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
              <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span> <span class="o">=></span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="nx">value</span> <span class="p">})}</span>
            <span class="sr">/</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">updatePost</span><span class="p">}</span><span class="o">></span><span class="nx">Update</span> <span class="nx">post</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>        <span class="p">)</span>
      <span class="p">}</span>
      <span class="p">{</span>
        <span class="o">!</span><span class="nx">editing</span> <span class="o">&&</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">div</span><span class="o">></span>
            <span class="p">{</span>
              <span class="nx">post</span><span class="p">.</span><span class="nx">coverImagePath</span> <span class="o">&&</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">img</span>
                  <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">coverImagePath</span><span class="p">}</span>
                  <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span>
                <span class="sr">/</span><span class="err">>
</span>              <span class="p">)</span>
            <span class="p">}</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">></span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">contentContainer</span><span class="p">}</span><span class="o">></span>
              <span class="o">&lt;</span><span class="nx">ReactMarkdown</span><span class="o">></span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/ReactMarkdown</span><span class="err">>
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>        <span class="p">)</span>
      <span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=></span> <span class="nx">setEditing</span><span class="p">(</span><span class="nx">editing</span> <span class="p">?</span> <span class="kc">false</span> <span class="p">:</span> <span class="kc">true</span><span class="p">)}</span><span class="o">></span><span class="p">{</span> <span class="nx">editing</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">View post</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Edit post</span><span class="dl">'</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">>
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">>
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  background-color: #fafafa;
  outline: none;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  margin-right: 10px;
  margin-top: 15px;
  font-size: 18px;
  padding: 16px 70px;
  box-shadow: 7px 7px rgba(0, 0, 0, .1);
`</span>

<span class="kd">const</span> <span class="nx">titleStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 40px;
  border: none;
  outline: none;
  background-color: inherit;
  font-size: 44px;
  font-weight: 600;
  &::placeholder {
    color: #999999;
  }
`</span>

<span class="kd">const</span> <span class="nx">mdEditor</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 40px;
`</span>

<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 900px;
`</span>

<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  width: 900px;
  margin: 0 auto;
`</span>

<span class="kd">const</span> <span class="nx">contentContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`
  margin-top: 60px;
  padding: 0px 40px;
  border-left: 1px solid #e7e7e7;
  border-right: 1px solid #e7e7e7;
  & img {
    max-width: 900px;
  }
`</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="testing-it-out" href="#testing-it-out">
  </a>
  Testing it out
</h3>

<p>We can now test it out.</p>

<p>To do so, be sure you have already deployed the contract to the network in the previous steps and you still have the local network running.</p>

<p>Open a new terminal window and start the Next.js app:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm run dev
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When the app starts, you should be able to connect your wallet and interact with the app.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--mdLlMvJ0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uaiouakr4b062x53lecp.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--mdLlMvJ0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uaiouakr4b062x53lecp.jpg" alt="Homepage" loading="lazy" width="880" height="472"></a></p>

<p>You should also be able to create a new post.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5iXvlqxL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c41ztmvvzgvlbjb9r0ib.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5iXvlqxL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c41ztmvvzgvlbjb9r0ib.jpg" alt="Create a post" loading="lazy" width="880" height="585"></a></p>

<p>You may notice that the app is not as fast as it could be, but Next.js is blazingly fast in production. </p>

<p>To run a production build, run the following commands:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm run build <span class="o">&&</span> npm start
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h2>
  <a name="deploying-to-polygon" href="#deploying-to-polygon">
  </a>
  Deploying to Polygon
</h2>

<p>Now that we have the project up and running and tested locally, let's deploy to Polygon. We'll start by deploying to <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai</a>, the Polygon test network.</p>

<p>The first thing we will need to do is set one of our <strong>private keys</strong> from our wallet as an environment variable.</p>

<p>To get a private key, you can export them directly from MetaMask.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" alt="Private keys" loading="lazy" width="880" height="532"></a></p>

<blockquote>
<p>Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.</p>
</blockquote>

<p>If you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">pk</span><span class="o">=</span><span class="s2">"your-private-key"</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="configuring-the-network" href="#configuring-the-network">
  </a>
  Configuring the network
</h3>

<p>Next, we need to switch from the local test network to the <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai Testnet</a>.</p>

<p>To do so, we need to create and set the network configuration.</p>

<p>First, open MetaMask and click on <strong>Settings</strong>.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" alt="MetaMask settings" loading="lazy" width="477" height="643"></a></p>

<p>Next, click on <strong>Networks</strong> and then <strong>Add Network</strong>:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" alt="New Network" loading="lazy" width="880" height="558"></a></p>

<p>Here, we will add the following configurations for the Mumbai test network as listed <a href="https://docs.polygon.technology/docs/develop/network-details/network/">here</a>:</p>

<p>Network Name: <strong>Mumbai TestNet</strong><br>
New RPC URL: <strong><a href="https://rpc-mumbai.matic.today">https://rpc-mumbai.matic.today</a></strong><br>
Chain ID: <strong>80001</strong><br>
Currency Symbol: <strong>Matic</strong></p>

<p>Save this, then you should be able to switch to and use the new network!</p>

<p>Finally, you will need some testnet Polygon tokens in order to interact with the applications.</p>

<p>To get these, you can visit the <a href="https://faucet.polygon.technology/">Polygon Faucet</a>, inputting the address of the wallets that you would like to request the tokens.</p>
<h3>
  <a name="deploying-to-the-polygon-network" href="#deploying-to-the-polygon-network">
  </a>
  Deploying to the Polygon network
</h3>

<p>Now that you have some tokens, you can deploy to the Polygon network!</p>

<p>To do so, be sure that the address associated with the private key you are deploying your contract with has received some tokens in order to pay the gas fees for the transaction.</p>

<p>Next, uncomment the <code>mumbai</code> configuration in hardhat.config.js:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">mumbai</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mumbai.matic.today</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">pk</span><span class="p">]</span>
<span class="p">},</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>To deploy to Polygon testnet, run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> mumbai
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<blockquote>
<p>If you run into this error: <code>ProviderError: RPCError</code>, the public RPC may be congested. In production, it's recommended to use an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, or <a href="https://www.quicknode.com/">Quicknode</a>.</p>
</blockquote>

<p>Next, update the environment variables in <strong>.env.local</strong> to be <code>testnet</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>ENVIRONMENT="testnet"
NEXT_PUBLIC_ENVIRONMENT="testnet"
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, restart the server to register the change in environment variables:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm run dev
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You should now be able to test the app on the new network 🎉!</p>

<p>If you have any issues connecting to the public Mumbai RPC endpoint, consider replacing the endpoints in your app using endpoints from an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, or <a href="https://www.quicknode.com/">Quicknode</a>.</p>

<h2>
  <a name="creating-a-subgraph-api" href="#creating-a-subgraph-api">
  </a>
  Creating a subgraph API
</h2>

<p>By default the only data access patterns we have are the two functions we've written into the contract, <code>fetchPost</code> and <code>fetchPosts</code>.</p>

<p>This is a fine place to start, but as your app starts to scale you'll probably find yourself needing a more flexible and scalable API.</p>

<p>For instance, what if we wanted to give the user the ability to search posts, fetch posts created by a certain user, or to sort posts by the date which they were created?</p>

<p>We can build all of this functionality into an API by using <a href="https://thegraph.com/en/">The Graph</a> protocol. Let's see how to do this.</p>

<h3>
  <a name="creating-the-project-in-the-graph" href="#creating-the-project-in-the-graph">
  </a>
  Creating the project in The Graph
</h3>

<p>To get started, visit <a href="https://thegraph.com/explorer/dashboard">The Graph hosted service</a> and either sign in or create a new account.</p>

<p>Next, go to the <a href="https://thegraph.com/explorer/dashboard">dashboard</a> and click on <strong>Add Subgraph</strong> to create a new subgraph.</p>

<p>Configure your subgraph with the following properties:</p>

<ul>
<li>Subgraph Name - <strong>Blogcms</strong>
</li>
<li>Subtitle - <strong>A subgraph for querying post data</strong>
</li>
<li>Optional - Fill the description and GITHUB URL properties</li>
</ul>

<p>Once the subgraph is created, we will initialize the subgraph locally using the Graph CLI.</p>

<h3>
  <a name="initializing-a-new-subgraph-using-the-graph-cli" href="#initializing-a-new-subgraph-using-the-graph-cli">
  </a>
  Initializing a new subgraph using the Graph CLI
</h3>

<p>Next, install the Graph CLI:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> @graphprotocol/graph-cli

<span class="c"># or</span>

<span class="nv">$ </span>yarn global add @graphprotocol/graph-cli
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Once the Graph CLI has been installed you can initialize a new subgraph with the Graph CLI <code>init</code> command.</p>

<p>Since we've already deployed our contract to the network, we can initialize from that contract address by passing in the contract address using the <code>--from-contract</code> flag.</p>

<p>This address is available for reference in <strong>config.js</strong> as <code>contractAddress</code>.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nv">$ </span>graph init <span class="nt">--from-contract</span> your-contract-address <span class="se">\</span>
<span class="nt">--network</span> mumbai <span class="nt">--contract-name</span> Blog <span class="nt">--index-events</span>

? Protocol: ethereum
? Product <span class="k">for </span>which to initialize › hosted-service
? Subgraph name › your-username/blogcms
? Directory to create the subgraph <span class="k">in</span> › blogcms
? Ethereum network › mumbai
? Contract address › your-contract-address
? ABI file <span class="o">(</span>path<span class="o">)</span> › artifacts/contracts/Blog.sol/Blog.json
? Contract Name › Blog
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This command will generate a basic subgraph based off of the contract address passed in as the argument to <code>--from-contract</code>. By using this contract address, the CLI will initialize a few things in your project to get you started (including fetching the <code>abis</code> and saving them in the <strong>abis</strong> directory).</p>

<blockquote>
<p>By passing in <code>--index-events</code> the CLI will automatically populate some code for us both in <strong>schema.graphql</strong> as well as <strong>src/mapping.ts</strong> based on the events emitted from the contract.</p>
</blockquote>

<p>The main configuration and definition for the subgraph lives in the <strong>subgraph.yaml</strong> file. The subgraph codebase consists of a few files:</p>

<ul>
<li>
<strong>subgraph.yaml</strong>: a YAML file containing the subgraph manifest</li>
<li>
<strong>schema.graphql</strong>: a GraphQL schema that defines what data is stored for your subgraph, and how to query it via GraphQL</li>
<li>
<strong>AssemblyScript Mappings</strong>: AssemblyScript code that translates from the event data in Ethereum to the entities defined in your schema (e.g. mapping.ts in this tutorial)</li>
</ul>

<p>The entries in <strong>subgraph.yaml</strong> that we will be working with are:</p>

<ul>
<li>
<code>description</code> (optional): a human-readable description of what the subgraph is. This description is displayed by the Graph Explorer when the subgraph is deployed to the Hosted Service.</li>
<li>
<code>repository</code> (optional): the URL of the repository where the subgraph manifest can be found. This is also displayed by the Graph Explorer.</li>
<li>
<code>dataSources.source</code>: the address of the smart contract the subgraph sources, and the abi of the smart contract to use. The address is optional; omitting it allows to index matching events from all contracts.</li>
<li>
<code>dataSources.source.startBlock</code> (optional): the number of the block that the data source starts indexing from. In most cases we suggest using the block in which the contract was created.</li>
<li>
<code>dataSources.mapping.entities</code> : the entities that the data source writes to the store. The schema for each entity is defined in the the schema.graphql file.</li>
<li>
<code>dataSources.mapping.abis</code>: one or more named ABI files for the source contract as well as any other smart contracts that you interact with from within the mappings.</li>
<li>
<code>dataSources.mapping.eventHandlers</code>: lists the smart contract events this subgraph reacts to and the handlers in the mapping — <strong>./src/mapping.ts</strong> in the example — that transform these events into entities in the store.</li>
</ul>

<h3>
  <a name="defining-the-entities" href="#defining-the-entities">
  </a>
  Defining the entities
</h3>

<p>With The Graph, you define entity types in <strong>schema.graphql</strong>, and Graph Node will generate top level fields for querying single instances and collections of that entity type. Each type that should be an entity is required to be annotated with an <code>@entity</code> directive.</p>

<p>The entities / data we will be indexing are the <code>Token</code> and <code>User</code>. This way we can index the Tokens created by the users as well as the users themselves.</p>

<p>To do this, update <strong>schema.graphql</strong> with the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight graphql"><code><span class="k">type</span><span class="w"> </span><span class="n">_Schema_</span><span class="w">
  </span><span class="err">@</span><span class="n">fulltext</span><span class="p">(</span><span class="w">
    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="err">"</span><span class="n">postSearch</span><span class="err">"</span><span class="w">
    </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="n">en</span><span class="w">
    </span><span class="n">algorithm</span><span class="p">:</span><span class="w"> </span><span class="n">rank</span><span class="w">
    </span><span class="n">include</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">{</span><span class="w"> </span><span class="n">entity</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">Post</span><span class="err">"</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="err">:</span><span class="w"> </span><span class="err">[{</span><span class="w"> </span><span class="n">name</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">title</span><span class="err">"</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">name</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">postContent</span><span class="err">"</span><span class="w"> </span><span class="err">}</span><span class="p">]</span><span class="w"> </span><span class="err">}]</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">type</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="err">@</span><span class="n">entity</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!</span><span class="w">
  </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">contentHash</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">published</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">!</span><span class="w">
  </span><span class="n">postContent</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">createdAtTimestamp</span><span class="p">:</span><span class="w"> </span><span class="n">BigInt</span><span class="p">!</span><span class="w">
  </span><span class="n">updatedAtTimestamp</span><span class="p">:</span><span class="w"> </span><span class="n">BigInt</span><span class="p">!</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now that we have created the GraphQL schema for our app, we can generate the entities locally to start using in the <code>mappings</code> created by the CLI:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>graph codegen
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In order to make working smart contracts, events and entities easy and type-safe, the Graph CLI generates AssemblyScript types from a combination of the subgraph's GraphQL schema and the contract ABIs included in the data sources.</p>

<h2>
  <a name="updating-the-subgraph-with-the-entities-and-mappings" href="#updating-the-subgraph-with-the-entities-and-mappings">
  </a>
  Updating the subgraph with the entities and mappings
</h2>

<p>Now we can configure the <strong>subgraph.yaml</strong> to use the entities that we have just created and configure their mappings.</p>

<p>To do so, first update the <code>dataSources.mapping.entities</code> field with the <code>User</code> and <code>Token</code> entities:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">entities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Post</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next we'll need to find the block which the contract was deployed (optional). We need this so that we can set the start block for the indexer to begin syncing so that it does not need to sync from the genesis block. You can find the start block by visiting <a href="https://mumbai.polygonscan.com/">https://mumbai.polygonscan.com/</a> and pasting in your contract address.</p>

<p>Finally, update the configuration to add the <code>startBlock</code> :<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">source</span><span class="pi">:</span>
  <span class="na">address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">your-contract-adddress"</span>
  <span class="na">abi</span><span class="pi">:</span> <span class="s">Blog</span>
  <span class="na">startBlock</span><span class="pi">:</span> <span class="s">your-start-block</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h2>
  <a name="assemblyscript-mappings" href="#assemblyscript-mappings">
  </a>
  Assemblyscript mappings
</h2>

<p>Next, open <strong>src/mappings.ts</strong> to write the mappings that we defined in our subgraph subgraph <code>eventHandlers</code>.</p>

<p>Update the file with the following code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span>
  <span class="nx">PostCreated</span> <span class="k">as</span> <span class="nx">PostCreatedEvent</span><span class="p">,</span>
  <span class="nx">PostUpdated</span> <span class="k">as</span> <span class="nx">PostUpdatedEvent</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../generated/Blog/Blog</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">Post</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../generated/schema</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ipfs</span><span class="p">,</span> <span class="nx">json</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@graphprotocol/graph-ts</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">handlePostCreated</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">PostCreatedEvent</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">contentHash</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ipfs</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">toObject</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">post</span><span class="p">.</span><span class="nx">postContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">createdAtTimestamp</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">handlePostUpdated</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">PostUpdatedEvent</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">contentHash</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">published</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">published</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ipfs</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">toObject</span><span class="p">()</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">post</span><span class="p">.</span><span class="nx">postContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">updatedAtTimestamp</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>These mappings will handle events for when a new post is created and when a post is updated. When these events fire, the mappings will save the data into the subgraph.</p>

<h3>
  <a name="running-a-build" href="#running-a-build">
  </a>
  Running a build
</h3>

<p>Next, let's run a build to make sure that everything is configured properly. To do so, run the <code>build</code> command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nv">$ </span>graph build
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>If the build is successful, you should see a new <strong>build</strong> folder generated in your root directory.</p>

<h2>
  <a name="deploying-the-subgraph" href="#deploying-the-subgraph">
  </a>
  Deploying the subgraph
</h2>

<p>To deploy, we can run the <code>deploy</code> command. To deploy, you will first need to copy the <strong>Access token</strong> for your account, available in the <a href="https://thegraph.com/hosted-service/dashboard">Graph Dashboard</a>:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--v7zoQMgq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/820lwqh8yo3iyu7fsbhj.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--v7zoQMgq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/820lwqh8yo3iyu7fsbhj.jpg" alt="Graph Dashboard" loading="lazy" width="880" height="246"></a></p>

<p>Next, run the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nv">$ </span>graph auth
✔ Product <span class="k">for </span>which to initialize · hosted-service
✔ Deploy key · <span class="k">********************************</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The deploy the subgraph:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code><span class="nv">$ </span>yarn deploy
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Once the subgraph is deployed, you should see it show up in your dashboard.</p>

<p>When you click on the subgraph, it should open the subgraph details:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Jhj9vm7o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8kxjleaatn2fvgug8tsx.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Jhj9vm7o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8kxjleaatn2fvgug8tsx.png" alt="Blogcms details" loading="lazy" width="880" height="660"></a></p>

<h2>
  <a name="querying-for-data" href="#querying-for-data">
  </a>
  Querying for data
</h2>

<p>Now that we are in the dashboard, we should be able to start querying for data. Run the following query to get a list of posts:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight graphql"><code><span class="p">{</span><span class="w">
  </span><span class="n">posts</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">title</span><span class="w">
    </span><span class="n">contentHash</span><span class="w">
    </span><span class="n">published</span><span class="w">
    </span><span class="n">postContent</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We can also configure the order direction by creation date:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight graphql"><code><span class="p">{</span><span class="w">
  </span><span class="n">posts</span><span class="p">(</span><span class="w">
    </span><span class="n">orderBy</span><span class="p">:</span><span class="w"> </span><span class="n">createdAtTimestamp</span><span class="w">
    </span><span class="n">orderDirection</span><span class="p">:</span><span class="w"> </span><span class="n">desc</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">title</span><span class="w">
    </span><span class="n">contentHash</span><span class="w">
    </span><span class="n">published</span><span class="w">
    </span><span class="n">postContent</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We can also do full text search on the post title or content:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight graphql"><code><span class="p">{</span><span class="w">
  </span><span class="n">postSearch</span><span class="p">(</span><span class="w">
    </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">title</span><span class="w">
    </span><span class="n">contentHash</span><span class="w">
    </span><span class="n">published</span><span class="w">
    </span><span class="n">postContent</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Congratulations, you have now build out a more flexible API that you can use to query your app!</p>

<p>To learn how to use the API endpoint in your app, check out the documentation <a href="https://thegraph.com/docs/en/developer/querying-from-your-app/">here</a> or the video <a href="https://www.youtube.com/watch?v=PjyKPMpahuc">here</a></p>

<h2>
  <a name="next-steps" href="#next-steps">
  </a>
  Next steps
</h2>

<p>If you'd like a challenge, consider adding some functionality that will allow you to update the cover image in <strong>pages/edit-post/[id].js</strong>.</p>

<p>If you'd like to deploy your code to a web3 / decentralized git hosting protocol, check out <a href="https://www.youtube.com/watch?v=MhoRiH2podI">this</a> video on <a href="https://radicle.xyz/">Radicle</a>.</p>

<p>If you'd like to deploy your app and make it live, check out <a href="https://vercel.com/new">Vercel</a>.</p>

<p>If you enjoyed this tutorial, be sure to check out my other three comprehensive guides:</p>

<ol>
<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a></li>
<li><a href="https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb">Building a Full Stack NFT Marketplace on Ethereum with Polygon
</a></li>
<li>The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom
<a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291">https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291</a>
</li>
</ol>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-web3-development-4g74" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,n,a,p,t,e){return a.type_of="article",a.id=982888,a.title="The Complete Guide to Full Stack Web3 Development",a.description="Building a full stack web3 app with Next.js, Polygon, Solidity, The Graph, IPFS, and Hardhat",a.readable_publish_date="Feb 10",a.slug="the-complete-guide-to-full-stack-web3-development-4g74",a.path="/edge-and-node/the-complete-guide-to-full-stack-web3-development-4g74",a.url=p,a.comments_count=67,a.public_reactions_count=4741,a.collection_id=s,a.published_timestamp=t,a.positive_reactions_count=4741,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--3wa8vtB8--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/maq07rzwhayt5qvwarw6.jpg",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--HUwcqrpJ--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/maq07rzwhayt5qvwarw6.jpg",a.canonical_url=p,a.created_at="2022-02-08T17:30:55Z",a.edited_at="2022-04-09T12:48:47Z",a.crossposted_at=s,a.published_at=t,a.last_comment_at="2022-06-13T08:53:39Z",a.reading_time_minutes=28,a.tag_list="web3, blockchain, solidity, webdev",a.tags=["web3","blockchain","solidity","webdev"],a.body_html='<h2>\n  <a name="building-a-full-stack-web3-app-with-nextjs-polygon-solidity-the-graph-ipfs-and-hardhat" href="#building-a-full-stack-web3-app-with-nextjs-polygon-solidity-the-graph-ipfs-and-hardhat">\n  </a>\n  Building a full stack web3 app with Next.js, Polygon, Solidity, The Graph, IPFS, and Hardhat\n</h2>\n\n<blockquote>\n<p>The video for this tutorial is also available <a href="https://www.youtube.com/watch?v=nRMo5jjgCr4">here</a></p>\n</blockquote>\n\n<p>In this in depth tutorial you\'ll learn the tools, protocols, and frameworks for building full stack web3 apps, and most importantly - how to put everything together to lay the groundwork for building out any of your own ideas in the future.</p>\n\n<blockquote>\n<p>The codebase for this app is located <a href="https://github.com/dabit3/full-stack-web3">here</a></p>\n</blockquote>\n\n<p>The main network we\'ll be deploying to is <a href="https://polygon.technology/">Polygon</a>. I chose Polygon because of its low transaction cost, fast block times, and current network adoption.</p>\n\n<p>That being said, we\'re going to be building on the <a href="https://ethereum.org/en/developers/docs/evm/">Ethereum Virtual Machine</a> (EVM), so you can apply these skills to build for dozens of other blockchain networks as well, including Ethereum, Celo, Avalanche, and many others.</p>\n\n<p>The app we\'ll be building is a full stack blog as well as a content management system (CMS), meaning that you will have an open, public, and composable back end that can be transferred and reused anywhere.</p>\n\n<p>By the end of this tutorial you should have a good understanding of the most important pieces of a modern web3 stack and how to build performant, scalable, full stack decentralized blockchain applications.</p>\n\n<p><strong>This is the fourth guide in my "Full Stack" web3 series. Also be sure to check out:</strong></p>\n\n<ol>\n<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a></li>\n<li><a href="https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb">Building a Full Stack NFT Marketplace on Ethereum with Polygon\n</a></li>\n<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291">The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom</a></li>\n</ol>\n\n<h3>\n  <a name="the-web3-stack" href="#the-web3-stack">\n  </a>\n  The web3 stack\n</h3>\n\n<p><a href="https://edgeandnode.com/images/web3-stack.jpg"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--UQYhll4y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://edgeandnode.com/images/web3-stack.jpg" alt="The web3 stack" loading="lazy" width="880" height="495"></a></p>\n\n<p>In <a href="https://edgeandnode.com/blog/defining-the-web3-stack">Defining the web3 stack</a> I wrote about my interpretation of the current state of the web3 tech stack from a developer\'s perspective using a combination of my own personal experience as well as research that was done over the past year on my team at <a href="https://edgeandnode.com/">Edge &amp; Node</a>.</p>\n\n<p>We will be using pieces of this stack for this application:</p>\n\n<ol>\n<li>Blockchain - <a href="https://polygon.technology/">Polygon</a> (with optional RPC provider)</li>\n<li>Ethereum development environment - <a href="https://hardhat.org/">Hardhat</a>\n</li>\n<li>Front end framework - <a href="https://nextjs.org/">Next.js</a> &amp; <a href="https://reactjs.org/">React</a>\n</li>\n<li>Ethereum web client library - <a href="https://docs.ethers.io/v5/">Ethers.js</a>\n</li>\n<li>File storage - <a href="https://ipfs.io/">IPFS</a>\n</li>\n<li>Indexing and querying - <a href="https://thegraph.com/en/">The Graph Protocol</a>\n</li>\n</ol>\n\n<p>Learning how to use these building blocks we can build out many types of applications, so the goal with this tutorial is to show how they each work and how they all fit together.</p>\n\n<p>Let\'s get started!</p>\n\n<h3>\n  <a name="prerequisites" href="#prerequisites">\n  </a>\n  Prerequisites\n</h3>\n\n<ul>\n<li>Node.js installed on your local machine</li>\n<li>MetaMask Chrome extension installed in your browser</li>\n</ul>\n\n<h2>\n  <a name="project-setup" href="#project-setup">\n  </a>\n  Project setup\n</h2>\n\n<p>Here we will create the application boilerplates, install all of the necessary dependencies, and configure the project.</p>\n\n<p>The code will be commented to give you insight as to what is happening, and I\'ll describe some of what is going on throughout the tutorial as well.</p>\n\n<p>To get started, create a new <strong>Next.js</strong> application and change into the new directory:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>npx create-next-app web3-blog\n\ncd web3-blog\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, change into the new directory and install the following dependencies using either <strong>npm</strong>, <strong>yarn</strong>, or <strong>pnpm</strong>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm <span class="nb">install </span>ethers hardhat @nomiclabs/hardhat-waffle <span class="se">\\</span>\nethereum-waffle chai @nomiclabs/hardhat-ethers <span class="se">\\</span>\nweb3modal @walletconnect/web3-provider <span class="se">\\</span>\neasymde react-markdown react-simplemde-editor <span class="se">\\</span>\nipfs-http-client @emotion/css @openzeppelin/contracts\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>An overview of some of these dependencies:</p>\n\n<p><a href="https://hardhat.org/">hardhat</a> - Ethereum development environment<br>\n<a href="https://github.com/Web3Modal/web3modal">web3modal</a> - An easy-to-use library that allows users to connect their wallets to your app<br>\n<a href="https://github.com/remarkjs/react-markdown">react-markdown</a> and <a href="https://github.com/sparksuite/simplemde-markdown-editor">simplemde</a> - Markdown editor and markdown renderer for the CMS<br>\n<a href="https://emotion.sh/docs/introduction">@emotion/css</a> - A great CSS in JS library<br>\n<a href="https://github.com/OpenZeppelin/openzeppelin-contracts">@openzeppelin/contracts</a> - Open source implementations of useful smart contract standards and functionality</p>\n\n<p>Next, we\'ll initialize the local smart contract development environment.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat\n\n? What <span class="k">do </span>you want to <span class="k">do</span>? Create a basic sample project\n? Hardhat project root: &lt;Choose default path&gt;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>If you get an error referencing your <strong>README.md</strong>, delete <strong>README.md</strong> and run <code>npx hardhat</code> again.</p>\n</blockquote>\n\n<p>This should scaffold out the basic Solidity development environment that we will use. You should see a few new files and folders created, including <strong>contracts</strong>, <strong>scripts</strong>, <strong>test</strong>, and <strong>hardhat.config.js</strong>.</p>\n\n<p>Next, let\'s update the hardhat configuration at <strong>hardhat.config.js</strong>.</p>\n\n<p>Update this file with the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@nomiclabs/hardhat-waffle</span><span class="dl">"</span><span class="p">);</span>\n\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">solidity</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.8.4</span><span class="dl">"</span><span class="p">,</span>\n  <span class="na">networks</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">hardhat</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">chainId</span><span class="p">:</span> <span class="mi">1337</span>\n    <span class="p">},</span>\n    <span class="c1">// mumbai: {</span>\n    <span class="c1">//   url: "https://rpc-mumbai.matic.today",</span>\n    <span class="c1">//   accounts: [process.env.pk]</span>\n    <span class="c1">// },</span>\n    <span class="c1">// polygon: {</span>\n    <span class="c1">//   url: "https://polygon-rpc.com/",</span>\n    <span class="c1">//   accounts: [process.env.pk]</span>\n    <span class="c1">// }</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Here, we\'ve configured the local hardhat development environment as well as set up (and commented out) the Polygon mainnet and Mumbai testnet environments that we\'ll be using to deploy to Polygon.</p>\n\n<p>Next, let\'s add some basic global CSS that we\'ll be needing to style the markdown editor for the CMS.</p>\n\n<p>Open <strong>styles/globals.css</strong> and add the following code below the existing css:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight css"><code><span class="nc">.EasyMDEContainer</span> <span class="nc">.editor-toolbar</span> <span class="p">{</span>\n  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nc">.EasyMDEContainer</span> <span class="nc">.CodeMirror</span> <span class="p">{</span>\n  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span> <span class="cp">!important</span><span class="p">;</span>\n  <span class="nl">background</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nc">.editor-preview</span> <span class="p">{</span>\n  <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span> <span class="cp">!important</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nc">.CodeMirror</span> <span class="nc">.cm-spell-error</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-url</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-comment</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-tag</span><span class="o">)</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.cm-word</span><span class="o">)</span> <span class="p">{</span>\n  <span class="nl">background-color</span><span class="p">:</span> <span class="nb">transparent</span> <span class="cp">!important</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nt">pre</span> <span class="p">{</span>\n  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>\n  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#efefef</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nt">blockquote</span> <span class="p">{</span>\n  <span class="nl">border-left</span><span class="p">:</span> <span class="m">5px</span> <span class="nb">solid</span> <span class="m">#ddd</span><span class="p">;</span>\n  <span class="nl">padding-left</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>\n  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">0px</span><span class="p">;</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, we\'ll create a couple of <strong>SVG</strong> files for the app images, one for the logo and one as an arrow button.</p>\n\n<p>Create <strong><a href="https://gist.github.com/dabit3/28ab34ed85b1b1036d9b28c03fa6361b?short_path=0f62324">logo.svg</a></strong> and <strong><a href="https://gist.github.com/dabit3/06cefe57313c22082a2836065a9ec25e?short_path=6b7ad37">right-arrow.svg</a></strong> in the <strong>public</strong> folder and copy the linked SVG code into each of those files.</p>\n\n<h2>\n  <a name="the-smart-contract" href="#the-smart-contract">\n  </a>\n  The smart contract\n</h2>\n\n<p>Next, let\'s create the smart contract that will be powering our blog and CMS.</p>\n\n<p>Create a new file in the <strong>contracts</strong> folder named <strong>Blog.sol</strong>.</p>\n\n<p>Here, add the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight solidity"><code><span class="c1">// contracts/Blog.sol\n//SPDX-License-Identifier: Unlicense\n</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>\n\n<span class="k">import</span> <span class="s">"hardhat/console.sol"</span><span class="p">;</span>\n<span class="k">import</span> <span class="s">"@openzeppelin/contracts/utils/Counters.sol"</span><span class="p">;</span>\n\n<span class="k">contract</span> <span class="n">Blog</span> <span class="p">{</span>\n    <span class="kt">string</span> <span class="k">public</span> <span class="n">name</span><span class="p">;</span>\n    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>\n\n    <span class="k">using</span> <span class="n">Counters</span> <span class="k">for</span> <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span><span class="p">;</span>\n    <span class="n">Counters</span><span class="p">.</span><span class="n">Counter</span> <span class="k">private</span> <span class="n">_postIds</span><span class="p">;</span>\n\n    <span class="k">struct</span> <span class="n">Post</span> <span class="p">{</span>\n      <span class="kt">uint</span> <span class="n">id</span><span class="p">;</span>\n      <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>\n      <span class="kt">string</span> <span class="n">content</span><span class="p">;</span>\n      <span class="kt">bool</span> <span class="n">published</span><span class="p">;</span>\n    <span class="p">}</span>\n    <span class="cm">/* mappings can be seen as hash tables */</span>\n    <span class="cm">/* here we create lookups for posts by id and posts by ipfs hash */</span>\n    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">Post</span><span class="p">)</span> <span class="k">private</span> <span class="n">idToPost</span><span class="p">;</span>\n    <span class="k">mapping</span><span class="p">(</span><span class="kt">string</span> <span class="o">=&gt;</span> <span class="n">Post</span><span class="p">)</span> <span class="k">private</span> <span class="n">hashToPost</span><span class="p">;</span>\n\n    <span class="cm">/* events facilitate communication between smart contractsand their user interfaces  */</span>\n    <span class="cm">/* i.e. we can create listeners for events in the client and also use them in The Graph  */</span>\n    <span class="k">event</span> <span class="n">PostCreated</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="n">hash</span><span class="p">);</span>\n    <span class="k">event</span> <span class="n">PostUpdated</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="n">hash</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">published</span><span class="p">);</span>\n\n    <span class="cm">/* when the blog is deployed, give it a name */</span>\n    <span class="cm">/* also set the creator as the owner of the contract */</span>\n    <span class="k">constructor</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">)</span> <span class="p">{</span>\n        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"Deploying Blog with name:"</span><span class="p">,</span> <span class="n">_name</span><span class="p">);</span>\n        <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>\n        <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* updates the blog name */</span>\n    <span class="k">function</span> <span class="n">updateName</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>\n        <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* transfers ownership of the contract to another address */</span>\n    <span class="k">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>\n        <span class="n">owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* fetches an individual post by the content hash */</span>\n    <span class="k">function</span> <span class="n">fetchPost</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="n">Post</span> <span class="k">memory</span><span class="p">){</span>\n      <span class="k">return</span> <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">];</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* creates a new post */</span>\n    <span class="k">function</span> <span class="n">createPost</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>\n        <span class="n">_postIds</span><span class="p">.</span><span class="n">increment</span><span class="p">();</span>\n        <span class="kt">uint</span> <span class="n">postId</span> <span class="o">=</span> <span class="n">_postIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n        <span class="n">Post</span> <span class="k">storage</span> <span class="n">post</span> <span class="o">=</span> <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">];</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">postId</span><span class="p">;</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">published</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>\n        <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>\n        <span class="k">emit</span> <span class="n">PostCreated</span><span class="p">(</span><span class="n">postId</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">hash</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* updates an existing post */</span>\n    <span class="k">function</span> <span class="n">updatePost</span><span class="p">(</span><span class="kt">uint</span> <span class="n">postId</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">title</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">hash</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">published</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>\n        <span class="n">Post</span> <span class="k">storage</span> <span class="n">post</span> <span class="o">=</span>  <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">];</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">published</span> <span class="o">=</span> <span class="n">published</span><span class="p">;</span>\n        <span class="n">post</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>\n        <span class="n">idToPost</span><span class="p">[</span><span class="n">postId</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>\n        <span class="n">hashToPost</span><span class="p">[</span><span class="n">hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="p">;</span>\n        <span class="k">emit</span> <span class="n">PostUpdated</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">hash</span><span class="p">,</span> <span class="n">published</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* fetches all posts */</span>\n    <span class="k">function</span> <span class="n">fetchPosts</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Post</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>\n        <span class="kt">uint</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">_postIds</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>\n\n        <span class="n">Post</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="p">[](</span><span class="n">itemCount</span><span class="p">);</span>\n        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">itemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n            <span class="kt">uint</span> <span class="n">currentId</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>\n            <span class="n">Post</span> <span class="k">storage</span> <span class="n">currentItem</span> <span class="o">=</span> <span class="n">idToPost</span><span class="p">[</span><span class="n">currentId</span><span class="p">];</span>\n            <span class="n">posts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentItem</span><span class="p">;</span>\n        <span class="p">}</span>\n        <span class="k">return</span> <span class="n">posts</span><span class="p">;</span>\n    <span class="p">}</span>\n\n    <span class="cm">/* this modifier means only the contract owner can */</span>\n    <span class="cm">/* invoke the function */</span>\n    <span class="k">modifier</span> <span class="n">onlyOwner</span><span class="p">()</span> <span class="p">{</span>\n      <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>\n    <span class="n">_</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This contract allows the owner to create and edit posts, and for anyone to fetch posts.</p>\n\n<blockquote>\n<p>To make this smart contract permissionless, you could remove the <code>onlyOwner</code> modifier and use <a href="https://thegraph.com/en/">The Graph</a> to index and query posts by owner.</p>\n</blockquote>\n\n<p>Next, let\'s write a basic test to test out the most important functionality we\'ll be using.</p>\n\n<p>To do so, open <strong>test/sample-test.js</strong> and update it with the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">chai</span><span class="dl">"</span><span class="p">)</span>\n<span class="kd">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">)</span>\n\n<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>\n  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should create a post</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="dl">"</span><span class="s2">My first post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">)</span>\n\n    <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>\n    <span class="nx">expect</span><span class="p">(</span><span class="nx">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My first post</span><span class="dl">"</span><span class="p">)</span>\n  <span class="p">})</span>\n\n  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should edit a post</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="dl">"</span><span class="s2">My Second post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">)</span>\n\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">updatePost</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">My updated post</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">23456</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>\n\n    <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>\n    <span class="nx">expect</span><span class="p">(</span><span class="nx">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My updated post</span><span class="dl">"</span><span class="p">)</span>\n  <span class="p">})</span>\n\n  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should add update the name</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>\n\n    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">updateName</span><span class="p">(</span><span class="dl">\'</span><span class="s1">My new blog</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="dl">"</span><span class="s2">My new blog</span><span class="dl">"</span><span class="p">)</span>\n  <span class="p">})</span>\n<span class="p">})</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, run the test by opening your terminal and running this command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat <span class="nb">test</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name="deploying-the-contract" href="#deploying-the-contract">\n  </a>\n  Deploying the contract\n</h2>\n\n<p>Now that the contract has been written and tested, let\'s try to deploy it to a local test network.</p>\n\n<p>To start the local network, open your terminal at least two separate windows. In one window, run the following script:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat node\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When we run this command, you should see a list of addresses and private keys.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JXW8vJow--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x4oxdb5n7cucibup6l2z.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JXW8vJow--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x4oxdb5n7cucibup6l2z.jpeg" alt="accounts" loading="lazy" width="880" height="530"></a></p>\n\n<p>These are 20 test accounts and addresses created for us that we can use to deploy and test our smart contracts. Each account is also loaded up with 10,000 fake Ether. In a moment, we\'ll learn how to import the test account into MetaMask so that we can use it.</p>\n\n<p>Next, we need to deploy the contract to the test network. First update the name of <strong>scripts/sample-script.js</strong> to <strong>scripts/deploy.js</strong>.</p>\n\n<p>Next, update the file with this new deploy script:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* scripts/deploy.js */</span>\n<span class="kd">const</span> <span class="nx">hre</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hardhat</span><span class="dl">"</span><span class="p">);</span>\n<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">fs</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>\n  <span class="cm">/* these two lines deploy the contract to the network */</span>\n  <span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hre</span><span class="p">.</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog</span><span class="dl">"</span><span class="p">);</span>\n  <span class="kd">const</span> <span class="nx">blog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="dl">"</span><span class="s2">My blog</span><span class="dl">"</span><span class="p">);</span>\n\n  <span class="k">await</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>\n  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Blog deployed to:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">blog</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>\n\n  <span class="cm">/* this code writes the contract addresses to a local */</span>\n  <span class="cm">/* file named config.js that we can use in the app */</span>\n  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">\'</span><span class="s1">./config.js</span><span class="dl">\'</span><span class="p">,</span> <span class="s2">`\n  export const contractAddress = "</span><span class="p">${</span><span class="nx">blog</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"\n  export const ownerAddress = "</span><span class="p">${</span><span class="nx">blog</span><span class="p">.</span><span class="nx">signer</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">"\n  `</span><span class="p">)</span>\n<span class="p">}</span>\n\n<span class="nx">main</span><span class="p">()</span>\n  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>\n  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>\n    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>\n  <span class="p">});</span>\n\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now in a separate window (while the local network is still running) we can run the deploy script and give a flag to the CLI that we would like to deploy to our local network:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> localhost\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When the contract is deployed, you should see some output in your network terminal 🎉.</p>\n\n<h3>\n  <a name="importing-the-test-account-into-your-wallet" href="#importing-the-test-account-into-your-wallet">\n  </a>\n  Importing the test account into your wallet\n</h3>\n\n<p>To send transactions to the smart contract, we will need to connect our MetaMask wallet using one of the accounts created when we ran <code>npx hardhat node</code>. In the list of contracts that the CLI logs out, you should see both an <strong>Account number</strong> as well as a <strong>Private Key</strong>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>➜  react-dapp git:<span class="o">(</span>main<span class="o">)</span> npx hardhat node\nStarted HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/\n\nAccounts\n<span class="o">========</span>\nAccount <span class="c">#0: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 (10000 ETH)</span>\nPrivate Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80\n\n...\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We can import this account into MetaMask in order to start using some of the fake Eth available there.</p>\n\n<p>To do so, first open MetaMask and enable <strong>test networks</strong>:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--9eDrJ4Ml--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/06d5xd3h04th44q8plny.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--9eDrJ4Ml--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/06d5xd3h04th44q8plny.png" alt="Test Networks" loading="lazy" width="880" height="321"></a></p>\n\n<p>Next, update the network to be Localhost 8545:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7n8kDt_o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo46g1vi1183hsixq1op.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7n8kDt_o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo46g1vi1183hsixq1op.png" alt="Choose network" loading="lazy" width="880" height="591"></a></p>\n\n<p>Next, in MetaMask click on <strong>Import Account</strong> from the accounts menu:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--DbKbW31B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/96qsky18d9pb964u2udc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--DbKbW31B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/96qsky18d9pb964u2udc.png" alt="Import account" loading="lazy" width="880" height="596"></a></p>\n\n<p>Copy then paste the very first <strong>Private Key</strong> logged out by the CLI and click <strong>Import</strong>. Once the account is imported, you should see the Eth in the account:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qLXLIKjf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/imccr6kdjhwwvvmbcw4f.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qLXLIKjf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/imccr6kdjhwwvvmbcw4f.jpg" alt="Imported account" loading="lazy" width="880" height="590"></a></p>\n\n<blockquote>\n<p><strong>Be sure you imported the first account in the list of accounts (Account #0) as this will be the account used by default when the contract is deployed and therefore the contract owner.</strong></p>\n</blockquote>\n\n<p>Now that we have a smart contract deployed and an account ready to use, we can start interacting with it from the Next.js app.</p>\n\n<h2>\n  <a name="the-nextjs-app" href="#the-nextjs-app">\n  </a>\n  The Next.js app\n</h2>\n\n<p>Next, let\'s write the code for the app.</p>\n\n<p>The first thing we\'ll do is set up a couple of environment variables that we\'ll use to switch between a local testing environment, Mumbai testnet, and Polygon mainnet.</p>\n\n<p>Create a new file named <strong>.env.local</strong> in the root of your project and add the following configuration to start with:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>ENVIRONMENT="local"\nNEXT_PUBLIC_ENVIRONMENT="local"\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We will be able to switch these variables between <code>local</code>, <code>testnet</code>, and <code>mainnet</code> to switch between </p>\n\n<p>This will allow us to reference our environment both on the client as well as the server. To learn more about how environment variables work in Next.js, check out the documentation <a href="https://nextjs.org/docs/basic-features/environment-variables">here</a>.</p>\n\n<h3>\n  <a name="contextjs" href="#contextjs">\n  </a>\n  context.js\n</h3>\n\n<p>Next, let\'s create the app <a href="https://reactjs.org/docs/context.html">context</a>. Context will give us an easy way to share state throughout the app.</p>\n\n<p>Create a file named <strong>context.js</strong> and add the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">AccountContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="layout-and-nav" href="#layout-and-nav">\n  </a>\n  Layout and Nav\n</h3>\n\n<p>Next, let\'s open up <strong>pages/_app.js</strong>. Here we will update the code to include navigation, wallet connection, context, and some basic styling.</p>\n\n<p>This page serves as a wrapper or layout for the rest of the app.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/__app.js */</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">../styles/globals.css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/link</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@emotion/css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Web3Modal</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">web3modal</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">WalletConnectProvider</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@walletconnect/web3-provider</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../context.js</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ownerAddress</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">easymde/dist/easymde.min.css</span><span class="dl">\'</span>\n\n<span class="kd">function</span> <span class="nx">MyApp</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">})</span> <span class="p">{</span>\n  <span class="cm">/* create local state to save account information after signin */</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">account</span><span class="p">,</span> <span class="nx">setAccount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n  <span class="cm">/* web3Modal configuration for enabling wallet access */</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">getWeb3Modal</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3Modal</span><span class="p">({</span>\n      <span class="na">cacheProvider</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">providerOptions</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">walletconnect</span><span class="p">:</span> <span class="p">{</span>\n          <span class="na">package</span><span class="p">:</span> <span class="nx">WalletConnectProvider</span><span class="p">,</span>\n          <span class="na">options</span><span class="p">:</span> <span class="p">{</span> \n            <span class="na">infuraId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your-infura-id</span><span class="dl">"</span>\n          <span class="p">},</span>\n        <span class="p">},</span>\n      <span class="p">},</span>\n    <span class="p">})</span>\n    <span class="k">return</span> <span class="nx">web3Modal</span>\n  <span class="p">}</span>\n\n  <span class="cm">/* the connect function uses web3 modal to connect to the user\'s wallet */</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">connect</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">web3Modal</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getWeb3Modal</span><span class="p">()</span>\n      <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3Modal</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>\n      <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">accounts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">listAccounts</span><span class="p">()</span>\n      <span class="nx">setAccount</span><span class="p">(</span><span class="nx">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">error:</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">nav</span><span class="p">}</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">header</span><span class="p">}</span><span class="o">&gt;</span>\n          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span><span class="o">&gt;</span>\n              <span class="o">&lt;</span><span class="nx">img</span>\n                <span class="nx">src</span><span class="o">=</span><span class="dl">\'</span><span class="s1">/logo.svg</span><span class="dl">\'</span>\n                <span class="nx">alt</span><span class="o">=</span><span class="dl">"</span><span class="s2">React Logo</span><span class="dl">"</span>\n                <span class="nx">style</span><span class="o">=</span><span class="p">{{</span> <span class="na">width</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">50px</span><span class="dl">\'</span> <span class="p">}}</span>\n              <span class="sr">/</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span><span class="o">&gt;</span>\n              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleContainer</span><span class="p">}</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Full</span> <span class="nx">Stack</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">WEB3</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="p">{</span>\n            <span class="o">!</span><span class="nx">account</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonContainer</span><span class="p">}</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonStyle</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">connect</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Connect</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>            <span class="p">)</span>\n          <span class="p">}</span>\n          <span class="p">{</span>\n            <span class="nx">account</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">accountInfo</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">account</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>          <span class="p">}</span>\n        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">linkContainer</span><span class="p">}</span><span class="o">&gt;</span>\n          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">link</span><span class="p">}</span><span class="o">&gt;</span>\n              <span class="nx">Home</span>\n            <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="p">{</span>\n            <span class="cm">/* if the signed in user is the contract owner, we */</span>\n            <span class="cm">/* show the nav link to create a new post */</span>\n            <span class="p">(</span><span class="nx">account</span> <span class="o">===</span> <span class="nx">ownerAddress</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n              <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/create-post</span><span class="dl">"</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">link</span><span class="p">}</span><span class="o">&gt;</span>\n                  <span class="nx">Create</span> <span class="nx">Post</span>\n                <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>            <span class="p">)</span>\n          <span class="p">}</span>\n        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/nav</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>\n        <span class="o">&lt;</span><span class="nx">AccountContext</span><span class="p">.</span><span class="nx">Provider</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">account</span><span class="p">}</span><span class="o">&gt;</span>\n          <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="nx">connect</span><span class="o">=</span><span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="o">&lt;</span><span class="sr">/AccountContext.Provider</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">accountInfo</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 100%;\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n  font-size: 12px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  padding: 40px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">linkContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  padding: 30px 60px;\n  background-color: #fafafa;\n`</span>\n\n<span class="kd">const</span> <span class="nx">nav</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  background-color: white;\n`</span>\n\n<span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  display: flex;\n  border-bottom: 1px solid rgba(0, 0, 0, .075);\n  padding: 20px 30px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin: 0;\n  color: #999999;\n`</span>\n\n<span class="kd">const</span> <span class="nx">titleContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  display: flex;\n  flex-direction: column;\n  padding-left: 15px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-left: 30px;\n  font-weight: 500;\n  margin: 0;\n`</span>\n\n<span class="kd">const</span> <span class="nx">buttonContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 100%;\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n`</span>\n\n<span class="kd">const</span> <span class="nx">buttonStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  font-size: 18px;\n  padding: 16px 70px;\n  border-radius: 15px;\n  cursor: pointer;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`</span>\n\n<span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin: 0px 40px 0px 0px;\n  font-size: 16px;\n  font-weight: 400;\n`</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">MyApp</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="entrypoint" href="#entrypoint">\n  </a>\n  Entrypoint\n</h3>\n\n<p>Now that we have the layout set up, let\' create the entrypoint to the app.</p>\n\n<p>This page will fetch the list of posts from the network and render the post titles in a listview. When the user clicks on a post, we will navigate them to another page for a detail view (page will be created next).<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/index.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@emotion/css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/link</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../context</span><span class="dl">\'</span>\n\n<span class="cm">/* import contract address and contract owner address */</span>\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">ownerAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="cm">/* import Application Binary Interface (ABI) */</span>\n<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>\n  <span class="cm">/* posts are fetched server side and passed in as props */</span>\n  <span class="cm">/* see getServerSideProps */</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">posts</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>\n  <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AccountContext</span><span class="p">)</span>\n\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">navigate</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/create-post</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">postList</span><span class="p">}</span><span class="o">&gt;</span>\n        <span class="p">{</span>\n          <span class="cm">/* map over the posts array and render a button with the post title */</span>\n          <span class="nx">posts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">post</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>\n            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/post/</span><span class="p">${</span><span class="nx">post</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="o">&gt;</span>\n              <span class="o">&lt;</span><span class="nx">a</span><span class="o">&gt;</span>\n                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">linkStyle</span><span class="p">}</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">postTitle</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">post</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">arrowContainer</span><span class="p">}</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">img</span>\n                      <span class="nx">src</span><span class="o">=</span><span class="dl">\'</span><span class="s1">/right-arrow.svg</span><span class="dl">\'</span>\n                      <span class="nx">alt</span><span class="o">=</span><span class="dl">\'</span><span class="s1">Right arrow</span><span class="dl">\'</span>\n                      <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">smallArrow</span><span class="p">}</span>\n                    <span class="sr">/</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>              <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>          <span class="p">))</span>\n        <span class="p">}</span>\n      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>\n        <span class="p">{</span>\n          <span class="p">(</span><span class="nx">account</span> <span class="o">===</span> <span class="nx">ownerAddress</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">posts</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n            <span class="cm">/* if the signed in user is the account owner, render a button */</span>\n            <span class="cm">/* to create the first post */</span>\n            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonStyle</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">navigate</span><span class="p">}</span><span class="o">&gt;</span>\n              <span class="nx">Create</span> <span class="nx">your</span> <span class="nx">first</span> <span class="nx">post</span>\n              <span class="o">&lt;</span><span class="nx">img</span>\n                <span class="nx">src</span><span class="o">=</span><span class="dl">\'</span><span class="s1">/right-arrow.svg</span><span class="dl">\'</span>\n                <span class="nx">alt</span><span class="o">=</span><span class="dl">\'</span><span class="s1">Right arrow</span><span class="dl">\'</span>\n                <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">arrow</span><span class="p">}</span>\n              <span class="sr">/</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>          <span class="p">)</span>\n        <span class="p">}</span>\n      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getServerSideProps</span><span class="p">()</span> <span class="p">{</span>\n  <span class="cm">/* here we check to see the current environment variable */</span>\n  <span class="cm">/* and render a provider based on the environment we\'re in */</span>\n  <span class="kd">let</span> <span class="nx">provider</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">local</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>\n  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">testnet</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>\n  <span class="k">return</span> <span class="p">{</span>\n    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">posts</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">arrowContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n  padding-right: 20px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">postTitle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  font-size: 30px;\n  font-weight: bold;\n  cursor: pointer;\n  margin: 0;\n  padding: 20px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">linkStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  border: 1px solid #ddd;\n  margin-top: 20px;\n  border-radius: 8px;\n  display: flex;\n`</span>\n\n<span class="kd">const</span> <span class="nx">postList</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 700px;\n  margin: 0 auto;\n  padding-top: 50px;  \n`</span>\n\n<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  display: flex;\n  justify-content: center;\n`</span>\n\n<span class="kd">const</span> <span class="nx">buttonStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 100px;\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  font-size: 44px;\n  padding: 20px 70px;\n  border-radius: 15px;\n  cursor: pointer;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`</span>\n\n<span class="kd">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 35px;\n  margin-left: 30px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">smallArrow</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 25px;\n`</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="creating-posts" href="#creating-posts">\n  </a>\n  Creating posts\n</h3>\n\n<p>Next, create a new file in the <strong>pages</strong> directory named <strong>create-post.js</strong>.</p>\n\n<p>This will hold the route that will allow us to create posts and save them to the network.</p>\n\n<p>We\'ll also have the option to upload and save a cover image to IPFS, with the hash of the ipfs upload anchored on chain with the rest of the most data.</p>\n\n<p>Add the following code to this file:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/create-post.js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useRef</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span> <span class="c1">// new</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">dynamic</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/dynamic</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@emotion/css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ipfs-http-client</span><span class="dl">\'</span>\n\n<span class="cm">/* import contract address and contract owner address */</span>\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">contractAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../config</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">\'</span>\n\n<span class="cm">/* define the ipfs endpoint */</span>\n<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="cm">/* configure the markdown editor to be client-side import */</span>\n<span class="kd">const</span> <span class="nx">SimpleMDE</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(</span>\n  <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">\'</span><span class="s1">react-simplemde-editor</span><span class="dl">\'</span><span class="p">),</span>\n  <span class="p">{</span> <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>\n<span class="p">)</span>\n\n<span class="kd">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">\'\'</span> <span class="p">}</span>\n\n<span class="kd">function</span> <span class="nx">CreatePost</span><span class="p">()</span> <span class="p">{</span>\n  <span class="cm">/* configure initial state to be used in the component */</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="nx">initialState</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">image</span><span class="p">,</span> <span class="nx">setImage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">loaded</span><span class="p">,</span> <span class="nx">setLoaded</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>\n\n  <span class="kd">const</span> <span class="nx">fileRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">content</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">post</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="cm">/* delay rendering buttons until dynamic import is complete */</span>\n      <span class="nx">setLoaded</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>\n    <span class="p">},</span> <span class="mi">500</span><span class="p">)</span>\n  <span class="p">},</span> <span class="p">[])</span>\n\n  <span class="kd">function</span> <span class="nx">onChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">setPost</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">}))</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">createNewPost</span><span class="p">()</span> <span class="p">{</span>   \n    <span class="cm">/* saves post to ipfs then anchors to smart contract */</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">title</span> <span class="o">||</span> <span class="o">!</span><span class="nx">content</span><span class="p">)</span> <span class="k">return</span>\n    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">savePostToIpfs</span><span class="p">()</span>\n    <span class="k">await</span> <span class="nx">savePost</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span>\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`/`</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePostToIpfs</span><span class="p">()</span> <span class="p">{</span>\n    <span class="cm">/* save post metadata to ipfs */</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">post</span><span class="p">))</span>\n      <span class="k">return</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">error: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePost</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>\n    <span class="cm">/* anchor post to smart contract */</span>\n    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span> <span class="o">!==</span> <span class="dl">\'</span><span class="s1">undefined</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n      <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">contract: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">contract</span><span class="p">)</span>\n      <span class="k">try</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">createPost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span>\n        <span class="cm">/* optional - wait for transaction to be confirmed before rerouting */</span>\n        <span class="cm">/* await provider.waitForTransaction(val.hash) */</span>\n        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">val: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>\n      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Error: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>\n      <span class="p">}</span>\n    <span class="p">}</span>    \n  <span class="p">}</span>\n\n  <span class="kd">function</span> <span class="nx">triggerOnChange</span><span class="p">()</span> <span class="p">{</span>\n    <span class="cm">/* trigger handleFileChange handler of hidden file input */</span>\n    <span class="nx">fileRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">click</span><span class="p">()</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">handleFileChange</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n    <span class="cm">/* upload cover image to ipfs and save hash to state */</span>\n    <span class="kd">const</span> <span class="nx">uploadedFile</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uploadedFile</span><span class="p">)</span> <span class="k">return</span>\n    <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">uploadedFile</span><span class="p">)</span>\n    <span class="nx">setPost</span><span class="p">(</span><span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">coverImage</span><span class="p">:</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span> <span class="p">}))</span>\n    <span class="nx">setImage</span><span class="p">(</span><span class="nx">uploadedFile</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>\n      <span class="p">{</span>\n        <span class="nx">image</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n          <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">image</span><span class="p">)}</span> <span class="sr">/</span><span class="err">&gt;\n</span>        <span class="p">)</span>\n      <span class="p">}</span>\n      <span class="o">&lt;</span><span class="nx">input</span>\n        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onChange</span><span class="p">}</span>\n        <span class="nx">name</span><span class="o">=</span><span class="dl">\'</span><span class="s1">title</span><span class="dl">\'</span>\n        <span class="nx">placeholder</span><span class="o">=</span><span class="dl">\'</span><span class="s1">Give it a title ...</span><span class="dl">\'</span>\n        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>\n        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleStyle</span><span class="p">}</span>\n      <span class="sr">/</span><span class="err">&gt;\n</span>      <span class="o">&lt;</span><span class="nx">SimpleMDE</span>\n        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">mdEditor</span><span class="p">}</span>\n        <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">What\'s on your mind?</span><span class="dl">"</span>\n        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>\n        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="nx">value</span> <span class="p">})}</span>\n      <span class="sr">/</span><span class="err">&gt;\n</span>      <span class="p">{</span>\n        <span class="nx">loaded</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n          <span class="o">&lt;&gt;</span>\n            <span class="o">&lt;</span><span class="nx">button</span>\n              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span>\n              <span class="nx">type</span><span class="o">=</span><span class="dl">\'</span><span class="s1">button</span><span class="dl">\'</span>\n              <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">createNewPost</span><span class="p">}</span>\n            <span class="o">&gt;</span><span class="nx">Publish</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="nx">button</span>\n              <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">triggerOnChange</span><span class="p">}</span>\n              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span>\n            <span class="o">&gt;</span><span class="nx">Add</span> <span class="nx">cover</span> <span class="nx">image</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;\n</span>        <span class="p">)</span>\n      <span class="p">}</span>\n      <span class="o">&lt;</span><span class="nx">input</span>\n        <span class="nx">id</span><span class="o">=</span><span class="dl">\'</span><span class="s1">selectImage</span><span class="dl">\'</span>\n        <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">hiddenInput</span><span class="p">}</span> \n        <span class="nx">type</span><span class="o">=</span><span class="dl">\'</span><span class="s1">file</span><span class="dl">\'</span>\n        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileChange</span><span class="p">}</span>\n        <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">fileRef</span><span class="p">}</span>\n      <span class="sr">/</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">hiddenInput</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  display: none;\n`</span>\n\n<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  max-width: 800px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">mdEditor</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 40px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">titleStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 40px;\n  border: none;\n  outline: none;\n  background-color: inherit;\n  font-size: 44px;\n  font-weight: 600;\n  &amp;::placeholder {\n    color: #999999;\n  }\n`</span>\n\n<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 800px;\n  margin: 0 auto;\n`</span>\n\n<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  border-radius: 15px;\n  cursor: pointer;\n  margin-right: 10px;\n  font-size: 18px;\n  padding: 16px 70px;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">CreatePost</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="viewing-a-post" href="#viewing-a-post">\n  </a>\n  Viewing a post\n</h3>\n\n<p>Now that we have the ability to create posts, how do we navigate and view posts? We want to have the ability to view a post in a route that looks something like <code>myapp.com/post/some-post-id</code>.</p>\n\n<p>We can do this in a couple of different ways with <a href="https://nextjs.org/docs/routing/dynamic-routes">next.js dynamic routes</a>.</p>\n\n<p>We will be leveraging server-side data fetching using <a href="https://nextjs.org/docs/basic-features/data-fetching/get-static-paths">getStaticPaths</a> and <a href="https://nextjs.org/docs/basic-features/data-fetching/get-static-props">getStaticProps</a> which will create these pages at build time using the array of posts queried from the network.</p>\n\n<p>To make this happen, create a new folder in the <strong>pages</strong> directory named <strong>post</strong> and a file in that folder named <strong>[id].js</strong>. There, add the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/post/[id].js */</span>\n<span class="k">import</span> <span class="nx">ReactMarkdown</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react-markdown</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Link</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/link</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@emotion/css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AccountContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../context</span><span class="dl">\'</span>\n\n<span class="cm">/* import contract and owner addresses */</span>\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">ownerAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../config</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">\'</span>\n\n<span class="kd">const</span> <span class="nx">ipfsURI</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://ipfs.io/ipfs/</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Post</span><span class="p">({</span> <span class="nx">post</span> <span class="p">})</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AccountContext</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">isFallback</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n      <span class="p">{</span>\n        <span class="nx">post</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>\n            <span class="p">{</span>\n              <span class="cm">/* if the owner is the user, render an edit button */</span>\n              <span class="nx">ownerAddress</span> <span class="o">===</span> <span class="nx">account</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">editPost</span><span class="p">}</span><span class="o">&gt;</span>\n                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/edit-post/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span><span class="o">&gt;</span>\n                    <span class="o">&lt;</span><span class="nx">a</span><span class="o">&gt;</span>\n                      <span class="nx">Edit</span> <span class="nx">post</span>\n                    <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;\n</span>                  <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;\n</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>              <span class="p">)</span>\n            <span class="p">}</span>\n            <span class="p">{</span>\n              <span class="cm">/* if the post has a cover image, render it */</span>\n              <span class="nx">post</span><span class="p">.</span><span class="nx">coverImage</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n                <span class="o">&lt;</span><span class="nx">img</span>\n                  <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span>\n                  <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span>\n                <span class="sr">/</span><span class="err">&gt;\n</span>              <span class="p">)</span>\n            <span class="p">}</span>\n            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">contentContainer</span><span class="p">}</span><span class="o">&gt;</span>\n              <span class="o">&lt;</span><span class="nx">ReactMarkdown</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/ReactMarkdown</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>        <span class="p">)</span>\n      <span class="p">}</span>\n    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getStaticPaths</span><span class="p">()</span> <span class="p">{</span>\n  <span class="cm">/* here we fetch the posts from the network */</span>\n  <span class="kd">let</span> <span class="nx">provider</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">local</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>\n  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">testnet</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n    <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPosts</span><span class="p">()</span>\n\n  <span class="cm">/* then we map over the posts and create a params object passing */</span>\n  <span class="cm">/* the id property to getStaticProps which will run for ever post */</span>\n  <span class="cm">/* in the array and generate a new page */</span>\n  <span class="kd">const</span> <span class="nx">paths</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span> <span class="p">}))</span>\n\n  <span class="k">return</span> <span class="p">{</span>\n    <span class="nx">paths</span><span class="p">,</span>\n    <span class="na">fallback</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getStaticProps</span><span class="p">({</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">{</span>\n  <span class="cm">/* using the id property passed in through the params object */</span>\n  <span class="cm">/* we can us it to fetch the data from IPFS and pass the */</span>\n  <span class="cm">/* post data into the page as props */</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">params</span>\n  <span class="kd">const</span> <span class="nx">ipfsUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span>\n  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">ipfsUrl</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>\n  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">)</span> <span class="p">{</span>\n    <span class="kd">let</span> <span class="nx">coverImage</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span><span class="s2">`</span>\n    <span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span> <span class="o">=</span> <span class="nx">coverImage</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="p">{</span>\n    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">post</span><span class="p">:</span> <span class="nx">data</span>\n    <span class="p">},</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">editPost</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin: 20px 0px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 900px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 900px;\n  margin: 0 auto;\n`</span>\n\n<span class="kd">const</span> <span class="nx">contentContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 60px;\n  padding: 0px 40px;\n  border-left: 1px solid #e7e7e7;\n  border-right: 1px solid #e7e7e7;\n  &amp; img {\n    max-width: 900px;\n  }\n`</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="editing-a-post" href="#editing-a-post">\n  </a>\n  Editing a post\n</h3>\n\n<p>The final page we need to create is a way to edit existing posts.</p>\n\n<p>This page will carry over some functionality from both <strong>pages/create-post.js</strong> as well as <strong>pages/post/[id].js</strong>. We will be able to toggle between viewing and editing a post.</p>\n\n<p>Create a new folder in the <strong>pages</strong> directory named <strong>edit-post</strong> and a file named <strong>[id].js</strong> there. Next, add the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="cm">/* pages/edit-post/[id].js */</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/router</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">ReactMarkdown</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">react-markdown</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">css</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@emotion/css</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">dynamic</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">next/dynamic</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ethers</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">create</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">ipfs-http-client</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">contractAddress</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../config</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Blog</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../artifacts/contracts/Blog.sol/Blog.json</span><span class="dl">\'</span>\n\n<span class="kd">const</span> <span class="nx">ipfsURI</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://ipfs.io/ipfs/</span><span class="dl">\'</span>\n<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://ipfs.infura.io:5001/api/v0</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="kd">const</span> <span class="nx">SimpleMDE</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(</span>\n  <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">\'</span><span class="s1">react-simplemde-editor</span><span class="dl">\'</span><span class="p">),</span>\n  <span class="p">{</span> <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>\n<span class="p">)</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Post</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">[</span><span class="nx">editing</span><span class="p">,</span> <span class="nx">setEditing</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">()</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">router</span><span class="p">.</span><span class="nx">query</span>\n\n  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">fetchPost</span><span class="p">()</span>\n  <span class="p">},</span> <span class="p">[</span><span class="nx">id</span><span class="p">])</span>\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchPost</span><span class="p">()</span> <span class="p">{</span>\n    <span class="cm">/* we first fetch the individual post by ipfs hash from the network */</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span>\n    <span class="kd">let</span> <span class="nx">provider</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">local</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">()</span>\n    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_ENVIRONMENT</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">testnet</span><span class="dl">\'</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://rpc-mumbai.matic.today</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n      <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="dl">\'</span><span class="s1">https://polygon-rpc.com/</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">}</span>\n    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">provider</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fetchPost</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">postId</span> <span class="o">=</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toNumber</span><span class="p">()</span>\n\n    <span class="cm">/* next we fetch the IPFS metadata from the network */</span>\n    <span class="kd">const</span> <span class="nx">ipfsUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span>\n    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">ipfsUrl</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>\n    <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">let</span> <span class="nx">coverImagePath</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">ipfsURI</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">coverImage</span><span class="p">}</span><span class="s2">`</span>\n      <span class="nx">data</span><span class="p">.</span><span class="nx">coverImagePath</span> <span class="o">=</span> <span class="nx">coverImagePath</span>\n    <span class="p">}</span>\n    <span class="cm">/* finally we append the post ID to the post data */</span>\n    <span class="cm">/* we need this ID to make updates to the post */</span>\n    <span class="nx">data</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">postId</span><span class="p">;</span>\n    <span class="nx">setPost</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">savePostToIpfs</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">added</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">post</span><span class="p">))</span>\n      <span class="k">return</span> <span class="nx">added</span><span class="p">.</span><span class="nx">path</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">error: </span><span class="dl">\'</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="kd">function</span> <span class="nx">updatePost</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">savePostToIpfs</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">signer</span> <span class="o">=</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">()</span>\n    <span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">Blog</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">signer</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">updatePost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">hash</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>\n    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">post</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span>\n\n  <span class="k">return</span> <span class="p">(</span>\n    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>\n      <span class="p">{</span>\n      <span class="cm">/* editing state will allow the user to toggle between */</span>\n      <span class="cm">/*  a markdown editor and a markdown renderer */</span>\n      <span class="p">}</span>\n      <span class="p">{</span>\n        <span class="nx">editing</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n            <span class="o">&lt;</span><span class="nx">input</span>\n              <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>\n              <span class="nx">name</span><span class="o">=</span><span class="dl">\'</span><span class="s1">title</span><span class="dl">\'</span>\n              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">\'</span><span class="s1">Give it a title ...</span><span class="dl">\'</span>\n              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>\n              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">titleStyle</span><span class="p">}</span>\n            <span class="sr">/</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="nx">SimpleMDE</span>\n              <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">mdEditor</span><span class="p">}</span>\n              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">What\'s on your mind?</span><span class="dl">"</span>\n              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>\n              <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">setPost</span><span class="p">({</span> <span class="p">...</span><span class="nx">post</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="nx">value</span> <span class="p">})}</span>\n            <span class="sr">/</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">updatePost</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Update</span> <span class="nx">post</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>        <span class="p">)</span>\n      <span class="p">}</span>\n      <span class="p">{</span>\n        <span class="o">!</span><span class="nx">editing</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>\n            <span class="p">{</span>\n              <span class="nx">post</span><span class="p">.</span><span class="nx">coverImagePath</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>\n                <span class="o">&lt;</span><span class="nx">img</span>\n                  <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">coverImagePath</span><span class="p">}</span>\n                  <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">coverImageStyle</span><span class="p">}</span>\n                <span class="sr">/</span><span class="err">&gt;\n</span>              <span class="p">)</span>\n            <span class="p">}</span>\n            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">contentContainer</span><span class="p">}</span><span class="o">&gt;</span>\n              <span class="o">&lt;</span><span class="nx">ReactMarkdown</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/ReactMarkdown</span><span class="err">&gt;\n</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>        <span class="p">)</span>\n      <span class="p">}</span>\n      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">button</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">setEditing</span><span class="p">(</span><span class="nx">editing</span> <span class="p">?</span> <span class="kc">false</span> <span class="p">:</span> <span class="kc">true</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span> <span class="nx">editing</span> <span class="p">?</span> <span class="dl">\'</span><span class="s1">View post</span><span class="dl">\'</span> <span class="p">:</span> <span class="dl">\'</span><span class="s1">Edit post</span><span class="dl">\'</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;\n</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;\n</span>  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  border-radius: 15px;\n  cursor: pointer;\n  margin-right: 10px;\n  margin-top: 15px;\n  font-size: 18px;\n  padding: 16px 70px;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`</span>\n\n<span class="kd">const</span> <span class="nx">titleStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 40px;\n  border: none;\n  outline: none;\n  background-color: inherit;\n  font-size: 44px;\n  font-weight: 600;\n  &amp;::placeholder {\n    color: #999999;\n  }\n`</span>\n\n<span class="kd">const</span> <span class="nx">mdEditor</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 40px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">coverImageStyle</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 900px;\n`</span>\n\n<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  width: 900px;\n  margin: 0 auto;\n`</span>\n\n<span class="kd">const</span> <span class="nx">contentContainer</span> <span class="o">=</span> <span class="nx">css</span><span class="s2">`\n  margin-top: 60px;\n  padding: 0px 40px;\n  border-left: 1px solid #e7e7e7;\n  border-right: 1px solid #e7e7e7;\n  &amp; img {\n    max-width: 900px;\n  }\n`</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="testing-it-out" href="#testing-it-out">\n  </a>\n  Testing it out\n</h3>\n\n<p>We can now test it out.</p>\n\n<p>To do so, be sure you have already deployed the contract to the network in the previous steps and you still have the local network running.</p>\n\n<p>Open a new terminal window and start the Next.js app:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm run dev\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When the app starts, you should be able to connect your wallet and interact with the app.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--mdLlMvJ0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uaiouakr4b062x53lecp.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--mdLlMvJ0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uaiouakr4b062x53lecp.jpg" alt="Homepage" loading="lazy" width="880" height="472"></a></p>\n\n<p>You should also be able to create a new post.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5iXvlqxL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c41ztmvvzgvlbjb9r0ib.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5iXvlqxL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c41ztmvvzgvlbjb9r0ib.jpg" alt="Create a post" loading="lazy" width="880" height="585"></a></p>\n\n<p>You may notice that the app is not as fast as it could be, but Next.js is blazingly fast in production. </p>\n\n<p>To run a production build, run the following commands:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm run build <span class="o">&amp;&amp;</span> npm start\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name="deploying-to-polygon" href="#deploying-to-polygon">\n  </a>\n  Deploying to Polygon\n</h2>\n\n<p>Now that we have the project up and running and tested locally, let\'s deploy to Polygon. We\'ll start by deploying to <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai</a>, the Polygon test network.</p>\n\n<p>The first thing we will need to do is set one of our <strong>private keys</strong> from our wallet as an environment variable.</p>\n\n<p>To get a private key, you can export them directly from MetaMask.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A6H5cUQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png" alt="Private keys" loading="lazy" width="880" height="532"></a></p>\n\n<blockquote>\n<p>Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.</p>\n</blockquote>\n\n<p>If you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">pk</span><span class="o">=</span><span class="s2">"your-private-key"</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="configuring-the-network" href="#configuring-the-network">\n  </a>\n  Configuring the network\n</h3>\n\n<p>Next, we need to switch from the local test network to the <a href="https://docs.polygon.technology/docs/develop/network-details/network/">Mumbai Testnet</a>.</p>\n\n<p>To do so, we need to create and set the network configuration.</p>\n\n<p>First, open MetaMask and click on <strong>Settings</strong>.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--m7IT4BJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png" alt="MetaMask settings" loading="lazy" width="477" height="643"></a></p>\n\n<p>Next, click on <strong>Networks</strong> and then <strong>Add Network</strong>:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--e7hY_j6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png" alt="New Network" loading="lazy" width="880" height="558"></a></p>\n\n<p>Here, we will add the following configurations for the Mumbai test network as listed <a href="https://docs.polygon.technology/docs/develop/network-details/network/">here</a>:</p>\n\n<p>Network Name: <strong>Mumbai TestNet</strong><br>\nNew RPC URL: <strong><a href="https://rpc-mumbai.matic.today">https://rpc-mumbai.matic.today</a></strong><br>\nChain ID: <strong>80001</strong><br>\nCurrency Symbol: <strong>Matic</strong></p>\n\n<p>Save this, then you should be able to switch to and use the new network!</p>\n\n<p>Finally, you will need some testnet Polygon tokens in order to interact with the applications.</p>\n\n<p>To get these, you can visit the <a href="https://faucet.polygon.technology/">Polygon Faucet</a>, inputting the address of the wallets that you would like to request the tokens.</p>\n<h3>\n  <a name="deploying-to-the-polygon-network" href="#deploying-to-the-polygon-network">\n  </a>\n  Deploying to the Polygon network\n</h3>\n\n<p>Now that you have some tokens, you can deploy to the Polygon network!</p>\n\n<p>To do so, be sure that the address associated with the private key you are deploying your contract with has received some tokens in order to pay the gas fees for the transaction.</p>\n\n<p>Next, uncomment the <code>mumbai</code> configuration in hardhat.config.js:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">mumbai</span><span class="p">:</span> <span class="p">{</span>\n  <span class="nl">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://rpc-mumbai.matic.today</span><span class="dl">"</span><span class="p">,</span>\n  <span class="nx">accounts</span><span class="p">:</span> <span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">pk</span><span class="p">]</span>\n<span class="p">},</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>To deploy to Polygon testnet, run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npx hardhat run scripts/deploy.js <span class="nt">--network</span> mumbai\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>If you run into this error: <code>ProviderError: RPCError</code>, the public RPC may be congested. In production, it\'s recommended to use an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, or <a href="https://www.quicknode.com/">Quicknode</a>.</p>\n</blockquote>\n\n<p>Next, update the environment variables in <strong>.env.local</strong> to be <code>testnet</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>ENVIRONMENT="testnet"\nNEXT_PUBLIC_ENVIRONMENT="testnet"\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, restart the server to register the change in environment variables:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm run dev\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You should now be able to test the app on the new network 🎉!</p>\n\n<p>If you have any issues connecting to the public Mumbai RPC endpoint, consider replacing the endpoints in your app using endpoints from an RPC provider like <a href="https://infura.io/">Infura</a>, <a href="https://www.alchemy.com/">Alchemy</a>, or <a href="https://www.quicknode.com/">Quicknode</a>.</p>\n\n<h2>\n  <a name="creating-a-subgraph-api" href="#creating-a-subgraph-api">\n  </a>\n  Creating a subgraph API\n</h2>\n\n<p>By default the only data access patterns we have are the two functions we\'ve written into the contract, <code>fetchPost</code> and <code>fetchPosts</code>.</p>\n\n<p>This is a fine place to start, but as your app starts to scale you\'ll probably find yourself needing a more flexible and scalable API.</p>\n\n<p>For instance, what if we wanted to give the user the ability to search posts, fetch posts created by a certain user, or to sort posts by the date which they were created?</p>\n\n<p>We can build all of this functionality into an API by using <a href="https://thegraph.com/en/">The Graph</a> protocol. Let\'s see how to do this.</p>\n\n<h3>\n  <a name="creating-the-project-in-the-graph" href="#creating-the-project-in-the-graph">\n  </a>\n  Creating the project in The Graph\n</h3>\n\n<p>To get started, visit <a href="https://thegraph.com/explorer/dashboard">The Graph hosted service</a> and either sign in or create a new account.</p>\n\n<p>Next, go to the <a href="https://thegraph.com/explorer/dashboard">dashboard</a> and click on <strong>Add Subgraph</strong> to create a new subgraph.</p>\n\n<p>Configure your subgraph with the following properties:</p>\n\n<ul>\n<li>Subgraph Name - <strong>Blogcms</strong>\n</li>\n<li>Subtitle - <strong>A subgraph for querying post data</strong>\n</li>\n<li>Optional - Fill the description and GITHUB URL properties</li>\n</ul>\n\n<p>Once the subgraph is created, we will initialize the subgraph locally using the Graph CLI.</p>\n\n<h3>\n  <a name="initializing-a-new-subgraph-using-the-graph-cli" href="#initializing-a-new-subgraph-using-the-graph-cli">\n  </a>\n  Initializing a new subgraph using the Graph CLI\n</h3>\n\n<p>Next, install the Graph CLI:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> @graphprotocol/graph-cli\n\n<span class="c"># or</span>\n\n<span class="nv">$ </span>yarn global add @graphprotocol/graph-cli\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Once the Graph CLI has been installed you can initialize a new subgraph with the Graph CLI <code>init</code> command.</p>\n\n<p>Since we\'ve already deployed our contract to the network, we can initialize from that contract address by passing in the contract address using the <code>--from-contract</code> flag.</p>\n\n<p>This address is available for reference in <strong>config.js</strong> as <code>contractAddress</code>.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nv">$ </span>graph init <span class="nt">--from-contract</span> your-contract-address <span class="se">\\</span>\n<span class="nt">--network</span> mumbai <span class="nt">--contract-name</span> Blog <span class="nt">--index-events</span>\n\n? Protocol: ethereum\n? Product <span class="k">for </span>which to initialize › hosted-service\n? Subgraph name › your-username/blogcms\n? Directory to create the subgraph <span class="k">in</span> › blogcms\n? Ethereum network › mumbai\n? Contract address › your-contract-address\n? ABI file <span class="o">(</span>path<span class="o">)</span> › artifacts/contracts/Blog.sol/Blog.json\n? Contract Name › Blog\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This command will generate a basic subgraph based off of the contract address passed in as the argument to <code>--from-contract</code>. By using this contract address, the CLI will initialize a few things in your project to get you started (including fetching the <code>abis</code> and saving them in the <strong>abis</strong> directory).</p>\n\n<blockquote>\n<p>By passing in <code>--index-events</code> the CLI will automatically populate some code for us both in <strong>schema.graphql</strong> as well as <strong>src/mapping.ts</strong> based on the events emitted from the contract.</p>\n</blockquote>\n\n<p>The main configuration and definition for the subgraph lives in the <strong>subgraph.yaml</strong> file. The subgraph codebase consists of a few files:</p>\n\n<ul>\n<li>\n<strong>subgraph.yaml</strong>: a YAML file containing the subgraph manifest</li>\n<li>\n<strong>schema.graphql</strong>: a GraphQL schema that defines what data is stored for your subgraph, and how to query it via GraphQL</li>\n<li>\n<strong>AssemblyScript Mappings</strong>: AssemblyScript code that translates from the event data in Ethereum to the entities defined in your schema (e.g. mapping.ts in this tutorial)</li>\n</ul>\n\n<p>The entries in <strong>subgraph.yaml</strong> that we will be working with are:</p>\n\n<ul>\n<li>\n<code>description</code> (optional): a human-readable description of what the subgraph is. This description is displayed by the Graph Explorer when the subgraph is deployed to the Hosted Service.</li>\n<li>\n<code>repository</code> (optional): the URL of the repository where the subgraph manifest can be found. This is also displayed by the Graph Explorer.</li>\n<li>\n<code>dataSources.source</code>: the address of the smart contract the subgraph sources, and the abi of the smart contract to use. The address is optional; omitting it allows to index matching events from all contracts.</li>\n<li>\n<code>dataSources.source.startBlock</code> (optional): the number of the block that the data source starts indexing from. In most cases we suggest using the block in which the contract was created.</li>\n<li>\n<code>dataSources.mapping.entities</code> : the entities that the data source writes to the store. The schema for each entity is defined in the the schema.graphql file.</li>\n<li>\n<code>dataSources.mapping.abis</code>: one or more named ABI files for the source contract as well as any other smart contracts that you interact with from within the mappings.</li>\n<li>\n<code>dataSources.mapping.eventHandlers</code>: lists the smart contract events this subgraph reacts to and the handlers in the mapping — <strong>./src/mapping.ts</strong> in the example — that transform these events into entities in the store.</li>\n</ul>\n\n<h3>\n  <a name="defining-the-entities" href="#defining-the-entities">\n  </a>\n  Defining the entities\n</h3>\n\n<p>With The Graph, you define entity types in <strong>schema.graphql</strong>, and Graph Node will generate top level fields for querying single instances and collections of that entity type. Each type that should be an entity is required to be annotated with an <code>@entity</code> directive.</p>\n\n<p>The entities / data we will be indexing are the <code>Token</code> and <code>User</code>. This way we can index the Tokens created by the users as well as the users themselves.</p>\n\n<p>To do this, update <strong>schema.graphql</strong> with the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight graphql"><code><span class="k">type</span><span class="w"> </span><span class="n">_Schema_</span><span class="w">\n  </span><span class="err">@</span><span class="n">fulltext</span><span class="p">(</span><span class="w">\n    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="err">"</span><span class="n">postSearch</span><span class="err">"</span><span class="w">\n    </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="n">en</span><span class="w">\n    </span><span class="n">algorithm</span><span class="p">:</span><span class="w"> </span><span class="n">rank</span><span class="w">\n    </span><span class="n">include</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">{</span><span class="w"> </span><span class="n">entity</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">Post</span><span class="err">"</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="err">:</span><span class="w"> </span><span class="err">[{</span><span class="w"> </span><span class="n">name</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">title</span><span class="err">"</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">name</span><span class="err">:</span><span class="w"> </span><span class="err">"</span><span class="n">postContent</span><span class="err">"</span><span class="w"> </span><span class="err">}</span><span class="p">]</span><span class="w"> </span><span class="err">}]</span><span class="w">\n  </span><span class="p">)</span><span class="w">\n\n</span><span class="n">type</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="err">@</span><span class="n">entity</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!</span><span class="w">\n  </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n  </span><span class="n">contentHash</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n  </span><span class="n">published</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">!</span><span class="w">\n  </span><span class="n">postContent</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n  </span><span class="n">createdAtTimestamp</span><span class="p">:</span><span class="w"> </span><span class="n">BigInt</span><span class="p">!</span><span class="w">\n  </span><span class="n">updatedAtTimestamp</span><span class="p">:</span><span class="w"> </span><span class="n">BigInt</span><span class="p">!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now that we have created the GraphQL schema for our app, we can generate the entities locally to start using in the <code>mappings</code> created by the CLI:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>graph codegen\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In order to make working smart contracts, events and entities easy and type-safe, the Graph CLI generates AssemblyScript types from a combination of the subgraph\'s GraphQL schema and the contract ABIs included in the data sources.</p>\n\n<h2>\n  <a name="updating-the-subgraph-with-the-entities-and-mappings" href="#updating-the-subgraph-with-the-entities-and-mappings">\n  </a>\n  Updating the subgraph with the entities and mappings\n</h2>\n\n<p>Now we can configure the <strong>subgraph.yaml</strong> to use the entities that we have just created and configure their mappings.</p>\n\n<p>To do so, first update the <code>dataSources.mapping.entities</code> field with the <code>User</code> and <code>Token</code> entities:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight yaml"><code><span class="na">entities</span><span class="pi">:</span>\n  <span class="pi">-</span> <span class="s">Post</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next we\'ll need to find the block which the contract was deployed (optional). We need this so that we can set the start block for the indexer to begin syncing so that it does not need to sync from the genesis block. You can find the start block by visiting <a href="https://mumbai.polygonscan.com/">https://mumbai.polygonscan.com/</a> and pasting in your contract address.</p>\n\n<p>Finally, update the configuration to add the <code>startBlock</code> :<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight yaml"><code><span class="na">source</span><span class="pi">:</span>\n  <span class="na">address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">your-contract-adddress"</span>\n  <span class="na">abi</span><span class="pi">:</span> <span class="s">Blog</span>\n  <span class="na">startBlock</span><span class="pi">:</span> <span class="s">your-start-block</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name="assemblyscript-mappings" href="#assemblyscript-mappings">\n  </a>\n  Assemblyscript mappings\n</h2>\n\n<p>Next, open <strong>src/mappings.ts</strong> to write the mappings that we defined in our subgraph subgraph <code>eventHandlers</code>.</p>\n\n<p>Update the file with the following code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span>\n  <span class="nx">PostCreated</span> <span class="k">as</span> <span class="nx">PostCreatedEvent</span><span class="p">,</span>\n  <span class="nx">PostUpdated</span> <span class="k">as</span> <span class="nx">PostUpdatedEvent</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../generated/Blog/Blog</span><span class="dl">"</span>\n<span class="k">import</span> <span class="p">{</span>\n  <span class="nx">Post</span>\n<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../generated/schema</span><span class="dl">"</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ipfs</span><span class="p">,</span> <span class="nx">json</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@graphprotocol/graph-ts</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="kd">function</span> <span class="nx">handlePostCreated</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">PostCreatedEvent</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>\n  <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>\n  <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>\n  <span class="nx">post</span><span class="p">.</span><span class="nx">contentHash</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>\n  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ipfs</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>\n    <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">toObject</span><span class="p">()</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nx">post</span><span class="p">.</span><span class="nx">postContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n  <span class="nx">post</span><span class="p">.</span><span class="nx">createdAtTimestamp</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>\n  <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">function</span> <span class="nx">handlePostUpdated</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">PostUpdatedEvent</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>\n  <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>\n    <span class="nx">post</span><span class="p">.</span><span class="nx">contentHash</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>\n    <span class="nx">post</span><span class="p">.</span><span class="nx">published</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">published</span><span class="p">;</span>\n    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ipfs</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">toObject</span><span class="p">()</span>\n      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>\n          <span class="nx">post</span><span class="p">.</span><span class="nx">postContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n    <span class="nx">post</span><span class="p">.</span><span class="nx">updatedAtTimestamp</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>\n    <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>These mappings will handle events for when a new post is created and when a post is updated. When these events fire, the mappings will save the data into the subgraph.</p>\n\n<h3>\n  <a name="running-a-build" href="#running-a-build">\n  </a>\n  Running a build\n</h3>\n\n<p>Next, let\'s run a build to make sure that everything is configured properly. To do so, run the <code>build</code> command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nv">$ </span>graph build\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>If the build is successful, you should see a new <strong>build</strong> folder generated in your root directory.</p>\n\n<h2>\n  <a name="deploying-the-subgraph" href="#deploying-the-subgraph">\n  </a>\n  Deploying the subgraph\n</h2>\n\n<p>To deploy, we can run the <code>deploy</code> command. To deploy, you will first need to copy the <strong>Access token</strong> for your account, available in the <a href="https://thegraph.com/hosted-service/dashboard">Graph Dashboard</a>:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--v7zoQMgq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/820lwqh8yo3iyu7fsbhj.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--v7zoQMgq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/820lwqh8yo3iyu7fsbhj.jpg" alt="Graph Dashboard" loading="lazy" width="880" height="246"></a></p>\n\n<p>Next, run the following command:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nv">$ </span>graph auth\n✔ Product <span class="k">for </span>which to initialize · hosted-service\n✔ Deploy key · <span class="k">********************************</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The deploy the subgraph:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code><span class="nv">$ </span>yarn deploy\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Once the subgraph is deployed, you should see it show up in your dashboard.</p>\n\n<p>When you click on the subgraph, it should open the subgraph details:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Jhj9vm7o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8kxjleaatn2fvgug8tsx.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Jhj9vm7o--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8kxjleaatn2fvgug8tsx.png" alt="Blogcms details" loading="lazy" width="880" height="660"></a></p>\n\n<h2>\n  <a name="querying-for-data" href="#querying-for-data">\n  </a>\n  Querying for data\n</h2>\n\n<p>Now that we are in the dashboard, we should be able to start querying for data. Run the following query to get a list of posts:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight graphql"><code><span class="p">{</span><span class="w">\n  </span><span class="n">posts</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="n">id</span><span class="w">\n    </span><span class="n">title</span><span class="w">\n    </span><span class="n">contentHash</span><span class="w">\n    </span><span class="n">published</span><span class="w">\n    </span><span class="n">postContent</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We can also configure the order direction by creation date:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight graphql"><code><span class="p">{</span><span class="w">\n  </span><span class="n">posts</span><span class="p">(</span><span class="w">\n    </span><span class="n">orderBy</span><span class="p">:</span><span class="w"> </span><span class="n">createdAtTimestamp</span><span class="w">\n    </span><span class="n">orderDirection</span><span class="p">:</span><span class="w"> </span><span class="n">desc</span><span class="w">\n  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="n">id</span><span class="w">\n    </span><span class="n">title</span><span class="w">\n    </span><span class="n">contentHash</span><span class="w">\n    </span><span class="n">published</span><span class="w">\n    </span><span class="n">postContent</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We can also do full text search on the post title or content:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight graphql"><code><span class="p">{</span><span class="w">\n  </span><span class="n">postSearch</span><span class="p">(</span><span class="w">\n    </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello"</span><span class="w">\n  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="n">id</span><span class="w">\n    </span><span class="n">title</span><span class="w">\n    </span><span class="n">contentHash</span><span class="w">\n    </span><span class="n">published</span><span class="w">\n    </span><span class="n">postContent</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span></code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Congratulations, you have now build out a more flexible API that you can use to query your app!</p>\n\n<p>To learn how to use the API endpoint in your app, check out the documentation <a href="https://thegraph.com/docs/en/developer/querying-from-your-app/">here</a> or the video <a href="https://www.youtube.com/watch?v=PjyKPMpahuc">here</a></p>\n\n<h2>\n  <a name="next-steps" href="#next-steps">\n  </a>\n  Next steps\n</h2>\n\n<p>If you\'d like a challenge, consider adding some functionality that will allow you to update the cover image in <strong>pages/edit-post/[id].js</strong>.</p>\n\n<p>If you\'d like to deploy your code to a web3 / decentralized git hosting protocol, check out <a href="https://www.youtube.com/watch?v=MhoRiH2podI">this</a> video on <a href="https://radicle.xyz/">Radicle</a>.</p>\n\n<p>If you\'d like to deploy your app and make it live, check out <a href="https://vercel.com/new">Vercel</a>.</p>\n\n<p>If you enjoyed this tutorial, be sure to check out my other three comprehensive guides:</p>\n\n<ol>\n<li><a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13">The Complete Guide to Full Stack Ethereum Development</a></li>\n<li><a href="https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb">Building a Full Stack NFT Marketplace on Ethereum with Polygon\n</a></li>\n<li>The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom\n<a href="https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291">https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291</a>\n</li>\n</ol>\n\n',a.body_markdown="---\ntitle: The Complete Guide to Full Stack Web3 Development\npublished: true\ndescription: Building a full stack web3 app with Next.js, Polygon, Solidity, The Graph, IPFS, and Hardhat\ntags: web3, blockchain, solidity, webdev\ncover_image: https://dev-to-uploads.s3.amazonaws.com/uploads/articles/maq07rzwhayt5qvwarw6.jpg\n---\n\n## Building a full stack web3 app with Next.js, Polygon, Solidity, The Graph, IPFS, and Hardhat\n\n> The video for this tutorial is also available [here](https://www.youtube.com/watch?v=nRMo5jjgCr4)\n\nIn this in depth tutorial you'll learn the tools, protocols, and frameworks for building full stack web3 apps, and most importantly - how to put everything together to lay the groundwork for building out any of your own ideas in the future.\n\n> The codebase for this app is located [here](https://github.com/dabit3/full-stack-web3)\n\nThe main network we'll be deploying to is [Polygon](https://polygon.technology/). I chose Polygon because of its low transaction cost, fast block times, and current network adoption.\n\nThat being said, we're going to be building on the [Ethereum Virtual Machine](https://ethereum.org/en/developers/docs/evm/) (EVM), so you can apply these skills to build for dozens of other blockchain networks as well, including Ethereum, Celo, Avalanche, and many others.\n\nThe app we'll be building is a full stack blog as well as a content management system (CMS), meaning that you will have an open, public, and composable back end that can be transferred and reused anywhere.\n\nBy the end of this tutorial you should have a good understanding of the most important pieces of a modern web3 stack and how to build performant, scalable, full stack decentralized blockchain applications.\n\n__This is the fourth guide in my \"Full Stack\" web3 series. Also be sure to check out:__\n1. [The Complete Guide to Full Stack Ethereum Development](https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13)\n2. [Building a Full Stack NFT Marketplace on Ethereum with Polygon\n](https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb)\n3. [The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom](\nhttps://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291)\n\n### The web3 stack\n\n[![The web3 stack](https://edgeandnode.com/images/web3-stack.jpg)](https://edgeandnode.com/images/web3-stack.jpg)\n\nIn [Defining the web3 stack](https://edgeandnode.com/blog/defining-the-web3-stack) I wrote about my interpretation of the current state of the web3 tech stack from a developer's perspective using a combination of my own personal experience as well as research that was done over the past year on my team at [Edge & Node](https://edgeandnode.com/).\n\nWe will be using pieces of this stack for this application:\n\n1. Blockchain - [Polygon](https://polygon.technology/) (with optional RPC provider)\n2. Ethereum development environment - [Hardhat](https://hardhat.org/)\n3. Front end framework - [Next.js](https://nextjs.org/) & [React](https://reactjs.org/)\n4. Ethereum web client library - [Ethers.js](https://docs.ethers.io/v5/)\n5. File storage - [IPFS](https://ipfs.io/)\n6. Indexing and querying - [The Graph Protocol](https://thegraph.com/en/)\n\nLearning how to use these building blocks we can build out many types of applications, so the goal with this tutorial is to show how they each work and how they all fit together.\n\nLet's get started!\n\n### Prerequisites\n\n- Node.js installed on your local machine\n- MetaMask Chrome extension installed in your browser\n\n## Project setup\n\nHere we will create the application boilerplates, install all of the necessary dependencies, and configure the project.\n\nThe code will be commented to give you insight as to what is happening, and I'll describe some of what is going on throughout the tutorial as well.\n\nTo get started, create a new __Next.js__ application and change into the new directory:\n\n```\nnpx create-next-app web3-blog\n\ncd web3-blog\n```\n\nNext, change into the new directory and install the following dependencies using either __npm__, __yarn__, or __pnpm__:\n\n```sh\nnpm install ethers hardhat @nomiclabs/hardhat-waffle \\\nethereum-waffle chai @nomiclabs/hardhat-ethers \\\nweb3modal @walletconnect/web3-provider \\\neasymde react-markdown react-simplemde-editor \\\nipfs-http-client @emotion/css @openzeppelin/contracts\n```\n\nAn overview of some of these dependencies:\n\n[hardhat](https://hardhat.org/) - Ethereum development environment\n[web3modal](https://github.com/Web3Modal/web3modal) - An easy-to-use library that allows users to connect their wallets to your app\n[react-markdown](https://github.com/remarkjs/react-markdown) and [simplemde](https://github.com/sparksuite/simplemde-markdown-editor) - Markdown editor and markdown renderer for the CMS\n[@emotion/css](https://emotion.sh/docs/introduction) - A great CSS in JS library\n[@openzeppelin/contracts](https://github.com/OpenZeppelin/openzeppelin-contracts) - Open source implementations of useful smart contract standards and functionality\n\nNext, we'll initialize the local smart contract development environment.\n\n```sh\nnpx hardhat\n\n? What do you want to do? Create a basic sample project\n? Hardhat project root: <Choose default path>\n```\n\n> If you get an error referencing your __README.md__, delete __README.md__ and run `npx hardhat` again.\n\nThis should scaffold out the basic Solidity development environment that we will use. You should see a few new files and folders created, including __contracts__, __scripts__, __test__, and __hardhat.config.js__.\n\nNext, let's update the hardhat configuration at __hardhat.config.js__.\n\nUpdate this file with the following code:\n\n```javascript\nrequire(\"@nomiclabs/hardhat-waffle\");\n\nmodule.exports = {\n  solidity: \"0.8.4\",\n  networks: {\n    hardhat: {\n      chainId: 1337\n    },\n    // mumbai: {\n    //   url: \"https://rpc-mumbai.matic.today\",\n    //   accounts: [process.env.pk]\n    // },\n    // polygon: {\n    //   url: \"https://polygon-rpc.com/\",\n    //   accounts: [process.env.pk]\n    // }\n  }\n};\n```\n\nHere, we've configured the local hardhat development environment as well as set up (and commented out) the Polygon mainnet and Mumbai testnet environments that we'll be using to deploy to Polygon.\n\nNext, let's add some basic global CSS that we'll be needing to style the markdown editor for the CMS.\n\nOpen __styles/globals.css__ and add the following code below the existing css:\n\n```css\n.EasyMDEContainer .editor-toolbar {\n  border: none;\n}\n\n.EasyMDEContainer .CodeMirror {\n  border: none !important;\n  background: none;\n}\n\n.editor-preview {\n  background-color: white !important;\n}\n\n.CodeMirror .cm-spell-error:not(.cm-url):not(.cm-comment):not(.cm-tag):not(.cm-word) {\n  background-color: transparent !important;\n}\n\npre {\n  padding: 20px;\n  background-color: #efefef;\n}\n\nblockquote {\n  border-left: 5px solid #ddd;\n  padding-left: 20px;\n  margin-left: 0px;\n}\n```\n\nNext, we'll create a couple of __SVG__ files for the app images, one for the logo and one as an arrow button.\n\nCreate __[logo.svg](https://gist.github.com/dabit3/28ab34ed85b1b1036d9b28c03fa6361b?short_path=0f62324)__ and __[right-arrow.svg](https://gist.github.com/dabit3/06cefe57313c22082a2836065a9ec25e?short_path=6b7ad37)__ in the __public__ folder and copy the linked SVG code into each of those files.\n\n## The smart contract\n\nNext, let's create the smart contract that will be powering our blog and CMS.\n\nCreate a new file in the __contracts__ folder named __Blog.sol__.\n\nHere, add the following code:\n\n```solidity\n// contracts/Blog.sol\n//SPDX-License-Identifier: Unlicense\npragma solidity ^0.8.0;\n\nimport \"hardhat/console.sol\";\nimport \"@openzeppelin/contracts/utils/Counters.sol\";\n\ncontract Blog {\n    string public name;\n    address public owner;\n\n    using Counters for Counters.Counter;\n    Counters.Counter private _postIds;\n\n    struct Post {\n      uint id;\n      string title;\n      string content;\n      bool published;\n    }\n    /* mappings can be seen as hash tables */\n    /* here we create lookups for posts by id and posts by ipfs hash */\n    mapping(uint => Post) private idToPost;\n    mapping(string => Post) private hashToPost;\n\n    /* events facilitate communication between smart contractsand their user interfaces  */\n    /* i.e. we can create listeners for events in the client and also use them in The Graph  */\n    event PostCreated(uint id, string title, string hash);\n    event PostUpdated(uint id, string title, string hash, bool published);\n\n    /* when the blog is deployed, give it a name */\n    /* also set the creator as the owner of the contract */\n    constructor(string memory _name) {\n        console.log(\"Deploying Blog with name:\", _name);\n        name = _name;\n        owner = msg.sender;\n    }\n\n    /* updates the blog name */\n    function updateName(string memory _name) public {\n        name = _name;\n    }\n\n    /* transfers ownership of the contract to another address */\n    function transferOwnership(address newOwner) public onlyOwner {\n        owner = newOwner;\n    }\n\n    /* fetches an individual post by the content hash */\n    function fetchPost(string memory hash) public view returns(Post memory){\n      return hashToPost[hash];\n    }\n\n    /* creates a new post */\n    function createPost(string memory title, string memory hash) public onlyOwner {\n        _postIds.increment();\n        uint postId = _postIds.current();\n        Post storage post = idToPost[postId];\n        post.id = postId;\n        post.title = title;\n        post.published = true;\n        post.content = hash;\n        hashToPost[hash] = post;\n        emit PostCreated(postId, title, hash);\n    }\n\n    /* updates an existing post */\n    function updatePost(uint postId, string memory title, string memory hash, bool published) public onlyOwner {\n        Post storage post =  idToPost[postId];\n        post.title = title;\n        post.published = published;\n        post.content = hash;\n        idToPost[postId] = post;\n        hashToPost[hash] = post;\n        emit PostUpdated(post.id, title, hash, published);\n    }\n\n    /* fetches all posts */\n    function fetchPosts() public view returns (Post[] memory) {\n        uint itemCount = _postIds.current();\n\n        Post[] memory posts = new Post[](itemCount);\n        for (uint i = 0; i < itemCount; i++) {\n            uint currentId = i + 1;\n            Post storage currentItem = idToPost[currentId];\n            posts[i] = currentItem;\n        }\n        return posts;\n    }\n\n    /* this modifier means only the contract owner can */\n    /* invoke the function */\n    modifier onlyOwner() {\n      require(msg.sender == owner);\n    _;\n  }\n}\n```\n\nThis contract allows the owner to create and edit posts, and for anyone to fetch posts.\n\n> To make this smart contract permissionless, you could remove the `onlyOwner` modifier and use [The Graph](https://thegraph.com/en/) to index and query posts by owner.\n\nNext, let's write a basic test to test out the most important functionality we'll be using.\n\nTo do so, open __test/sample-test.js__ and update it with the following code:\n\n```javascript\nconst { expect } = require(\"chai\")\nconst { ethers } = require(\"hardhat\")\n\ndescribe(\"Blog\", async function () {\n  it(\"Should create a post\", async function () {\n    const Blog = await ethers.getContractFactory(\"Blog\")\n    const blog = await Blog.deploy(\"My blog\")\n    await blog.deployed()\n    await blog.createPost(\"My first post\", \"12345\")\n\n    const posts = await blog.fetchPosts()\n    expect(posts[0].title).to.equal(\"My first post\")\n  })\n\n  it(\"Should edit a post\", async function () {\n    const Blog = await ethers.getContractFactory(\"Blog\")\n    const blog = await Blog.deploy(\"My blog\")\n    await blog.deployed()\n    await blog.createPost(\"My Second post\", \"12345\")\n    \n    await blog.updatePost(1, \"My updated post\", \"23456\", true)\n\n    posts = await blog.fetchPosts()\n    expect(posts[0].title).to.equal(\"My updated post\")\n  })\n\n  it(\"Should add update the name\", async function () {\n    const Blog = await ethers.getContractFactory(\"Blog\")\n    const blog = await Blog.deploy(\"My blog\")\n    await blog.deployed()\n\n    expect(await blog.name()).to.equal(\"My blog\")\n    await blog.updateName('My new blog')\n    expect(await blog.name()).to.equal(\"My new blog\")\n  })\n})\n```\n\nNext, run the test by opening your terminal and running this command:\n\n```sh\nnpx hardhat test\n```\n\n## Deploying the contract\n\nNow that the contract has been written and tested, let's try to deploy it to a local test network.\n\nTo start the local network, open your terminal at least two separate windows. In one window, run the following script:\n\n```sh\nnpx hardhat node\n```\n\nWhen we run this command, you should see a list of addresses and private keys.\n\n![accounts](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x4oxdb5n7cucibup6l2z.jpeg)\n\nThese are 20 test accounts and addresses created for us that we can use to deploy and test our smart contracts. Each account is also loaded up with 10,000 fake Ether. In a moment, we'll learn how to import the test account into MetaMask so that we can use it.\n\nNext, we need to deploy the contract to the test network. First update the name of __scripts/sample-script.js__ to __scripts/deploy.js__.\n\nNext, update the file with this new deploy script:\n\n```javascript\n/* scripts/deploy.js */\nconst hre = require(\"hardhat\");\nconst fs = require('fs');\n\nasync function main() {\n  /* these two lines deploy the contract to the network */\n  const Blog = await hre.ethers.getContractFactory(\"Blog\");\n  const blog = await Blog.deploy(\"My blog\");\n\n  await blog.deployed();\n  console.log(\"Blog deployed to:\", blog.address);\n  \n  /* this code writes the contract addresses to a local */\n  /* file named config.js that we can use in the app */\n  fs.writeFileSync('./config.js', `\n  export const contractAddress = \"${blog.address}\"\n  export const ownerAddress = \"${blog.signer.address}\"\n  `)\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(error);\n    process.exit(1);\n  });\n\n```\n\nNow in a separate window (while the local network is still running) we can run the deploy script and give a flag to the CLI that we would like to deploy to our local network:\n\n```sh\nnpx hardhat run scripts/deploy.js --network localhost\n```\n\nWhen the contract is deployed, you should see some output in your network terminal 🎉.\n\n### Importing the test account into your wallet\n\nTo send transactions to the smart contract, we will need to connect our MetaMask wallet using one of the accounts created when we ran `npx hardhat node`. In the list of contracts that the CLI logs out, you should see both an __Account number__ as well as a __Private Key__:\n\n```bash\n➜  react-dapp git:(main) npx hardhat node\nStarted HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/\n\nAccounts\n========\nAccount #0: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 (10000 ETH)\nPrivate Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80\n\n...\n```\n\nWe can import this account into MetaMask in order to start using some of the fake Eth available there.\n\nTo do so, first open MetaMask and enable __test networks__:\n\n![Test Networks](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/06d5xd3h04th44q8plny.png)\n\nNext, update the network to be Localhost 8545:\n\n![Choose network](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo46g1vi1183hsixq1op.png)\n\nNext, in MetaMask click on __Import Account__ from the accounts menu:\n\n![Import account](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/96qsky18d9pb964u2udc.png)\n\nCopy then paste the very first __Private Key__ logged out by the CLI and click __Import__. Once the account is imported, you should see the Eth in the account:\n\n![Imported account](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/imccr6kdjhwwvvmbcw4f.jpg)\n\n> __Be sure you imported the first account in the list of accounts (Account #0) as this will be the account used by default when the contract is deployed and therefore the contract owner.__\n\nNow that we have a smart contract deployed and an account ready to use, we can start interacting with it from the Next.js app.\n\n## The Next.js app\n\nNext, let's write the code for the app.\n\nThe first thing we'll do is set up a couple of environment variables that we'll use to switch between a local testing environment, Mumbai testnet, and Polygon mainnet.\n\nCreate a new file named __.env.local__ in the root of your project and add the following configuration to start with:\n\n```\nENVIRONMENT=\"local\"\nNEXT_PUBLIC_ENVIRONMENT=\"local\"\n```\n\nWe will be able to switch these variables between `local`, `testnet`, and `mainnet` to switch between \n\nThis will allow us to reference our environment both on the client as well as the server. To learn more about how environment variables work in Next.js, check out the documentation [here](https://nextjs.org/docs/basic-features/environment-variables).\n\n### context.js \n\nNext, let's create the app [context](https://reactjs.org/docs/context.html). Context will give us an easy way to share state throughout the app.\n\nCreate a file named __context.js__ and add the following code:\n\n```javascript\nimport { createContext } from 'react'\n\nexport const AccountContext = createContext(null)\n```\n\n### Layout and Nav\n\nNext, let's open up __pages/\\_app.js__. Here we will update the code to include navigation, wallet connection, context, and some basic styling.\n\nThis page serves as a wrapper or layout for the rest of the app.\n\n```javascript\n/* pages/__app.js */\nimport '../styles/globals.css'\nimport { useState } from 'react'\nimport Link from 'next/link'\nimport { css } from '@emotion/css'\nimport { ethers } from 'ethers'\nimport Web3Modal from 'web3modal'\nimport WalletConnectProvider from '@walletconnect/web3-provider'\nimport { AccountContext } from '../context.js'\nimport { ownerAddress } from '../config'\nimport 'easymde/dist/easymde.min.css'\n\nfunction MyApp({ Component, pageProps }) {\n  /* create local state to save account information after signin */\n  const [account, setAccount] = useState(null)\n  /* web3Modal configuration for enabling wallet access */\n  async function getWeb3Modal() {\n    const web3Modal = new Web3Modal({\n      cacheProvider: false,\n      providerOptions: {\n        walletconnect: {\n          package: WalletConnectProvider,\n          options: { \n            infuraId: \"your-infura-id\"\n          },\n        },\n      },\n    })\n    return web3Modal\n  }\n\n  /* the connect function uses web3 modal to connect to the user's wallet */\n  async function connect() {\n    try {\n      const web3Modal = await getWeb3Modal()\n      const connection = await web3Modal.connect()\n      const provider = new ethers.providers.Web3Provider(connection)\n      const accounts = await provider.listAccounts()\n      setAccount(accounts[0])\n    } catch (err) {\n      console.log('error:', err)\n    }\n  }\n\n  return (\n    <div>\n      <nav className={nav}>\n        <div className={header}>\n          <Link href=\"/\">\n            <a>\n              <img\n                src='/logo.svg'\n                alt=\"React Logo\"\n                style={{ width: '50px' }}\n              />\n            </a>\n          </Link>\n          <Link href=\"/\">\n            <a>\n              <div className={titleContainer}>\n                <h2 className={title}>Full Stack</h2>\n                <p className={description}>WEB3</p>\n              </div>\n            </a>\n          </Link>\n          {\n            !account && (\n              <div className={buttonContainer}>\n                <button className={buttonStyle} onClick={connect}>Connect</button>\n              </div>\n            )\n          }\n          {\n            account && <p className={accountInfo}>{account}</p>\n          }\n        </div>\n        <div className={linkContainer}>\n          <Link href=\"/\" >\n            <a className={link}>\n              Home\n            </a>\n          </Link>\n          {\n            /* if the signed in user is the contract owner, we */\n            /* show the nav link to create a new post */\n            (account === ownerAddress) && (\n              <Link href=\"/create-post\">\n                <a className={link}>\n                  Create Post\n                </a>\n              </Link>\n            )\n          }\n        </div>\n      </nav>\n      <div className={container}>\n        <AccountContext.Provider value={account}>\n          <Component {...pageProps} connect={connect} />\n        </AccountContext.Provider>\n      </div>\n    </div>\n  )\n}\n\nconst accountInfo = css`\n  width: 100%;\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n  font-size: 12px;\n`\n\nconst container = css`\n  padding: 40px;\n`\n\nconst linkContainer = css`\n  padding: 30px 60px;\n  background-color: #fafafa;\n`\n\nconst nav = css`\n  background-color: white;\n`\n\nconst header = css`\n  display: flex;\n  border-bottom: 1px solid rgba(0, 0, 0, .075);\n  padding: 20px 30px;\n`\n\nconst description = css`\n  margin: 0;\n  color: #999999;\n`\n\nconst titleContainer = css`\n  display: flex;\n  flex-direction: column;\n  padding-left: 15px;\n`\n\nconst title = css`\n  margin-left: 30px;\n  font-weight: 500;\n  margin: 0;\n`\n\nconst buttonContainer = css`\n  width: 100%;\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n`\n\nconst buttonStyle = css`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  font-size: 18px;\n  padding: 16px 70px;\n  border-radius: 15px;\n  cursor: pointer;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`\n\nconst link = css`\n  margin: 0px 40px 0px 0px;\n  font-size: 16px;\n  font-weight: 400;\n`\n\nexport default MyApp\n```\n\n### Entrypoint\n\nNow that we have the layout set up, let' create the entrypoint to the app.\n\nThis page will fetch the list of posts from the network and render the post titles in a listview. When the user clicks on a post, we will navigate them to another page for a detail view (page will be created next).\n\n```javascript\n/* pages/index.js */\nimport { css } from '@emotion/css'\nimport { useContext } from 'react'\nimport { useRouter } from 'next/router'\nimport { ethers } from 'ethers'\nimport Link from 'next/link'\nimport { AccountContext } from '../context'\n\n/* import contract address and contract owner address */\nimport {\n  contractAddress, ownerAddress\n} from '../config'\n\n/* import Application Binary Interface (ABI) */\nimport Blog from '../artifacts/contracts/Blog.sol/Blog.json'\n\nexport default function Home(props) {\n  /* posts are fetched server side and passed in as props */\n  /* see getServerSideProps */\n  const { posts } = props\n  const account = useContext(AccountContext)\n\n  const router = useRouter()\n  async function navigate() {\n    router.push('/create-post')\n  }\n\n  return (\n    <div>\n      <div className={postList}>\n        {\n          /* map over the posts array and render a button with the post title */\n          posts.map((post, index) => (\n            <Link href={`/post/${post[2]}`} key={index}>\n              <a>\n                <div className={linkStyle}>\n                  <p className={postTitle}>{post[1]}</p>\n                  <div className={arrowContainer}>\n                  <img\n                      src='/right-arrow.svg'\n                      alt='Right arrow'\n                      className={smallArrow}\n                    />\n                  </div>\n                </div>\n              </a>\n            </Link>\n          ))\n        }\n      </div>\n      <div className={container}>\n        {\n          (account === ownerAddress) && posts && !posts.length && (\n            /* if the signed in user is the account owner, render a button */\n            /* to create the first post */\n            <button className={buttonStyle} onClick={navigate}>\n              Create your first post\n              <img\n                src='/right-arrow.svg'\n                alt='Right arrow'\n                className={arrow}\n              />\n            </button>\n          )\n        }\n      </div>\n    </div>\n  )\n}\n\nexport async function getServerSideProps() {\n  /* here we check to see the current environment variable */\n  /* and render a provider based on the environment we're in */\n  let provider\n  if (process.env.ENVIRONMENT === 'local') {\n    provider = new ethers.providers.JsonRpcProvider()\n  } else if (process.env.ENVIRONMENT === 'testnet') {\n    provider = new ethers.providers.JsonRpcProvider('https://rpc-mumbai.matic.today')\n  } else {\n    provider = new ethers.providers.JsonRpcProvider('https://polygon-rpc.com/')\n  }\n\n  const contract = new ethers.Contract(contractAddress, Blog.abi, provider)\n  const data = await contract.fetchPosts()\n  return {\n    props: {\n      posts: JSON.parse(JSON.stringify(data))\n    }\n  }\n}\n\nconst arrowContainer = css`\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n  padding-right: 20px;\n`\n\nconst postTitle = css`\n  font-size: 30px;\n  font-weight: bold;\n  cursor: pointer;\n  margin: 0;\n  padding: 20px;\n`\n\nconst linkStyle = css`\n  border: 1px solid #ddd;\n  margin-top: 20px;\n  border-radius: 8px;\n  display: flex;\n`\n\nconst postList = css`\n  width: 700px;\n  margin: 0 auto;\n  padding-top: 50px;  \n`\n\nconst container = css`\n  display: flex;\n  justify-content: center;\n`\n\nconst buttonStyle = css`\n  margin-top: 100px;\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  font-size: 44px;\n  padding: 20px 70px;\n  border-radius: 15px;\n  cursor: pointer;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`\n\nconst arrow = css`\n  width: 35px;\n  margin-left: 30px;\n`\n\nconst smallArrow = css`\n  width: 25px;\n`\n```\n\n### Creating posts\n\nNext, create a new file in the __pages__ directory named __create-post.js__.\n\nThis will hold the route that will allow us to create posts and save them to the network.\n\nWe'll also have the option to upload and save a cover image to IPFS, with the hash of the ipfs upload anchored on chain with the rest of the most data.\n\nAdd the following code to this file:\n\n```javascript\n/* pages/create-post.js */\nimport { useState, useRef, useEffect } from 'react' // new\nimport { useRouter } from 'next/router'\nimport dynamic from 'next/dynamic'\nimport { css } from '@emotion/css'\nimport { ethers } from 'ethers'\nimport { create } from 'ipfs-http-client'\n\n/* import contract address and contract owner address */\nimport {\n  contractAddress\n} from '../config'\n\nimport Blog from '../artifacts/contracts/Blog.sol/Blog.json'\n\n/* define the ipfs endpoint */\nconst client = create('https://ipfs.infura.io:5001/api/v0')\n\n/* configure the markdown editor to be client-side import */\nconst SimpleMDE = dynamic(\n  () => import('react-simplemde-editor'),\n  { ssr: false }\n)\n\nconst initialState = { title: '', content: '' }\n\nfunction CreatePost() {\n  /* configure initial state to be used in the component */\n  const [post, setPost] = useState(initialState)\n  const [image, setImage] = useState(null)\n  const [loaded, setLoaded] = useState(false)\n\n  const fileRef = useRef(null)\n  const { title, content } = post\n  const router = useRouter()\n\n  useEffect(() => {\n    setTimeout(() => {\n      /* delay rendering buttons until dynamic import is complete */\n      setLoaded(true)\n    }, 500)\n  }, [])\n\n  function onChange(e) {\n    setPost(() => ({ ...post, [e.target.name]: e.target.value }))\n  }\n\n  async function createNewPost() {   \n    /* saves post to ipfs then anchors to smart contract */\n    if (!title || !content) return\n    const hash = await savePostToIpfs()\n    await savePost(hash)\n    router.push(`/`)\n  }\n\n  async function savePostToIpfs() {\n    /* save post metadata to ipfs */\n    try {\n      const added = await client.add(JSON.stringify(post))\n      return added.path\n    } catch (err) {\n      console.log('error: ', err)\n    }\n  }\n  \n  async function savePost(hash) {\n    /* anchor post to smart contract */\n    if (typeof window.ethereum !== 'undefined') {\n      const provider = new ethers.providers.Web3Provider(window.ethereum)\n      const signer = provider.getSigner()\n      const contract = new ethers.Contract(contractAddress, Blog.abi, signer)\n      console.log('contract: ', contract)\n      try {\n        const val = await contract.createPost(post.title, hash)\n        /* optional - wait for transaction to be confirmed before rerouting */\n        /* await provider.waitForTransaction(val.hash) */\n        console.log('val: ', val)\n      } catch (err) {\n        console.log('Error: ', err)\n      }\n    }    \n  }\n\n  function triggerOnChange() {\n    /* trigger handleFileChange handler of hidden file input */\n    fileRef.current.click()\n  }\n\n  async function handleFileChange (e) {\n    /* upload cover image to ipfs and save hash to state */\n    const uploadedFile = e.target.files[0]\n    if (!uploadedFile) return\n    const added = await client.add(uploadedFile)\n    setPost(state => ({ ...state, coverImage: added.path }))\n    setImage(uploadedFile)\n  }\n\n  return (\n    <div className={container}>\n      {\n        image && (\n          <img className={coverImageStyle} src={URL.createObjectURL(image)} />\n        )\n      }\n      <input\n        onChange={onChange}\n        name='title'\n        placeholder='Give it a title ...'\n        value={post.title}\n        className={titleStyle}\n      />\n      <SimpleMDE\n        className={mdEditor}\n        placeholder=\"What's on your mind?\"\n        value={post.content}\n        onChange={value => setPost({ ...post, content: value })}\n      />\n      {\n        loaded && (\n          <>\n            <button\n              className={button}\n              type='button'\n              onClick={createNewPost}\n            >Publish</button>\n            <button\n              onClick={triggerOnChange}\n              className={button}\n            >Add cover image</button>\n          </>\n        )\n      }\n      <input\n        id='selectImage'\n        className={hiddenInput} \n        type='file'\n        onChange={handleFileChange}\n        ref={fileRef}\n      />\n    </div>\n  )\n}\n\nconst hiddenInput = css`\n  display: none;\n`\n\nconst coverImageStyle = css`\n  max-width: 800px;\n`\n\nconst mdEditor = css`\n  margin-top: 40px;\n`\n\nconst titleStyle = css`\n  margin-top: 40px;\n  border: none;\n  outline: none;\n  background-color: inherit;\n  font-size: 44px;\n  font-weight: 600;\n  &::placeholder {\n    color: #999999;\n  }\n`\n\nconst container = css`\n  width: 800px;\n  margin: 0 auto;\n`\n\nconst button = css`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  border-radius: 15px;\n  cursor: pointer;\n  margin-right: 10px;\n  font-size: 18px;\n  padding: 16px 70px;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`\n\nexport default CreatePost\n```\n\n### Viewing a post\n\nNow that we have the ability to create posts, how do we navigate and view posts? We want to have the ability to view a post in a route that looks something like `myapp.com/post/some-post-id`.\n\nWe can do this in a couple of different ways with [next.js dynamic routes](https://nextjs.org/docs/routing/dynamic-routes).\n\nWe will be leveraging server-side data fetching using [getStaticPaths](https://nextjs.org/docs/basic-features/data-fetching/get-static-paths) and [getStaticProps](https://nextjs.org/docs/basic-features/data-fetching/get-static-props) which will create these pages at build time using the array of posts queried from the network.\n\nTo make this happen, create a new folder in the __pages__ directory named __post__ and a file in that folder named __[id].js__. There, add the following code:\n\n```javascript\n/* pages/post/[id].js */\nimport ReactMarkdown from 'react-markdown'\nimport { useContext } from 'react'\nimport { useRouter } from 'next/router'\nimport Link from 'next/link'\nimport { css } from '@emotion/css'\nimport { ethers } from 'ethers'\nimport { AccountContext } from '../../context'\n\n/* import contract and owner addresses */\nimport {\n  contractAddress, ownerAddress\n} from '../../config'\nimport Blog from '../../artifacts/contracts/Blog.sol/Blog.json'\n\nconst ipfsURI = 'https://ipfs.io/ipfs/'\n\nexport default function Post({ post }) {\n  const account = useContext(AccountContext)\n  const router = useRouter()\n  const { id } = router.query\n\n  if (router.isFallback) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <div>\n      {\n        post && (\n          <div className={container}>\n            {\n              /* if the owner is the user, render an edit button */\n              ownerAddress === account && (\n                <div className={editPost}>\n                  <Link href={`/edit-post/${id}`}>\n                    <a>\n                      Edit post\n                    </a>\n                  </Link>\n                </div>\n              )\n            }\n            {\n              /* if the post has a cover image, render it */\n              post.coverImage && (\n                <img\n                  src={post.coverImage}\n                  className={coverImageStyle}\n                />\n              )\n            }\n            <h1>{post.title}</h1>\n            <div className={contentContainer}>\n              <ReactMarkdown>{post.content}</ReactMarkdown>\n            </div>\n          </div>\n        )\n      }\n    </div>\n  )\n}\n\nexport async function getStaticPaths() {\n  /* here we fetch the posts from the network */\n  let provider\n  if (process.env.ENVIRONMENT === 'local') {\n    provider = new ethers.providers.JsonRpcProvider()\n  } else if (process.env.ENVIRONMENT === 'testnet') {\n    provider = new ethers.providers.JsonRpcProvider('https://rpc-mumbai.matic.today')\n  } else {\n    provider = new ethers.providers.JsonRpcProvider('https://polygon-rpc.com/')\n  }\n\n  const contract = new ethers.Contract(contractAddress, Blog.abi, provider)\n  const data = await contract.fetchPosts()\n\n  /* then we map over the posts and create a params object passing */\n  /* the id property to getStaticProps which will run for ever post */\n  /* in the array and generate a new page */\n  const paths = data.map(d => ({ params: { id: d[2] } }))\n\n  return {\n    paths,\n    fallback: true\n  }\n}\n\nexport async function getStaticProps({ params }) {\n  /* using the id property passed in through the params object */\n  /* we can us it to fetch the data from IPFS and pass the */\n  /* post data into the page as props */\n  const { id } = params\n  const ipfsUrl = `${ipfsURI}/${id}`\n  const response = await fetch(ipfsUrl)\n  const data = await response.json()\n  if(data.coverImage) {\n    let coverImage = `${ipfsURI}/${data.coverImage}`\n    data.coverImage = coverImage\n  }\n\n  return {\n    props: {\n      post: data\n    },\n  }\n}\n\nconst editPost = css`\n  margin: 20px 0px;\n`\n\nconst coverImageStyle = css`\n  width: 900px;\n`\n\nconst container = css`\n  width: 900px;\n  margin: 0 auto;\n`\n\nconst contentContainer = css`\n  margin-top: 60px;\n  padding: 0px 40px;\n  border-left: 1px solid #e7e7e7;\n  border-right: 1px solid #e7e7e7;\n  & img {\n    max-width: 900px;\n  }\n`\n```\n\n### Editing a post\n\nThe final page we need to create is a way to edit existing posts.\n\nThis page will carry over some functionality from both __pages/create-post.js__ as well as __pages/post/[id].js__. We will be able to toggle between viewing and editing a post.\n\nCreate a new folder in the __pages__ directory named __edit-post__ and a file named __[id].js__ there. Next, add the following code:\n\n```javascript\n/* pages/edit-post/[id].js */\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/router'\nimport ReactMarkdown from 'react-markdown'\nimport { css } from '@emotion/css'\nimport dynamic from 'next/dynamic'\nimport { ethers } from 'ethers'\nimport { create } from 'ipfs-http-client'\n\nimport {\n  contractAddress\n} from '../../config'\nimport Blog from '../../artifacts/contracts/Blog.sol/Blog.json'\n\nconst ipfsURI = 'https://ipfs.io/ipfs/'\nconst client = create('https://ipfs.infura.io:5001/api/v0')\n\nconst SimpleMDE = dynamic(\n  () => import('react-simplemde-editor'),\n  { ssr: false }\n)\n\nexport default function Post() {\n  const [post, setPost] = useState(null)\n  const [editing, setEditing] = useState(true)\n  const router = useRouter()\n  const { id } = router.query\n\n  useEffect(() => {\n    fetchPost()\n  }, [id])\n  async function fetchPost() {\n    /* we first fetch the individual post by ipfs hash from the network */\n    if (!id) return\n    let provider\n    if (process.env.NEXT_PUBLIC_ENVIRONMENT === 'local') {\n      provider = new ethers.providers.JsonRpcProvider()\n    } else if (process.env.NEXT_PUBLIC_ENVIRONMENT === 'testnet') {\n      provider = new ethers.providers.JsonRpcProvider('https://rpc-mumbai.matic.today')\n    } else {\n      provider = new ethers.providers.JsonRpcProvider('https://polygon-rpc.com/')\n    }\n    const contract = new ethers.Contract(contractAddress, Blog.abi, provider)\n    const val = await contract.fetchPost(id)\n    const postId = val[0].toNumber()\n\n    /* next we fetch the IPFS metadata from the network */\n    const ipfsUrl = `${ipfsURI}/${id}`\n    const response = await fetch(ipfsUrl)\n    const data = await response.json()\n    if(data.coverImage) {\n      let coverImagePath = `${ipfsURI}/${data.coverImage}`\n      data.coverImagePath = coverImagePath\n    }\n    /* finally we append the post ID to the post data */\n    /* we need this ID to make updates to the post */\n    data.id = postId;\n    setPost(data)\n  }\n\n  async function savePostToIpfs() {\n    try {\n      const added = await client.add(JSON.stringify(post))\n      return added.path\n    } catch (err) {\n      console.log('error: ', err)\n    }\n  }\n\n  async function updatePost() {\n    const hash = await savePostToIpfs()\n    const provider = new ethers.providers.Web3Provider(window.ethereum)\n    const signer = provider.getSigner()\n    const contract = new ethers.Contract(contractAddress, Blog.abi, signer)\n    await contract.updatePost(post.id, post.title, hash, true)\n    router.push('/')\n  }\n  \n  if (!post) return null\n\n  return (\n    <div className={container}>\n      {\n      /* editing state will allow the user to toggle between */\n      /*  a markdown editor and a markdown renderer */\n      }\n      {\n        editing && (\n          <div>\n            <input\n              onChange={e => setPost({ ...post, title: e.target.value })}\n              name='title'\n              placeholder='Give it a title ...'\n              value={post.title}\n              className={titleStyle}\n            />\n            <SimpleMDE\n              className={mdEditor}\n              placeholder=\"What's on your mind?\"\n              value={post.content}\n              onChange={value => setPost({ ...post, content: value })}\n            />\n            <button className={button} onClick={updatePost}>Update post</button>\n          </div>\n        )\n      }\n      {\n        !editing && (\n          <div>\n            {\n              post.coverImagePath && (\n                <img\n                  src={post.coverImagePath}\n                  className={coverImageStyle}\n                />\n              )\n            }\n            <h1>{post.title}</h1>\n            <div className={contentContainer}>\n              <ReactMarkdown>{post.content}</ReactMarkdown>\n            </div>\n          </div>\n        )\n      }\n      <button className={button} onClick={() => setEditing(editing ? false : true)}>{ editing ? 'View post' : 'Edit post'}</button>\n    </div>\n  )\n}\n\nconst button = css`\n  background-color: #fafafa;\n  outline: none;\n  border: none;\n  border-radius: 15px;\n  cursor: pointer;\n  margin-right: 10px;\n  margin-top: 15px;\n  font-size: 18px;\n  padding: 16px 70px;\n  box-shadow: 7px 7px rgba(0, 0, 0, .1);\n`\n\nconst titleStyle = css`\n  margin-top: 40px;\n  border: none;\n  outline: none;\n  background-color: inherit;\n  font-size: 44px;\n  font-weight: 600;\n  &::placeholder {\n    color: #999999;\n  }\n`\n\nconst mdEditor = css`\n  margin-top: 40px;\n`\n\nconst coverImageStyle = css`\n  width: 900px;\n`\n\nconst container = css`\n  width: 900px;\n  margin: 0 auto;\n`\n\nconst contentContainer = css`\n  margin-top: 60px;\n  padding: 0px 40px;\n  border-left: 1px solid #e7e7e7;\n  border-right: 1px solid #e7e7e7;\n  & img {\n    max-width: 900px;\n  }\n`\n```\n\n### Testing it out\n\nWe can now test it out.\n\nTo do so, be sure you have already deployed the contract to the network in the previous steps and you still have the local network running.\n\nOpen a new terminal window and start the Next.js app:\n\n```sh\nnpm run dev\n```\n\nWhen the app starts, you should be able to connect your wallet and interact with the app.\n\n![Homepage](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uaiouakr4b062x53lecp.jpg)\n\nYou should also be able to create a new post.\n\n![Create a post](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c41ztmvvzgvlbjb9r0ib.jpg)\n\nYou may notice that the app is not as fast as it could be, but Next.js is blazingly fast in production. \n\nTo run a production build, run the following commands:\n\n```sh\nnpm run build && npm start\n```\n\n## Deploying to Polygon\n\nNow that we have the project up and running and tested locally, let's deploy to Polygon. We'll start by deploying to [Mumbai](https://docs.polygon.technology/docs/develop/network-details/network/), the Polygon test network.\n\nThe first thing we will need to do is set one of our __private keys__ from our wallet as an environment variable.\n\nTo get a private key, you can export them directly from MetaMask.\n\n![Private keys](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zyd4cs7f3czfwyeh5513.png)\n\n> Private keys are never meant to be shared publicly under any circumstance. It is advised never to hardcode a private key in a file. If you do choose to do so, be sure to use a testing wallet and to never under any circumstances push a file containing a private key to source control or expose it publicly.\n\nIf you are on a Mac, you can set an environment variable from the command line like so (be sure to run the deploy script from this same terminal and session):\n\n```sh\nexport pk=\"your-private-key\"\n```\n\n### Configuring the network\n\nNext, we need to switch from the local test network to the [Mumbai Testnet](https://docs.polygon.technology/docs/develop/network-details/network/).\n\nTo do so, we need to create and set the network configuration.\n\nFirst, open MetaMask and click on __Settings__.\n\n![MetaMask settings](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/175kmqy9dp4uw94sk14l.png)\n\nNext, click on __Networks__ and then __Add Network__:\n\n![New Network](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d762mh6l545ce9hexugf.png)\n\nHere, we will add the following configurations for the Mumbai test network as listed [here](https://docs.polygon.technology/docs/develop/network-details/network/):\n\nNetwork Name: __Mumbai TestNet__\nNew RPC URL: __https://rpc-mumbai.matic.today__\nChain ID: __80001__\nCurrency Symbol: __Matic__\n\nSave this, then you should be able to switch to and use the new network!\n\nFinally, you will need some testnet Polygon tokens in order to interact with the applications.\n\nTo get these, you can visit the [Polygon Faucet](https://faucet.polygon.technology/), inputting the address of the wallets that you would like to request the tokens.\n\n### Deploying to the Polygon network\n\nNow that you have some tokens, you can deploy to the Polygon network!\n\nTo do so, be sure that the address associated with the private key you are deploying your contract with has received some tokens in order to pay the gas fees for the transaction.\n\nNext, uncomment the `mumbai` configuration in hardhat.config.js:\n\n```javascript\nmumbai: {\n  url: \"https://rpc-mumbai.matic.today\",\n  accounts: [process.env.pk]\n},\n```\n\nTo deploy to Polygon testnet, run the following command:\n\n```sh\nnpx hardhat run scripts/deploy.js --network mumbai\n```\n\n> If you run into this error: `ProviderError: RPCError`, the public RPC may be congested. In production, it's recommended to use an RPC provider like [Infura](https://infura.io/), [Alchemy](https://www.alchemy.com/), or [Quicknode](https://www.quicknode.com/).\n\nNext, update the environment variables in __.env.local__ to be `testnet`:\n\n```\nENVIRONMENT=\"testnet\"\nNEXT_PUBLIC_ENVIRONMENT=\"testnet\"\n```\n\nNext, restart the server to register the change in environment variables:\n\n```sh\nnpm run dev\n```\n\nYou should now be able to test the app on the new network 🎉!\n\nIf you have any issues connecting to the public Mumbai RPC endpoint, consider replacing the endpoints in your app using endpoints from an RPC provider like [Infura](https://infura.io/), [Alchemy](https://www.alchemy.com/), or [Quicknode](https://www.quicknode.com/).\n\n## Creating a subgraph API\n\nBy default the only data access patterns we have are the two functions we've written into the contract, `fetchPost` and `fetchPosts`.\n\nThis is a fine place to start, but as your app starts to scale you'll probably find yourself needing a more flexible and scalable API.\n\nFor instance, what if we wanted to give the user the ability to search posts, fetch posts created by a certain user, or to sort posts by the date which they were created?\n\nWe can build all of this functionality into an API by using [The Graph](https://thegraph.com/en/) protocol. Let's see how to do this.\n\n### Creating the project in The Graph\n\nTo get started, visit [The Graph hosted service](https://thegraph.com/explorer/dashboard) and either sign in or create a new account.\n\nNext, go to the [dashboard](https://thegraph.com/explorer/dashboard) and click on __Add Subgraph__ to create a new subgraph.\n\nConfigure your subgraph with the following properties:\n\n- Subgraph Name - __Blogcms__\n- Subtitle - __A subgraph for querying post data__\n- Optional - Fill the description and GITHUB URL properties\n\nOnce the subgraph is created, we will initialize the subgraph locally using the Graph CLI.\n\n### Initializing a new subgraph using the Graph CLI\n\nNext, install the Graph CLI:\n\n```sh\n$ npm install -g @graphprotocol/graph-cli\n\n# or\n\n$ yarn global add @graphprotocol/graph-cli\n```\n\nOnce the Graph CLI has been installed you can initialize a new subgraph with the Graph CLI `init` command.\n\nSince we've already deployed our contract to the network, we can initialize from that contract address by passing in the contract address using the `--from-contract` flag.\n\nThis address is available for reference in __config.js__ as `contractAddress`.\n\n```sh\n$ graph init --from-contract your-contract-address \\\n--network mumbai --contract-name Blog --index-events\n\n? Protocol: ethereum\n? Product for which to initialize › hosted-service\n? Subgraph name › your-username/blogcms\n? Directory to create the subgraph in › blogcms\n? Ethereum network › mumbai\n? Contract address › your-contract-address\n? ABI file (path) › artifacts/contracts/Blog.sol/Blog.json\n? Contract Name › Blog\n```\n\nThis command will generate a basic subgraph based off of the contract address passed in as the argument to `--from-contract`. By using this contract address, the CLI will initialize a few things in your project to get you started (including fetching the `abis` and saving them in the __abis__ directory).\n\n> By passing in `--index-events` the CLI will automatically populate some code for us both in __schema.graphql__ as well as __src/mapping.ts__ based on the events emitted from the contract.\n\nThe main configuration and definition for the subgraph lives in the __subgraph.yaml__ file. The subgraph codebase consists of a few files:\n\n- __subgraph.yaml__: a YAML file containing the subgraph manifest\n- __schema.graphql__: a GraphQL schema that defines what data is stored for your subgraph, and how to query it via GraphQL\n- __AssemblyScript Mappings__: AssemblyScript code that translates from the event data in Ethereum to the entities defined in your schema (e.g. mapping.ts in this tutorial)\n\nThe entries in __subgraph.yaml__ that we will be working with are:\n\n- `description` (optional): a human-readable description of what the subgraph is. This description is displayed by the Graph Explorer when the subgraph is deployed to the Hosted Service.\n- `repository` (optional): the URL of the repository where the subgraph manifest can be found. This is also displayed by the Graph Explorer.\n- `dataSources.source`: the address of the smart contract the subgraph sources, and the abi of the smart contract to use. The address is optional; omitting it allows to index matching events from all contracts.\n- `dataSources.source.startBlock` (optional): the number of the block that the data source starts indexing from. In most cases we suggest using the block in which the contract was created.\n- `dataSources.mapping.entities` : the entities that the data source writes to the store. The schema for each entity is defined in the the schema.graphql file.\n- `dataSources.mapping.abis`: one or more named ABI files for the source contract as well as any other smart contracts that you interact with from within the mappings.\n- `dataSources.mapping.eventHandlers`: lists the smart contract events this subgraph reacts to and the handlers in the mapping — __./src/mapping.ts__ in the example — that transform these events into entities in the store.\n\n### Defining the entities\n\nWith The Graph, you define entity types in __schema.graphql__, and Graph Node will generate top level fields for querying single instances and collections of that entity type. Each type that should be an entity is required to be annotated with an `@entity` directive.\n\nThe entities / data we will be indexing are the `Token` and `User`. This way we can index the Tokens created by the users as well as the users themselves.\n\nTo do this, update __schema.graphql__ with the following code:\n\n```graphql\ntype _Schema_\n  @fulltext(\n    name: \"postSearch\"\n    language: en\n    algorithm: rank\n    include: [{ entity: \"Post\", fields: [{ name: \"title\" }, { name: \"postContent\" }] }]\n  )\n\ntype Post @entity {\n  id: ID!\n  title: String!\n  contentHash: String!\n  published: Boolean!\n  postContent: String!\n  createdAtTimestamp: BigInt!\n  updatedAtTimestamp: BigInt!\n}\n```\n\nNow that we have created the GraphQL schema for our app, we can generate the entities locally to start using in the `mappings` created by the CLI:\n\n```sh\ngraph codegen\n```\n\nIn order to make working smart contracts, events and entities easy and type-safe, the Graph CLI generates AssemblyScript types from a combination of the subgraph's GraphQL schema and the contract ABIs included in the data sources.\n\n## Updating the subgraph with the entities and mappings\n\nNow we can configure the __subgraph.yaml__ to use the entities that we have just created and configure their mappings.\n\nTo do so, first update the `dataSources.mapping.entities` field with the `User` and `Token` entities:\n\n```yaml\nentities:\n  - Post\n```\n\nNext we'll need to find the block which the contract was deployed (optional). We need this so that we can set the start block for the indexer to begin syncing so that it does not need to sync from the genesis block. You can find the start block by visiting [https://mumbai.polygonscan.com/](https://mumbai.polygonscan.com/) and pasting in your contract address.\n\nFinally, update the configuration to add the `startBlock` :\n\n```yaml\nsource:\n  address: \"your-contract-adddress\"\n  abi: Blog\n  startBlock: your-start-block\n```\n\n## Assemblyscript mappings\n\nNext, open __src/mappings.ts__ to write the mappings that we defined in our subgraph subgraph `eventHandlers`.\n\nUpdate the file with the following code:\n\n```typescript\nimport {\n  PostCreated as PostCreatedEvent,\n  PostUpdated as PostUpdatedEvent\n} from \"../generated/Blog/Blog\"\nimport {\n  Post\n} from \"../generated/schema\"\nimport { ipfs, json } from '@graphprotocol/graph-ts'\n\nexport function handlePostCreated(event: PostCreatedEvent): void {\n  let post = new Post(event.params.id.toString());\n  post.title = event.params.title;\n  post.contentHash = event.params.hash;\n  let data = ipfs.cat(event.params.hash);\n  if (data) {\n    let value = json.fromBytes(data).toObject()\n    if (value) {\n      const content = value.get('content')\n      if (content) {\n        post.postContent = content.toString()\n      }\n    }\n  }\n  post.createdAtTimestamp = event.block.timestamp;\n  post.save()\n}\n\nexport function handlePostUpdated(event: PostUpdatedEvent): void {\n  let post = Post.load(event.params.id.toString());\n  if (post) {\n    post.title = event.params.title;\n    post.contentHash = event.params.hash;\n    post.published = event.params.published;\n    let data = ipfs.cat(event.params.hash);\n    if (data) {\n      let value = json.fromBytes(data).toObject()\n      if (value) {\n        const content = value.get('content')\n        if (content) {\n          post.postContent = content.toString()\n        }\n      }\n    }\n    post.updatedAtTimestamp = event.block.timestamp;\n    post.save()\n  }\n}\n```\n\nThese mappings will handle events for when a new post is created and when a post is updated. When these events fire, the mappings will save the data into the subgraph.\n\n### Running a build\n\nNext, let's run a build to make sure that everything is configured properly. To do so, run the `build` command:\n\n```sh\n$ graph build\n```\n\nIf the build is successful, you should see a new __build__ folder generated in your root directory.\n\n## Deploying the subgraph\n\nTo deploy, we can run the `deploy` command. To deploy, you will first need to copy the __Access token__ for your account, available in the [Graph Dashboard](https://thegraph.com/hosted-service/dashboard):\n\n![Graph Dashboard](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/820lwqh8yo3iyu7fsbhj.jpg)\n\nNext, run the following command:\n\n```sh\n$ graph auth\n✔ Product for which to initialize · hosted-service\n✔ Deploy key · ********************************\n```\n\nThe deploy the subgraph:\n\n```sh\n$ yarn deploy\n```\n\nOnce the subgraph is deployed, you should see it show up in your dashboard.\n\nWhen you click on the subgraph, it should open the subgraph details:\n\n![Blogcms details](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8kxjleaatn2fvgug8tsx.png)\n\n## Querying for data\n\nNow that we are in the dashboard, we should be able to start querying for data. Run the following query to get a list of posts:\n\n```graphql\n{\n  posts {\n    id\n    title\n    contentHash\n    published\n    postContent\n  }\n}\n```\n\nWe can also configure the order direction by creation date:\n\n```graphql\n{\n  posts(\n    orderBy: createdAtTimestamp\n    orderDirection: desc\n  ) {\n    id\n    title\n    contentHash\n    published\n    postContent\n  }\n}\n```\n\nWe can also do full text search on the post title or content:\n\n```graphql\n{\n  postSearch(\n    text: \"Hello\"\n  ) {\n    id\n    title\n    contentHash\n    published\n    postContent\n  }\n}\n\n```\n\nCongratulations, you have now build out a more flexible API that you can use to query your app!\n\nTo learn how to use the API endpoint in your app, check out the documentation [here](https://thegraph.com/docs/en/developer/querying-from-your-app/) or the video [here](https://www.youtube.com/watch?v=PjyKPMpahuc)\n\n## Next steps\n\nIf you'd like a challenge, consider adding some functionality that will allow you to update the cover image in __pages/edit-post/[id].js__.\n\nIf you'd like to deploy your code to a web3 / decentralized git hosting protocol, check out [this](https://www.youtube.com/watch?v=MhoRiH2podI) video on [Radicle](https://radicle.xyz/).\n\nIf you'd like to deploy your app and make it live, check out [Vercel](https://vercel.com/new).\n\nIf you enjoyed this tutorial, be sure to check out my other three comprehensive guides:\n1. [The Complete Guide to Full Stack Ethereum Development](https://dev.to/dabit3/the-complete-guide-to-full-stack-ethereum-development-3j13)\n2. [Building a Full Stack NFT Marketplace on Ethereum with Polygon\n](https://dev.to/dabit3/building-scalable-full-stack-apps-on-ethereum-with-polygon-2cfb)\n3. The Complete Guide to Full Stack Solana Development with React, Anchor, Rust, and Phantom\nhttps://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291",a.user={name:"Nader Dabit",username:n,twitter_username:n,github_username:n,website_url:"https://mmm.page/nader.main",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--aNfZvjEi--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/126437/41231eb2-054b-4417-bc35-814e491a2d5d.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--qYNR4ugk--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/126437/41231eb2-054b-4417-bc35-814e491a2d5d.jpeg"},a.organization={name:"Edge and Node",username:e,slug:e,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--XVvCNUhC--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/5310/ea8cfcbf-e2a2-463d-a7ba-cdaf565222d8.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--xi_iSmfh--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/5310/ea8cfcbf-e2a2-463d-a7ba-cdaf565222d8.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:s,state:{currentArticle:a},serverRendered:!0,routePath:"/dabit3/982888",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"dabit3",{},"https://dev.to/edge-and-node/the-complete-guide-to-full-stack-web3-development-4g74","2022-02-10T12:33:58Z","edge-and-node")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
