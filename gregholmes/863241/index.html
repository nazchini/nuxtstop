<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>SIM Card Based Mobile Authentication with Android</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>SIM Card Based Mobile Authentication with Android</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/android" class="tag" data-v-70afb46a>
          #android
        </a><a href="/nuxtstop/t/kotlin" class="tag" data-v-70afb46a>
          #kotlin
        </a><a href="/nuxtstop/t/tutorial" class="tag" data-v-70afb46a>
          #tutorial
        </a><a href="/nuxtstop/t/security" class="tag" data-v-70afb46a>
          #security
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--CSyseFV---/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fhjbpcwy82657rwuuzfw.png" alt="SIM Card Based Mobile Authentication with Android" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            25
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            1
          </span></div> <time data-v-70afb46a>Oct 14 '21</time></div></header> <div class="content" data-v-70afb46a><p>Validating user identity is incredibly important in mobile applications. The most common approaches to this are social login or, as seen with apps such as WhatsApp, Telegram, Line, WeChat and many more, the mobile phone number. Using a mobile phone number as a unique identifier on a mobile application, verified via an SMS PIN code, makes logical sense. Unfortunately, there are <a href="https://tru.id/blog/msisdn-vs-imsi-and-mobile-identity">flaws with SMS-based verification</a> that result in poor UX such as long waits, failed delivery, and the risk of SIM Swap attacks.</p>

<p>The solution? Authentication based on the SIM card, which can confirm the ownership of a mobile phone number by verifying the possession of an active SIM with the same number. It also indicates when the SIM card associated with a phone number was last changed as a signal for SIM swap detection.</p>

<p>Along with adding cryptographically secure phone verification to an application and protecting the user from SIM swap attacks, SIM card based authentication improves the user experience. No more one-time code exchange, custom logic to handle mistyped PINS, or retries due to SMS delivery failure. The user never leaves the app and the entire verification happens seamlessly.</p>

<p>Fewer dependencies, better security and a better experience.</p>

<p>In this tutorial we'll cover how to add SIM card based phone authentication to and Android application using <a href="https://developer.tru.id/docs/subscriber-check"><strong>tru.ID SubscriberCheck</strong></a>.</p>

<p>The completed Android sample app in the <a href="https://github.com/tru-ID/sim-card-auth-android">sim-card-auth-android repo</a> on GitHub. The repo includes a README with documentation for running and exploring the code.</p>

<p>Let's run through building this application step by step.</p>

<h2>
  <a name="before-you-begin" href="#before-you-begin">
  </a>
  Before you Begin
</h2>

<p>To complete this tutorial you'll need an up to date version of <a href="https://developer.android.com/studio">Android Studio</a> installed, some basic knowledge of Kotlin programming and <a href="https://nodejs.org/en/download/">Node.js</a> installed. You'll also need a physical Android device with an active SIM card because SubscriberCheck verifies a phone number by making a web request over a mobile data session.</p>

<h2>
  <a name="get-setup-with-truid" href="#get-setup-with-truid">
  </a>
  Get Setup with <strong>tru.ID</strong>
</h2>

<p>Sign up for a <a href="https://developer.tru.id/signup"><strong>tru.ID</strong> account</a> which comes with some free credit. Then install the <a href="https://github.com/tru-ID/cli"><strong>tru.ID</strong> CLI</a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>npm <span class="nb">install</span> <span class="nt">-g</span> @tru_id/cli
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Run <code>tru setup:credentials</code> using the credentials from the <a href="https://developer.tru.id/console"><strong>tru.ID</strong> console</a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>tru setup:credentials <span class="o">{</span>YOUR_CLIENT_ID<span class="o">}</span> <span class="o">{</span>YOUR_CLIENT_SECRET<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Install the CLI <a href="https://github.com/tru-ID/cli-plugin-dev-server">development server plugin</a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>tru plugins:install @tru_id/cli-plugin-dev-server@canary
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Create a new <strong>tru.ID</strong> project:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>tru projects:create AuthDemo
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This will save a <code>tru.json</code> <strong>tru.ID</strong> project configuration to <code>./authdemo/tru.json</code>.</p>

<p>Run the development server, pointing it to the directly containing the newly created project configuration. This will also open up a localtunnel to your development server, making it publicly accessible to the Internet so that your mobile phone can access it when only connected to mobile data.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>tru server <span class="nt">-t</span> <span class="nt">--project-dir</span> ./authdemo
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Open up the URL that is shown in the terminal, which will be in the format <code>https://{subdomain}.loca.lt</code>, in your desktop web browser to check that it is accessible.</p>

<p>With the development server setup we can move on to building the Android application.</p>

<h2>
  <a name="creating-a-new-android-project" href="#creating-a-new-android-project">
  </a>
  Creating a New Android Project
</h2>

<p>First, you have to create a new Android application using Android Studio. The app name is "SIMAuthentication". The package name is <code>id.tru.authentication.demo</code>.<br>
Click through the wizard, ensuring that "Empty Activity" is selected. Leave the "Activity Name" set to <code>MainActivity</code>, and leave the "Layout Name" set to <code>activity_main</code>.</p>

<p>The <a href="https://github.com/tru-ID/tru-sdk-android"><code>tru-sdk-android</code></a> is available on Android devices with minimum Android SDK Version 21 (Lollipop), therefore select minSdkVersion = 21 once creating the project.</p>
<h2>
  <a name="phone-number-authentication-ui" href="#phone-number-authentication-ui">
  </a>
  Phone Number Authentication UI
</h2>

<p>The first screen will be our Verification screen on which the user has to enter their phone number. After adding their phone number, the user will click on a "Verify my phone number" button to initiate the verification worflow.</p>

<p>The user interface is straight forward: a <code>ConstraintLayout</code> with one <code>TextInputEditText</code> <code>phone_number</code> inside a <code>TextInputLayout</code> <code>input_layout</code> for phone number input and a Button to trigger the verification, followed by a <code>progress_bar</code> where the user is updated on the progress, as we will see later on. Update <code>activity_main.xml</code> with the following:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:id=</span><span class="s">"@+id/container"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span>
    <span class="na">android:paddingLeft=</span><span class="s">"36dp"</span>
    <span class="na">android:paddingTop=</span><span class="s">"220dp"</span>
    <span class="na">android:paddingRight=</span><span class="s">"36dp"</span><span class="nt">></span>


    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/sign_in_header"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:text=</span><span class="s">"To experience tru.ID verification, please enter your phone number"</span>
        <span class="na">android:textStyle=</span><span class="s">"bold"</span>
        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span> <span class="nt">/></span>

    <span class="nt">&lt;com.google.android.material.textfield.TextInputLayout</span>
        <span class="na">android:id=</span><span class="s">"@+id/input_layout"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">app:errorEnabled=</span><span class="s">"true"</span>
        <span class="na">app:counterEnabled=</span><span class="s">"true"</span>
        <span class="na">app:counterMaxLength=</span><span class="s">"13"</span>
        <span class="na">android:layout_marginTop=</span><span class="s">"20dp"</span>
        <span class="na">style=</span><span class="s">"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"</span>
        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/sign_in_header"</span><span class="nt">></span>

        <span class="nt">&lt;com.google.android.material.textfield.TextInputEditText</span>
            <span class="na">android:id=</span><span class="s">"@+id/phone_number"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:gravity=</span><span class="s">"top|center"</span>
            <span class="na">android:hint=</span><span class="s">"Phone number"</span>
            <span class="na">android:inputType=</span><span class="s">"phone"</span>
            <span class="na">android:imeOptions=</span><span class="s">"actionDone"</span>
            <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
            <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
            <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/textView"</span> <span class="nt">/></span>
    <span class="nt">&lt;/com.google.android.material.textfield.TextInputLayout></span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:id=</span><span class="s">"@+id/verify"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_gravity=</span><span class="s">"center"</span>
        <span class="na">android:layout_marginTop=</span><span class="s">"20dp"</span>
        <span class="na">android:background=</span><span class="s">"#6200EE"</span>
        <span class="na">android:text=</span><span class="s">"Verify my phone number"</span>
        <span class="na">android:textAllCaps=</span><span class="s">"false"</span>
        <span class="na">android:textColor=</span><span class="s">"@android:color/white"</span>
        <span class="na">android:enabled=</span><span class="s">"false"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"@+id/input_layout"</span>
        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"@+id/progress_bar"</span>
        <span class="na">app:layout_constraintVertical_bias=</span><span class="s">"0.698"</span> <span class="nt">/></span>

    <span class="nt">&lt;com.google.android.material.progressindicator.LinearProgressIndicator</span>
        <span class="na">android:id=</span><span class="s">"@+id/progress_bar"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:indeterminate=</span><span class="s">"true"</span>
        <span class="na">android:visibility=</span><span class="s">"invisible"</span>
        <span class="na">android:layout_marginTop=</span><span class="s">"100dp"</span>
        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/verify"</span><span class="nt">/></span>

<span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout></span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Make sure to update the dependencies for <code>ConstraintLayout</code> and Material Components with the latest available versions with <code>app/build.gradle</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">'com.google.android.material:material:1.3.0'</span>
<span class="n">implementation</span> <span class="s1">'androidx.constraintlayout:constraintlayout:2.0.4'</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The main screen will look like this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--QFLna3Gk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mm8l69yqk4x0n5m01n1n.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QFLna3Gk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mm8l69yqk4x0n5m01n1n.png" alt='A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number"' loading="lazy" width="270" height="484"></a></p>

<p>To enable view binding that allows you to more easily write code that interacts with views set the <code>viewBinding</code> build option to <code>true</code> in the <code>app/build.gradle</code> file and :<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>android {
    buildFeatures {
        viewBinding true
    }
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Bind the verification workflow to the verify button within <code>app/src/main/java/id/tru/authentication/demo/MainActivity.kt</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">_binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">binding</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">_binding</span><span class="o">!!</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>

        <span class="n">_binding</span> <span class="p">=</span> <span class="nc">ActivityMainBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span>
        <span class="nf">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>

        <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="nf">setOnClickListener</span> <span class="p">{</span>
            <span class="nf">initVerification</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onDestroy</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onDestroy</span><span class="p">()</span>
        <span class="n">_binding</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"Verify button clicked"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TAG</span> <span class="p">=</span> <span class="s">"MainActivity"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Each time a verification is started we invalidate the UI, making sure all fields are reset, in order to cater for subsequent verification attempts:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="cm">/** Called when the user taps the verify button */</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="c1">// close virtual keyboard when sign in starts</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>

        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="n">isEnabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isEnabled</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">progressBar</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">progressBar</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="n">isEnabled</span> <span class="p">=</span> <span class="n">isEnabled</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">isEnabled</span> <span class="p">=</span> <span class="n">isEnabled</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ESI5fOJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bfstp3giv4mb7huyy3t7.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ESI5fOJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bfstp3giv4mb7huyy3t7.jpeg" alt="A screenshot of a mobile app in Android showing a text field with a phone number entered and a button greyed out to show the verification is in progress" loading="lazy" width="270" height="540"></a></p>

<p>Now, let's proceed to initiate a SubscriberCheck workflow, as described in the next section.</p>

<h2>
  <a name="subscribercheck-workflow" href="#subscribercheck-workflow">
  </a>
  SubscriberCheck Workflow
</h2>

<p>The sequence diagram below shows the complete SubscriberCheck Workflow. For this tutorial we'll focus on the <code>Device</code> and <code>Device -> Server</code> logic.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7H_b46Uc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5wjv6n5o893b0h6i7x8q.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7H_b46Uc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5wjv6n5o893b0h6i7x8q.png" alt="An image showing the flow between the mobile app, backend webserver, tru.ID and the users Mobile network operator" loading="lazy" width="880" height="617"></a></p>

<p>Create a <code>app/tru-id.properties</code> file and set the value of <code>EXAMPLE_SERVER_BASE_URL</code> to be the public URL of your development server:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>EXAMPLE_SERVER_BASE_URL="https://{subdomain}.loca.lt"
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>To perform network operations in your application such as making requests to the verification server, your <code>AndroidManifest.xml</code> must include <code>android.permission.INTERNET</code> and <code>android.permission.ACCESS_NETWORK_STATE</code> permissions. Also, some mobile network operator check requests are over HTTP (and not HTTPS) so the application must also allow <a href="https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic">cleartext network traffic</a>. Note that no data is sent over the HTTP request. The request is used by the MNO to verify that the device is connected to their mobile data network.</p>

<p>Your <code>AndroidManifest.xml</code> will look as follows:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"id.tru.authentication.demo"</span><span class="nt">></span>

    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span> <span class="nt">/></span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span> <span class="nt">/></span>

    <span class="nt">&lt;application</span>
        <span class="na">android:usesCleartextTraffic=</span><span class="s">"true"</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span>
        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
        <span class="na">android:theme=</span><span class="s">"@style/Theme.MaterialComponents.Light.NoActionBar"</span><span class="nt">></span>

        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span><span class="nt">></span>
            <span class="nt">&lt;intent-filter></span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/></span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/></span>
            <span class="nt">&lt;/intent-filter></span>
        <span class="nt">&lt;/activity></span>
    <span class="nt">&lt;/application></span>

<span class="nt">&lt;/manifest></span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Both the Internet and <code>ACCESS_NETWORK_STATE</code> permissions are <a href="https://developer.android.com/guide/topics/permissions/overview#normal-dangerous">normal permissions</a>, which means they're granted at install time and don't need to be requested at runtime.</p>

<p>In order to communicate with our local server the app needs to read in the <code>app/tru-id.properties</code> file containing the server URL and set a build configuration field. We want to include Retrofit, relevant JSON converters and OkHttp. Finally, include kotlinx-coroutine:</p>

<p>Update <code>app/build.gradle</code> with the following additions:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="kt">def</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">()</span>
<span class="n">file</span><span class="o">(</span><span class="s2">"tru-id.properties"</span><span class="o">).</span><span class="na">withInputStream</span> <span class="o">{</span> <span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>

<span class="n">android</span> <span class="o">{</span>
    <span class="n">defaultConfig</span> <span class="o">{</span>
        <span class="n">buildConfigField</span><span class="o">(</span><span class="s2">"String"</span><span class="o">,</span> <span class="s2">"SERVER_BASE_URL"</span><span class="o">,</span> <span class="n">props</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"EXAMPLE_SERVER_BASE_URL"</span><span class="o">))</span>
    <span class="o">}</span>

    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">implementation</span> <span class="s1">'com.squareup.retrofit2:retrofit:2.9.0'</span>
        <span class="n">implementation</span> <span class="s1">'com.squareup.retrofit2:converter-gson:2.9.0'</span>
        <span class="n">implementation</span> <span class="s1">'com.squareup.okhttp3:okhttp:4.9.0'</span>
        <span class="n">implementation</span> <span class="s1">'com.squareup.okhttp3:logging-interceptor:4.9.0'</span>
        <span class="n">implementation</span> <span class="s1">'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.7'</span>
        <span class="n">implementation</span> <span class="s1">'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.0'</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="1-create-a-subscribercheck" href="#1-create-a-subscribercheck">
  </a>
  1. Create a SubscriberCheck
</h3>

<p>To start the phone number verification flow in an Android app, the user enters their phone number and either presses the done keyboard key or touch the "Verify my phone number" button. The application then sends the phone number to your verification server that will create a SubscriberCheck resource on the <strong>tru.ID</strong> platform.</p>

<p>So, in order to create a SubscriberCheck a <code>phone_number</code> is required, and once created, the SubscriberCheck will contain a <code>check_url</code> and a <code>check_id</code>.</p>

<p>Let's create these required models for our network operations in a new file <code>data/Model.kt</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">data class</span> <span class="nc">SubscriberCheckPost</span><span class="p">(</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"phone_number"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">phone_number</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">SubscriberCheck</span><span class="p">(</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_url"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">check_url</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">check_id</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, create an <code>ApiService</code> interface in <code>api/ApiService.kt</code> that makes use of the models, making a <code>POST</code> request to the <code>/subscriber-check</code> endpoint on the development server:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">interface</span> <span class="nc">ApiService</span> <span class="p">{</span>
    <span class="nd">@Headers</span><span class="p">(</span><span class="s">"Content-Type: application/json"</span><span class="p">)</span>
    <span class="nd">@POST</span><span class="p">(</span><span class="s">"/subscriber-check"</span><span class="p">)</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">(</span><span class="nd">@Body</span> <span class="n">user</span><span class="p">:</span> <span class="nc">SubscriberCheckPost</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheck</span><span class="p">></span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Create a new file, <code>api/RetrofitBuilder.kt</code>, and within it create a Retrofit instance using <code>Retrofit.Builder</code>, passing the <code>ApiService</code> interface to generate an implementation.</p>

<p>We are also adding the <code>HttpLoggingInterceptor</code> so we can check what is going on every step of the way.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">object</span> <span class="nc">RetrofitBuilder</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">apiClient</span><span class="p">:</span> <span class="nc">ApiService</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span>

        <span class="kd">val</span> <span class="py">httpLoggingInterceptor</span> <span class="p">=</span> <span class="nc">HttpLoggingInterceptor</span><span class="p">()</span>
        <span class="n">httpLoggingInterceptor</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="nc">HttpLoggingInterceptor</span><span class="p">.</span><span class="nc">Level</span><span class="p">.</span><span class="nc">BODY</span><span class="p">);</span>

        <span class="kd">val</span> <span class="py">okHttpClient</span> <span class="p">=</span> <span class="nc">OkHttpClient</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">newBuilder</span><span class="p">()</span>
            <span class="c1">//httpLogging interceptor for logging network requests</span>
            <span class="p">.</span><span class="nf">addInterceptor</span><span class="p">(</span><span class="n">httpLoggingInterceptor</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>

        <span class="nc">Retrofit</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">baseUrl</span><span class="p">(</span><span class="nc">BuildConfig</span><span class="p">.</span><span class="nc">SERVER_BASE_URL</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="n">okHttpClient</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">addConverterFactory</span><span class="p">(</span><span class="nc">GsonConverterFactory</span><span class="p">.</span><span class="nf">create</span><span class="p">())</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nc">ApiService</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Note that the <code>BuildConfig.SERVER_BASE_URL</code> will be set with the value of <code>EXAMPLE_SERVER_BASE_URL</code> you defined in <code>tru-id.properties</code>.</p>

<p>Now we are ready to inform the user the verification process has started and create the SubscriberCheck using the provided phone number within <code>MainActivity.kt</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="cm">/** Called when the user taps the verify button */</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="c1">// close virtual keyboard when sign in starts</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>

        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
        <span class="nf">createSubscriberCheck</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>

            <span class="kd">val</span> <span class="py">subscriberCheck</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">createSubscriberCheck</span><span class="p">(</span>
                <span class="nc">SubscriberCheckPost</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="2-use-the-truid-sdk-to-request-the-subscribercheck-url" href="#2-use-the-truid-sdk-to-request-the-subscribercheck-url">
  </a>
  2. Use the <strong>tru.ID</strong> SDK to Request the SubscriberCheck URL
</h3>

<p>At this point you're going to add the <code>tru-sdk-android</code> SDK to your project to enable the SubscriberCheck URL to be requested over a mobile data connection.</p>

<p>Edit the <code>build.gradle</code> at your project's root and add the following code snippet to the <code>allprojects/repositories</code> section:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">allprojects</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">google</span><span class="o">()</span>
        <span class="n">jcenter</span><span class="o">()</span>
        <span class="n">maven</span> <span class="o">{</span>
            <span class="n">url</span> <span class="s2">"https://gitlab.com/api/v4/projects/22035475/packages/maven"</span>
        <span class="o">}</span>
        <span class="n">maven</span> <span class="o">{</span> <span class="n">url</span> <span class="s1">'https://jitpack.io'</span> <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Add the SDK dependency to <code>app/build.gradle</code> and sync the project.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">'id.tru.sdk:tru-sdk-android:0.0.+'</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Initialize the <code>TruSDK</code> within <code>onCreate</code> in <code>MainActivity.kt</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>

    <span class="nc">TruSDK</span><span class="p">.</span><span class="nf">initializeSdk</span><span class="p">(</span><span class="n">applicationContext</span><span class="p">)</span>

    <span class="n">_binding</span> <span class="p">=</span> <span class="nc">ActivityMainBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span>
    <span class="nf">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>

    <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="nf">setOnClickListener</span> <span class="p">{</span>
        <span class="nf">initVerification</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Create <code>api/RedirectManager.kt</code> to encapsulate obtaining a <code>TruSDK</code> instance and performing the network request with SubscriberCheck URL over the mobile data connection.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">RedirectManager</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">truSdk</span> <span class="p">=</span> <span class="nc">TruSDK</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">checkUrl</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">truSdk</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">checkUrl</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Update the <code>createSubscriberCheck</code> function in <code>MainActivity.kt</code> to use the <code>RedirectManager</code> to request the SubscriberCheck URL from the previous step. This enables the mobile network operator and the <strong>tru.ID</strong> platform to verify the phone number is associated with the mobile data session.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="kd">val</span> <span class="py">redirectManager</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span> <span class="nc">RedirectManager</span><span class="p">()</span> <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">createSubscriberCheck</span><span class="p">(</span>
                <span class="nc">SubscriberCheckPost</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="p">&&</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">subscriberCheck</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="k">as</span> <span class="nc">SubscriberCheck</span>
                <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">subscriberCheck</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nf">updateUIonError</span><span class="p">(</span><span class="s">"Error Occurred: ${response.message()}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">redirectManager</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_url</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUIonError</span><span class="p">(</span><span class="n">additionalInfo</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="n">additionalInfo</span><span class="p">)</span>
        <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="3-get-the-subscribercheck-results" href="#3-get-the-subscribercheck-results">
  </a>
  3. Get the SubscriberCheck Results
</h3>

<p>Once the SubscriberCheck URL has been requested the <strong>tru.ID</strong> platform now knows the check request has been performed. Your mobile application should query the result via your server application. This will in turn trigger the <strong>tru.ID</strong> platform to fetch the SubscriberCheck match result from the MNO (Mobile Network Operator).</p>

<p>Add the SubscriberCheckResult model to <code>Model.kt</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">data class</span> <span class="nc">SubscriberCheckResult</span><span class="p">(</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"match"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">match</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">,</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">check_id</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"no_sim_change"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">no_sim_change</span><span class="p">:</span> <span class="nc">Boolean</span>
<span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Add a <code>getSubscriberCheckResult</code> function to the <code>ApiService</code> interface:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">interface</span> <span class="nc">ApiService</span> <span class="p">{</span>
    <span class="nd">@Headers</span><span class="p">(</span><span class="s">"Content-Type: application/json"</span><span class="p">)</span>
    <span class="nd">@POST</span><span class="p">(</span><span class="s">"/subscriber-check"</span><span class="p">)</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">(</span><span class="nd">@Body</span> <span class="n">user</span><span class="p">:</span> <span class="nc">SubscriberCheckPost</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheck</span><span class="p">></span>

    <span class="nd">@GET</span><span class="p">(</span><span class="s">"/subscriber-check/{check_id}"</span><span class="p">)</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="nd">@Path</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span> <span class="n">checkId</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheckResult</span><span class="p">></span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now it's time to find out if the phone number was verified successfully. Create a new <code>getSubscriberCheckResult</code> function in <code>MainActivity.kt</code> and call it after the <code>redirectManager.openCheckUrl</code>. The call to <code>getSubscriberCheckResult</code> must be done within the coroutine to ensure the check URL request has completed.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">redirectManager</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_url</span><span class="p">)</span>

            <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_id</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="p">&&</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">subscriberCheckResult</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="k">as</span> <span class="nc">SubscriberCheckResult</span>

                <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">:</span> <span class="nc">SubscriberCheckResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"TODO: update the UI"</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>There you go, based on the <code>subscriberCheckResult</code> you may notify the user that the authentication has completed.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">:</span> <span class="nc">SubscriberCheckResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">.</span><span class="n">match</span> <span class="p">&&</span> <span class="n">subscriberCheckResult</span><span class="p">.</span><span class="n">no_sim_change</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone verification complete"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone verification failed"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The value of <code>no_sim_change</code> indicates if the SIM card has not been changed in the last 7 days. For example, in the case of <code>match = true</code> but <code>no_sim_change = false</code> the phone number has been verified but the fact the SIM card has changed recently means that it's good practice to perform additional user checks before allowing them to register or login.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--eG3p1aa1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/heag3e465bo9w3dmfck3.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eG3p1aa1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/heag3e465bo9w3dmfck3.jpeg" alt='A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number". There is a little pop up at the bottom of the screen with a grey background and white text saying "Verification Done"' loading="lazy" width="270" height="540"></a></p>

<p>In an application that contains more than a login or signup activity you would now show either a screen to capture more user information or the successfully registered/logged-in screen.</p>

<h3>
  <a name="try-out-sim-card-based-authentication" href="#try-out-sim-card-based-authentication">
  </a>
  Try Out SIM Card Based Authentication
</h3>

<p>Now that your code is complete, you can run the application on a real device. Bear in mind that SIM card based authentication is not be possible against an emulator.</p>

<p>Enter the phone number for the mobile device in the UI in the format +{country_code}{number} e.g. <code>+447900123456</code>.</p>

<p>Touch the "Verify my phone number" button.</p>

<p>Congratulations! You've finished the <strong>SIM Card Based Mobile Authentication for Android</strong> Tutorial.</p>

<h2>
  <a name="where-next" href="#where-next">
  </a>
  Where next?
</h2>

<p>You can view a completed version of this sample app in the <a href="https://github.com/tru-ID/sim-card-auth-android">sim-card-auth-android repo</a> on GitHub.</p>

<h3>
  <a name="optional-step-client-side-phone-number-prevalidation" href="#optional-step-client-side-phone-number-prevalidation">
  </a>
  Optional step: Client side phone number pre-validation
</h3>

<p>The minimum phone number pre-validation that can be achieved on the client side is to validate the phone number format with <code>libphonenumber</code>.</p>

<p>Update <code>app/build.gradle</code> to include this library:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">'com.googlecode.libphonenumber:libphonenumber:8.12.10'</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And create a <code>util/PhoneNumberUtil.kt</code> utility that validates the phone number format +{country_code}{number} e.g. <code>+447900123456</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="k">fun</span> <span class="nf">isPhoneNumberFormatValid</span><span class="p">(</span><span class="n">phoneNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">phoneNumberUtil</span> <span class="p">=</span> <span class="nc">PhoneNumberUtil</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">phoneNumberUtil</span><span class="p">.</span><span class="nf">isValidNumber</span><span class="p">(</span><span class="n">phoneNumberUtil</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span>
                <span class="n">phoneNumber</span><span class="p">,</span> <span class="nc">Phonenumber</span><span class="p">.</span><span class="nc">PhoneNumber</span><span class="p">.</span><span class="nc">CountryCodeSource</span><span class="p">.</span><span class="nc">UNSPECIFIED</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">NumberParseException</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Now invoke the phone number pre-validation on <code>createSubscriberCheck</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">isPhoneNumberFormatValid</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">()))</span> <span class="p">{</span>
        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone number invalid"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="optional-step-check-if-mobile-data-is-enabled-at-runtime" href="#optional-step-check-if-mobile-data-is-enabled-at-runtime">
  </a>
  Optional step: check if mobile data is enabled at runtime
</h3>

<p>The SubscriberCheck validation requires the device to have mobile data enabled. We can programmatically check if this is the case and launch Internet Connectivity settings dialog if required.</p>

<p>Firstly, add a utility method <code>isMobileDataEnabled</code> to your <code>MainActivity.kt</code> to check if the mobile data is enabled:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="nd">@RequiresApi</span><span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">O</span><span class="p">)</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isMobileDataEnabled</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tm</span> <span class="p">=</span> <span class="nf">getSystemService</span><span class="p">(</span><span class="nc">TELEPHONY_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="nc">TelephonyManager</span>
        <span class="k">return</span> <span class="n">tm</span><span class="p">.</span><span class="n">isDataEnabled</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The Activity Result APIs provide components for registering for a result, launching the result, and handling the result once it is dispatched by the system.</p>

<p>To get started, add the dependencies:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">'androidx.activity:activity-ktx:1.2.0'</span>
<span class="n">implementation</span> <span class="s1">'androidx.fragment:fragment-ktx:1.3.0'</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The next step is to create a custom result contract <code>data/ConnectivitySettingsContract.kt</code>, this class would extend ActivityResultContract which requires defining input and output classes.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">ConnectivitySettingsContract</span> <span class="p">:</span> <span class="nc">ActivityResultContract</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Uri</span><span class="p">?>()</span> <span class="p">{</span>
    <span class="nd">@RequiresApi</span><span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">Q</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">createIntent</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Intent</span><span class="p">(</span><span class="nc">Settings</span><span class="p">.</span><span class="nc">Panel</span><span class="p">.</span><span class="nc">ACTION_INTERNET_CONNECTIVITY</span><span class="p">)</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">parseResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?):</span> <span class="nc">Uri</span><span class="p">?</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Result code $resultCode"</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">resultCode</span> <span class="p">!=</span> <span class="nc">Activity</span><span class="p">.</span><span class="nc">RESULT_OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">?.</span><span class="n">data</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, we register a callback for an activity result, we do that by defining <code>registerForActivityResult()</code> which takes the <code>ConnectivitySettingsContract</code> and <code>ActivityResultCallback</code> and returns an <code>ActivityResultLauncher</code> which is used to launch the other activity:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="kd">val</span> <span class="py">startSettingsForResult</span> <span class="p">=</span> <span class="nf">registerForActivityResult</span><span class="p">(</span><span class="nc">ConnectivitySettingsContract</span><span class="p">())</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"Internet Connectivity Setting dismissed"</span><span class="p">)</span>
        <span class="nf">initVerification</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>If the mobile data is disabled we launch the previously created <code>ActivityResultLauncher</code>, as follows:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="c1">// close virtual keyboard when sign in starts</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">>=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">O</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">isMobileDataEnabled</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">startSettingsForResult</span><span class="p">.</span><span class="nf">launch</span><span class="p">(</span><span class="nc">CONNECTIVITY_SETTINGS_ACTION</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">startVerification</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TAG</span> <span class="p">=</span> <span class="s">"MainActivity"</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">CONNECTIVITY_SETTINGS_ACTION</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5TTbD5qa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tmkbrsbiglrzl6uvakm0.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5TTbD5qa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tmkbrsbiglrzl6uvakm0.jpeg" alt="A screenshot of Android connectivity settings" loading="lazy" width="270" height="540"></a></p>

<h3>
  <a name="programmatically-reading-the-device-phone-number" href="#programmatically-reading-the-device-phone-number">
  </a>
  Programmatically reading the device Phone Number
</h3>

<p>If you're trying to create a even more magical phone number verification experience, you can make the phone number input part of the app's responsibility.</p>

<p>One option is to use <a href="https://developers.google.com/identity/sms-retriever/request#1_obtain_the_users_phone_number">Play Services auth-api-phone library</a> hint picker that prompts the user to choose from the phone numbers stored on the device and thereby avoid having to manually type a phone number.</p>

<h2>
  <a name="troubleshooting" href="#troubleshooting">
  </a>
  Troubleshooting
</h2>

<h3>
  <a name="mobile-data-is-required" href="#mobile-data-is-required">
  </a>
  Mobile Data is Required
</h3>

<p>Don't forget the SubscriberCheck validation requires the device to enable mobile data.</p>

<h3>
  <a name="check-the-http-logging-output" href="#check-the-http-logging-output">
  </a>
  Check the HTTP Logging Output
</h3>

<p>Because we have attached a <em>HttpLoggingInterceptor</em> you can use adb logs to debug your SubscriberCheck:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>I/okhttp.OkHttpClient: --> POST https://mylocalserver.example/subscriber-check
I/okhttp.OkHttpClient: {"phone_number":"+447XXXXXXXXX"}
I/okhttp.OkHttpClient: --> END POST (32-byte body)
I/okhttp.OkHttpClient: &lt;-- 200 https://mylocalserver.example/check (1479ms)
I/okhttp.OkHttpClient: {"check_id":"NEW_CHECK_ID","check_url":"https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect"}
I/okhttp.OkHttpClient: &lt;-- END HTTP (157-byte body)

D/RedirectManager: Triggering open check url https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect
I/SDK::checkUrl: Triggering check url
I/System.out: Response to https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect
D/LoginActivity: redirect done [7961ms]
I/okhttp.OkHttpClient: --> GET https://mylocalserver.example/subscriber-check/NEW_CHECK_ID
I/okhttp.OkHttpClient: --> END GET
I/okhttp.OkHttpClient: &lt;-- 200 https://mylocalserver.example/subscriber-check/NEW_CHECK_ID (749ms)
I/okhttp.OkHttpClient: {"match":true,"check_id":"NEW_CHECK_ID","no_sim_change":true}
I/okhttp.OkHttpClient: &lt;-- END HTTP (64-byte body)
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h3>
  <a name="check-the-development-server-logging" href="#check-the-development-server-logging">
  </a>
  Check the Development Server Logging
</h3>

<p>The <a href="https://github.com/tru-ID/dev-server">development server</a> also logs information out to the terminal including request and response payloads. Check that output for any errors or unexpected values.</p>

<h3>
  <a name="get-in-touch" href="#get-in-touch">
  </a>
  Get in touch
</h3>

<p>If you have any questions, get in touch via <a href="//mailto:help@tru.id">help@tru.id</a>.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/gregholmes/sim-card-based-mobile-authentication-with-android-1g3a" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(n,s,a,e){return a.type_of="article",a.id=863241,a.title="SIM Card Based Mobile Authentication with Android",a.description="Validating user identity is incredibly important in mobile applications. The most common approaches...",a.readable_publish_date="Oct 14 '21",a.slug="sim-card-based-mobile-authentication-with-android-1g3a",a.path="/tru-id/sim-card-based-mobile-authentication-with-android-1g3a",a.url="https://dev.to/tru-id/sim-card-based-mobile-authentication-with-android-1g3a",a.comments_count=1,a.public_reactions_count=25,a.collection_id=n,a.published_timestamp=s,a.positive_reactions_count=25,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--CSyseFV---/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fhjbpcwy82657rwuuzfw.png",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--9p8Fpq9i--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fhjbpcwy82657rwuuzfw.png",a.canonical_url="https://developer.tru.id/tutorials/android-sim-card-mobile-auth",a.created_at=s,a.edited_at=n,a.crossposted_at=n,a.published_at=s,a.last_comment_at="2021-10-18T06:02:35Z",a.reading_time_minutes=14,a.tag_list="android, kotlin, tutorial, security",a.tags=["android","kotlin","tutorial","security"],a.body_html='<p>Validating user identity is incredibly important in mobile applications. The most common approaches to this are social login or, as seen with apps such as WhatsApp, Telegram, Line, WeChat and many more, the mobile phone number. Using a mobile phone number as a unique identifier on a mobile application, verified via an SMS PIN code, makes logical sense. Unfortunately, there are <a href="https://tru.id/blog/msisdn-vs-imsi-and-mobile-identity">flaws with SMS-based verification</a> that result in poor UX such as long waits, failed delivery, and the risk of SIM Swap attacks.</p>\n\n<p>The solution? Authentication based on the SIM card, which can confirm the ownership of a mobile phone number by verifying the possession of an active SIM with the same number. It also indicates when the SIM card associated with a phone number was last changed as a signal for SIM swap detection.</p>\n\n<p>Along with adding cryptographically secure phone verification to an application and protecting the user from SIM swap attacks, SIM card based authentication improves the user experience. No more one-time code exchange, custom logic to handle mistyped PINS, or retries due to SMS delivery failure. The user never leaves the app and the entire verification happens seamlessly.</p>\n\n<p>Fewer dependencies, better security and a better experience.</p>\n\n<p>In this tutorial we\'ll cover how to add SIM card based phone authentication to and Android application using <a href="https://developer.tru.id/docs/subscriber-check"><strong>tru.ID SubscriberCheck</strong></a>.</p>\n\n<p>The completed Android sample app in the <a href="https://github.com/tru-ID/sim-card-auth-android">sim-card-auth-android repo</a> on GitHub. The repo includes a README with documentation for running and exploring the code.</p>\n\n<p>Let\'s run through building this application step by step.</p>\n\n<h2>\n  <a name="before-you-begin" href="#before-you-begin">\n  </a>\n  Before you Begin\n</h2>\n\n<p>To complete this tutorial you\'ll need an up to date version of <a href="https://developer.android.com/studio">Android Studio</a> installed, some basic knowledge of Kotlin programming and <a href="https://nodejs.org/en/download/">Node.js</a> installed. You\'ll also need a physical Android device with an active SIM card because SubscriberCheck verifies a phone number by making a web request over a mobile data session.</p>\n\n<h2>\n  <a name="get-setup-with-truid" href="#get-setup-with-truid">\n  </a>\n  Get Setup with <strong>tru.ID</strong>\n</h2>\n\n<p>Sign up for a <a href="https://developer.tru.id/signup"><strong>tru.ID</strong> account</a> which comes with some free credit. Then install the <a href="https://github.com/tru-ID/cli"><strong>tru.ID</strong> CLI</a>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>npm <span class="nb">install</span> <span class="nt">-g</span> @tru_id/cli\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Run <code>tru setup:credentials</code> using the credentials from the <a href="https://developer.tru.id/console"><strong>tru.ID</strong> console</a>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>tru setup:credentials <span class="o">{</span>YOUR_CLIENT_ID<span class="o">}</span> <span class="o">{</span>YOUR_CLIENT_SECRET<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Install the CLI <a href="https://github.com/tru-ID/cli-plugin-dev-server">development server plugin</a>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>tru plugins:install @tru_id/cli-plugin-dev-server@canary\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Create a new <strong>tru.ID</strong> project:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>tru projects:create AuthDemo\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This will save a <code>tru.json</code> <strong>tru.ID</strong> project configuration to <code>./authdemo/tru.json</code>.</p>\n\n<p>Run the development server, pointing it to the directly containing the newly created project configuration. This will also open up a localtunnel to your development server, making it publicly accessible to the Internet so that your mobile phone can access it when only connected to mobile data.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight shell"><code>tru server <span class="nt">-t</span> <span class="nt">--project-dir</span> ./authdemo\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Open up the URL that is shown in the terminal, which will be in the format <code>https://{subdomain}.loca.lt</code>, in your desktop web browser to check that it is accessible.</p>\n\n<p>With the development server setup we can move on to building the Android application.</p>\n\n<h2>\n  <a name="creating-a-new-android-project" href="#creating-a-new-android-project">\n  </a>\n  Creating a New Android Project\n</h2>\n\n<p>First, you have to create a new Android application using Android Studio. The app name is "SIMAuthentication". The package name is <code>id.tru.authentication.demo</code>.<br>\nClick through the wizard, ensuring that "Empty Activity" is selected. Leave the "Activity Name" set to <code>MainActivity</code>, and leave the "Layout Name" set to <code>activity_main</code>.</p>\n\n<p>The <a href="https://github.com/tru-ID/tru-sdk-android"><code>tru-sdk-android</code></a> is available on Android devices with minimum Android SDK Version 21 (Lollipop), therefore select minSdkVersion = 21 once creating the project.</p>\n<h2>\n  <a name="phone-number-authentication-ui" href="#phone-number-authentication-ui">\n  </a>\n  Phone Number Authentication UI\n</h2>\n\n<p>The first screen will be our Verification screen on which the user has to enter their phone number. After adding their phone number, the user will click on a "Verify my phone number" button to initiate the verification worflow.</p>\n\n<p>The user interface is straight forward: a <code>ConstraintLayout</code> with one <code>TextInputEditText</code> <code>phone_number</code> inside a <code>TextInputLayout</code> <code>input_layout</code> for phone number input and a Button to trigger the verification, followed by a <code>progress_bar</code> where the user is updated on the progress, as we will see later on. Update <code>activity_main.xml</code> with the following:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>\n<span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>\n    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>\n    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>\n    <span class="na">android:id=</span><span class="s">"@+id/container"</span>\n    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>\n    <span class="na">tools:context=</span><span class="s">".MainActivity"</span>\n    <span class="na">android:paddingLeft=</span><span class="s">"36dp"</span>\n    <span class="na">android:paddingTop=</span><span class="s">"220dp"</span>\n    <span class="na">android:paddingRight=</span><span class="s">"36dp"</span><span class="nt">&gt;</span>\n\n\n    <span class="nt">&lt;TextView</span>\n        <span class="na">android:id=</span><span class="s">"@+id/sign_in_header"</span>\n        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>\n        <span class="na">android:text=</span><span class="s">"To experience tru.ID verification, please enter your phone number"</span>\n        <span class="na">android:textStyle=</span><span class="s">"bold"</span>\n        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span> <span class="nt">/&gt;</span>\n\n    <span class="nt">&lt;com.google.android.material.textfield.TextInputLayout</span>\n        <span class="na">android:id=</span><span class="s">"@+id/input_layout"</span>\n        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>\n        <span class="na">app:errorEnabled=</span><span class="s">"true"</span>\n        <span class="na">app:counterEnabled=</span><span class="s">"true"</span>\n        <span class="na">app:counterMaxLength=</span><span class="s">"13"</span>\n        <span class="na">android:layout_marginTop=</span><span class="s">"20dp"</span>\n        <span class="na">style=</span><span class="s">"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"</span>\n        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/sign_in_header"</span><span class="nt">&gt;</span>\n\n        <span class="nt">&lt;com.google.android.material.textfield.TextInputEditText</span>\n            <span class="na">android:id=</span><span class="s">"@+id/phone_number"</span>\n            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>\n            <span class="na">android:gravity=</span><span class="s">"top|center"</span>\n            <span class="na">android:hint=</span><span class="s">"Phone number"</span>\n            <span class="na">android:inputType=</span><span class="s">"phone"</span>\n            <span class="na">android:imeOptions=</span><span class="s">"actionDone"</span>\n            <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>\n            <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>\n            <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/textView"</span> <span class="nt">/&gt;</span>\n    <span class="nt">&lt;/com.google.android.material.textfield.TextInputLayout&gt;</span>\n\n    <span class="nt">&lt;Button</span>\n        <span class="na">android:id=</span><span class="s">"@+id/verify"</span>\n        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>\n        <span class="na">android:layout_gravity=</span><span class="s">"center"</span>\n        <span class="na">android:layout_marginTop=</span><span class="s">"20dp"</span>\n        <span class="na">android:background=</span><span class="s">"#6200EE"</span>\n        <span class="na">android:text=</span><span class="s">"Verify my phone number"</span>\n        <span class="na">android:textAllCaps=</span><span class="s">"false"</span>\n        <span class="na">android:textColor=</span><span class="s">"@android:color/white"</span>\n        <span class="na">android:enabled=</span><span class="s">"false"</span>\n        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"@+id/input_layout"</span>\n        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"@+id/progress_bar"</span>\n        <span class="na">app:layout_constraintVertical_bias=</span><span class="s">"0.698"</span> <span class="nt">/&gt;</span>\n\n    <span class="nt">&lt;com.google.android.material.progressindicator.LinearProgressIndicator</span>\n        <span class="na">android:id=</span><span class="s">"@+id/progress_bar"</span>\n        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>\n        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>\n        <span class="na">android:indeterminate=</span><span class="s">"true"</span>\n        <span class="na">android:visibility=</span><span class="s">"invisible"</span>\n        <span class="na">android:layout_marginTop=</span><span class="s">"100dp"</span>\n        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>\n        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@+id/verify"</span><span class="nt">/&gt;</span>\n\n<span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Make sure to update the dependencies for <code>ConstraintLayout</code> and Material Components with the latest available versions with <code>app/build.gradle</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">\'com.google.android.material:material:1.3.0\'</span>\n<span class="n">implementation</span> <span class="s1">\'androidx.constraintlayout:constraintlayout:2.0.4\'</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The main screen will look like this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--QFLna3Gk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mm8l69yqk4x0n5m01n1n.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QFLna3Gk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mm8l69yqk4x0n5m01n1n.png" alt=\'A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number"\' loading="lazy" width="270" height="484"></a></p>\n\n<p>To enable view binding that allows you to more easily write code that interacts with views set the <code>viewBinding</code> build option to <code>true</code> in the <code>app/build.gradle</code> file and :<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>android {\n    buildFeatures {\n        viewBinding true\n    }\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Bind the verification workflow to the verify button within <code>app/src/main/java/id/tru/authentication/demo/MainActivity.kt</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>\n\n    <span class="k">private</span> <span class="kd">var</span> <span class="py">_binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>\n    <span class="k">private</span> <span class="kd">val</span> <span class="py">binding</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">_binding</span><span class="o">!!</span>\n\n    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>\n        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>\n\n        <span class="n">_binding</span> <span class="p">=</span> <span class="nc">ActivityMainBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span>\n        <span class="nf">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>\n\n        <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="nf">setOnClickListener</span> <span class="p">{</span>\n            <span class="nf">initVerification</span><span class="p">()</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onDestroy</span><span class="p">()</span> <span class="p">{</span>\n        <span class="k">super</span><span class="p">.</span><span class="nf">onDestroy</span><span class="p">()</span>\n        <span class="n">_binding</span> <span class="p">=</span> <span class="k">null</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"Verify button clicked"</span><span class="p">)</span>\n    <span class="p">}</span>\n\n    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>\n        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TAG</span> <span class="p">=</span> <span class="s">"MainActivity"</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Each time a verification is started we invalidate the UI, making sure all fields are reset, in order to cater for subsequent verification attempts:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="cm">/** Called when the user taps the verify button */</span>\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>\n        <span class="c1">// close virtual keyboard when sign in starts</span>\n        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>\n\n        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="n">isEnabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span><span class="n">isEnabled</span><span class="p">)</span> <span class="p">{</span>\n            <span class="n">binding</span><span class="p">.</span><span class="n">progressBar</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>\n            <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>\n        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n            <span class="n">binding</span><span class="p">.</span><span class="n">progressBar</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>\n        <span class="p">}</span>\n        <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="n">isEnabled</span> <span class="p">=</span> <span class="n">isEnabled</span>\n        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">isEnabled</span> <span class="p">=</span> <span class="n">isEnabled</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ESI5fOJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bfstp3giv4mb7huyy3t7.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ESI5fOJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bfstp3giv4mb7huyy3t7.jpeg" alt="A screenshot of a mobile app in Android showing a text field with a phone number entered and a button greyed out to show the verification is in progress" loading="lazy" width="270" height="540"></a></p>\n\n<p>Now, let\'s proceed to initiate a SubscriberCheck workflow, as described in the next section.</p>\n\n<h2>\n  <a name="subscribercheck-workflow" href="#subscribercheck-workflow">\n  </a>\n  SubscriberCheck Workflow\n</h2>\n\n<p>The sequence diagram below shows the complete SubscriberCheck Workflow. For this tutorial we\'ll focus on the <code>Device</code> and <code>Device -&gt; Server</code> logic.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7H_b46Uc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5wjv6n5o893b0h6i7x8q.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7H_b46Uc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5wjv6n5o893b0h6i7x8q.png" alt="An image showing the flow between the mobile app, backend webserver, tru.ID and the users Mobile network operator" loading="lazy" width="880" height="617"></a></p>\n\n<p>Create a <code>app/tru-id.properties</code> file and set the value of <code>EXAMPLE_SERVER_BASE_URL</code> to be the public URL of your development server:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>EXAMPLE_SERVER_BASE_URL="https://{subdomain}.loca.lt"\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>To perform network operations in your application such as making requests to the verification server, your <code>AndroidManifest.xml</code> must include <code>android.permission.INTERNET</code> and <code>android.permission.ACCESS_NETWORK_STATE</code> permissions. Also, some mobile network operator check requests are over HTTP (and not HTTPS) so the application must also allow <a href="https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic">cleartext network traffic</a>. Note that no data is sent over the HTTP request. The request is used by the MNO to verify that the device is connected to their mobile data network.</p>\n\n<p>Your <code>AndroidManifest.xml</code> will look as follows:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>\n<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>\n    <span class="na">package=</span><span class="s">"id.tru.authentication.demo"</span><span class="nt">&gt;</span>\n\n    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span> <span class="nt">/&gt;</span>\n    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span> <span class="nt">/&gt;</span>\n\n    <span class="nt">&lt;application</span>\n        <span class="na">android:usesCleartextTraffic=</span><span class="s">"true"</span>\n        <span class="na">android:allowBackup=</span><span class="s">"true"</span>\n        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>\n        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>\n        <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span>\n        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>\n        <span class="na">android:theme=</span><span class="s">"@style/Theme.MaterialComponents.Light.NoActionBar"</span><span class="nt">&gt;</span>\n\n        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;intent-filter&gt;</span>\n                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>\n\n                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>\n            <span class="nt">&lt;/intent-filter&gt;</span>\n        <span class="nt">&lt;/activity&gt;</span>\n    <span class="nt">&lt;/application&gt;</span>\n\n<span class="nt">&lt;/manifest&gt;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Both the Internet and <code>ACCESS_NETWORK_STATE</code> permissions are <a href="https://developer.android.com/guide/topics/permissions/overview#normal-dangerous">normal permissions</a>, which means they\'re granted at install time and don\'t need to be requested at runtime.</p>\n\n<p>In order to communicate with our local server the app needs to read in the <code>app/tru-id.properties</code> file containing the server URL and set a build configuration field. We want to include Retrofit, relevant JSON converters and OkHttp. Finally, include kotlinx-coroutine:</p>\n\n<p>Update <code>app/build.gradle</code> with the following additions:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="kt">def</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">()</span>\n<span class="n">file</span><span class="o">(</span><span class="s2">"tru-id.properties"</span><span class="o">).</span><span class="na">withInputStream</span> <span class="o">{</span> <span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>\n\n<span class="n">android</span> <span class="o">{</span>\n    <span class="n">defaultConfig</span> <span class="o">{</span>\n        <span class="n">buildConfigField</span><span class="o">(</span><span class="s2">"String"</span><span class="o">,</span> <span class="s2">"SERVER_BASE_URL"</span><span class="o">,</span> <span class="n">props</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"EXAMPLE_SERVER_BASE_URL"</span><span class="o">))</span>\n    <span class="o">}</span>\n\n    <span class="n">dependencies</span> <span class="o">{</span>\n        <span class="n">implementation</span> <span class="s1">\'com.squareup.retrofit2:retrofit:2.9.0\'</span>\n        <span class="n">implementation</span> <span class="s1">\'com.squareup.retrofit2:converter-gson:2.9.0\'</span>\n        <span class="n">implementation</span> <span class="s1">\'com.squareup.okhttp3:okhttp:4.9.0\'</span>\n        <span class="n">implementation</span> <span class="s1">\'com.squareup.okhttp3:logging-interceptor:4.9.0\'</span>\n        <span class="n">implementation</span> <span class="s1">\'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.7\'</span>\n        <span class="n">implementation</span> <span class="s1">\'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.0\'</span>\n    <span class="o">}</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="1-create-a-subscribercheck" href="#1-create-a-subscribercheck">\n  </a>\n  1. Create a SubscriberCheck\n</h3>\n\n<p>To start the phone number verification flow in an Android app, the user enters their phone number and either presses the done keyboard key or touch the "Verify my phone number" button. The application then sends the phone number to your verification server that will create a SubscriberCheck resource on the <strong>tru.ID</strong> platform.</p>\n\n<p>So, in order to create a SubscriberCheck a <code>phone_number</code> is required, and once created, the SubscriberCheck will contain a <code>check_url</code> and a <code>check_id</code>.</p>\n\n<p>Let\'s create these required models for our network operations in a new file <code>data/Model.kt</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">data class</span> <span class="nc">SubscriberCheckPost</span><span class="p">(</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"phone_number"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">phone_number</span><span class="p">:</span> <span class="nc">String</span>\n<span class="p">)</span>\n\n<span class="kd">data class</span> <span class="nc">SubscriberCheck</span><span class="p">(</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_url"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">check_url</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">check_id</span><span class="p">:</span> <span class="nc">String</span>\n<span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, create an <code>ApiService</code> interface in <code>api/ApiService.kt</code> that makes use of the models, making a <code>POST</code> request to the <code>/subscriber-check</code> endpoint on the development server:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">interface</span> <span class="nc">ApiService</span> <span class="p">{</span>\n    <span class="nd">@Headers</span><span class="p">(</span><span class="s">"Content-Type: application/json"</span><span class="p">)</span>\n    <span class="nd">@POST</span><span class="p">(</span><span class="s">"/subscriber-check"</span><span class="p">)</span>\n    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">(</span><span class="nd">@Body</span> <span class="n">user</span><span class="p">:</span> <span class="nc">SubscriberCheckPost</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheck</span><span class="p">&gt;</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Create a new file, <code>api/RetrofitBuilder.kt</code>, and within it create a Retrofit instance using <code>Retrofit.Builder</code>, passing the <code>ApiService</code> interface to generate an implementation.</p>\n\n<p>We are also adding the <code>HttpLoggingInterceptor</code> so we can check what is going on every step of the way.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">object</span> <span class="nc">RetrofitBuilder</span> <span class="p">{</span>\n    <span class="kd">val</span> <span class="py">apiClient</span><span class="p">:</span> <span class="nc">ApiService</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span>\n\n        <span class="kd">val</span> <span class="py">httpLoggingInterceptor</span> <span class="p">=</span> <span class="nc">HttpLoggingInterceptor</span><span class="p">()</span>\n        <span class="n">httpLoggingInterceptor</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="nc">HttpLoggingInterceptor</span><span class="p">.</span><span class="nc">Level</span><span class="p">.</span><span class="nc">BODY</span><span class="p">);</span>\n\n        <span class="kd">val</span> <span class="py">okHttpClient</span> <span class="p">=</span> <span class="nc">OkHttpClient</span><span class="p">()</span>\n            <span class="p">.</span><span class="nf">newBuilder</span><span class="p">()</span>\n            <span class="c1">//httpLogging interceptor for logging network requests</span>\n            <span class="p">.</span><span class="nf">addInterceptor</span><span class="p">(</span><span class="n">httpLoggingInterceptor</span><span class="p">)</span>\n            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>\n\n        <span class="nc">Retrofit</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>\n            <span class="p">.</span><span class="nf">baseUrl</span><span class="p">(</span><span class="nc">BuildConfig</span><span class="p">.</span><span class="nc">SERVER_BASE_URL</span><span class="p">)</span>\n            <span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="n">okHttpClient</span><span class="p">)</span>\n            <span class="p">.</span><span class="nf">addConverterFactory</span><span class="p">(</span><span class="nc">GsonConverterFactory</span><span class="p">.</span><span class="nf">create</span><span class="p">())</span>\n            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>\n            <span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nc">ApiService</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Note that the <code>BuildConfig.SERVER_BASE_URL</code> will be set with the value of <code>EXAMPLE_SERVER_BASE_URL</code> you defined in <code>tru-id.properties</code>.</p>\n\n<p>Now we are ready to inform the user the verification process has started and create the SubscriberCheck using the provided phone number within <code>MainActivity.kt</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="cm">/** Called when the user taps the verify button */</span>\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>\n        <span class="c1">// close virtual keyboard when sign in starts</span>\n        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>\n\n        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>\n        <span class="nf">createSubscriberCheck</span><span class="p">()</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>\n\n            <span class="kd">val</span> <span class="py">subscriberCheck</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">createSubscriberCheck</span><span class="p">(</span>\n                <span class="nc">SubscriberCheckPost</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>\n            <span class="p">)</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="2-use-the-truid-sdk-to-request-the-subscribercheck-url" href="#2-use-the-truid-sdk-to-request-the-subscribercheck-url">\n  </a>\n  2. Use the <strong>tru.ID</strong> SDK to Request the SubscriberCheck URL\n</h3>\n\n<p>At this point you\'re going to add the <code>tru-sdk-android</code> SDK to your project to enable the SubscriberCheck URL to be requested over a mobile data connection.</p>\n\n<p>Edit the <code>build.gradle</code> at your project\'s root and add the following code snippet to the <code>allprojects/repositories</code> section:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">allprojects</span> <span class="o">{</span>\n    <span class="n">repositories</span> <span class="o">{</span>\n        <span class="n">google</span><span class="o">()</span>\n        <span class="n">jcenter</span><span class="o">()</span>\n        <span class="n">maven</span> <span class="o">{</span>\n            <span class="n">url</span> <span class="s2">"https://gitlab.com/api/v4/projects/22035475/packages/maven"</span>\n        <span class="o">}</span>\n        <span class="n">maven</span> <span class="o">{</span> <span class="n">url</span> <span class="s1">\'https://jitpack.io\'</span> <span class="o">}</span>\n    <span class="o">}</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Add the SDK dependency to <code>app/build.gradle</code> and sync the project.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">\'id.tru.sdk:tru-sdk-android:0.0.+\'</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Initialize the <code>TruSDK</code> within <code>onCreate</code> in <code>MainActivity.kt</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>\n    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>\n\n    <span class="nc">TruSDK</span><span class="p">.</span><span class="nf">initializeSdk</span><span class="p">(</span><span class="n">applicationContext</span><span class="p">)</span>\n\n    <span class="n">_binding</span> <span class="p">=</span> <span class="nc">ActivityMainBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span>\n    <span class="nf">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>\n\n    <span class="n">binding</span><span class="p">.</span><span class="n">verify</span><span class="p">.</span><span class="nf">setOnClickListener</span> <span class="p">{</span>\n        <span class="nf">initVerification</span><span class="p">()</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Create <code>api/RedirectManager.kt</code> to encapsulate obtaining a <code>TruSDK</code> instance and performing the network request with SubscriberCheck URL over the mobile data connection.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">RedirectManager</span> <span class="p">{</span>\n    <span class="k">private</span> <span class="kd">val</span> <span class="py">truSdk</span> <span class="p">=</span> <span class="nc">TruSDK</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">()</span>\n\n    <span class="k">fun</span> <span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">checkUrl</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>\n        <span class="n">truSdk</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">checkUrl</span><span class="p">)</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Update the <code>createSubscriberCheck</code> function in <code>MainActivity.kt</code> to use the <code>RedirectManager</code> to request the SubscriberCheck URL from the previous step. This enables the mobile network operator and the <strong>tru.ID</strong> platform to verify the phone number is associated with the mobile data session.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="kd">val</span> <span class="py">redirectManager</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span> <span class="nc">RedirectManager</span><span class="p">()</span> <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>\n            <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">createSubscriberCheck</span><span class="p">(</span>\n                <span class="nc">SubscriberCheckPost</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>\n            <span class="p">)</span>\n\n            <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="p">&amp;&amp;</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>\n                <span class="kd">val</span> <span class="py">subscriberCheck</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="k">as</span> <span class="nc">SubscriberCheck</span>\n                <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">subscriberCheck</span><span class="p">)</span>\n            <span class="p">}</span>\n            <span class="k">else</span> <span class="p">{</span>\n                <span class="nf">updateUIonError</span><span class="p">(</span><span class="s">"Error Occurred: ${response.message()}"</span><span class="p">)</span>\n            <span class="p">}</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>\n            <span class="n">redirectManager</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_url</span><span class="p">)</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUIonError</span><span class="p">(</span><span class="n">additionalInfo</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="n">additionalInfo</span><span class="p">)</span>\n        <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>\n            <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="3-get-the-subscribercheck-results" href="#3-get-the-subscribercheck-results">\n  </a>\n  3. Get the SubscriberCheck Results\n</h3>\n\n<p>Once the SubscriberCheck URL has been requested the <strong>tru.ID</strong> platform now knows the check request has been performed. Your mobile application should query the result via your server application. This will in turn trigger the <strong>tru.ID</strong> platform to fetch the SubscriberCheck match result from the MNO (Mobile Network Operator).</p>\n\n<p>Add the SubscriberCheckResult model to <code>Model.kt</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">data class</span> <span class="nc">SubscriberCheckResult</span><span class="p">(</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"match"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">match</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">,</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">check_id</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>\n    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s">"no_sim_change"</span><span class="p">)</span>\n    <span class="kd">val</span> <span class="py">no_sim_change</span><span class="p">:</span> <span class="nc">Boolean</span>\n<span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Add a <code>getSubscriberCheckResult</code> function to the <code>ApiService</code> interface:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">interface</span> <span class="nc">ApiService</span> <span class="p">{</span>\n    <span class="nd">@Headers</span><span class="p">(</span><span class="s">"Content-Type: application/json"</span><span class="p">)</span>\n    <span class="nd">@POST</span><span class="p">(</span><span class="s">"/subscriber-check"</span><span class="p">)</span>\n    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">(</span><span class="nd">@Body</span> <span class="n">user</span><span class="p">:</span> <span class="nc">SubscriberCheckPost</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheck</span><span class="p">&gt;</span>\n\n    <span class="nd">@GET</span><span class="p">(</span><span class="s">"/subscriber-check/{check_id}"</span><span class="p">)</span>\n    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="nd">@Path</span><span class="p">(</span><span class="s">"check_id"</span><span class="p">)</span> <span class="n">checkId</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Response</span><span class="p">&lt;</span><span class="nc">SubscriberCheckResult</span><span class="p">&gt;</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now it\'s time to find out if the phone number was verified successfully. Create a new <code>getSubscriberCheckResult</code> function in <code>MainActivity.kt</code> and call it after the <code>redirectManager.openCheckUrl</code>. The call to <code>getSubscriberCheckResult</code> must be done within the coroutine to ensure the check URL request has completed.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">openCheckURL</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>\n            <span class="n">redirectManager</span><span class="p">.</span><span class="nf">openCheckUrl</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_url</span><span class="p">)</span>\n\n            <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nc">SubscriberCheck</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nc">CoroutineScope</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">IO</span><span class="p">).</span><span class="nf">launch</span> <span class="p">{</span>\n            <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nc">RetrofitBuilder</span><span class="p">.</span><span class="n">apiClient</span><span class="p">.</span><span class="nf">getSubscriberCheckResult</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">check_id</span><span class="p">)</span>\n            <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">isSuccessful</span> <span class="p">&amp;&amp;</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>\n                <span class="kd">val</span> <span class="py">subscriberCheckResult</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span> <span class="k">as</span> <span class="nc">SubscriberCheckResult</span>\n\n                <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">)</span>\n            <span class="p">}</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">:</span> <span class="nc">SubscriberCheckResult</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"TODO: update the UI"</span><span class="p">)</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>There you go, based on the <code>subscriberCheckResult</code> you may notify the user that the authentication has completed.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateUI</span><span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">:</span> <span class="nc">SubscriberCheckResult</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">if</span> <span class="p">(</span><span class="n">subscriberCheckResult</span><span class="p">.</span><span class="n">match</span> <span class="p">&amp;&amp;</span> <span class="n">subscriberCheckResult</span><span class="p">.</span><span class="n">no_sim_change</span><span class="p">)</span> <span class="p">{</span>\n                <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone verification complete"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>\n            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n                <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone verification failed"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>\n            <span class="p">}</span>\n\n            <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The value of <code>no_sim_change</code> indicates if the SIM card has not been changed in the last 7 days. For example, in the case of <code>match = true</code> but <code>no_sim_change = false</code> the phone number has been verified but the fact the SIM card has changed recently means that it\'s good practice to perform additional user checks before allowing them to register or login.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--eG3p1aa1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/heag3e465bo9w3dmfck3.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eG3p1aa1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/heag3e465bo9w3dmfck3.jpeg" alt=\'A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number". There is a little pop up at the bottom of the screen with a grey background and white text saying "Verification Done"\' loading="lazy" width="270" height="540"></a></p>\n\n<p>In an application that contains more than a login or signup activity you would now show either a screen to capture more user information or the successfully registered/logged-in screen.</p>\n\n<h3>\n  <a name="try-out-sim-card-based-authentication" href="#try-out-sim-card-based-authentication">\n  </a>\n  Try Out SIM Card Based Authentication\n</h3>\n\n<p>Now that your code is complete, you can run the application on a real device. Bear in mind that SIM card based authentication is not be possible against an emulator.</p>\n\n<p>Enter the phone number for the mobile device in the UI in the format +{country_code}{number} e.g. <code>+447900123456</code>.</p>\n\n<p>Touch the "Verify my phone number" button.</p>\n\n<p>Congratulations! You\'ve finished the <strong>SIM Card Based Mobile Authentication for Android</strong> Tutorial.</p>\n\n<h2>\n  <a name="where-next" href="#where-next">\n  </a>\n  Where next?\n</h2>\n\n<p>You can view a completed version of this sample app in the <a href="https://github.com/tru-ID/sim-card-auth-android">sim-card-auth-android repo</a> on GitHub.</p>\n\n<h3>\n  <a name="optional-step-client-side-phone-number-prevalidation" href="#optional-step-client-side-phone-number-prevalidation">\n  </a>\n  Optional step: Client side phone number pre-validation\n</h3>\n\n<p>The minimum phone number pre-validation that can be achieved on the client side is to validate the phone number format with <code>libphonenumber</code>.</p>\n\n<p>Update <code>app/build.gradle</code> to include this library:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">\'com.googlecode.libphonenumber:libphonenumber:8.12.10\'</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And create a <code>util/PhoneNumberUtil.kt</code> utility that validates the phone number format +{country_code}{number} e.g. <code>+447900123456</code><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="k">fun</span> <span class="nf">isPhoneNumberFormatValid</span><span class="p">(</span><span class="n">phoneNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>\n    <span class="kd">val</span> <span class="py">phoneNumberUtil</span> <span class="p">=</span> <span class="nc">PhoneNumberUtil</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">()</span>\n    <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>\n        <span class="n">phoneNumberUtil</span><span class="p">.</span><span class="nf">isValidNumber</span><span class="p">(</span><span class="n">phoneNumberUtil</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span>\n                <span class="n">phoneNumber</span><span class="p">,</span> <span class="nc">Phonenumber</span><span class="p">.</span><span class="nc">PhoneNumber</span><span class="p">.</span><span class="nc">CountryCodeSource</span><span class="p">.</span><span class="nc">UNSPECIFIED</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">NumberParseException</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">false</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now invoke the phone number pre-validation on <code>createSubscriberCheck</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="k">private</span> <span class="k">fun</span> <span class="nf">createSubscriberCheck</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(!</span><span class="nf">isPhoneNumberFormatValid</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">toString</span><span class="p">()))</span> <span class="p">{</span>\n        <span class="nf">invalidateVerificationUI</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>\n        <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">container</span><span class="p">,</span> <span class="s">"Phone number invalid"</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_LONG</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>\n        <span class="k">return</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="optional-step-check-if-mobile-data-is-enabled-at-runtime" href="#optional-step-check-if-mobile-data-is-enabled-at-runtime">\n  </a>\n  Optional step: check if mobile data is enabled at runtime\n</h3>\n\n<p>The SubscriberCheck validation requires the device to have mobile data enabled. We can programmatically check if this is the case and launch Internet Connectivity settings dialog if required.</p>\n\n<p>Firstly, add a utility method <code>isMobileDataEnabled</code> to your <code>MainActivity.kt</code> to check if the mobile data is enabled:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="nd">@RequiresApi</span><span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">O</span><span class="p">)</span>\n    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isMobileDataEnabled</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>\n        <span class="kd">val</span> <span class="py">tm</span> <span class="p">=</span> <span class="nf">getSystemService</span><span class="p">(</span><span class="nc">TELEPHONY_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="nc">TelephonyManager</span>\n        <span class="k">return</span> <span class="n">tm</span><span class="p">.</span><span class="n">isDataEnabled</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The Activity Result APIs provide components for registering for a result, launching the result, and handling the result once it is dispatched by the system.</p>\n\n<p>To get started, add the dependencies:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">implementation</span> <span class="s1">\'androidx.activity:activity-ktx:1.2.0\'</span>\n<span class="n">implementation</span> <span class="s1">\'androidx.fragment:fragment-ktx:1.3.0\'</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The next step is to create a custom result contract <code>data/ConnectivitySettingsContract.kt</code>, this class would extend ActivityResultContract which requires defining input and output classes.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="kd">class</span> <span class="nc">ConnectivitySettingsContract</span> <span class="p">:</span> <span class="nc">ActivityResultContract</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Uri</span><span class="p">?&gt;()</span> <span class="p">{</span>\n    <span class="nd">@RequiresApi</span><span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">Q</span><span class="p">)</span>\n    <span class="k">override</span> <span class="k">fun</span> <span class="nf">createIntent</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Intent</span><span class="p">(</span><span class="nc">Settings</span><span class="p">.</span><span class="nc">Panel</span><span class="p">.</span><span class="nc">ACTION_INTERNET_CONNECTIVITY</span><span class="p">)</span>\n\n    <span class="k">override</span> <span class="k">fun</span> <span class="nf">parseResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?):</span> <span class="nc">Uri</span><span class="p">?</span> <span class="p">{</span>\n        <span class="nf">println</span><span class="p">(</span><span class="s">"Result code $resultCode"</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="p">(</span><span class="n">resultCode</span> <span class="p">!=</span> <span class="nc">Activity</span><span class="p">.</span><span class="nc">RESULT_OK</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">return</span> <span class="k">null</span>\n        <span class="p">}</span>\n\n        <span class="k">return</span> <span class="n">result</span><span class="o">?.</span><span class="n">data</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, we register a callback for an activity result, we do that by defining <code>registerForActivityResult()</code> which takes the <code>ConnectivitySettingsContract</code> and <code>ActivityResultCallback</code> and returns an <code>ActivityResultLauncher</code> which is used to launch the other activity:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="kd">val</span> <span class="py">startSettingsForResult</span> <span class="p">=</span> <span class="nf">registerForActivityResult</span><span class="p">(</span><span class="nc">ConnectivitySettingsContract</span><span class="p">())</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"Internet Connectivity Setting dismissed"</span><span class="p">)</span>\n        <span class="nf">initVerification</span><span class="p">()</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>If the mobile data is disabled we launch the previously created <code>ActivityResultLauncher</code>, as follows:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initVerification</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="s">"phoneNumber "</span> <span class="p">+</span> <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>\n        <span class="c1">// close virtual keyboard when sign in starts</span>\n        <span class="n">binding</span><span class="p">.</span><span class="n">phoneNumber</span><span class="p">.</span><span class="nf">onEditorAction</span><span class="p">(</span><span class="nc">EditorInfo</span><span class="p">.</span><span class="nc">IME_ACTION_DONE</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">&gt;=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">O</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">if</span> <span class="p">(!</span><span class="nf">isMobileDataEnabled</span><span class="p">())</span> <span class="p">{</span>\n                <span class="n">startSettingsForResult</span><span class="p">.</span><span class="nf">launch</span><span class="p">(</span><span class="nc">CONNECTIVITY_SETTINGS_ACTION</span><span class="p">)</span>\n                <span class="k">return</span>\n            <span class="p">}</span>\n        <span class="p">}</span>\n        <span class="nf">startVerification</span><span class="p">()</span>\n    <span class="p">}</span>\n\n    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>\n        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TAG</span> <span class="p">=</span> <span class="s">"MainActivity"</span>\n        <span class="k">const</span> <span class="kd">val</span> <span class="py">CONNECTIVITY_SETTINGS_ACTION</span> <span class="p">=</span> <span class="mi">1</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5TTbD5qa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tmkbrsbiglrzl6uvakm0.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5TTbD5qa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tmkbrsbiglrzl6uvakm0.jpeg" alt="A screenshot of Android connectivity settings" loading="lazy" width="270" height="540"></a></p>\n\n<h3>\n  <a name="programmatically-reading-the-device-phone-number" href="#programmatically-reading-the-device-phone-number">\n  </a>\n  Programmatically reading the device Phone Number\n</h3>\n\n<p>If you\'re trying to create a even more magical phone number verification experience, you can make the phone number input part of the app\'s responsibility.</p>\n\n<p>One option is to use <a href="https://developers.google.com/identity/sms-retriever/request#1_obtain_the_users_phone_number">Play Services auth-api-phone library</a> hint picker that prompts the user to choose from the phone numbers stored on the device and thereby avoid having to manually type a phone number.</p>\n\n<h2>\n  <a name="troubleshooting" href="#troubleshooting">\n  </a>\n  Troubleshooting\n</h2>\n\n<h3>\n  <a name="mobile-data-is-required" href="#mobile-data-is-required">\n  </a>\n  Mobile Data is Required\n</h3>\n\n<p>Don\'t forget the SubscriberCheck validation requires the device to enable mobile data.</p>\n\n<h3>\n  <a name="check-the-http-logging-output" href="#check-the-http-logging-output">\n  </a>\n  Check the HTTP Logging Output\n</h3>\n\n<p>Because we have attached a <em>HttpLoggingInterceptor</em> you can use adb logs to debug your SubscriberCheck:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>I/okhttp.OkHttpClient: --&gt; POST https://mylocalserver.example/subscriber-check\nI/okhttp.OkHttpClient: {"phone_number":"+447XXXXXXXXX"}\nI/okhttp.OkHttpClient: --&gt; END POST (32-byte body)\nI/okhttp.OkHttpClient: &lt;-- 200 https://mylocalserver.example/check (1479ms)\nI/okhttp.OkHttpClient: {"check_id":"NEW_CHECK_ID","check_url":"https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect"}\nI/okhttp.OkHttpClient: &lt;-- END HTTP (157-byte body)\n\nD/RedirectManager: Triggering open check url https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect\nI/SDK::checkUrl: Triggering check url\nI/System.out: Response to https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect\nD/LoginActivity: redirect done [7961ms]\nI/okhttp.OkHttpClient: --&gt; GET https://mylocalserver.example/subscriber-check/NEW_CHECK_ID\nI/okhttp.OkHttpClient: --&gt; END GET\nI/okhttp.OkHttpClient: &lt;-- 200 https://mylocalserver.example/subscriber-check/NEW_CHECK_ID (749ms)\nI/okhttp.OkHttpClient: {"match":true,"check_id":"NEW_CHECK_ID","no_sim_change":true}\nI/okhttp.OkHttpClient: &lt;-- END HTTP (64-byte body)\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name="check-the-development-server-logging" href="#check-the-development-server-logging">\n  </a>\n  Check the Development Server Logging\n</h3>\n\n<p>The <a href="https://github.com/tru-ID/dev-server">development server</a> also logs information out to the terminal including request and response payloads. Check that output for any errors or unexpected values.</p>\n\n<h3>\n  <a name="get-in-touch" href="#get-in-touch">\n  </a>\n  Get in touch\n</h3>\n\n<p>If you have any questions, get in touch via <a href="//mailto:help@tru.id">help@tru.id</a>.</p>\n\n',a.body_markdown='Validating user identity is incredibly important in mobile applications. The most common approaches to this are social login or, as seen with apps such as WhatsApp, Telegram, Line, WeChat and many more, the mobile phone number. Using a mobile phone number as a unique identifier on a mobile application, verified via an SMS PIN code, makes logical sense. Unfortunately, there are [flaws with SMS-based verification](https://tru.id/blog/msisdn-vs-imsi-and-mobile-identity) that result in poor UX such as long waits, failed delivery, and the risk of SIM Swap attacks.\n\nThe solution? Authentication based on the SIM card, which can confirm the ownership of a mobile phone number by verifying the possession of an active SIM with the same number. It also indicates when the SIM card associated with a phone number was last changed as a signal for SIM swap detection.\n\nAlong with adding cryptographically secure phone verification to an application and protecting the user from SIM swap attacks, SIM card based authentication improves the user experience. No more one-time code exchange, custom logic to handle mistyped PINS, or retries due to SMS delivery failure. The user never leaves the app and the entire verification happens seamlessly.\n\nFewer dependencies, better security and a better experience.\n\nIn this tutorial we\'ll cover how to add SIM card based phone authentication to and Android application using [**tru.ID SubscriberCheck**](https://developer.tru.id/docs/subscriber-check).\n\nThe completed Android sample app in the [sim-card-auth-android repo](https://github.com/tru-ID/sim-card-auth-android) on GitHub. The repo includes a README with documentation for running and exploring the code.\n\nLet\'s run through building this application step by step.\n\n## Before you Begin\n\nTo complete this tutorial you\'ll need an up to date version of [Android Studio](https://developer.android.com/studio) installed, some basic knowledge of Kotlin programming and [Node.js](https://nodejs.org/en/download/) installed. You\'ll also need a physical Android device with an active SIM card because SubscriberCheck verifies a phone number by making a web request over a mobile data session.\n\n## Get Setup with **tru.ID**\n\nSign up for a [**tru.ID** account](https://developer.tru.id/signup) which comes with some free credit. Then install the [**tru.ID** CLI](https://github.com/tru-ID/cli):\n\n```bash\nnpm install -g @tru_id/cli\n```\n\nRun `tru setup:credentials` using the credentials from the [**tru.ID** console](https://developer.tru.id/console):\n\n```bash\ntru setup:credentials {YOUR_CLIENT_ID} {YOUR_CLIENT_SECRET}\n```\n\nInstall the CLI [development server plugin](https://github.com/tru-ID/cli-plugin-dev-server):\n\n```bash\ntru plugins:install @tru_id/cli-plugin-dev-server@canary\n```\n\nCreate a new **tru.ID** project:\n\n```bash\ntru projects:create AuthDemo\n```\n\nThis will save a `tru.json` **tru.ID** project configuration to `./authdemo/tru.json`.\n\nRun the development server, pointing it to the directly containing the newly created project configuration. This will also open up a localtunnel to your development server, making it publicly accessible to the Internet so that your mobile phone can access it when only connected to mobile data.\n\n```bash\ntru server -t --project-dir ./authdemo\n```\n\nOpen up the URL that is shown in the terminal, which will be in the format `https://{subdomain}.loca.lt`, in your desktop web browser to check that it is accessible.\n\nWith the development server setup we can move on to building the Android application.\n\n## Creating a New Android Project\n\nFirst, you have to create a new Android application using Android Studio. The app name is "SIMAuthentication". The package name is `id.tru.authentication.demo`.\nClick through the wizard, ensuring that "Empty Activity" is selected. Leave the "Activity Name" set to `MainActivity`, and leave the "Layout Name" set to `activity_main`.\n\nThe [`tru-sdk-android`](https://github.com/tru-ID/tru-sdk-android) is available on Android devices with minimum Android SDK Version 21 (Lollipop), therefore select minSdkVersion = 21 once creating the project.\n\n## Phone Number Authentication UI\n\nThe first screen will be our Verification screen on which the user has to enter their phone number. After adding their phone number, the user will click on a "Verify my phone number" button to initiate the verification worflow.\n\nThe user interface is straight forward: a `ConstraintLayout` with one `TextInputEditText` `phone_number` inside a `TextInputLayout` `input_layout` for phone number input and a Button to trigger the verification, followed by a `progress_bar` where the user is updated on the progress, as we will see later on. Update `activity_main.xml` with the following:\n\n```xml\n<?xml version="1.0" encoding="utf-8"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:app="http://schemas.android.com/apk/res-auto"\n    xmlns:tools="http://schemas.android.com/tools"\n    android:id="@+id/container"\n    android:layout_width="match_parent"\n    android:layout_height="match_parent"\n    tools:context=".MainActivity"\n    android:paddingLeft="36dp"\n    android:paddingTop="220dp"\n    android:paddingRight="36dp">\n\n\n    <TextView\n        android:id="@+id/sign_in_header"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:text="To experience tru.ID verification, please enter your phone number"\n        android:textStyle="bold"\n        app:layout_constraintEnd_toEndOf="parent"\n        app:layout_constraintStart_toStartOf="parent"\n        app:layout_constraintTop_toTopOf="parent" />\n\n    <com.google.android.material.textfield.TextInputLayout\n        android:id="@+id/input_layout"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        app:errorEnabled="true"\n        app:counterEnabled="true"\n        app:counterMaxLength="13"\n        android:layout_marginTop="20dp"\n        style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"\n        app:layout_constraintEnd_toEndOf="parent"\n        app:layout_constraintStart_toStartOf="parent"\n        app:layout_constraintTop_toBottomOf="@+id/sign_in_header">\n\n        <com.google.android.material.textfield.TextInputEditText\n            android:id="@+id/phone_number"\n            android:layout_width="match_parent"\n            android:layout_height="wrap_content"\n            android:gravity="top|center"\n            android:hint="Phone number"\n            android:inputType="phone"\n            android:imeOptions="actionDone"\n            app:layout_constraintEnd_toEndOf="parent"\n            app:layout_constraintStart_toStartOf="parent"\n            app:layout_constraintTop_toBottomOf="@+id/textView" />\n    </com.google.android.material.textfield.TextInputLayout>\n\n    <Button\n        android:id="@+id/verify"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:layout_gravity="center"\n        android:layout_marginTop="20dp"\n        android:background="#6200EE"\n        android:text="Verify my phone number"\n        android:textAllCaps="false"\n        android:textColor="@android:color/white"\n        android:enabled="false"\n        app:layout_constraintBottom_toBottomOf="@+id/input_layout"\n        app:layout_constraintEnd_toEndOf="parent"\n        app:layout_constraintStart_toStartOf="parent"\n        app:layout_constraintTop_toTopOf="@+id/progress_bar"\n        app:layout_constraintVertical_bias="0.698" />\n\n    <com.google.android.material.progressindicator.LinearProgressIndicator\n        android:id="@+id/progress_bar"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:indeterminate="true"\n        android:visibility="invisible"\n        android:layout_marginTop="100dp"\n        app:layout_constraintEnd_toEndOf="parent"\n        app:layout_constraintStart_toStartOf="parent"\n        app:layout_constraintTop_toBottomOf="@+id/verify"/>\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\nMake sure to update the dependencies for `ConstraintLayout` and Material Components with the latest available versions with `app/build.gradle`:\n\n```groovy\nimplementation \'com.google.android.material:material:1.3.0\'\nimplementation \'androidx.constraintlayout:constraintlayout:2.0.4\'\n```\n\nThe main screen will look like this:\n\n![A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number"](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mm8l69yqk4x0n5m01n1n.png)\n\nTo enable view binding that allows you to more easily write code that interacts with views set the `viewBinding` build option to `true` in the `app/build.gradle` file and :\n\n```\nandroid {\n    buildFeatures {\n        viewBinding true\n    }\n}\n```\n\nBind the verification workflow to the verify button within `app/src/main/java/id/tru/authentication/demo/MainActivity.kt`:\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private var _binding: ActivityMainBinding? = null\n    private val binding get() = _binding!!\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        _binding = ActivityMainBinding.inflate(layoutInflater)\n        setContentView(binding.root)\n\n        binding.verify.setOnClickListener {\n            initVerification()\n        }\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        _binding = null\n    }\n\n    private fun initVerification() {\n        Log.d(TAG, "Verify button clicked")\n    }\n\n    companion object {\n        private const val TAG = "MainActivity"\n    }\n}\n```\n\nEach time a verification is started we invalidate the UI, making sure all fields are reset, in order to cater for subsequent verification attempts:\n\n```kotlin\n    /** Called when the user taps the verify button */\n    private fun initVerification() {\n        Log.d(TAG, "phoneNumber " + binding.phoneNumber.text)\n        // close virtual keyboard when sign in starts\n        binding.phoneNumber.onEditorAction(EditorInfo.IME_ACTION_DONE)\n\n        invalidateVerificationUI(false)\n    }\n\n    private fun invalidateVerificationUI(isEnabled: Boolean) {\n        if (isEnabled) {\n            binding.progressBar.hide()\n            binding.phoneNumber.setText("")\n        } else {\n            binding.progressBar.show()\n        }\n        binding.verify.isEnabled = isEnabled\n        binding.phoneNumber.isEnabled = isEnabled\n    }\n```\n\n![A screenshot of a mobile app in Android showing a text field with a phone number entered and a button greyed out to show the verification is in progress](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bfstp3giv4mb7huyy3t7.jpeg)\n\nNow, let\'s proceed to initiate a SubscriberCheck workflow, as described in the next section.\n\n## SubscriberCheck Workflow\n\nThe sequence diagram below shows the complete SubscriberCheck Workflow. For this tutorial we\'ll focus on the `Device` and `Device -> Server` logic.\n\n![An image showing the flow between the mobile app, backend webserver, tru.ID and the users Mobile network operator](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5wjv6n5o893b0h6i7x8q.png)\n\nCreate a `app/tru-id.properties` file and set the value of `EXAMPLE_SERVER_BASE_URL` to be the public URL of your development server:\n\n```\nEXAMPLE_SERVER_BASE_URL="https://{subdomain}.loca.lt"\n```\n\nTo perform network operations in your application such as making requests to the verification server, your `AndroidManifest.xml` must include `android.permission.INTERNET` and `android.permission.ACCESS_NETWORK_STATE` permissions. Also, some mobile network operator check requests are over HTTP (and not HTTPS) so the application must also allow [cleartext network traffic](https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic). Note that no data is sent over the HTTP request. The request is used by the MNO to verify that the device is connected to their mobile data network.\n\nYour `AndroidManifest.xml` will look as follows:\n\n```xml\n<?xml version="1.0" encoding="utf-8"?>\n<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n    package="id.tru.authentication.demo">\n\n    <uses-permission android:name="android.permission.INTERNET" />\n    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />\n\n    <application\n        android:usesCleartextTraffic="true"\n        android:allowBackup="true"\n        android:icon="@mipmap/ic_launcher"\n        android:label="@string/app_name"\n        android:roundIcon="@mipmap/ic_launcher_round"\n        android:supportsRtl="true"\n        android:theme="@style/Theme.MaterialComponents.Light.NoActionBar">\n\n        <activity android:name=".MainActivity">\n            <intent-filter>\n                <action android:name="android.intent.action.MAIN" />\n\n                <category android:name="android.intent.category.LAUNCHER" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\nBoth the Internet and `ACCESS_NETWORK_STATE` permissions are [normal permissions](https://developer.android.com/guide/topics/permissions/overview#normal-dangerous), which means they\'re granted at install time and don\'t need to be requested at runtime.\n\nIn order to communicate with our local server the app needs to read in the `app/tru-id.properties` file containing the server URL and set a build configuration field. We want to include Retrofit, relevant JSON converters and OkHttp. Finally, include kotlinx-coroutine:\n\nUpdate `app/build.gradle` with the following additions:\n\n```groovy\ndef props = new Properties()\nfile("tru-id.properties").withInputStream { props.load(it) }\n\nandroid {\n    defaultConfig {\n        buildConfigField("String", "SERVER_BASE_URL", props.getProperty("EXAMPLE_SERVER_BASE_URL"))\n    }\n\n    dependencies {\n        implementation \'com.squareup.retrofit2:retrofit:2.9.0\'\n        implementation \'com.squareup.retrofit2:converter-gson:2.9.0\'\n        implementation \'com.squareup.okhttp3:okhttp:4.9.0\'\n        implementation \'com.squareup.okhttp3:logging-interceptor:4.9.0\'\n        implementation \'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.7\'\n        implementation \'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.0\'\n    }\n}\n```\n\n### 1. Create a SubscriberCheck\n\nTo start the phone number verification flow in an Android app, the user enters their phone number and either presses the done keyboard key or touch the "Verify my phone number" button. The application then sends the phone number to your verification server that will create a SubscriberCheck resource on the **tru.ID** platform.\n\nSo, in order to create a SubscriberCheck a `phone_number` is required, and once created, the SubscriberCheck will contain a `check_url` and a `check_id`.\n\nLet\'s create these required models for our network operations in a new file `data/Model.kt`:\n\n```kotlin\ndata class SubscriberCheckPost(\n    @SerializedName("phone_number")\n    val phone_number: String\n)\n\ndata class SubscriberCheck(\n    @SerializedName("check_url")\n    val check_url: String,\n    @SerializedName("check_id")\n    val check_id: String\n)\n```\n\nNext, create an `ApiService` interface in `api/ApiService.kt` that makes use of the models, making a `POST` request to the `/subscriber-check` endpoint on the development server:\n\n```kotlin\ninterface ApiService {\n    @Headers("Content-Type: application/json")\n    @POST("/subscriber-check")\n    suspend fun createSubscriberCheck(@Body user: SubscriberCheckPost): Response<SubscriberCheck>\n}\n```\n\nCreate a new file, `api/RetrofitBuilder.kt`, and within it create a Retrofit instance using `Retrofit.Builder`, passing the `ApiService` interface to generate an implementation.\n\nWe are also adding the `HttpLoggingInterceptor` so we can check what is going on every step of the way.\n\n```kotlin\nobject RetrofitBuilder {\n    val apiClient: ApiService by lazy {\n\n        val httpLoggingInterceptor = HttpLoggingInterceptor()\n        httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);\n\n        val okHttpClient = OkHttpClient()\n            .newBuilder()\n            //httpLogging interceptor for logging network requests\n            .addInterceptor(httpLoggingInterceptor)\n            .build()\n\n        Retrofit.Builder()\n            .baseUrl(BuildConfig.SERVER_BASE_URL)\n            .client(okHttpClient)\n            .addConverterFactory(GsonConverterFactory.create())\n            .build()\n            .create(ApiService::class.java)\n    }\n}\n```\n\nNote that the `BuildConfig.SERVER_BASE_URL` will be set with the value of `EXAMPLE_SERVER_BASE_URL` you defined in `tru-id.properties`.\n\nNow we are ready to inform the user the verification process has started and create the SubscriberCheck using the provided phone number within `MainActivity.kt`:\n\n```kotlin\n    /** Called when the user taps the verify button */\n    private fun initVerification() {\n        Log.d(TAG, "phoneNumber " + binding.phoneNumber.text)\n        // close virtual keyboard when sign in starts\n        binding.phoneNumber.onEditorAction(EditorInfo.IME_ACTION_DONE)\n\n        invalidateVerificationUI(false)\n        createSubscriberCheck()\n    }\n\n    private fun createSubscriberCheck() {\n        CoroutineScope(Dispatchers.IO).launch {\n\n            val subscriberCheck = RetrofitBuilder.apiClient.createSubscriberCheck(\n                SubscriberCheckPost(binding.phoneNumber.text.toString())\n            )\n        }\n    }\n```\n\n### 2. Use the **tru.ID** SDK to Request the SubscriberCheck URL\n\nAt this point you\'re going to add the `tru-sdk-android` SDK to your project to enable the SubscriberCheck URL to be requested over a mobile data connection.\n\nEdit the `build.gradle` at your project\'s root and add the following code snippet to the `allprojects/repositories` section:\n\n```groovy\nallprojects {\n    repositories {\n        google()\n        jcenter()\n        maven {\n            url "https://gitlab.com/api/v4/projects/22035475/packages/maven"\n        }\n        maven { url \'https://jitpack.io\' }\n    }\n}\n```\n\nAdd the SDK dependency to `app/build.gradle` and sync the project.\n\n```groovy\nimplementation \'id.tru.sdk:tru-sdk-android:0.0.+\'\n```\n\nInitialize the `TruSDK` within `onCreate` in `MainActivity.kt`:\n\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n\n    TruSDK.initializeSdk(applicationContext)\n\n    _binding = ActivityMainBinding.inflate(layoutInflater)\n    setContentView(binding.root)\n\n    binding.verify.setOnClickListener {\n        initVerification()\n    }\n}\n```\n\nCreate `api/RedirectManager.kt` to encapsulate obtaining a `TruSDK` instance and performing the network request with SubscriberCheck URL over the mobile data connection.\n\n```kotlin\nclass RedirectManager {\n    private val truSdk = TruSDK.getInstance()\n\n    fun openCheckUrl(checkUrl: String) {\n        truSdk.openCheckUrl(checkUrl)\n    }\n}\n```\n\nUpdate the `createSubscriberCheck` function in `MainActivity.kt` to use the `RedirectManager` to request the SubscriberCheck URL from the previous step. This enables the mobile network operator and the **tru.ID** platform to verify the phone number is associated with the mobile data session.\n\n```kotlin\n    private val redirectManager by lazy { RedirectManager() }\n\n    private fun createSubscriberCheck() {\n        CoroutineScope(Dispatchers.IO).launch {\n            val response = RetrofitBuilder.apiClient.createSubscriberCheck(\n                SubscriberCheckPost(binding.phoneNumber.text.toString())\n            )\n\n            if (response.isSuccessful && response.body() != null) {\n                val subscriberCheck = response.body() as SubscriberCheck\n                openCheckURL(subscriberCheck)\n            }\n            else {\n                updateUIonError("Error Occurred: ${response.message()}")\n            }\n        }\n    }\n\n    private fun openCheckURL(check: SubscriberCheck) {\n        CoroutineScope(Dispatchers.IO).launch {\n            redirectManager.openCheckUrl(check.check_url)\n        }\n    }\n\n    private suspend fun updateUIonError(additionalInfo: String) {\n        Log.e(TAG, additionalInfo)\n        withContext(Dispatchers.Main) {\n            invalidateVerificationUI(true)\n        }\n    }\n```\n\n### 3. Get the SubscriberCheck Results\n\nOnce the SubscriberCheck URL has been requested the **tru.ID** platform now knows the check request has been performed. Your mobile application should query the result via your server application. This will in turn trigger the **tru.ID** platform to fetch the SubscriberCheck match result from the MNO (Mobile Network Operator).\n\nAdd the SubscriberCheckResult model to `Model.kt`:\n\n```kotlin\ndata class SubscriberCheckResult(\n    @SerializedName("match")\n    val match: Boolean,\n    @SerializedName("check_id")\n    val check_id: String,\n    @SerializedName("no_sim_change")\n    val no_sim_change: Boolean\n)\n```\n\nAdd a `getSubscriberCheckResult` function to the `ApiService` interface:\n\n```kotlin\ninterface ApiService {\n    @Headers("Content-Type: application/json")\n    @POST("/subscriber-check")\n    suspend fun createSubscriberCheck(@Body user: SubscriberCheckPost): Response<SubscriberCheck>\n\n    @GET("/subscriber-check/{check_id}")\n    suspend fun getSubscriberCheckResult(@Path("check_id") checkId: String): Response<SubscriberCheckResult>\n}\n```\n\nNow it\'s time to find out if the phone number was verified successfully. Create a new `getSubscriberCheckResult` function in `MainActivity.kt` and call it after the `redirectManager.openCheckUrl`. The call to `getSubscriberCheckResult` must be done within the coroutine to ensure the check URL request has completed.\n\n```kotlin\n    private fun openCheckURL(check: SubscriberCheck) {\n        CoroutineScope(Dispatchers.IO).launch {\n            redirectManager.openCheckUrl(check.check_url)\n\n            getSubscriberCheckResult(check)\n        }\n    }\n\n    private fun getSubscriberCheckResult(check: SubscriberCheck) {\n        CoroutineScope(Dispatchers.IO).launch {\n            val response = RetrofitBuilder.apiClient.getSubscriberCheckResult(check.check_id)\n            if(response.isSuccessful && response.body() != null) {\n                val subscriberCheckResult = response.body() as SubscriberCheckResult\n\n                updateUI(subscriberCheckResult)\n            }\n        }\n    }\n\n    private suspend fun updateUI(subscriberCheckResult: SubscriberCheckResult) {\n        Log.d(TAG, "TODO: update the UI")\n    }\n```\n\nThere you go, based on the `subscriberCheckResult` you may notify the user that the authentication has completed.\n\n```kotlin\n    private suspend fun updateUI(subscriberCheckResult: SubscriberCheckResult) {\n        withContext(Dispatchers.Main) {\n            if (subscriberCheckResult.match && subscriberCheckResult.no_sim_change) {\n                Snackbar.make(binding.container, "Phone verification complete", Snackbar.LENGTH_LONG).show()\n            } else {\n                Snackbar.make(binding.container, "Phone verification failed", Snackbar.LENGTH_LONG).show()\n            }\n\n            invalidateVerificationUI(true)\n        }\n    }\n```\n\nThe value of `no_sim_change` indicates if the SIM card has not been changed in the last 7 days. For example, in the case of `match = true` but `no_sim_change = false` the phone number has been verified but the fact the SIM card has changed recently means that it\'s good practice to perform additional user checks before allowing them to register or login.\n\n![A screenshot of a mobile app in Android showing a text field with a placeholder "Phone Number" and a button with a blue background, and white text "Verify my Phone Number". There is a little pop up at the bottom of the screen with a grey background and white text saying "Verification Done"](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/heag3e465bo9w3dmfck3.jpeg)\n\nIn an application that contains more than a login or signup activity you would now show either a screen to capture more user information or the successfully registered/logged-in screen.\n\n### Try Out SIM Card Based Authentication\n\nNow that your code is complete, you can run the application on a real device. Bear in mind that SIM card based authentication is not be possible against an emulator.\n\nEnter the phone number for the mobile device in the UI in the format +{country_code}{number} e.g. `+447900123456`.\n\nTouch the "Verify my phone number" button.\n\nCongratulations! You\'ve finished the **SIM Card Based Mobile Authentication for Android** Tutorial.\n\n## Where next?\n\nYou can view a completed version of this sample app in the [sim-card-auth-android repo](https://github.com/tru-ID/sim-card-auth-android) on GitHub.\n\n### Optional step: Client side phone number pre-validation\n\nThe minimum phone number pre-validation that can be achieved on the client side is to validate the phone number format with `libphonenumber`.\n\nUpdate `app/build.gradle` to include this library:\n\n```groovy\nimplementation \'com.googlecode.libphonenumber:libphonenumber:8.12.10\'\n```\n\nAnd create a `util/PhoneNumberUtil.kt` utility that validates the phone number format +{country_code}{number} e.g. `+447900123456`\n\n```kotlin\nfun isPhoneNumberFormatValid(phoneNumber: String): Boolean {\n    val phoneNumberUtil = PhoneNumberUtil.getInstance()\n    return try {\n        phoneNumberUtil.isValidNumber(phoneNumberUtil.parse(\n                phoneNumber, Phonenumber.PhoneNumber.CountryCodeSource.UNSPECIFIED.name))\n    } catch (e: NumberParseException) {\n        false\n    }\n}\n```\n\nNow invoke the phone number pre-validation on `createSubscriberCheck`:\n\n```kotlin\nprivate fun createSubscriberCheck() {\n    if (!isPhoneNumberFormatValid(binding.phoneNumber.text.toString())) {\n        invalidateVerificationUI(true)\n        Snackbar.make(binding.container, "Phone number invalid", Snackbar.LENGTH_LONG).show()\n        return\n    }\n```\n\n### Optional step: check if mobile data is enabled at runtime\n\nThe SubscriberCheck validation requires the device to have mobile data enabled. We can programmatically check if this is the case and launch Internet Connectivity settings dialog if required.\n\nFirstly, add a utility method `isMobileDataEnabled` to your `MainActivity.kt` to check if the mobile data is enabled:\n\n```kotlin\n    @RequiresApi(Build.VERSION_CODES.O)\n    private fun isMobileDataEnabled(): Boolean {\n        val tm = getSystemService(TELEPHONY_SERVICE) as TelephonyManager\n        return tm.isDataEnabled\n    }\n```\n\nThe Activity Result APIs provide components for registering for a result, launching the result, and handling the result once it is dispatched by the system.\n\nTo get started, add the dependencies:\n\n```groovy\nimplementation \'androidx.activity:activity-ktx:1.2.0\'\nimplementation \'androidx.fragment:fragment-ktx:1.3.0\'\n```\n\nThe next step is to create a custom result contract `data/ConnectivitySettingsContract.kt`, this class would extend ActivityResultContract<I,O> which requires defining input and output classes.\n\n```kotlin\nclass ConnectivitySettingsContract : ActivityResultContract<Int, Uri?>() {\n    @RequiresApi(Build.VERSION_CODES.Q)\n    override fun createIntent(context: Context, input: Int) = Intent(Settings.Panel.ACTION_INTERNET_CONNECTIVITY)\n\n    override fun parseResult(resultCode: Int, result: Intent?): Uri? {\n        println("Result code $resultCode")\n\n        if (resultCode != Activity.RESULT_OK) {\n            return null\n        }\n\n        return result?.data\n    }\n}\n```\n\nNext, we register a callback for an activity result, we do that by defining `registerForActivityResult()` which takes the `ConnectivitySettingsContract` and `ActivityResultCallback` and returns an `ActivityResultLauncher` which is used to launch the other activity:\n\n```kotlin\n    private val startSettingsForResult = registerForActivityResult(ConnectivitySettingsContract()) {\n        Log.i(TAG, "Internet Connectivity Setting dismissed")\n        initVerification()\n    }\n```\n\nIf the mobile data is disabled we launch the previously created `ActivityResultLauncher`, as follows:\n\n```kotlin\n    private fun initVerification() {\n        Log.d(TAG, "phoneNumber " + binding.phoneNumber.text)\n        // close virtual keyboard when sign in starts\n        binding.phoneNumber.onEditorAction(EditorInfo.IME_ACTION_DONE)\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            if (!isMobileDataEnabled()) {\n                startSettingsForResult.launch(CONNECTIVITY_SETTINGS_ACTION)\n                return\n            }\n        }\n        startVerification()\n    }\n\n    companion object {\n        private const val TAG = "MainActivity"\n        const val CONNECTIVITY_SETTINGS_ACTION = 1\n    }\n```\n\n![A screenshot of Android connectivity settings](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tmkbrsbiglrzl6uvakm0.jpeg)\n\n### Programmatically reading the device Phone Number\n\nIf you\'re trying to create a even more magical phone number verification experience, you can make the phone number input part of the app\'s responsibility.\n\nOne option is to use [Play Services auth-api-phone library](https://developers.google.com/identity/sms-retriever/request#1_obtain_the_users_phone_number) hint picker that prompts the user to choose from the phone numbers stored on the device and thereby avoid having to manually type a phone number.\n\n## Troubleshooting\n\n### Mobile Data is Required\n\nDon\'t forget the SubscriberCheck validation requires the device to enable mobile data.\n\n### Check the HTTP Logging Output\n\nBecause we have attached a _HttpLoggingInterceptor_ you can use adb logs to debug your SubscriberCheck:\n\n```code\nI/okhttp.OkHttpClient: --\x3e POST https://mylocalserver.example/subscriber-check\nI/okhttp.OkHttpClient: {"phone_number":"+447XXXXXXXXX"}\nI/okhttp.OkHttpClient: --\x3e END POST (32-byte body)\nI/okhttp.OkHttpClient: <-- 200 https://mylocalserver.example/check (1479ms)\nI/okhttp.OkHttpClient: {"check_id":"NEW_CHECK_ID","check_url":"https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect"}\nI/okhttp.OkHttpClient: <-- END HTTP (157-byte body)\n\nD/RedirectManager: Triggering open check url https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect\nI/SDK::checkUrl: Triggering check url\nI/System.out: Response to https://eu.api.tru.id/subscriber_check/v0.1/checks/NEW_CHECK_ID/redirect\nD/LoginActivity: redirect done [7961ms]\nI/okhttp.OkHttpClient: --\x3e GET https://mylocalserver.example/subscriber-check/NEW_CHECK_ID\nI/okhttp.OkHttpClient: --\x3e END GET\nI/okhttp.OkHttpClient: <-- 200 https://mylocalserver.example/subscriber-check/NEW_CHECK_ID (749ms)\nI/okhttp.OkHttpClient: {"match":true,"check_id":"NEW_CHECK_ID","no_sim_change":true}\nI/okhttp.OkHttpClient: <-- END HTTP (64-byte body)\n```\n\n### Check the Development Server Logging\n\nThe [development server](https://github.com/tru-ID/dev-server) also logs information out to the terminal including request and response payloads. Check that output for any errors or unexpected values.\n\n### Get in touch\n\nIf you have any questions, get in touch via [help@tru.id](mailto:help@tru.id).',a.user={name:"Greg Holmes",username:"gregholmes",twitter_username:"Greg__Holmes",github_username:"GregHolmes",website_url:"https://www.gregholmes.dev",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--1e3aXQHg--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/276831/e9a4e8ab-7862-4334-9a2e-4fc1faf3cae8.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--AL2U-Bhm--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/276831/e9a4e8ab-7862-4334-9a2e-4fc1faf3cae8.jpg"},a.organization={name:"tru.ID",username:e,slug:e,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--rWmOK6gr--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3637/d55dd5be-7eac-4747-b1e7-520475b5f5dd.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--iU4GhYif--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3637/d55dd5be-7eac-4747-b1e7-520475b5f5dd.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:n,state:{currentArticle:a},serverRendered:!0,routePath:"/gregholmes/863241",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:n}}}}(null,"2021-10-14T08:47:48Z",{},"tru-id")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
