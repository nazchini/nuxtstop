<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Working With Hierarchy Data In DynamoDB</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Working With Hierarchy Data In DynamoDB</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/serverless" class="tag" data-v-70afb46a>
          #serverless
        </a><a href="/nuxtstop/t/database" class="tag" data-v-70afb46a>
          #database
        </a><a href="/nuxtstop/t/dynamodb" class="tag" data-v-70afb46a>
          #dynamodb
        </a></div> <!----> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            25
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            3
          </span></div> <time data-v-70afb46a>Jul 6 '21</time></div></header> <div class="content" data-v-70afb46a><p>Working with hierarchies in DynamoDB can be a little intimidating. In this post I'll show you two ways to work with hierarchies, and hopefully take away some of the fear.</p>

<h2>
  <a name="the-path-pattern" href="#the-path-pattern">
  </a>
  The Path Pattern
</h2>

<p>The first, and most common, way to deal with hierarchy data in DynamoDB is what I refer to as the path pattern. If you think of you hierarchy data like a directory or folder structure on a computer, it's pretty easy to get your head around how this works. Each element in the tree represents a folder and finding what is in a folder is as simple as knowing the path to the folder. With the right table structure, you can query for items in a folder as well as all items in all folders below a given folder. Here is how that works.</p>

<p>We'll start with a simple folder structure. Imagine you have some data that is something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>  Drive C
    Folder I
    Folder II
  Drive D
    Folder III
      Folder a
      Folder b
    Folder IV
      Folder c
    Folder V
      Folder d
        Folder i
        Folder ii
        Folder iii
      Folder e
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>When storing this data in DynamoDB you would include the full path of each item with that item. You might have a table that looks something like this:</p>

<div class="table-wrapper-paragraph"><table>
<thead>
<tr>
<th>ID</th>
<th>Root</th>
<th>Path</th>
<th>Folder Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>C</td>
<td></td>
<td></td>
<td>Drive C</td>
</tr>
<tr>
<td>I</td>
<td>C</td>
<td>/</td>
<td>Folder I</td>
</tr>
<tr>
<td>II</td>
<td>C</td>
<td>/</td>
<td>Folder II</td>
</tr>
<tr>
<td>D</td>
<td></td>
<td></td>
<td>Drive D</td>
</tr>
<tr>
<td>III</td>
<td>D</td>
<td>/</td>
<td>Folder III</td>
</tr>
<tr>
<td>a</td>
<td>D</td>
<td>/III/</td>
<td>Folder a</td>
</tr>
<tr>
<td>b</td>
<td>D</td>
<td>/III/</td>
<td>Folder b</td>
</tr>
<tr>
<td>IV</td>
<td>D</td>
<td>/</td>
<td>Folder IV</td>
</tr>
<tr>
<td>c</td>
<td>D</td>
<td>/IV/</td>
<td>Folder c</td>
</tr>
<tr>
<td>V</td>
<td>D</td>
<td>/</td>
<td>Folder V</td>
</tr>
<tr>
<td>d</td>
<td>D</td>
<td>/V/</td>
<td>Folder d</td>
</tr>
<tr>
<td>i</td>
<td>D</td>
<td>/V/d/</td>
<td>Folder i</td>
</tr>
<tr>
<td>ii</td>
<td>D</td>
<td>/V/d/</td>
<td>Folder ii</td>
</tr>
<tr>
<td>iii</td>
<td>D</td>
<td>/V/d/</td>
<td>Folder iii</td>
</tr>
<tr>
<td>e</td>
<td>D</td>
<td>/V/</td>
<td>Folder e</td>
</tr>
</tbody>
</table></div>

<p>With the data in this format, you can get any single folder by its ID. You can list all folders directly under a folder by using the GSI (which will be the <code>Root</code> and the <code>Path</code>) and specifying the root and the path. You can also get all folders below a folder (all the way down the tree) by using the GSI and specifying the root and that the path <code>begins_with</code> the path of the folder.</p>

<p>The code to get the <code>Folder d</code> looks something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">Key</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">ID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">d</span><span class="dl">'</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Querying for a list of the items directly below <code>Folder V</code> would look something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">gsi1</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#root = :root AND #path = :path</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">#root</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Root</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">#path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Path</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">:root</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">D</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/V/</span><span class="dl">'</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Because the condition is <code>=</code> the only results will be those directly below <code>Folder V</code>; <code>Folder d</code> and <code>Folder e</code>.</p>

<p>Getting a list of all items below <code>Folder V</code> would look something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">gsi1</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#pk = :root AND begins_with(#sk, :path)</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">#root</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Root</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">#path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Path</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">:root</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">D</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/V/</span><span class="dl">'</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In this case the condition is <code>begins_with</code>, so the results will include all values below <code>Folder V</code>; <code>Folder d</code>, <code>Folder i</code>, <code>Folder ii</code>, <code>Folder iii</code>, and <code>Folder e</code>.</p>

<p>This pattern allows for a great deal of power when dealing with hierarchical data. I would say that most often this is the pattern you'll want to use.</p>

<h2>
  <a name="the-replication-pattern" href="#the-replication-pattern">
  </a>
  The Replication Pattern
</h2>

<p>While the above pattern is a very powerful tool in working with data in DynamoDB, I use it all the time, sometimes, you might find that it doesn't work for you. The above approach assumes that you will always know the structure above the node you are searching. In the examples, querying for items below a folder requires that you not only know the ID of the folder you wish to query, but you needed to know all the folders above it as well. In most cases that's not a problem, and even when you don't want to expose that information (maybe for security reasons), doing a quick lookup of that data is likely the best route (i.e., you can get the folder you want to query, and use that to know the path information above it without requiring that the caller supply the full path). So, when might you want to do something different?</p>

<h3>
  <a name="querying-varying-levels-of-depth" href="#querying-varying-levels-of-depth">
  </a>
  Querying varying levels of depth
</h3>

<p>In the first example you were limited to only being to query either items directly below a node, or all items below a node.</p>

<p>If you wanted to get all items <em>except</em> those directly below a node you'd have to query all items and filter the direct items out. That's not so bad if the number of direct items is a small number, but if you have a lot of data to exclude it's not ideal.</p>

<p>If you wanted to get just the items below a node and the items directly below those items (i.e., two levels deep from the node you're querying) you'd have to either query all the items and filter out the ones you don't want, or run multiple queries, one for the direct items, and one query for each of the results from that query. The first option may be okay if there aren't too many records you want to exclude, but if you are a large hierarchy, say you are working with employee data and you're the size of Amazon, doing that for the root node (e.g., the CEO) would probably not be the best idea. The second option may not be terrible, assuming the number of items directly below the node you are querying is small, but it's certainly not going to be as fast as querying it all at once. Yes, you can run the each of the sub node queries in parallel, but they all require the first query to return first.</p>

<p>If you want three levels, or four levels, want to skip a level or two, or some other combination of ranges, well, I think you can see how complicated, and non-performant, that might get.</p>

<h3>
  <a name="faster-querying-when-hierarchy-is-unknown" href="#faster-querying-when-hierarchy-is-unknown">
  </a>
  Faster querying when hierarchy is unknown
</h3>

<p>As I mentioned, if you don't know the structure of the hierarchy you can always request the node you want to start at and get that information before querying the hierarchy. In the world of DynamoDB you're talking about single digit millisecond latency on that get. For some applications that level of added latency is a problem (if it wasn't there wouldn't be a service like DAX). Most applications are probably fine accepting this small hit, but if you find that you need something with better read performance keep reading.</p>

<h3>
  <a name="reduced-read-costs" href="#reduced-read-costs">
  </a>
  Reduced read costs
</h3>

<p>This one isn't a slam dunk, and there are even some cases where it might not be true (though most of those cases aren't a good use for this pattern anyway), but the size of that hierarchy data can get to be big if your hierarchy is deep. Small amounts can add up to a lot if you process a lot of data. This pattern will be more expensive on writes (and storage), but the read costs can be quite a bit lower in many cases.</p>

<h3>
  <a name="the-solution" href="#the-solution">
  </a>
  The solution
</h3>

<p>Okay, let's get into how it works. At its core is one simple thing; every record needs to have a copy made for each node above it in the hierarchy. The data will include some extra information, specifically the relative depth and the id of the ancestor item. Using the above data, you'd end up with records like this:</p>

<div class="table-wrapper-paragraph"><table>
<thead>
<tr>
<th>ID</th>
<th>Ancestor ID</th>
<th>Relative Depth</th>
<th>Folder Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>C</td>
<td>I</td>
<td>0</td>
<td>Drive C</td>
</tr>
<tr>
<td>I</td>
<td>I</td>
<td>0</td>
<td>Folder I</td>
</tr>
<tr>
<td>I</td>
<td>C</td>
<td>1</td>
<td>Folder I</td>
</tr>
<tr>
<td>II</td>
<td>II</td>
<td>0</td>
<td>Folder II</td>
</tr>
<tr>
<td>II</td>
<td>C</td>
<td>1</td>
<td>Folder II</td>
</tr>
<tr>
<td>D</td>
<td>D</td>
<td>0</td>
<td>Drive D</td>
</tr>
<tr>
<td>III</td>
<td>III</td>
<td>0</td>
<td>Folder III</td>
</tr>
<tr>
<td>III</td>
<td>D</td>
<td>1</td>
<td>Folder III</td>
</tr>
<tr>
<td>a</td>
<td>a</td>
<td>0</td>
<td>Folder a</td>
</tr>
<tr>
<td>a</td>
<td>III</td>
<td>1</td>
<td>Folder a</td>
</tr>
<tr>
<td>a</td>
<td>D</td>
<td>2</td>
<td>Folder a</td>
</tr>
<tr>
<td>b</td>
<td>b</td>
<td>0</td>
<td>Folder b</td>
</tr>
<tr>
<td>b</td>
<td>III</td>
<td>1</td>
<td>Folder b</td>
</tr>
<tr>
<td>b</td>
<td>D</td>
<td>2</td>
<td>Folder b</td>
</tr>
<tr>
<td>IV</td>
<td>IV</td>
<td>0</td>
<td>Folder IV</td>
</tr>
<tr>
<td>IV</td>
<td>D</td>
<td>1</td>
<td>Folder IV</td>
</tr>
<tr>
<td>c</td>
<td>c</td>
<td>0</td>
<td>Folder c</td>
</tr>
<tr>
<td>c</td>
<td>IV</td>
<td>1</td>
<td>Folder c</td>
</tr>
<tr>
<td>c</td>
<td>D</td>
<td>2</td>
<td>Folder c</td>
</tr>
<tr>
<td>V</td>
<td>V</td>
<td>0</td>
<td>Folder V</td>
</tr>
<tr>
<td>V</td>
<td>D</td>
<td>1</td>
<td>Folder V</td>
</tr>
<tr>
<td>d</td>
<td>d</td>
<td>0</td>
<td>Folder d</td>
</tr>
<tr>
<td>d</td>
<td>V</td>
<td>1</td>
<td>Folder d</td>
</tr>
<tr>
<td>d</td>
<td>D</td>
<td>2</td>
<td>Folder d</td>
</tr>
<tr>
<td>i</td>
<td>i</td>
<td>0</td>
<td>Folder i</td>
</tr>
<tr>
<td>i</td>
<td>d</td>
<td>1</td>
<td>Folder i</td>
</tr>
<tr>
<td>i</td>
<td>V</td>
<td>2</td>
<td>Folder i</td>
</tr>
<tr>
<td>i</td>
<td>D</td>
<td>3</td>
<td>Folder i</td>
</tr>
<tr>
<td>ii</td>
<td>ii</td>
<td>0</td>
<td>Folder ii</td>
</tr>
<tr>
<td>ii</td>
<td>d</td>
<td>1</td>
<td>Folder ii</td>
</tr>
<tr>
<td>ii</td>
<td>V</td>
<td>2</td>
<td>Folder ii</td>
</tr>
<tr>
<td>ii</td>
<td>D</td>
<td>3</td>
<td>Folder ii</td>
</tr>
<tr>
<td>iii</td>
<td>iii</td>
<td>0</td>
<td>Folder iii</td>
</tr>
<tr>
<td>iii</td>
<td>d</td>
<td>1</td>
<td>Folder iii</td>
</tr>
<tr>
<td>iii</td>
<td>V</td>
<td>2</td>
<td>Folder iii</td>
</tr>
<tr>
<td>iii</td>
<td>D</td>
<td>3</td>
<td>Folder iii</td>
</tr>
<tr>
<td>e</td>
<td>e</td>
<td>0</td>
<td>Folder e</td>
</tr>
<tr>
<td>e</td>
<td>V</td>
<td>1</td>
<td>Folder e</td>
</tr>
<tr>
<td>e</td>
<td>D</td>
<td>2</td>
<td>Folder e</td>
</tr>
</tbody>
</table></div>

<p>As you can see, there are a lot more records in the table. You'll also notice that each record is smaller than the first example. The <code>Relative Depth</code> is a number, so the size of that is fixed, and because we don't have to store the entire hierarchy on each row the extra data of the <code>Ancestor ID</code> is smaller than the <code>Path</code>, in the first pattern, for most rows.</p>

<p>Let's now look at some of the query patterns this makes available.</p>

<p>The code to get a folder, like <code>Folder d</code>, looks like it did before, but we need to add the relative depth:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">Key</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">ID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">d</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">Relative Depth</span><span class="dl">'</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Querying for a list of the items directly below <code>Folder V</code> would look something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">gsi1</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth = :relativeDepth</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">#ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Ancestor ID</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">#relativeDepth</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Relative Depth</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">:ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">V</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:relativeDepth</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Because the relative depth is set to <code>1</code> the only results will be those directly below <code>Folder V</code>; <code>Folder d</code> and <code>Folder e</code>.</p>

<p>Getting a list of all items below <code>Folder V</code> would look something like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">gsi1</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth > :zero</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">#ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Ancestor ID</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">#relativeDepth</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Relative Depth</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">:ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">V</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:zero</span><span class="dl">'</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In this example we are stating that the relative depth needs to be greater than <code>0</code>, so it will not return <code>Folder V</code>, but it will return everything below it; <code>Folder d</code>, <code>Folder i</code>, <code>Folder ii</code>, <code>Folder iii</code>, and <code>Folder e</code>.</p>

<p>Now, let's say you want everything directly in <code>Drive D</code> as well as everything in those folders, but nothing beyond that (i.e., two levels deep). The query would look like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">gsi1</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth BETWEEN :start AND :end</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">#ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Ancestor ID</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">#relativeDepth</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Relative Depth</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">:ancestorId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">D</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:start</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">:end</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This would return <code>Folder III</code>, <code>Folder a</code>, <code>Folder b</code>, <code>Folder IV</code>, <code>Folder c</code>, <code>Folder V</code>, <code>Folder d</code>, and <code>Folder e</code>, but it would not return <code>Folder i</code>, <code>Folder ii</code>, or <code>Folder iii</code>.</p>

<p>If you want three (3), or four (4) levels you just change the parameters. You can even include the node you are querying by starting at zero (0) or skip a level by starting at a depth of two (2).</p>

<p>As you can see, this pattern opens up some new access patterns that didn't exist before, or that might have been slower performing.</p>

<h3>
  <a name="tradeoffs" href="#tradeoffs">
  </a>
  Tradeoffs
</h3>

<p>Of course, there are tradeoffs to this method, beyond the write vs. read tradeoffs we already mentioned.</p>

<p>First, any time a record is updated you'll have to update the record and all the replicated records as well. The cost of that operation isn't too expensive because it's a linear value based on the depth in the tree. For most trees you probably wouldn't need to do more than a handful of updates.</p>

<p>Second, re-parenting can be a bit complex. In the first pattern re-parenting just means updating the <code>Path</code> for the records at and below the re-parented record. With this pattern you need to remove records from former ancestors and add them to new ancestors. I've linked to example code for doing this, and it's not too terribly complex, but it's not a particular cheap operation, so if you move nodes around a lot you may want to consider the cost of that.</p>

<h3>
  <a name="streams" href="#streams">
  </a>
  Streams
</h3>

<p>In the example code I've linked to this blog post I'm doing all the work of duplicating and updating the records at the time of saving. A better approach to this would be to use DynamoDB streams. As a record is added you can use the stream <code>INSERT</code> event to trigger the code to replicate the data to each of the ancestors. You can also use the stream <code>MODIFY</code> event to trigger re-parenting and updating of name data (or any other data that needs to be updated), and the <code>REMOVE</code> event to remove records from ancestors.</p>

<h2>
  <a name="conclusion" href="#conclusion">
  </a>
  Conclusion
</h2>

<p>Hierarchies are an important part of working with data, and data stored in DynamoDB is no exception. By using one of the above patterns, I hope you find that working with hierarchy data in DynamoDB isn't something to fear. Once you find yourself using them, you'll open up a whole world of potential query patterns you might not have thought possible before.</p>

<h2>
  <a name="try-it-out" href="#try-it-out">
  </a>
  Try It Out
</h2>

<p>If you want to give the second pattern a try, I have a working example on GitHub that you can deploy to your AWS account. <a href="https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb">https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb</a></p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/jasonwadsworth/working-with-hierarchy-data-in-dynamodb-3459" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(n,s,a,t,e){return s.type_of="article",s.id=748799,s.title="Working With Hierarchy Data In DynamoDB",s.description="Working with hierarchies in DynamoDB can be a little intimidating. In this post I'll show you two...",s.readable_publish_date="Jul 6 '21",s.slug="working-with-hierarchy-data-in-dynamodb-3459",s.path="/aws-builders/working-with-hierarchy-data-in-dynamodb-3459",s.url="https://dev.to/aws-builders/working-with-hierarchy-data-in-dynamodb-3459",s.comments_count=3,s.public_reactions_count=25,s.collection_id=n,s.published_timestamp=a,s.positive_reactions_count=25,s.cover_image=n,s.social_image="https://dev.to/social_previews/article/748799.png",s.canonical_url="https://jason.wadsworth.dev/working-with-hierarchy-data-in-dynamodb/",s.created_at="2021-07-05T23:56:24Z",s.edited_at="2021-07-06T13:58:23Z",s.crossposted_at=n,s.published_at=a,s.last_comment_at="2021-07-09T11:07:09Z",s.reading_time_minutes=9,s.tag_list="serverless, database, dynamodb",s.tags=["serverless","database","dynamodb"],s.body_html='<p>Working with hierarchies in DynamoDB can be a little intimidating. In this post I\'ll show you two ways to work with hierarchies, and hopefully take away some of the fear.</p>\n\n<h2>\n  <a name="the-path-pattern" href="#the-path-pattern">\n  </a>\n  The Path Pattern\n</h2>\n\n<p>The first, and most common, way to deal with hierarchy data in DynamoDB is what I refer to as the path pattern. If you think of you hierarchy data like a directory or folder structure on a computer, it\'s pretty easy to get your head around how this works. Each element in the tree represents a folder and finding what is in a folder is as simple as knowing the path to the folder. With the right table structure, you can query for items in a folder as well as all items in all folders below a given folder. Here is how that works.</p>\n\n<p>We\'ll start with a simple folder structure. Imagine you have some data that is something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>  Drive C\n    Folder I\n    Folder II\n  Drive D\n    Folder III\n      Folder a\n      Folder b\n    Folder IV\n      Folder c\n    Folder V\n      Folder d\n        Folder i\n        Folder ii\n        Folder iii\n      Folder e\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When storing this data in DynamoDB you would include the full path of each item with that item. You might have a table that looks something like this:</p>\n\n<div class="table-wrapper-paragraph"><table>\n<thead>\n<tr>\n<th>ID</th>\n<th>Root</th>\n<th>Path</th>\n<th>Folder Name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>C</td>\n<td></td>\n<td></td>\n<td>Drive C</td>\n</tr>\n<tr>\n<td>I</td>\n<td>C</td>\n<td>/</td>\n<td>Folder I</td>\n</tr>\n<tr>\n<td>II</td>\n<td>C</td>\n<td>/</td>\n<td>Folder II</td>\n</tr>\n<tr>\n<td>D</td>\n<td></td>\n<td></td>\n<td>Drive D</td>\n</tr>\n<tr>\n<td>III</td>\n<td>D</td>\n<td>/</td>\n<td>Folder III</td>\n</tr>\n<tr>\n<td>a</td>\n<td>D</td>\n<td>/III/</td>\n<td>Folder a</td>\n</tr>\n<tr>\n<td>b</td>\n<td>D</td>\n<td>/III/</td>\n<td>Folder b</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>D</td>\n<td>/</td>\n<td>Folder IV</td>\n</tr>\n<tr>\n<td>c</td>\n<td>D</td>\n<td>/IV/</td>\n<td>Folder c</td>\n</tr>\n<tr>\n<td>V</td>\n<td>D</td>\n<td>/</td>\n<td>Folder V</td>\n</tr>\n<tr>\n<td>d</td>\n<td>D</td>\n<td>/V/</td>\n<td>Folder d</td>\n</tr>\n<tr>\n<td>i</td>\n<td>D</td>\n<td>/V/d/</td>\n<td>Folder i</td>\n</tr>\n<tr>\n<td>ii</td>\n<td>D</td>\n<td>/V/d/</td>\n<td>Folder ii</td>\n</tr>\n<tr>\n<td>iii</td>\n<td>D</td>\n<td>/V/d/</td>\n<td>Folder iii</td>\n</tr>\n<tr>\n<td>e</td>\n<td>D</td>\n<td>/V/</td>\n<td>Folder e</td>\n</tr>\n</tbody>\n</table></div>\n\n<p>With the data in this format, you can get any single folder by its ID. You can list all folders directly under a folder by using the GSI (which will be the <code>Root</code> and the <code>Path</code>) and specifying the root and the path. You can also get all folders below a folder (all the way down the tree) by using the GSI and specifying the root and that the path <code>begins_with</code> the path of the folder.</p>\n\n<p>The code to get the <code>Folder d</code> looks something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">Key</span><span class="p">:</span> <span class="p">{</span>\n                <span class="na">ID</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">d</span><span class="dl">\'</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Querying for a list of the items directly below <code>Folder V</code> would look something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">gsi1</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#root = :root AND #path = :path</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">#root</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Root</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">#path</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Path</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">:root</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">D</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:path</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/V/</span><span class="dl">\'</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Because the condition is <code>=</code> the only results will be those directly below <code>Folder V</code>; <code>Folder d</code> and <code>Folder e</code>.</p>\n\n<p>Getting a list of all items below <code>Folder V</code> would look something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">gsi1</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#pk = :root AND begins_with(#sk, :path)</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">#root</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Root</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">#path</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Path</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">:root</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">D</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:path</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/V/</span><span class="dl">\'</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In this case the condition is <code>begins_with</code>, so the results will include all values below <code>Folder V</code>; <code>Folder d</code>, <code>Folder i</code>, <code>Folder ii</code>, <code>Folder iii</code>, and <code>Folder e</code>.</p>\n\n<p>This pattern allows for a great deal of power when dealing with hierarchical data. I would say that most often this is the pattern you\'ll want to use.</p>\n\n<h2>\n  <a name="the-replication-pattern" href="#the-replication-pattern">\n  </a>\n  The Replication Pattern\n</h2>\n\n<p>While the above pattern is a very powerful tool in working with data in DynamoDB, I use it all the time, sometimes, you might find that it doesn\'t work for you. The above approach assumes that you will always know the structure above the node you are searching. In the examples, querying for items below a folder requires that you not only know the ID of the folder you wish to query, but you needed to know all the folders above it as well. In most cases that\'s not a problem, and even when you don\'t want to expose that information (maybe for security reasons), doing a quick lookup of that data is likely the best route (i.e., you can get the folder you want to query, and use that to know the path information above it without requiring that the caller supply the full path). So, when might you want to do something different?</p>\n\n<h3>\n  <a name="querying-varying-levels-of-depth" href="#querying-varying-levels-of-depth">\n  </a>\n  Querying varying levels of depth\n</h3>\n\n<p>In the first example you were limited to only being to query either items directly below a node, or all items below a node.</p>\n\n<p>If you wanted to get all items <em>except</em> those directly below a node you\'d have to query all items and filter the direct items out. That\'s not so bad if the number of direct items is a small number, but if you have a lot of data to exclude it\'s not ideal.</p>\n\n<p>If you wanted to get just the items below a node and the items directly below those items (i.e., two levels deep from the node you\'re querying) you\'d have to either query all the items and filter out the ones you don\'t want, or run multiple queries, one for the direct items, and one query for each of the results from that query. The first option may be okay if there aren\'t too many records you want to exclude, but if you are a large hierarchy, say you are working with employee data and you\'re the size of Amazon, doing that for the root node (e.g., the CEO) would probably not be the best idea. The second option may not be terrible, assuming the number of items directly below the node you are querying is small, but it\'s certainly not going to be as fast as querying it all at once. Yes, you can run the each of the sub node queries in parallel, but they all require the first query to return first.</p>\n\n<p>If you want three levels, or four levels, want to skip a level or two, or some other combination of ranges, well, I think you can see how complicated, and non-performant, that might get.</p>\n\n<h3>\n  <a name="faster-querying-when-hierarchy-is-unknown" href="#faster-querying-when-hierarchy-is-unknown">\n  </a>\n  Faster querying when hierarchy is unknown\n</h3>\n\n<p>As I mentioned, if you don\'t know the structure of the hierarchy you can always request the node you want to start at and get that information before querying the hierarchy. In the world of DynamoDB you\'re talking about single digit millisecond latency on that get. For some applications that level of added latency is a problem (if it wasn\'t there wouldn\'t be a service like DAX). Most applications are probably fine accepting this small hit, but if you find that you need something with better read performance keep reading.</p>\n\n<h3>\n  <a name="reduced-read-costs" href="#reduced-read-costs">\n  </a>\n  Reduced read costs\n</h3>\n\n<p>This one isn\'t a slam dunk, and there are even some cases where it might not be true (though most of those cases aren\'t a good use for this pattern anyway), but the size of that hierarchy data can get to be big if your hierarchy is deep. Small amounts can add up to a lot if you process a lot of data. This pattern will be more expensive on writes (and storage), but the read costs can be quite a bit lower in many cases.</p>\n\n<h3>\n  <a name="the-solution" href="#the-solution">\n  </a>\n  The solution\n</h3>\n\n<p>Okay, let\'s get into how it works. At its core is one simple thing; every record needs to have a copy made for each node above it in the hierarchy. The data will include some extra information, specifically the relative depth and the id of the ancestor item. Using the above data, you\'d end up with records like this:</p>\n\n<div class="table-wrapper-paragraph"><table>\n<thead>\n<tr>\n<th>ID</th>\n<th>Ancestor ID</th>\n<th>Relative Depth</th>\n<th>Folder Name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>C</td>\n<td>I</td>\n<td>0</td>\n<td>Drive C</td>\n</tr>\n<tr>\n<td>I</td>\n<td>I</td>\n<td>0</td>\n<td>Folder I</td>\n</tr>\n<tr>\n<td>I</td>\n<td>C</td>\n<td>1</td>\n<td>Folder I</td>\n</tr>\n<tr>\n<td>II</td>\n<td>II</td>\n<td>0</td>\n<td>Folder II</td>\n</tr>\n<tr>\n<td>II</td>\n<td>C</td>\n<td>1</td>\n<td>Folder II</td>\n</tr>\n<tr>\n<td>D</td>\n<td>D</td>\n<td>0</td>\n<td>Drive D</td>\n</tr>\n<tr>\n<td>III</td>\n<td>III</td>\n<td>0</td>\n<td>Folder III</td>\n</tr>\n<tr>\n<td>III</td>\n<td>D</td>\n<td>1</td>\n<td>Folder III</td>\n</tr>\n<tr>\n<td>a</td>\n<td>a</td>\n<td>0</td>\n<td>Folder a</td>\n</tr>\n<tr>\n<td>a</td>\n<td>III</td>\n<td>1</td>\n<td>Folder a</td>\n</tr>\n<tr>\n<td>a</td>\n<td>D</td>\n<td>2</td>\n<td>Folder a</td>\n</tr>\n<tr>\n<td>b</td>\n<td>b</td>\n<td>0</td>\n<td>Folder b</td>\n</tr>\n<tr>\n<td>b</td>\n<td>III</td>\n<td>1</td>\n<td>Folder b</td>\n</tr>\n<tr>\n<td>b</td>\n<td>D</td>\n<td>2</td>\n<td>Folder b</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>IV</td>\n<td>0</td>\n<td>Folder IV</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>D</td>\n<td>1</td>\n<td>Folder IV</td>\n</tr>\n<tr>\n<td>c</td>\n<td>c</td>\n<td>0</td>\n<td>Folder c</td>\n</tr>\n<tr>\n<td>c</td>\n<td>IV</td>\n<td>1</td>\n<td>Folder c</td>\n</tr>\n<tr>\n<td>c</td>\n<td>D</td>\n<td>2</td>\n<td>Folder c</td>\n</tr>\n<tr>\n<td>V</td>\n<td>V</td>\n<td>0</td>\n<td>Folder V</td>\n</tr>\n<tr>\n<td>V</td>\n<td>D</td>\n<td>1</td>\n<td>Folder V</td>\n</tr>\n<tr>\n<td>d</td>\n<td>d</td>\n<td>0</td>\n<td>Folder d</td>\n</tr>\n<tr>\n<td>d</td>\n<td>V</td>\n<td>1</td>\n<td>Folder d</td>\n</tr>\n<tr>\n<td>d</td>\n<td>D</td>\n<td>2</td>\n<td>Folder d</td>\n</tr>\n<tr>\n<td>i</td>\n<td>i</td>\n<td>0</td>\n<td>Folder i</td>\n</tr>\n<tr>\n<td>i</td>\n<td>d</td>\n<td>1</td>\n<td>Folder i</td>\n</tr>\n<tr>\n<td>i</td>\n<td>V</td>\n<td>2</td>\n<td>Folder i</td>\n</tr>\n<tr>\n<td>i</td>\n<td>D</td>\n<td>3</td>\n<td>Folder i</td>\n</tr>\n<tr>\n<td>ii</td>\n<td>ii</td>\n<td>0</td>\n<td>Folder ii</td>\n</tr>\n<tr>\n<td>ii</td>\n<td>d</td>\n<td>1</td>\n<td>Folder ii</td>\n</tr>\n<tr>\n<td>ii</td>\n<td>V</td>\n<td>2</td>\n<td>Folder ii</td>\n</tr>\n<tr>\n<td>ii</td>\n<td>D</td>\n<td>3</td>\n<td>Folder ii</td>\n</tr>\n<tr>\n<td>iii</td>\n<td>iii</td>\n<td>0</td>\n<td>Folder iii</td>\n</tr>\n<tr>\n<td>iii</td>\n<td>d</td>\n<td>1</td>\n<td>Folder iii</td>\n</tr>\n<tr>\n<td>iii</td>\n<td>V</td>\n<td>2</td>\n<td>Folder iii</td>\n</tr>\n<tr>\n<td>iii</td>\n<td>D</td>\n<td>3</td>\n<td>Folder iii</td>\n</tr>\n<tr>\n<td>e</td>\n<td>e</td>\n<td>0</td>\n<td>Folder e</td>\n</tr>\n<tr>\n<td>e</td>\n<td>V</td>\n<td>1</td>\n<td>Folder e</td>\n</tr>\n<tr>\n<td>e</td>\n<td>D</td>\n<td>2</td>\n<td>Folder e</td>\n</tr>\n</tbody>\n</table></div>\n\n<p>As you can see, there are a lot more records in the table. You\'ll also notice that each record is smaller than the first example. The <code>Relative Depth</code> is a number, so the size of that is fixed, and because we don\'t have to store the entire hierarchy on each row the extra data of the <code>Ancestor ID</code> is smaller than the <code>Path</code>, in the first pattern, for most rows.</p>\n\n<p>Let\'s now look at some of the query patterns this makes available.</p>\n\n<p>The code to get a folder, like <code>Folder d</code>, looks like it did before, but we need to add the relative depth:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">Key</span><span class="p">:</span> <span class="p">{</span>\n                <span class="na">ID</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">d</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">Relative Depth</span><span class="dl">\'</span><span class="p">:</span> <span class="mi">0</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Querying for a list of the items directly below <code>Folder V</code> would look something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">gsi1</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth = :relativeDepth</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">#ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Ancestor ID</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">#relativeDepth</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Relative Depth</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">:ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">V</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:relativeDepth</span><span class="dl">\'</span><span class="p">:</span> <span class="mi">1</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Because the relative depth is set to <code>1</code> the only results will be those directly below <code>Folder V</code>; <code>Folder d</code> and <code>Folder e</code>.</p>\n\n<p>Getting a list of all items below <code>Folder V</code> would look something like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">gsi1</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth &gt; :zero</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">#ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Ancestor ID</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">#relativeDepth</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Relative Depth</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">:ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">V</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:zero</span><span class="dl">\'</span><span class="p">:</span> <span class="mi">0</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In this example we are stating that the relative depth needs to be greater than <code>0</code>, so it will not return <code>Folder V</code>, but it will return everything below it; <code>Folder d</code>, <code>Folder i</code>, <code>Folder ii</code>, <code>Folder iii</code>, and <code>Folder e</code>.</p>\n\n<p>Now, let\'s say you want everything directly in <code>Drive D</code> as well as everything in those folders, but nothing beyond that (i.e., two levels deep). The query would look like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">documentClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>\n<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">documentClient</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>\n            <span class="na">TableName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">working-with-hierarchy-data-in-dynamodb</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">IndexName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">gsi1</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">KeyConditionExpression</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#ancestorId = :ancestorId AND #relativeDepth BETWEEN :start AND :end</span><span class="dl">\'</span><span class="p">,</span>\n            <span class="na">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">#ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Ancestor ID</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">#relativeDepth</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Relative Depth</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="na">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>\n                <span class="dl">\'</span><span class="s1">:ancestorId</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">D</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:start</span><span class="dl">\'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>\n                <span class="dl">\'</span><span class="s1">:end</span><span class="dl">\'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>\n            <span class="p">},</span>\n        <span class="p">}).</span><span class="nx">promise</span><span class="p">();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This would return <code>Folder III</code>, <code>Folder a</code>, <code>Folder b</code>, <code>Folder IV</code>, <code>Folder c</code>, <code>Folder V</code>, <code>Folder d</code>, and <code>Folder e</code>, but it would not return <code>Folder i</code>, <code>Folder ii</code>, or <code>Folder iii</code>.</p>\n\n<p>If you want three (3), or four (4) levels you just change the parameters. You can even include the node you are querying by starting at zero (0) or skip a level by starting at a depth of two (2).</p>\n\n<p>As you can see, this pattern opens up some new access patterns that didn\'t exist before, or that might have been slower performing.</p>\n\n<h3>\n  <a name="tradeoffs" href="#tradeoffs">\n  </a>\n  Tradeoffs\n</h3>\n\n<p>Of course, there are tradeoffs to this method, beyond the write vs. read tradeoffs we already mentioned.</p>\n\n<p>First, any time a record is updated you\'ll have to update the record and all the replicated records as well. The cost of that operation isn\'t too expensive because it\'s a linear value based on the depth in the tree. For most trees you probably wouldn\'t need to do more than a handful of updates.</p>\n\n<p>Second, re-parenting can be a bit complex. In the first pattern re-parenting just means updating the <code>Path</code> for the records at and below the re-parented record. With this pattern you need to remove records from former ancestors and add them to new ancestors. I\'ve linked to example code for doing this, and it\'s not too terribly complex, but it\'s not a particular cheap operation, so if you move nodes around a lot you may want to consider the cost of that.</p>\n\n<h3>\n  <a name="streams" href="#streams">\n  </a>\n  Streams\n</h3>\n\n<p>In the example code I\'ve linked to this blog post I\'m doing all the work of duplicating and updating the records at the time of saving. A better approach to this would be to use DynamoDB streams. As a record is added you can use the stream <code>INSERT</code> event to trigger the code to replicate the data to each of the ancestors. You can also use the stream <code>MODIFY</code> event to trigger re-parenting and updating of name data (or any other data that needs to be updated), and the <code>REMOVE</code> event to remove records from ancestors.</p>\n\n<h2>\n  <a name="conclusion" href="#conclusion">\n  </a>\n  Conclusion\n</h2>\n\n<p>Hierarchies are an important part of working with data, and data stored in DynamoDB is no exception. By using one of the above patterns, I hope you find that working with hierarchy data in DynamoDB isn\'t something to fear. Once you find yourself using them, you\'ll open up a whole world of potential query patterns you might not have thought possible before.</p>\n\n<h2>\n  <a name="try-it-out" href="#try-it-out">\n  </a>\n  Try It Out\n</h2>\n\n<p>If you want to give the second pattern a try, I have a working example on GitHub that you can deploy to your AWS account. <a href="https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb">https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb</a></p>\n\n',s.body_markdown="Working with hierarchies in DynamoDB can be a little intimidating. In this post I'll show you two ways to work with hierarchies, and hopefully take away some of the fear.\n\n## The Path Pattern\n\nThe first, and most common, way to deal with hierarchy data in DynamoDB is what I refer to as the path pattern. If you think of you hierarchy data like a directory or folder structure on a computer, it's pretty easy to get your head around how this works. Each element in the tree represents a folder and finding what is in a folder is as simple as knowing the path to the folder. With the right table structure, you can query for items in a folder as well as all items in all folders below a given folder. Here is how that works.\n\nWe'll start with a simple folder structure. Imagine you have some data that is something like this:\n\n```text\n  Drive C\n    Folder I\n    Folder II\n  Drive D\n    Folder III\n      Folder a\n      Folder b\n    Folder IV\n      Folder c\n    Folder V\n      Folder d\n        Folder i\n        Folder ii\n        Folder iii\n      Folder e\n```\n\nWhen storing this data in DynamoDB you would include the full path of each item with that item. You might have a table that looks something like this:\n\n| ID | Root | Path | Folder Name\n| -- | ------ | ------ | -----------\n| C | | | Drive C\n| I | C | / | Folder I\n| II | C | / | Folder II\n| D | | | Drive D\n| III | D | / | Folder III\n| a | D | /III/ | Folder a\n| b | D | /III/ | Folder b\n| IV | D | / | Folder IV\n| c | D | /IV/ | Folder c\n| V | D | / | Folder V\n| d | D | /V/ | Folder d\n| i | D | /V/d/ | Folder i\n| ii | D | /V/d/ | Folder ii\n| iii | D | /V/d/ | Folder iii\n| e | D | /V/ | Folder e\n\nWith the data in this format, you can get any single folder by its ID. You can list all folders directly under a folder by using the GSI (which will be the `Root` and the `Path`) and specifying the root and the path. You can also get all folders below a folder (all the way down the tree) by using the GSI and specifying the root and that the path `begins_with` the path of the folder.\n\nThe code to get the `Folder d` looks something like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.get({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            Key: {\n                ID: 'd'\n            },\n        }).promise();\n```\n\nQuerying for a list of the items directly below `Folder V` would look something like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.query({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            IndexName: 'gsi1',\n            KeyConditionExpression: '#root = :root AND #path = :path',\n            ExpressionAttributeNames: {\n                '#root': 'Root',\n                '#path': 'Path'\n            },\n            ExpressionAttributeValues: {\n                ':root': 'D',\n                ':path': '/V/'\n            },\n        }).promise();\n```\n\nBecause the condition is `=` the only results will be those directly below `Folder V`; `Folder d` and `Folder e`.\n\nGetting a list of all items below `Folder V` would look something like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.query({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            IndexName: 'gsi1',\n            KeyConditionExpression: '#pk = :root AND begins_with(#sk, :path)',\n            ExpressionAttributeNames: {\n                '#root': 'Root',\n                '#path': 'Path'\n            },\n            ExpressionAttributeValues: {\n                ':root': 'D',\n                ':path': '/V/'\n            },\n        }).promise();\n```\n\nIn this case the condition is `begins_with`, so the results will include all values below `Folder V`; `Folder d`, `Folder i`, `Folder ii`, `Folder iii`, and `Folder e`.\n\nThis pattern allows for a great deal of power when dealing with hierarchical data. I would say that most often this is the pattern you'll want to use.\n\n## The Replication Pattern\n\nWhile the above pattern is a very powerful tool in working with data in DynamoDB, I use it all the time, sometimes, you might find that it doesn't work for you. The above approach assumes that you will always know the structure above the node you are searching. In the examples, querying for items below a folder requires that you not only know the ID of the folder you wish to query, but you needed to know all the folders above it as well. In most cases that's not a problem, and even when you don't want to expose that information (maybe for security reasons), doing a quick lookup of that data is likely the best route (i.e., you can get the folder you want to query, and use that to know the path information above it without requiring that the caller supply the full path). So, when might you want to do something different?\n\n### Querying varying levels of depth\n\nIn the first example you were limited to only being to query either items directly below a node, or all items below a node.\n\nIf you wanted to get all items _except_ those directly below a node you'd have to query all items and filter the direct items out. That's not so bad if the number of direct items is a small number, but if you have a lot of data to exclude it's not ideal.\n\nIf you wanted to get just the items below a node and the items directly below those items (i.e., two levels deep from the node you're querying) you'd have to either query all the items and filter out the ones you don't want, or run multiple queries, one for the direct items, and one query for each of the results from that query. The first option may be okay if there aren't too many records you want to exclude, but if you are a large hierarchy, say you are working with employee data and you're the size of Amazon, doing that for the root node (e.g., the CEO) would probably not be the best idea. The second option may not be terrible, assuming the number of items directly below the node you are querying is small, but it's certainly not going to be as fast as querying it all at once. Yes, you can run the each of the sub node queries in parallel, but they all require the first query to return first.\n\nIf you want three levels, or four levels, want to skip a level or two, or some other combination of ranges, well, I think you can see how complicated, and non-performant, that might get.\n\n### Faster querying when hierarchy is unknown\n\nAs I mentioned, if you don't know the structure of the hierarchy you can always request the node you want to start at and get that information before querying the hierarchy. In the world of DynamoDB you're talking about single digit millisecond latency on that get. For some applications that level of added latency is a problem (if it wasn't there wouldn't be a service like DAX). Most applications are probably fine accepting this small hit, but if you find that you need something with better read performance keep reading.\n\n### Reduced read costs\n\nThis one isn't a slam dunk, and there are even some cases where it might not be true (though most of those cases aren't a good use for this pattern anyway), but the size of that hierarchy data can get to be big if your hierarchy is deep. Small amounts can add up to a lot if you process a lot of data. This pattern will be more expensive on writes (and storage), but the read costs can be quite a bit lower in many cases.\n\n### The solution\n\nOkay, let's get into how it works. At its core is one simple thing; every record needs to have a copy made for each node above it in the hierarchy. The data will include some extra information, specifically the relative depth and the id of the ancestor item. Using the above data, you'd end up with records like this:\n\n| ID | Ancestor ID | Relative Depth | Folder Name\n| -- | ----------- | -------------- | -----------\n| C | I | 0 | Drive C\n| I | I | 0 | Folder I\n| I | C | 1 | Folder I\n| II | II | 0 | Folder II\n| II | C | 1 | Folder II\n| D | D | 0 | Drive D\n| III | III | 0 | Folder III\n| III | D | 1 | Folder III\n| a | a | 0 | Folder a\n| a | III | 1 | Folder a\n| a | D | 2 | Folder a\n| b | b | 0 | Folder b\n| b | III | 1 | Folder b\n| b | D | 2 | Folder b\n| IV | IV | 0 | Folder IV\n| IV | D | 1 | Folder IV\n| c | c | 0 | Folder c\n| c | IV | 1 | Folder c\n| c | D | 2 | Folder c\n| V | V | 0 | Folder V\n| V | D | 1 | Folder V\n| d | d | 0 | Folder d\n| d | V | 1 | Folder d\n| d | D | 2 | Folder d\n| i | i | 0 | Folder i\n| i | d | 1 | Folder i\n| i | V | 2 | Folder i\n| i | D | 3 | Folder i\n| ii | ii | 0 | Folder ii\n| ii | d | 1 | Folder ii\n| ii | V | 2 | Folder ii\n| ii | D | 3 | Folder ii\n| iii | iii | 0 | Folder iii\n| iii | d | 1 | Folder iii\n| iii | V | 2 | Folder iii\n| iii | D | 3 | Folder iii\n| e | e | 0 | Folder e\n| e | V | 1 | Folder e\n| e | D | 2 | Folder e\n\nAs you can see, there are a lot more records in the table. You'll also notice that each record is smaller than the first example. The `Relative Depth` is a number, so the size of that is fixed, and because we don't have to store the entire hierarchy on each row the extra data of the `Ancestor ID` is smaller than the `Path`, in the first pattern, for most rows.\n\nLet's now look at some of the query patterns this makes available.\n\nThe code to get a folder, like `Folder d`, looks like it did before, but we need to add the relative depth:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.get({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            Key: {\n                ID: 'd',\n                'Relative Depth': 0\n            },\n        }).promise();\n```\n\nQuerying for a list of the items directly below `Folder V` would look something like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.query({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            IndexName: 'gsi1',\n            KeyConditionExpression: '#ancestorId = :ancestorId AND #relativeDepth = :relativeDepth',\n            ExpressionAttributeNames: {\n                '#ancestorId': 'Ancestor ID',\n                '#relativeDepth': 'Relative Depth'\n            },\n            ExpressionAttributeValues: {\n                ':ancestorId': 'V',\n                ':relativeDepth': 1\n            },\n        }).promise();\n```\n\nBecause the relative depth is set to `1` the only results will be those directly below `Folder V`; `Folder d` and `Folder e`.\n\nGetting a list of all items below `Folder V` would look something like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.query({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            IndexName: 'gsi1',\n            KeyConditionExpression: '#ancestorId = :ancestorId AND #relativeDepth > :zero',\n            ExpressionAttributeNames: {\n                '#ancestorId': 'Ancestor ID',\n                '#relativeDepth': 'Relative Depth'\n            },\n            ExpressionAttributeValues: {\n                ':ancestorId': 'V',\n                ':zero': 0\n            },\n        }).promise();\n```\n\nIn this example we are stating that the relative depth needs to be greater than `0`, so it will not return `Folder V`, but it will return everything below it; `Folder d`, `Folder i`, `Folder ii`, `Folder iii`, and `Folder e`.\n\nNow, let's say you want everything directly in `Drive D` as well as everything in those folders, but nothing beyond that (i.e., two levels deep). The query would look like this:\n\n```javascript\nconst documentClient = new AWS.DynamoDB.DocumentClient();\nconst result = await documentClient.query({\n            TableName: 'working-with-hierarchy-data-in-dynamodb',\n            IndexName: 'gsi1',\n            KeyConditionExpression: '#ancestorId = :ancestorId AND #relativeDepth BETWEEN :start AND :end',\n            ExpressionAttributeNames: {\n                '#ancestorId': 'Ancestor ID',\n                '#relativeDepth': 'Relative Depth'\n            },\n            ExpressionAttributeValues: {\n                ':ancestorId': 'D',\n                ':start': 1,\n                ':end': 2,\n            },\n        }).promise();\n```\n\nThis would return `Folder III`, `Folder a`, `Folder b`, `Folder IV`, `Folder c`, `Folder V`, `Folder d`, and `Folder e`, but it would not return `Folder i`, `Folder ii`, or `Folder iii`.\n\nIf you want three (3), or four (4) levels you just change the parameters. You can even include the node you are querying by starting at zero (0) or skip a level by starting at a depth of two (2).\n\nAs you can see, this pattern opens up some new access patterns that didn't exist before, or that might have been slower performing.\n\n### Tradeoffs\n\nOf course, there are tradeoffs to this method, beyond the write vs. read tradeoffs we already mentioned.\n\nFirst, any time a record is updated you'll have to update the record and all the replicated records as well. The cost of that operation isn't too expensive because it's a linear value based on the depth in the tree. For most trees you probably wouldn't need to do more than a handful of updates.\n\nSecond, re-parenting can be a bit complex. In the first pattern re-parenting just means updating the `Path` for the records at and below the re-parented record. With this pattern you need to remove records from former ancestors and add them to new ancestors. I've linked to example code for doing this, and it's not too terribly complex, but it's not a particular cheap operation, so if you move nodes around a lot you may want to consider the cost of that.\n\n### Streams\n\nIn the example code I've linked to this blog post I'm doing all the work of duplicating and updating the records at the time of saving. A better approach to this would be to use DynamoDB streams. As a record is added you can use the stream `INSERT` event to trigger the code to replicate the data to each of the ancestors. You can also use the stream `MODIFY` event to trigger re-parenting and updating of name data (or any other data that needs to be updated), and the `REMOVE` event to remove records from ancestors.\n\n## Conclusion\n\nHierarchies are an important part of working with data, and data stored in DynamoDB is no exception. By using one of the above patterns, I hope you find that working with hierarchy data in DynamoDB isn't something to fear. Once you find yourself using them, you'll open up a whole world of potential query patterns you might not have thought possible before.\n\n## Try It Out\n\nIf you want to give the second pattern a try, I have a working example on GitHub that you can deploy to your AWS account. [https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb](https://github.com/jasonwadsworth/blog-code/tree/main/working-with-hierarchy-data-in-dynamodb)\n",s.user={name:"Jason Wadsworth",username:t,twitter_username:"quizout",github_username:t,website_url:"https://cloud913.com",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--lXDukiTe--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/500944/cbf43b56-97e4-4636-8781-fe05a8746853.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--dTe0BEO9--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/500944/cbf43b56-97e4-4636-8781-fe05a8746853.jpg"},s.organization={name:"AWS Community Builders ",username:e,slug:e,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--zmOZQNzv--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/2794/88da75b6-aadd-4ea1-8083-ae2dfca8be94.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--vWmcJ-ty--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/2794/88da75b6-aadd-4ea1-8083-ae2dfca8be94.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:s}},error:n,state:{currentArticle:s},serverRendered:!0,routePath:"/jasonwadsworth/748799",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:n}}}}(null,{},"2021-07-06T13:48:01Z","jasonwadsworth","aws-builders")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
