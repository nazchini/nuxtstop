<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/webassembly" class="tag" data-v-70afb46a>
          #webassembly
        </a><a href="/nuxtstop/t/dotnet" class="tag" data-v-70afb46a>
          #dotnet
        </a><a href="/nuxtstop/t/azure" class="tag" data-v-70afb46a>
          #azure
        </a><a href="/nuxtstop/t/blazor" class="tag" data-v-70afb46a>
          #blazor
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--pm3CpGsx--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z95jcmsil0tyw9si0y2z.png" alt="Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            8
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Mar 18</time></div></header> <div class="content" data-v-70afb46a><p>In the previous article of this series, we have created a secure project with Blazor WebAssembly Hosted and Azure Active Directory.<br>
In this article we are going to add another level of security: the roles.</p>

<p>Also in this case we will use a feature of Azure Active Directory called: "<strong>App Roles</strong>".</p>

<p>So, let's open our application and make some changes to it!</p>
<h1>
  <a name="add-app-roles-to-the-app-registration" href="#add-app-roles-to-the-app-registration">
  </a>
  Add App Roles to the App Registration
</h1>

<p>From the Azure Portal, come back to the App Registrations and search for your two apps.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JOVcPwV7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ya0x70fkikk449jzb15i.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JOVcPwV7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ya0x70fkikk449jzb15i.png" alt="Image description" loading="lazy" width="693" height="247"></a></p>

<p>Open the app registration for the server app and under the "<strong>Manage</strong>" section of the left navigation pane, click on "<strong>App roles</strong>".</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--i9jH-S8_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/papr1j7q3jtq2m4tgrlr.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--i9jH-S8_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/papr1j7q3jtq2m4tgrlr.png" alt="Image description" loading="lazy" width="880" height="319"></a></p>

<p>Click on the button "<strong>Create app role</strong>" on the top bar navigation and fill the form with the information about the new role.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--NzVeniMK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5ke6cmcs245de6kfjfsf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--NzVeniMK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5ke6cmcs245de6kfjfsf.png" alt="Image description" loading="lazy" width="580" height="465"></a></p>

<p>Pay attention to the field "value" because it will be the value that we will use in our code later.<br>
It's reccomended to use lowcase letters.</p>

<p>Repeat these operations for other roles as: Viewer, PowerUser, etc.</p>
<h1>
  <a name="copy-the-app-roles-to-the-client-app-registration" href="#copy-the-app-roles-to-the-client-app-registration">
  </a>
  Copy the App roles to the client App Registration
</h1>

<p>We have to do the same steps for the client app.<br>
But it's very important to use the same values for this application.<br>
The faster way is to copy the information about App roles directly from the Manifest file and put them in the manifest of the client application.</p>

<p>From the left navigation pane, click on "<strong>Manifest</strong>", select the Json portion of the code about appRoles and copy it in the clipboard.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BOjG9eI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m40abzdcptmiv22edfb9.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BOjG9eI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m40abzdcptmiv22edfb9.png" alt="Image description" loading="lazy" width="865" height="785"></a></p>

<p>Now you can open the manifest file of the client application and replase the Json node with the new values.</p>

<p>That's it.</p>
<h1>
  <a name="assign-users-to-the-new-roles" href="#assign-users-to-the-new-roles">
  </a>
  Assign users to the new roles
</h1>

<p>Navigate to the "<strong>Enterprise Applications</strong> and open the server app.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s---4uP1LEK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1bsh3fbhgqajiv0reqo2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---4uP1LEK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1bsh3fbhgqajiv0reqo2.png" alt="Image description" loading="lazy" width="880" height="294"></a></p>

<p>Under the menu "<strong>Manage</strong>" click on "<strong>Users and groups</strong>" and then "<strong>Add user/group</strong>".</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--z5hWeqiF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2dnv68cv45kc1ghzwhn6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--z5hWeqiF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2dnv68cv45kc1ghzwhn6.png" alt="Image description" loading="lazy" width="728" height="347"></a></p>

<p>In the new window, search and select a user and the role that you want to assign to him.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ig0Q2DJE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6oavy3g9zij582z9t7h3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ig0Q2DJE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6oavy3g9zij582z9t7h3.png" alt="Image description" loading="lazy" width="880" height="267"></a></p>

<p>Now in the list you can see all the users with their role assigned.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--uOzkRkla--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t56zt78i8pzvl34afy62.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--uOzkRkla--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t56zt78i8pzvl34afy62.png" alt="Image description" loading="lazy" width="768" height="346"></a></p>

<p><strong>Important</strong>: repeat all these steps for the client application. </p>
<h1>
  <a name="use-the-app-roles-in-the-application" href="#use-the-app-roles-in-the-application">
  </a>
  Use the App roles in the application
</h1>

<p>Open the Client project and add a class called "<strong>SecureUserAccount</strong>" (but you can choose the name that you prefer).<br>
This class extends the RemoteUserAccount.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SecureUserAccount</span> <span class="p">:</span> <span class="n">RemoteUserAccount</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">JsonPropertyName</span><span class="p">(</span><span class="s">"roles"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">Roles</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">>();</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p>Now our application need to know how to manage the roles from Azure AD.<br>
To do that, we can create a new class in the client project called "<strong>SecureAccountFactory</strong>"<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SecureAccountFactory</span> <span class="p">:</span> <span class="n">AccountClaimsPrincipalFactory</span><span class="p">&lt;</span><span class="n">SecureUserAccount</span><span class="p">></span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">SecureAccountFactory</span><span class="p">(</span><span class="n">IAccessTokenProviderAccessor</span> <span class="n">accessor</span><span class="p">)</span>
            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">accessor</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">async</span> <span class="k">override</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">ClaimsPrincipal</span><span class="p">></span> <span class="nf">CreateUserAsync</span><span class="p">(</span><span class="n">SecureUserAccount</span> <span class="n">account</span><span class="p">,</span>
            <span class="n">RemoteAuthenticationUserOptions</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">initialUser</span> <span class="p">=</span> <span class="k">await</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateUserAsync</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">initialUser</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="n">IsAuthenticated</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">userIdentity</span> <span class="p">=</span> <span class="p">(</span><span class="n">ClaimsIdentity</span><span class="p">)</span><span class="n">initialUser</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">role</span> <span class="k">in</span> <span class="n">account</span><span class="p">.</span><span class="n">Roles</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">userIdentity</span><span class="p">.</span><span class="nf">AddClaim</span><span class="p">(</span><span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="s">"appRole"</span><span class="p">,</span> <span class="n">role</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">initialUser</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p>The last change in the client application is in the Program.cs file.<br>
Replace the Msal authentication snippet with the new one:<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddMsalAuthentication</span><span class="p">&lt;</span><span class="n">RemoteAuthenticationState</span><span class="p">,</span> <span class="n">SecureUserAccount</span><span class="p">>(</span><span class="n">options</span> <span class="p">=></span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">.</span><span class="n">ProviderOptions</span><span class="p">.</span><span class="n">Authentication</span><span class="p">);</span>
    <span class="n">options</span><span class="p">.</span><span class="n">ProviderOptions</span><span class="p">.</span><span class="n">DefaultAccessTokenScopes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"api://957e1304-dd53-4589-b013-4a264dd19334/BlazorWASMHosted.API"</span><span class="p">);</span>
    <span class="n">options</span><span class="p">.</span><span class="n">UserOptions</span><span class="p">.</span><span class="n">RoleClaim</span> <span class="p">=</span> <span class="s">"appRole"</span><span class="p">;</span>
<span class="p">})</span>
<span class="p">.</span><span class="n">AddAccountClaimsPrincipalFactory</span><span class="p">&lt;</span><span class="n">RemoteAuthenticationState</span><span class="p">,</span> <span class="n">SecureUserAccount</span><span class="p">,</span>
    <span class="n">SecureAccountFactory</span><span class="p">>();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p>Now it's time to change the server application.</p>

<p>Open the Program.cs file and replace the MsalAuthentication code with the new one:<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddAuthentication</span><span class="p">(</span><span class="n">JwtBearerDefaults</span><span class="p">.</span><span class="n">AuthenticationScheme</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">AddMicrosoftIdentityWebApi</span><span class="p">(</span><span class="n">options</span> <span class="p">=></span>
        <span class="p">{</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
            <span class="n">options</span><span class="p">.</span><span class="n">TokenValidationParameters</span><span class="p">.</span><span class="n">RoleClaimType</span> <span class="p">=</span>
                <span class="s">"http://schemas.microsoft.com/ws/2008/06/identity/claims/role"</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="n">options</span> <span class="p">=></span> <span class="p">{</span> <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span> <span class="p">});</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<h1>
  <a name="securing-pages-web-api-and-features" href="#securing-pages-web-api-and-features">
  </a>
  Securing Pages, Web API and Features
</h1>

<p>Let's start to work with the roles.</p>

<p>First of all, the server application.<br>
Extend the Authorize attribute of the WeatherForecastController with the roles property:<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code><span class="p">[</span><span class="nf">Authorize</span><span class="p">(</span><span class="n">Roles</span> <span class="p">=</span> <span class="s">"administrator"</span><span class="p">)]</span> 
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>


<p>Now only a user with the Administrator role can call the controller.</p>

<p>In the client app, open the Fetchdata.razor file and extend the same attribute with the roles attributes:<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code><span class="n">@attribute</span> <span class="p">[</span><span class="nf">Authorize</span><span class="p">(</span><span class="n">Roles</span> <span class="p">=</span> <span class="s">"administrator"</span><span class="p">)]</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<h2>
  <a name="display-only-the-links-for-your-role" href="#display-only-the-links-for-your-role">
  </a>
  Display only the links for your role
</h2>

<p>If you want to prevent that a user access to a page with the wrong role, you can hide portions of the pages or links in the application.<br>
You can use one of the out-of-box features of Blazor called "<strong>AuthorizeView</strong>".</p>

<p>For instance, if you want to hide the page Fetch data, it's enough if you add this code in the NavMenu.razor file.<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight xml"><code><span class="nt">&lt;AuthorizeView</span> <span class="na">Roles=</span><span class="s">"administrator"</span><span class="nt">></span>
    <span class="nt">&lt;Authorized></span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item px-3"</span><span class="nt">></span>
            <span class="nt">&lt;NavLink</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"fetchdata"</span><span class="nt">></span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"oi oi-list-rich"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">>&lt;/span></span> Fetch data
            <span class="nt">&lt;/NavLink></span>
        <span class="nt">&lt;/li></span>
    <span class="nt">&lt;/Authorized></span>
<span class="nt">&lt;/AuthorizeView></span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<h2>
  <a name="access-to-the-app-role-from-the-code-behind" href="#access-to-the-app-role-from-the-code-behind">
  </a>
  Access to the App Role from the code behind
</h2>

<p>It's very easy also to access to the roles of the user from the code behind.<br>
Very often inside an application there a lot of code that change the behaviour based on the user permissions.</p>

<p>Let's start with an easy example.<br>
Open the Counter.razor page and change the code as below:<br>
</p>
<div class="highlight js-code-highlight">
<pre class="highlight csharp"><code><span class="n">@code</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">CascadingParameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">AuthenticationState</span><span class="p">></span> <span class="n">AuthState</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">private</span> <span class="kt">int</span> <span class="n">currentCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">IncrementCount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">authState</span> <span class="p">=</span> <span class="k">await</span> <span class="n">AuthState</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="n">authState</span><span class="p">.</span><span class="n">User</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">IsInRole</span><span class="p">(</span><span class="s">"viewer"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">currentCount</span> <span class="p">+=</span> <span class="m">2</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">IsInRole</span><span class="p">(</span><span class="s">"administrator"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">currentCount</span> <span class="p">-=</span> <span class="m">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<h1>
  <a name="wrap-up" href="#wrap-up">
  </a>
  Wrap up
</h1>

<p>Now you know how to create a new app on Azure Portal, assign roles to it and work with the roles in your Blazor applications.</p>

<p>You can find the source code of the example on GitHub.<br>
Follow the instructions in the Readme file.</p>


<div class="ltag-github-readme-tag">
  <div class="readme-overview">
    <h2>
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--566lAguM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev.to/assets/github-logo-5a155e1f9a670af7944dd5e12375bc76ed542ea80224905ecaf878b9157cdefc.svg" alt="GitHub logo" loading="lazy">
      <a href="https://github.com/kasuken">
        kasuken
      </a> / <a style="font-weight:600" href="https://github.com/kasuken/BlazorWASMHostedAzureADAuth">
        BlazorWASMHostedAzureADAuth
      </a>
    </h2>
    <h3>
      
    </h3>
  </div>
  <div class="ltag-github-body">
    
<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/2757486/158978139-a2097c49-99ab-4653-ae6c-9a004b926db9.png"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A7XUrQE---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/2757486/158978139-a2097c49-99ab-4653-ae6c-9a004b926db9.png" alt="image" style="max-width:100%" loading="lazy"></a></p>
<h1 dir="auto">
BlazorWASMHostedAzureADAuth</h1>
<p dir="auto">This repository is an example for Blazor WASM Hosted app secured by Azure Active Directory.</p>
<p dir="auto">There are two different branches.</p>
<ul dir="auto">
<li>Authorization</li>
<li>Roles</li>
</ul>
<p dir="auto">You can find the right code based on the two post on my blog with all the steps that you need to replicate these settings in your own projects.</p>
<ul dir="auto">
<li>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 1 - <a href="https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-1-382d" rel="nofollow">https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-1-382d</a>
</li>
<li>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2 - <a href="https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd" rel="nofollow">https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd</a>
</li>
</ul>
<p dir="auto">The link to the series: <a href="https://dev.to/kasuken/series/17352" rel="nofollow">https://dev.to/kasuken/series/17352</a></p>
</article></div>

  </div>
  <div class="gh-btn-container"><a class="gh-btn" href="https://github.com/kasuken/BlazorWASMHostedAzureADAuth">View on GitHub</a></div>
</div>



<p>Thank you and drop me a comment if you have questions or feedbacks!</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,a,n,e,t){return n.type_of="article",n.id=1026398,n.title="Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2",n.description="In the previous article of this series, we have created a secure project with Blazor WebAssembly...",n.readable_publish_date="Mar 18",n.slug="securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd",n.path="/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd",n.url=e,n.comments_count=0,n.public_reactions_count=8,n.collection_id=17352,n.published_timestamp=a,n.positive_reactions_count=8,n.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--pm3CpGsx--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z95jcmsil0tyw9si0y2z.png",n.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--J0NWe9l9--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z95jcmsil0tyw9si0y2z.png",n.canonical_url=e,n.created_at="2022-03-17T19:45:24Z",n.edited_at=s,n.crossposted_at=s,n.published_at=a,n.last_comment_at=a,n.reading_time_minutes=4,n.tag_list="webassembly, dotnet, azure, blazor",n.tags=["webassembly","dotnet","azure","blazor"],n.body_html='<p>In the previous article of this series, we have created a secure project with Blazor WebAssembly Hosted and Azure Active Directory.<br>\nIn this article we are going to add another level of security: the roles.</p>\n\n<p>Also in this case we will use a feature of Azure Active Directory called: "<strong>App Roles</strong>".</p>\n\n<p>So, let\'s open our application and make some changes to it!</p>\n<h1>\n  <a name="add-app-roles-to-the-app-registration" href="#add-app-roles-to-the-app-registration">\n  </a>\n  Add App Roles to the App Registration\n</h1>\n\n<p>From the Azure Portal, come back to the App Registrations and search for your two apps.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JOVcPwV7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ya0x70fkikk449jzb15i.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JOVcPwV7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ya0x70fkikk449jzb15i.png" alt="Image description" loading="lazy" width="693" height="247"></a></p>\n\n<p>Open the app registration for the server app and under the "<strong>Manage</strong>" section of the left navigation pane, click on "<strong>App roles</strong>".</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--i9jH-S8_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/papr1j7q3jtq2m4tgrlr.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--i9jH-S8_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/papr1j7q3jtq2m4tgrlr.png" alt="Image description" loading="lazy" width="880" height="319"></a></p>\n\n<p>Click on the button "<strong>Create app role</strong>" on the top bar navigation and fill the form with the information about the new role.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--NzVeniMK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5ke6cmcs245de6kfjfsf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--NzVeniMK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5ke6cmcs245de6kfjfsf.png" alt="Image description" loading="lazy" width="580" height="465"></a></p>\n\n<p>Pay attention to the field "value" because it will be the value that we will use in our code later.<br>\nIt\'s reccomended to use lowcase letters.</p>\n\n<p>Repeat these operations for other roles as: Viewer, PowerUser, etc.</p>\n<h1>\n  <a name="copy-the-app-roles-to-the-client-app-registration" href="#copy-the-app-roles-to-the-client-app-registration">\n  </a>\n  Copy the App roles to the client App Registration\n</h1>\n\n<p>We have to do the same steps for the client app.<br>\nBut it\'s very important to use the same values for this application.<br>\nThe faster way is to copy the information about App roles directly from the Manifest file and put them in the manifest of the client application.</p>\n\n<p>From the left navigation pane, click on "<strong>Manifest</strong>", select the Json portion of the code about appRoles and copy it in the clipboard.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BOjG9eI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m40abzdcptmiv22edfb9.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BOjG9eI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m40abzdcptmiv22edfb9.png" alt="Image description" loading="lazy" width="865" height="785"></a></p>\n\n<p>Now you can open the manifest file of the client application and replase the Json node with the new values.</p>\n\n<p>That\'s it.</p>\n<h1>\n  <a name="assign-users-to-the-new-roles" href="#assign-users-to-the-new-roles">\n  </a>\n  Assign users to the new roles\n</h1>\n\n<p>Navigate to the "<strong>Enterprise Applications</strong> and open the server app.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s---4uP1LEK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1bsh3fbhgqajiv0reqo2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---4uP1LEK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1bsh3fbhgqajiv0reqo2.png" alt="Image description" loading="lazy" width="880" height="294"></a></p>\n\n<p>Under the menu "<strong>Manage</strong>" click on "<strong>Users and groups</strong>" and then "<strong>Add user/group</strong>".</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--z5hWeqiF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2dnv68cv45kc1ghzwhn6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--z5hWeqiF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2dnv68cv45kc1ghzwhn6.png" alt="Image description" loading="lazy" width="728" height="347"></a></p>\n\n<p>In the new window, search and select a user and the role that you want to assign to him.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ig0Q2DJE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6oavy3g9zij582z9t7h3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ig0Q2DJE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6oavy3g9zij582z9t7h3.png" alt="Image description" loading="lazy" width="880" height="267"></a></p>\n\n<p>Now in the list you can see all the users with their role assigned.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--uOzkRkla--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t56zt78i8pzvl34afy62.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--uOzkRkla--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t56zt78i8pzvl34afy62.png" alt="Image description" loading="lazy" width="768" height="346"></a></p>\n\n<p><strong>Important</strong>: repeat all these steps for the client application. </p>\n<h1>\n  <a name="use-the-app-roles-in-the-application" href="#use-the-app-roles-in-the-application">\n  </a>\n  Use the App roles in the application\n</h1>\n\n<p>Open the Client project and add a class called "<strong>SecureUserAccount</strong>" (but you can choose the name that you prefer).<br>\nThis class extends the RemoteUserAccount.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SecureUserAccount</span> <span class="p">:</span> <span class="n">RemoteUserAccount</span>\n    <span class="p">{</span>\n        <span class="p">[</span><span class="nf">JsonPropertyName</span><span class="p">(</span><span class="s">"roles"</span><span class="p">)]</span>\n        <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">Roles</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p>Now our application need to know how to manage the roles from Azure AD.<br>\nTo do that, we can create a new class in the client project called "<strong>SecureAccountFactory</strong>"<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SecureAccountFactory</span> <span class="p">:</span> <span class="n">AccountClaimsPrincipalFactory</span><span class="p">&lt;</span><span class="n">SecureUserAccount</span><span class="p">&gt;</span>\n    <span class="p">{</span>\n        <span class="k">public</span> <span class="nf">SecureAccountFactory</span><span class="p">(</span><span class="n">IAccessTokenProviderAccessor</span> <span class="n">accessor</span><span class="p">)</span>\n            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">accessor</span><span class="p">)</span>\n        <span class="p">{</span>\n        <span class="p">}</span>\n        <span class="k">public</span> <span class="k">async</span> <span class="k">override</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">ClaimsPrincipal</span><span class="p">&gt;</span> <span class="nf">CreateUserAsync</span><span class="p">(</span><span class="n">SecureUserAccount</span> <span class="n">account</span><span class="p">,</span>\n            <span class="n">RemoteAuthenticationUserOptions</span> <span class="n">options</span><span class="p">)</span>\n        <span class="p">{</span>\n            <span class="kt">var</span> <span class="n">initialUser</span> <span class="p">=</span> <span class="k">await</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateUserAsync</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>\n            <span class="k">if</span> <span class="p">(</span><span class="n">initialUser</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="n">IsAuthenticated</span><span class="p">)</span>\n            <span class="p">{</span>\n                <span class="kt">var</span> <span class="n">userIdentity</span> <span class="p">=</span> <span class="p">(</span><span class="n">ClaimsIdentity</span><span class="p">)</span><span class="n">initialUser</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span>\n                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">role</span> <span class="k">in</span> <span class="n">account</span><span class="p">.</span><span class="n">Roles</span><span class="p">)</span>\n                <span class="p">{</span>\n                    <span class="n">userIdentity</span><span class="p">.</span><span class="nf">AddClaim</span><span class="p">(</span><span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="s">"appRole"</span><span class="p">,</span> <span class="n">role</span><span class="p">));</span>\n                <span class="p">}</span>\n            <span class="p">}</span>\n            <span class="k">return</span> <span class="n">initialUser</span><span class="p">;</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p>The last change in the client application is in the Program.cs file.<br>\nReplace the Msal authentication snippet with the new one:<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddMsalAuthentication</span><span class="p">&lt;</span><span class="n">RemoteAuthenticationState</span><span class="p">,</span> <span class="n">SecureUserAccount</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>\n<span class="p">{</span>\n    <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">.</span><span class="n">ProviderOptions</span><span class="p">.</span><span class="n">Authentication</span><span class="p">);</span>\n    <span class="n">options</span><span class="p">.</span><span class="n">ProviderOptions</span><span class="p">.</span><span class="n">DefaultAccessTokenScopes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"api://957e1304-dd53-4589-b013-4a264dd19334/BlazorWASMHosted.API"</span><span class="p">);</span>\n    <span class="n">options</span><span class="p">.</span><span class="n">UserOptions</span><span class="p">.</span><span class="n">RoleClaim</span> <span class="p">=</span> <span class="s">"appRole"</span><span class="p">;</span>\n<span class="p">})</span>\n<span class="p">.</span><span class="n">AddAccountClaimsPrincipalFactory</span><span class="p">&lt;</span><span class="n">RemoteAuthenticationState</span><span class="p">,</span> <span class="n">SecureUserAccount</span><span class="p">,</span>\n    <span class="n">SecureAccountFactory</span><span class="p">&gt;();</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p>Now it\'s time to change the server application.</p>\n\n<p>Open the Program.cs file and replace the MsalAuthentication code with the new one:<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddAuthentication</span><span class="p">(</span><span class="n">JwtBearerDefaults</span><span class="p">.</span><span class="n">AuthenticationScheme</span><span class="p">)</span>\n        <span class="p">.</span><span class="nf">AddMicrosoftIdentityWebApi</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>\n        <span class="p">{</span>\n            <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>\n            <span class="n">options</span><span class="p">.</span><span class="n">TokenValidationParameters</span><span class="p">.</span><span class="n">RoleClaimType</span> <span class="p">=</span>\n                <span class="s">"http://schemas.microsoft.com/ws/2008/06/identity/claims/role"</span><span class="p">;</span>\n        <span class="p">},</span>\n        <span class="n">options</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"AzureAd"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span> <span class="p">});</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<h1>\n  <a name="securing-pages-web-api-and-features" href="#securing-pages-web-api-and-features">\n  </a>\n  Securing Pages, Web API and Features\n</h1>\n\n<p>Let\'s start to work with the roles.</p>\n\n<p>First of all, the server application.<br>\nExtend the Authorize attribute of the WeatherForecastController with the roles property:<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code><span class="p">[</span><span class="nf">Authorize</span><span class="p">(</span><span class="n">Roles</span> <span class="p">=</span> <span class="s">"administrator"</span><span class="p">)]</span> \n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n<p>Now only a user with the Administrator role can call the controller.</p>\n\n<p>In the client app, open the Fetchdata.razor file and extend the same attribute with the roles attributes:<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code><span class="n">@attribute</span> <span class="p">[</span><span class="nf">Authorize</span><span class="p">(</span><span class="n">Roles</span> <span class="p">=</span> <span class="s">"administrator"</span><span class="p">)]</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<h2>\n  <a name="display-only-the-links-for-your-role" href="#display-only-the-links-for-your-role">\n  </a>\n  Display only the links for your role\n</h2>\n\n<p>If you want to prevent that a user access to a page with the wrong role, you can hide portions of the pages or links in the application.<br>\nYou can use one of the out-of-box features of Blazor called "<strong>AuthorizeView</strong>".</p>\n\n<p>For instance, if you want to hide the page Fetch data, it\'s enough if you add this code in the NavMenu.razor file.<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight xml"><code><span class="nt">&lt;AuthorizeView</span> <span class="na">Roles=</span><span class="s">"administrator"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;Authorized&gt;</span>\n        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item px-3"</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;NavLink</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"fetchdata"</span><span class="nt">&gt;</span>\n                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"oi oi-list-rich"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/span&gt;</span> Fetch data\n            <span class="nt">&lt;/NavLink&gt;</span>\n        <span class="nt">&lt;/li&gt;</span>\n    <span class="nt">&lt;/Authorized&gt;</span>\n<span class="nt">&lt;/AuthorizeView&gt;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<h2>\n  <a name="access-to-the-app-role-from-the-code-behind" href="#access-to-the-app-role-from-the-code-behind">\n  </a>\n  Access to the App Role from the code behind\n</h2>\n\n<p>It\'s very easy also to access to the roles of the user from the code behind.<br>\nVery often inside an application there a lot of code that change the behaviour based on the user permissions.</p>\n\n<p>Let\'s start with an easy example.<br>\nOpen the Counter.razor page and change the code as below:<br>\n</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight csharp"><code><span class="n">@code</span> <span class="p">{</span>\n    <span class="p">[</span><span class="n">CascadingParameter</span><span class="p">]</span>\n    <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">AuthenticationState</span><span class="p">&gt;</span> <span class="n">AuthState</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>\n\n    <span class="k">private</span> <span class="kt">int</span> <span class="n">currentCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>\n\n    <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">IncrementCount</span><span class="p">()</span>\n    <span class="p">{</span>\n        <span class="kt">var</span> <span class="n">authState</span> <span class="p">=</span> <span class="k">await</span> <span class="n">AuthState</span><span class="p">;</span>\n        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="n">authState</span><span class="p">.</span><span class="n">User</span><span class="p">;</span>\n\n        <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">IsInRole</span><span class="p">(</span><span class="s">"viewer"</span><span class="p">))</span>\n        <span class="p">{</span>\n            <span class="n">currentCount</span> <span class="p">+=</span> <span class="m">2</span><span class="p">;</span>\n        <span class="p">}</span>\n\n        <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">IsInRole</span><span class="p">(</span><span class="s">"administrator"</span><span class="p">))</span>\n        <span class="p">{</span>\n            <span class="n">currentCount</span> <span class="p">-=</span> <span class="m">2</span><span class="p">;</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<h1>\n  <a name="wrap-up" href="#wrap-up">\n  </a>\n  Wrap up\n</h1>\n\n<p>Now you know how to create a new app on Azure Portal, assign roles to it and work with the roles in your Blazor applications.</p>\n\n<p>You can find the source code of the example on GitHub.<br>\nFollow the instructions in the Readme file.</p>\n\n\n<div class="ltag-github-readme-tag">\n  <div class="readme-overview">\n    <h2>\n      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--566lAguM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev.to/assets/github-logo-5a155e1f9a670af7944dd5e12375bc76ed542ea80224905ecaf878b9157cdefc.svg" alt="GitHub logo" loading="lazy">\n      <a href="https://github.com/kasuken">\n        kasuken\n      </a> / <a style="font-weight: 600;" href="https://github.com/kasuken/BlazorWASMHostedAzureADAuth">\n        BlazorWASMHostedAzureADAuth\n      </a>\n    </h2>\n    <h3>\n      \n    </h3>\n  </div>\n  <div class="ltag-github-body">\n    \n<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/2757486/158978139-a2097c49-99ab-4653-ae6c-9a004b926db9.png"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A7XUrQE---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/2757486/158978139-a2097c49-99ab-4653-ae6c-9a004b926db9.png" alt="image" style="max-width: 100%;" loading="lazy"></a></p>\n<h1 dir="auto">\nBlazorWASMHostedAzureADAuth</h1>\n<p dir="auto">This repository is an example for Blazor WASM Hosted app secured by Azure Active Directory.</p>\n<p dir="auto">There are two different branches.</p>\n<ul dir="auto">\n<li>Authorization</li>\n<li>Roles</li>\n</ul>\n<p dir="auto">You can find the right code based on the two post on my blog with all the steps that you need to replicate these settings in your own projects.</p>\n<ul dir="auto">\n<li>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 1 - <a href="https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-1-382d" rel="nofollow">https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-1-382d</a>\n</li>\n<li>Securing a Blazor WebAssembly Hosted Apps with Azure Active Directory - Part 2 - <a href="https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd" rel="nofollow">https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd</a>\n</li>\n</ul>\n<p dir="auto">The link to the series: <a href="https://dev.to/kasuken/series/17352" rel="nofollow">https://dev.to/kasuken/series/17352</a></p>\n</article></div>\n\n  </div>\n  <div class="gh-btn-container"><a class="gh-btn" href="https://github.com/kasuken/BlazorWASMHostedAzureADAuth">View on GitHub</a></div>\n</div>\n\n\n\n<p>Thank you and drop me a comment if you have questions or feedbacks!</p>\n\n',n.body_markdown='In the previous article of this series, we have created a secure project with Blazor WebAssembly Hosted and Azure Active Directory.\nIn this article we are going to add another level of security: the roles.\n\nAlso in this case we will use a feature of Azure Active Directory called: "**App Roles**".\n\nSo, let\'s open our application and make some changes to it!\n\n# Add App Roles to the App Registration\n\nFrom the Azure Portal, come back to the App Registrations and search for your two apps.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ya0x70fkikk449jzb15i.png)\n \nOpen the app registration for the server app and under the "**Manage**" section of the left navigation pane, click on "**App roles**".\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/papr1j7q3jtq2m4tgrlr.png)\n\nClick on the button "**Create app role**" on the top bar navigation and fill the form with the information about the new role.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5ke6cmcs245de6kfjfsf.png)\n  \nPay attention to the field "value" because it will be the value that we will use in our code later.\nIt\'s reccomended to use lowcase letters.\n\nRepeat these operations for other roles as: Viewer, PowerUser, etc.\n\n# Copy the App roles to the client App Registration\n\nWe have to do the same steps for the client app.\nBut it\'s very important to use the same values for this application.\nThe faster way is to copy the information about App roles directly from the Manifest file and put them in the manifest of the client application.\n\nFrom the left navigation pane, click on "**Manifest**", select the Json portion of the code about appRoles and copy it in the clipboard.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m40abzdcptmiv22edfb9.png)\n \nNow you can open the manifest file of the client application and replase the Json node with the new values.\n\nThat\'s it.\n\n# Assign users to the new roles\n\nNavigate to the "**Enterprise Applications** and open the server app.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1bsh3fbhgqajiv0reqo2.png)\n \nUnder the menu "**Manage**" click on "**Users and groups**" and then "**Add user/group**".\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2dnv68cv45kc1ghzwhn6.png)\n \nIn the new window, search and select a user and the role that you want to assign to him.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6oavy3g9zij582z9t7h3.png)\n \nNow in the list you can see all the users with their role assigned.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t56zt78i8pzvl34afy62.png)\n\n**Important**: repeat all these steps for the client application. \n\n# Use the App roles in the application\n\nOpen the Client project and add a class called "**SecureUserAccount**" (but you can choose the name that you prefer).\nThis class extends the RemoteUserAccount.\n\n```csharp\n    public class SecureUserAccount : RemoteUserAccount\n    {\n        [JsonPropertyName("roles")]\n        public string[] Roles { get; set; } = Array.Empty<string>();\n    }\n```\n\nNow our application need to know how to manage the roles from Azure AD.\nTo do that, we can create a new class in the client project called "**SecureAccountFactory**"\n\n```csharp\n    public class SecureAccountFactory : AccountClaimsPrincipalFactory<SecureUserAccount>\n    {\n        public SecureAccountFactory(IAccessTokenProviderAccessor accessor)\n            : base(accessor)\n        {\n        }\n        public async override ValueTask<ClaimsPrincipal> CreateUserAsync(SecureUserAccount account,\n            RemoteAuthenticationUserOptions options)\n        {\n            var initialUser = await base.CreateUserAsync(account, options);\n            if (initialUser.Identity.IsAuthenticated)\n            {\n                var userIdentity = (ClaimsIdentity)initialUser.Identity;\n                foreach (var role in account.Roles)\n                {\n                    userIdentity.AddClaim(new Claim("appRole", role));\n                }\n            }\n            return initialUser;\n        }\n    }\n```\n\nThe last change in the client application is in the Program.cs file.\nReplace the Msal authentication snippet with the new one:\n\n```csharp\nbuilder.Services.AddMsalAuthentication<RemoteAuthenticationState, SecureUserAccount>(options =>\n{\n    builder.Configuration.Bind("AzureAd", options.ProviderOptions.Authentication);\n    options.ProviderOptions.DefaultAccessTokenScopes.Add("api://957e1304-dd53-4589-b013-4a264dd19334/BlazorWASMHosted.API");\n    options.UserOptions.RoleClaim = "appRole";\n})\n.AddAccountClaimsPrincipalFactory<RemoteAuthenticationState, SecureUserAccount,\n    SecureAccountFactory>();\n```\n\nNow it\'s time to change the server application.\n\nOpen the Program.cs file and replace the MsalAuthentication code with the new one:\n\n```csharp\nbuilder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\n        .AddMicrosoftIdentityWebApi(options =>\n        {\n            builder.Configuration.Bind("AzureAd", options);\n            options.TokenValidationParameters.RoleClaimType =\n                "http://schemas.microsoft.com/ws/2008/06/identity/claims/role";\n        },\n        options => { builder.Configuration.Bind("AzureAd", options); });\n```\n\n# Securing Pages, Web API and Features\n\nLet\'s start to work with the roles.\n\nFirst of all, the server application.\nExtend the Authorize attribute of the WeatherForecastController with the roles property:\n\n```csharp\n[Authorize(Roles = "administrator")] \n```\n\nNow only a user with the Administrator role can call the controller.\n\nIn the client app, open the Fetchdata.razor file and extend the same attribute with the roles attributes:\n\n```csharp\n@attribute [Authorize(Roles = "administrator")]\n```\n\n## Display only the links for your role\n\nIf you want to prevent that a user access to a page with the wrong role, you can hide portions of the pages or links in the application.\nYou can use one of the out-of-box features of Blazor called "**AuthorizeView**".\n\nFor instance, if you want to hide the page Fetch data, it\'s enough if you add this code in the NavMenu.razor file.\n\n```xml\n<AuthorizeView Roles="administrator">\n    <Authorized>\n        <li class="nav-item px-3">\n            <NavLink class="nav-link" href="fetchdata">\n                <span class="oi oi-list-rich" aria-hidden="true"></span> Fetch data\n            </NavLink>\n        </li>\n    </Authorized>\n</AuthorizeView>\n```\n\n## Access to the App Role from the code behind\n\nIt\'s very easy also to access to the roles of the user from the code behind.\nVery often inside an application there a lot of code that change the behaviour based on the user permissions.\n\nLet\'s start with an easy example.\nOpen the Counter.razor page and change the code as below:\n\n```csharp\n@code {\n    [CascadingParameter]\n    public Task<AuthenticationState> AuthState { get; set; }\n\n    private int currentCount = 0;\n\n    private async Task IncrementCount()\n    {\n        var authState = await AuthState;\n        var user = authState.User;\n\n        if (user.IsInRole("viewer"))\n        {\n            currentCount += 2;\n        }\n\n        if (user.IsInRole("administrator"))\n        {\n            currentCount -= 2;\n        }\n    }\n}\n```\n\n# Wrap up\nNow you know how to create a new app on Azure Portal, assign roles to it and work with the roles in your Blazor applications.\n\nYou can find the source code of the example on GitHub.\nFollow the instructions in the Readme file.\n\n{% embed\nhttps://github.com/kasuken/BlazorWASMHostedAzureADAuth\n%}\n\nThank you and drop me a comment if you have questions or feedbacks!\n',n.user={name:"Emanuele Bartolesi",username:t,twitter_username:s,github_username:t,website_url:"https://www.emanuelebartolesi.com",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--bPkcBMoR--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/79932/be7bcd76-1f69-4336-9155-6017aebb2c53.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--MA5AG0mH--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/79932/be7bcd76-1f69-4336-9155-6017aebb2c53.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:n}},error:s,state:{currentArticle:n},serverRendered:!0,routePath:"/kasuken/1026398",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"2022-03-18T09:33:36Z",{},"https://dev.to/kasuken/securing-a-blazor-webassembly-hosted-apps-with-azure-active-directory-part-2-1ppd","kasuken")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
