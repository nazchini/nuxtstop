<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Using GitOps for Infrastructure and Applications With Crossplane and Argo CD</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Using GitOps for Infrastructure and Applications With Crossplane and Argo CD</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/devops" class="tag" data-v-70afb46a>
          #devops
        </a><a href="/nuxtstop/t/kubernetes" class="tag" data-v-70afb46a>
          #kubernetes
        </a><a href="/nuxtstop/t/cloud" class="tag" data-v-70afb46a>
          #cloud
        </a><a href="/nuxtstop/t/gitops" class="tag" data-v-70afb46a>
          #gitops
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--6xBKRniJ--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/0ioepmjczad34oe3ot14.png" alt="Using GitOps for Infrastructure and Applications With Crossplane and Argo CD" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            6
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Dec 13 '21</time></div></header> <div class="content" data-v-70afb46a><p>If you have been following the Codefresh blog for a while, you might have noticed a common pattern in all the articles that talk about Kubernetes deployments. Almost all of them start with a Kubernetes cluster that is already there, and then the article explains how to deploy an application on top.</p>

<p>The reason for this simplification comes mainly from brevity and simplicity. We want to focus on the deployment part of the application and not its infrastructure just to make the article easier to follow. This is the obvious reason.</p>

<p>The hidden reason is that until recently infrastructure deployments were handled in a different manner than applications deployments. Especially in large enterprise companies, the skillset of people that deal with infrastructure and application can vary a lot as the tools of the trade are completely different. </p>

<p>For example, a lot of people that deal with infrastructure <a href="https://codefresh.io/docs/docs/yaml-examples/examples/terraform/">prefer to use Terraform templates</a>, but employ Kustomize/Helm or other similar tools for application development. While this is a very valid solution, it doesn’t have to be this way. </p>

<p>Now with GitOps you can have a uniform way of dealing with infrastructure and applications.</p>

<h2>
  <a name="gitops-and-terraform" href="#gitops-and-terraform">
  </a>
  GitOps and Terraform
</h2>

<p>If you are not familiar with GitOps, head over to <a href="https://opengitops.dev/">https://opengitops.dev/</a> which is the official page of the GitOps working group. The principles of GitOps are the following:</p>

<ol>
<li>The system is described in a declarative manner. (In practice, this means Kubernetes manifests.)</li>
<li>The definition of the system is versioned and audited. (In practice, it is stored in Git.)</li>
<li>A software agent automatically pulls the Git state and matches the platform state. (In practice, this means <a href="https://fluxcd.io/">Flux</a>/<a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a>.)</li>
<li>The state is continuously reconciled. This means that any changes happening in Git should also be reflected in the system, as well as the opposite scenario.</li>
</ol>

<p>If you have already worked with Terraform, you should already understand why it is difficult to apply GitOps to the Terraform CLI. While Terraform only has the first requirement (declarative format), it doesn’t satisfy the other three requirements around Git storage, automatic reconciliation, and two-way sync. As soon as Terraform finishes its job, it doesn’t interface with the system in any way. If you manually delete a Virtual Machine that was created by Terraform, vanilla Terraform doesn’t know about it. And regarding state, Terraform stores its own state which is completely different from the definition files in Git.</p>

<p>So at first glance, getting GitOps to work with infrastructure is a complicated task. You realize that you need to add something on top of vanilla Terraform in order to satisfy the GitOps requirements.</p>

<p>But there is a new kid on the block, and that is <a href="https://crossplane.io/">Crossplane</a>!</p>

<h2>
  <a name="gitops-and-crossplane" href="#gitops-and-crossplane">
  </a>
  GitOps and Crossplane
</h2>

<p>Crossplane has similar capabilities to Terraform (creating infrastructure) but with the following major differences:</p>

<ol>
<li>Crossplane itself is a Kubernetes application. (The infrastructure it creates can be anything.)</li>
<li>Crossplane definitions are Kubernetes manifests.</li>
<li>You can either use manifests that describe resources in the common cloud providers or create your own resources.</li>
</ol>

<p>As a simple example here is an EC2 instance describe in Crossplane:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ec2.aws.crossplane.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Instance</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sample-instance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">forProvider</span><span class="pi">:</span>
    <span class="na">region</span><span class="pi">:</span> <span class="s">us-east-1</span>
    <span class="na">imageId</span><span class="pi">:</span> <span class="s">ami-0dc2d3e4c0f9ebd18</span>
    <span class="na">securityGroupRefs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sample-cluster-sg</span>
    <span class="na">subnetIdRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">sample-subnet1</span>  
  <span class="na">providerConfigRef</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">example</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You can find more examples for <a href="https://github.com/crossplane/provider-aws/tree/master/examples">Amazon</a>, <a href="https://github.com/crossplane/provider-gcp/tree/master/examples">Google</a>, and <a href="https://github.com/crossplane/provider-azure/tree/master/examples">Azure</a>. Crossplane supports several other providers, and of course you can <a href="https://github.com/crossplane/provider-template">add your own</a>.</p>

<p>The important point here is that the file above is a standard Kubernetes manifest. You can:</p>

<ul>
<li>Apply it with kubectl.</li>
<li>Verify it with manifest verification tools (<a href="https://www.kubeval.com/">kubeval</a> or <a href="https://github.com/stackrox/kube-linter">kube-linter</a>).</li>
<li>Template it with Helm/Kustomize.</li>
<li>Use any of the tools in the Kubernetes ecosystem to read/manage/store it.</li>
</ul>

<p>And since it is a standard manifest, you can of course store it in Git and manage it with ArgoCD for a Full GitOps workflow. The importance of this capability cannot be overstated.</p>

<p>If you combine ArgoCD and Crossplane, you have a full solution for following the GitOps principles with infrastructure and not just applications. Imagine if your ArgoCD dashboard contained this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cU97kSbR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s4xtnny6c5lw4cdyrfur.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cU97kSbR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s4xtnny6c5lw4cdyrfur.png" alt="ArgoCD and Crossplane" loading="lazy" width="880" height="463"></a></p>

<p>Isn’t that cool?</p>

<h2>
  <a name="how-argocd-and-crossplane-work-together" href="#how-argocd-and-crossplane-work-together">
  </a>
  How ArgoCD and Crossplane work together
</h2>

<p>Crossplane offers an easy way to model your infrastructure as Kubernetes manifests. This is great on its own, but if you <a href="https://argo-cd.readthedocs.io/en/stable/getting_started/">put ArgoCD in the mix</a>, you essentially gain all the advantages of GitOps for your infrastructure.</p>

<ul>
<li>You know exactly what infrastructure you have simply by looking at the Git repository.</li>
<li>You know exactly what was changed and when by looking at Git history.</li>
<li>The infrastructure state IS the same as the Git state. Terraform has its own state that is used a the single source of truth</li>
<li>You don’t need any external credentials any more.</li>
<li>You can easily rollback to a previous version of your infra with a git reset/git-revert.
You completely avoid the dreaded configuration drift.</li>
</ul>

<p>The last point is very critical. Terraform only knows what is in your infrastructure during deployment. If you make any manual changes afterwards (e.g. delete some infra), terraform knows absolutely nothing. You need to rerun terraform and pray that the correct action is taken. There are many terraform horror stories about incomplete/invalid states. Here is one of my <a href="https://www.youtube.com/watch?v=ix0Tw8uinWs">favorite tfstate stories from Spotify</a>.</p>

<p>ArgoCD will instantly detect any manual changes in your infrastructure, present you a diff, and even allow you to completely discard them if you want.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Js7o0JZT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qs4m8i78akely3vy2j5z.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Js7o0JZT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qs4m8i78akely3vy2j5z.png" alt="Argo Everywhere" loading="lazy" width="880" height="458"></a></p>

<p>Essentially ArgoCD is agnostic as to what exactly is described by the Kubernetes manifests it manages. They can be plain Kubernetes applications, Virtual machines, Container registries, Load balancers, object storage, firewall rules, etc. </p>

<h2>
  <a name="create-infrastructure-and-deploy-to-it-using-gitops" href="#create-infrastructure-and-deploy-to-it-using-gitops">
  </a>
  Create infrastructure and deploy to it using GitOps
</h2>

<p>Now that we saw that you can use ArgoCD and Crossplane together for managing infrastructure, we are now ready to treat applications and the platform they need in the same way.</p>

<p>This means that we can do the following:</p>

<ol>
<li>Start from nothing.</li>
<li>Use Crossplane to create a Kubernetes cluster.</li>
<li>Commit the crossplane manifest and manage it with ArgoCD.</li>
<li>Use a standard manifest (e.g. deployment) to deploy an application to the cluster that was just created.</li>
<li>Commit that manifest in Git too. Like the application one, ArgoCD will manage it like any other Kubernetes manifest (even though it represents infrastructure).</li>
</ol>

<p>Here is the whole workflow:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Y9CxfvWf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x7nnuu0othvd5oh46et9.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Y9CxfvWf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x7nnuu0othvd5oh46et9.png" alt="GitOps Everywhere" loading="lazy" width="880" height="668"></a></p>

<p>The Kubernetes cluster that Crossplane is running on is only used to bootstrap crossplane. It doesn’t get any production workloads on its own. For simple demos, this can be any cluster (even a local one running on your workstation).</p>

<p>The end result is that now you have a unified way to handle both infrastructure and applications right from Argo CD.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--VoH35Eh---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tzc4rxnuf7ypp8pjx2we.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--VoH35Eh---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tzc4rxnuf7ypp8pjx2we.png" alt="Application and Infrastructure management" loading="lazy" width="880" height="462"></a></p>

<p>The process of changing either of them is exactly the same. </p>

<ul>
<li>If you want to change infrastructure, you commit a change and ArgoCD takes care of it (with the help of Crossplane).</li>
<li>If you want to change your application, you commit a change and ArgoCD takes care of it.</li>
</ul>

<p>They also both gain all the benefits of GitOps. If for example somebody changes the number of replicas in the deployment or tampers with the cluster nodes, ArgoCD will detect the manual changes automatically and give you the ability to discard them completely.</p>

<h2>
  <a name="why-gitops-is-the-way-forward" href="#why-gitops-is-the-way-forward">
  </a>
  Why GitOps is the way forward
</h2>

<p>The whole point of DevOps is to make everything self-service and promote collaboration between developers and operators. Adopting Crossplane in a GitOps setting means that now both parties have a common language that they can communicate with. </p>

<p>There is no need anymore for separate workflows that are confusing to either of them. Adopting a common workflow for both infrastructure and applications is the embodiment of the DevOps spirit.</p>

<p>If you want to learn more about <a href="https://codefresh.io/gitops/">GitOps</a> and how Codefresh has embraced it, check out the <a href="https://codefresh.io/codefresh-argo-platform/">Codefresh DevOps platform for Argo</a>. For more information about Crossplane, see <a href="https://crossplane.io/">the official site</a> and the hosted solution by <a href="https://www.upbound.io/">Upbound</a>.</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/kostiscodefresh/using-gitops-for-infrastructure-and-applications-with-crossplane-and-argo-cd-1mgd" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(e,t,a,n){return a.type_of="article",a.id=925024,a.title="Using GitOps for Infrastructure and Applications With Crossplane and Argo CD",a.description="If you have been following the Codefresh blog for a while, you might have noticed a common pattern in...",a.readable_publish_date="Dec 13 '21",a.slug="using-gitops-for-infrastructure-and-applications-with-crossplane-and-argo-cd-1mgd",a.path="/codefreshio/using-gitops-for-infrastructure-and-applications-with-crossplane-and-argo-cd-1mgd",a.url="https://dev.to/codefreshio/using-gitops-for-infrastructure-and-applications-with-crossplane-and-argo-cd-1mgd",a.comments_count=0,a.public_reactions_count=6,a.collection_id=e,a.published_timestamp=t,a.positive_reactions_count=6,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--6xBKRniJ--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/0ioepmjczad34oe3ot14.png",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--xmTfBHps--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/0ioepmjczad34oe3ot14.png",a.canonical_url="https://codefresh.io/about-gitops/gitops-for-infrastructure-and-applications/",a.created_at="2021-12-13T13:21:31Z",a.edited_at=e,a.crossposted_at=e,a.published_at=t,a.last_comment_at=t,a.reading_time_minutes=6,a.tag_list="devops, kubernetes, cloud, gitops",a.tags=["devops","kubernetes","cloud","gitops"],a.body_html='<p>If you have been following the Codefresh blog for a while, you might have noticed a common pattern in all the articles that talk about Kubernetes deployments. Almost all of them start with a Kubernetes cluster that is already there, and then the article explains how to deploy an application on top.</p>\n\n<p>The reason for this simplification comes mainly from brevity and simplicity. We want to focus on the deployment part of the application and not its infrastructure just to make the article easier to follow. This is the obvious reason.</p>\n\n<p>The hidden reason is that until recently infrastructure deployments were handled in a different manner than applications deployments. Especially in large enterprise companies, the skillset of people that deal with infrastructure and application can vary a lot as the tools of the trade are completely different. </p>\n\n<p>For example, a lot of people that deal with infrastructure <a href="https://codefresh.io/docs/docs/yaml-examples/examples/terraform/">prefer to use Terraform templates</a>, but employ Kustomize/Helm or other similar tools for application development. While this is a very valid solution, it doesn’t have to be this way. </p>\n\n<p>Now with GitOps you can have a uniform way of dealing with infrastructure and applications.</p>\n\n<h2>\n  <a name="gitops-and-terraform" href="#gitops-and-terraform">\n  </a>\n  GitOps and Terraform\n</h2>\n\n<p>If you are not familiar with GitOps, head over to <a href="https://opengitops.dev/">https://opengitops.dev/</a> which is the official page of the GitOps working group. The principles of GitOps are the following:</p>\n\n<ol>\n<li>The system is described in a declarative manner. (In practice, this means Kubernetes manifests.)</li>\n<li>The definition of the system is versioned and audited. (In practice, it is stored in Git.)</li>\n<li>A software agent automatically pulls the Git state and matches the platform state. (In practice, this means <a href="https://fluxcd.io/">Flux</a>/<a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a>.)</li>\n<li>The state is continuously reconciled. This means that any changes happening in Git should also be reflected in the system, as well as the opposite scenario.</li>\n</ol>\n\n<p>If you have already worked with Terraform, you should already understand why it is difficult to apply GitOps to the Terraform CLI. While Terraform only has the first requirement (declarative format), it doesn’t satisfy the other three requirements around Git storage, automatic reconciliation, and two-way sync. As soon as Terraform finishes its job, it doesn’t interface with the system in any way. If you manually delete a Virtual Machine that was created by Terraform, vanilla Terraform doesn’t know about it. And regarding state, Terraform stores its own state which is completely different from the definition files in Git.</p>\n\n<p>So at first glance, getting GitOps to work with infrastructure is a complicated task. You realize that you need to add something on top of vanilla Terraform in order to satisfy the GitOps requirements.</p>\n\n<p>But there is a new kid on the block, and that is <a href="https://crossplane.io/">Crossplane</a>!</p>\n\n<h2>\n  <a name="gitops-and-crossplane" href="#gitops-and-crossplane">\n  </a>\n  GitOps and Crossplane\n</h2>\n\n<p>Crossplane has similar capabilities to Terraform (creating infrastructure) but with the following major differences:</p>\n\n<ol>\n<li>Crossplane itself is a Kubernetes application. (The infrastructure it creates can be anything.)</li>\n<li>Crossplane definitions are Kubernetes manifests.</li>\n<li>You can either use manifests that describe resources in the common cloud providers or create your own resources.</li>\n</ol>\n\n<p>As a simple example here is an EC2 instance describe in Crossplane:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight yaml"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ec2.aws.crossplane.io/v1alpha1</span>\n<span class="na">kind</span><span class="pi">:</span> <span class="s">Instance</span>\n<span class="na">metadata</span><span class="pi">:</span>\n  <span class="na">name</span><span class="pi">:</span> <span class="s">sample-instance</span>\n<span class="na">spec</span><span class="pi">:</span>\n  <span class="na">forProvider</span><span class="pi">:</span>\n    <span class="na">region</span><span class="pi">:</span> <span class="s">us-east-1</span>\n    <span class="na">imageId</span><span class="pi">:</span> <span class="s">ami-0dc2d3e4c0f9ebd18</span>\n    <span class="na">securityGroupRefs</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sample-cluster-sg</span>\n    <span class="na">subnetIdRef</span><span class="pi">:</span>\n      <span class="na">name</span><span class="pi">:</span> <span class="s">sample-subnet1</span>  \n  <span class="na">providerConfigRef</span><span class="pi">:</span>\n    <span class="na">name</span><span class="pi">:</span> <span class="s">example</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You can find more examples for <a href="https://github.com/crossplane/provider-aws/tree/master/examples">Amazon</a>, <a href="https://github.com/crossplane/provider-gcp/tree/master/examples">Google</a>, and <a href="https://github.com/crossplane/provider-azure/tree/master/examples">Azure</a>. Crossplane supports several other providers, and of course you can <a href="https://github.com/crossplane/provider-template">add your own</a>.</p>\n\n<p>The important point here is that the file above is a standard Kubernetes manifest. You can:</p>\n\n<ul>\n<li>Apply it with kubectl.</li>\n<li>Verify it with manifest verification tools (<a href="https://www.kubeval.com/">kubeval</a> or <a href="https://github.com/stackrox/kube-linter">kube-linter</a>).</li>\n<li>Template it with Helm/Kustomize.</li>\n<li>Use any of the tools in the Kubernetes ecosystem to read/manage/store it.</li>\n</ul>\n\n<p>And since it is a standard manifest, you can of course store it in Git and manage it with ArgoCD for a Full GitOps workflow. The importance of this capability cannot be overstated.</p>\n\n<p>If you combine ArgoCD and Crossplane, you have a full solution for following the GitOps principles with infrastructure and not just applications. Imagine if your ArgoCD dashboard contained this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cU97kSbR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s4xtnny6c5lw4cdyrfur.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cU97kSbR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s4xtnny6c5lw4cdyrfur.png" alt="ArgoCD and Crossplane" loading="lazy" width="880" height="463"></a></p>\n\n<p>Isn’t that cool?</p>\n\n<h2>\n  <a name="how-argocd-and-crossplane-work-together" href="#how-argocd-and-crossplane-work-together">\n  </a>\n  How ArgoCD and Crossplane work together\n</h2>\n\n<p>Crossplane offers an easy way to model your infrastructure as Kubernetes manifests. This is great on its own, but if you <a href="https://argo-cd.readthedocs.io/en/stable/getting_started/">put ArgoCD in the mix</a>, you essentially gain all the advantages of GitOps for your infrastructure.</p>\n\n<ul>\n<li>You know exactly what infrastructure you have simply by looking at the Git repository.</li>\n<li>You know exactly what was changed and when by looking at Git history.</li>\n<li>The infrastructure state IS the same as the Git state. Terraform has its own state that is used a the single source of truth</li>\n<li>You don’t need any external credentials any more.</li>\n<li>You can easily rollback to a previous version of your infra with a git reset/git-revert.\nYou completely avoid the dreaded configuration drift.</li>\n</ul>\n\n<p>The last point is very critical. Terraform only knows what is in your infrastructure during deployment. If you make any manual changes afterwards (e.g. delete some infra), terraform knows absolutely nothing. You need to rerun terraform and pray that the correct action is taken. There are many terraform horror stories about incomplete/invalid states. Here is one of my <a href="https://www.youtube.com/watch?v=ix0Tw8uinWs">favorite tfstate stories from Spotify</a>.</p>\n\n<p>ArgoCD will instantly detect any manual changes in your infrastructure, present you a diff, and even allow you to completely discard them if you want.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Js7o0JZT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qs4m8i78akely3vy2j5z.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Js7o0JZT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qs4m8i78akely3vy2j5z.png" alt="Argo Everywhere" loading="lazy" width="880" height="458"></a></p>\n\n<p>Essentially ArgoCD is agnostic as to what exactly is described by the Kubernetes manifests it manages. They can be plain Kubernetes applications, Virtual machines, Container registries, Load balancers, object storage, firewall rules, etc. </p>\n\n<h2>\n  <a name="create-infrastructure-and-deploy-to-it-using-gitops" href="#create-infrastructure-and-deploy-to-it-using-gitops">\n  </a>\n  Create infrastructure and deploy to it using GitOps\n</h2>\n\n<p>Now that we saw that you can use ArgoCD and Crossplane together for managing infrastructure, we are now ready to treat applications and the platform they need in the same way.</p>\n\n<p>This means that we can do the following:</p>\n\n<ol>\n<li>Start from nothing.</li>\n<li>Use Crossplane to create a Kubernetes cluster.</li>\n<li>Commit the crossplane manifest and manage it with ArgoCD.</li>\n<li>Use a standard manifest (e.g. deployment) to deploy an application to the cluster that was just created.</li>\n<li>Commit that manifest in Git too. Like the application one, ArgoCD will manage it like any other Kubernetes manifest (even though it represents infrastructure).</li>\n</ol>\n\n<p>Here is the whole workflow:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Y9CxfvWf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x7nnuu0othvd5oh46et9.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Y9CxfvWf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x7nnuu0othvd5oh46et9.png" alt="GitOps Everywhere" loading="lazy" width="880" height="668"></a></p>\n\n<p>The Kubernetes cluster that Crossplane is running on is only used to bootstrap crossplane. It doesn’t get any production workloads on its own. For simple demos, this can be any cluster (even a local one running on your workstation).</p>\n\n<p>The end result is that now you have a unified way to handle both infrastructure and applications right from Argo CD.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--VoH35Eh---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tzc4rxnuf7ypp8pjx2we.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--VoH35Eh---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tzc4rxnuf7ypp8pjx2we.png" alt="Application and Infrastructure management" loading="lazy" width="880" height="462"></a></p>\n\n<p>The process of changing either of them is exactly the same. </p>\n\n<ul>\n<li>If you want to change infrastructure, you commit a change and ArgoCD takes care of it (with the help of Crossplane).</li>\n<li>If you want to change your application, you commit a change and ArgoCD takes care of it.</li>\n</ul>\n\n<p>They also both gain all the benefits of GitOps. If for example somebody changes the number of replicas in the deployment or tampers with the cluster nodes, ArgoCD will detect the manual changes automatically and give you the ability to discard them completely.</p>\n\n<h2>\n  <a name="why-gitops-is-the-way-forward" href="#why-gitops-is-the-way-forward">\n  </a>\n  Why GitOps is the way forward\n</h2>\n\n<p>The whole point of DevOps is to make everything self-service and promote collaboration between developers and operators. Adopting Crossplane in a GitOps setting means that now both parties have a common language that they can communicate with. </p>\n\n<p>There is no need anymore for separate workflows that are confusing to either of them. Adopting a common workflow for both infrastructure and applications is the embodiment of the DevOps spirit.</p>\n\n<p>If you want to learn more about <a href="https://codefresh.io/gitops/">GitOps</a> and how Codefresh has embraced it, check out the <a href="https://codefresh.io/codefresh-argo-platform/">Codefresh DevOps platform for Argo</a>. For more information about Crossplane, see <a href="https://crossplane.io/">the official site</a> and the hosted solution by <a href="https://www.upbound.io/">Upbound</a>.</p>\n\n',a.body_markdown="If you have been following the Codefresh blog for a while, you might have noticed a common pattern in all the articles that talk about Kubernetes deployments. Almost all of them start with a Kubernetes cluster that is already there, and then the article explains how to deploy an application on top.\n\nThe reason for this simplification comes mainly from brevity and simplicity. We want to focus on the deployment part of the application and not its infrastructure just to make the article easier to follow. This is the obvious reason.\n\nThe hidden reason is that until recently infrastructure deployments were handled in a different manner than applications deployments. Especially in large enterprise companies, the skillset of people that deal with infrastructure and application can vary a lot as the tools of the trade are completely different. \n\nFor example, a lot of people that deal with infrastructure [prefer to use Terraform templates](https://codefresh.io/docs/docs/yaml-examples/examples/terraform/), but employ Kustomize/Helm or other similar tools for application development. While this is a very valid solution, it doesn’t have to be this way. \n\nNow with GitOps you can have a uniform way of dealing with infrastructure and applications.\n\n## GitOps and Terraform\n\nIf you are not familiar with GitOps, head over to [https://opengitops.dev/](https://opengitops.dev/) which is the official page of the GitOps working group. The principles of GitOps are the following:\n\n1. The system is described in a declarative manner. (In practice, this means Kubernetes manifests.)\n1. The definition of the system is versioned and audited. (In practice, it is stored in Git.)\n1. A software agent automatically pulls the Git state and matches the platform state. (In practice, this means [Flux](https://fluxcd.io/)/[ArgoCD](https://argo-cd.readthedocs.io/en/stable/).)\n1. The state is continuously reconciled. This means that any changes happening in Git should also be reflected in the system, as well as the opposite scenario.\n\nIf you have already worked with Terraform, you should already understand why it is difficult to apply GitOps to the Terraform CLI. While Terraform only has the first requirement (declarative format), it doesn’t satisfy the other three requirements around Git storage, automatic reconciliation, and two-way sync. As soon as Terraform finishes its job, it doesn’t interface with the system in any way. If you manually delete a Virtual Machine that was created by Terraform, vanilla Terraform doesn’t know about it. And regarding state, Terraform stores its own state which is completely different from the definition files in Git.\n\nSo at first glance, getting GitOps to work with infrastructure is a complicated task. You realize that you need to add something on top of vanilla Terraform in order to satisfy the GitOps requirements.\n\nBut there is a new kid on the block, and that is [Crossplane](https://crossplane.io/)!\n\n## GitOps and Crossplane\n\nCrossplane has similar capabilities to Terraform (creating infrastructure) but with the following major differences:\n\n1. Crossplane itself is a Kubernetes application. (The infrastructure it creates can be anything.)\n1. Crossplane definitions are Kubernetes manifests.\n1. You can either use manifests that describe resources in the common cloud providers or create your own resources.\n\nAs a simple example here is an EC2 instance describe in Crossplane:\n\n```yaml\napiVersion: ec2.aws.crossplane.io/v1alpha1\nkind: Instance\nmetadata:\n  name: sample-instance\nspec:\n  forProvider:\n    region: us-east-1\n    imageId: ami-0dc2d3e4c0f9ebd18\n    securityGroupRefs:\n      - name: sample-cluster-sg\n    subnetIdRef:\n      name: sample-subnet1  \n  providerConfigRef:\n    name: example\n```\n\nYou can find more examples for [Amazon](https://github.com/crossplane/provider-aws/tree/master/examples), [Google](https://github.com/crossplane/provider-gcp/tree/master/examples), and [Azure](https://github.com/crossplane/provider-azure/tree/master/examples). Crossplane supports several other providers, and of course you can [add your own](https://github.com/crossplane/provider-template).\n\nThe important point here is that the file above is a standard Kubernetes manifest. You can:\n\n * Apply it with kubectl.\n * Verify it with manifest verification tools ([kubeval](https://www.kubeval.com/) or [kube-linter](https://github.com/stackrox/kube-linter)).\n * Template it with Helm/Kustomize.\n * Use any of the tools in the Kubernetes ecosystem to read/manage/store it.\n\nAnd since it is a standard manifest, you can of course store it in Git and manage it with ArgoCD for a Full GitOps workflow. The importance of this capability cannot be overstated.\n\nIf you combine ArgoCD and Crossplane, you have a full solution for following the GitOps principles with infrastructure and not just applications. Imagine if your ArgoCD dashboard contained this:\n\n\n![ArgoCD and Crossplane](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s4xtnny6c5lw4cdyrfur.png)\n\nIsn’t that cool?\n\n## How ArgoCD and Crossplane work together\n\nCrossplane offers an easy way to model your infrastructure as Kubernetes manifests. This is great on its own, but if you [put ArgoCD in the mix](https://argo-cd.readthedocs.io/en/stable/getting_started/), you essentially gain all the advantages of GitOps for your infrastructure.\n\n * You know exactly what infrastructure you have simply by looking at the Git repository.\n * You know exactly what was changed and when by looking at Git history.\n * The infrastructure state IS the same as the Git state. Terraform has its own state that is used a the single source of truth\n * You don’t need any external credentials any more.\n * You can easily rollback to a previous version of your infra with a git reset/git-revert.\nYou completely avoid the dreaded configuration drift.\n\nThe last point is very critical. Terraform only knows what is in your infrastructure during deployment. If you make any manual changes afterwards (e.g. delete some infra), terraform knows absolutely nothing. You need to rerun terraform and pray that the correct action is taken. There are many terraform horror stories about incomplete/invalid states. Here is one of my [favorite tfstate stories from Spotify](https://www.youtube.com/watch?v=ix0Tw8uinWs).\n\nArgoCD will instantly detect any manual changes in your infrastructure, present you a diff, and even allow you to completely discard them if you want.\n\n\n![Argo Everywhere](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qs4m8i78akely3vy2j5z.png)\n\nEssentially ArgoCD is agnostic as to what exactly is described by the Kubernetes manifests it manages. They can be plain Kubernetes applications, Virtual machines, Container registries, Load balancers, object storage, firewall rules, etc. \n\n## Create infrastructure and deploy to it using GitOps\n\nNow that we saw that you can use ArgoCD and Crossplane together for managing infrastructure, we are now ready to treat applications and the platform they need in the same way.\n\nThis means that we can do the following:\n\n1. Start from nothing.\n1. Use Crossplane to create a Kubernetes cluster.\n1. Commit the crossplane manifest and manage it with ArgoCD.\n1. Use a standard manifest (e.g. deployment) to deploy an application to the cluster that was just created.\n1. Commit that manifest in Git too. Like the application one, ArgoCD will manage it like any other Kubernetes manifest (even though it represents infrastructure).\n\nHere is the whole workflow:\n\n\n![GitOps Everywhere](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/x7nnuu0othvd5oh46et9.png)\n\nThe Kubernetes cluster that Crossplane is running on is only used to bootstrap crossplane. It doesn’t get any production workloads on its own. For simple demos, this can be any cluster (even a local one running on your workstation).\n\nThe end result is that now you have a unified way to handle both infrastructure and applications right from Argo CD.\n\n\n![Application and Infrastructure management](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tzc4rxnuf7ypp8pjx2we.png)\n\nThe process of changing either of them is exactly the same. \n\n * If you want to change infrastructure, you commit a change and ArgoCD takes care of it (with the help of Crossplane).\n * If you want to change your application, you commit a change and ArgoCD takes care of it.\n\nThey also both gain all the benefits of GitOps. If for example somebody changes the number of replicas in the deployment or tampers with the cluster nodes, ArgoCD will detect the manual changes automatically and give you the ability to discard them completely.\n\n## Why GitOps is the way forward\n\nThe whole point of DevOps is to make everything self-service and promote collaboration between developers and operators. Adopting Crossplane in a GitOps setting means that now both parties have a common language that they can communicate with. \n\nThere is no need anymore for separate workflows that are confusing to either of them. Adopting a common workflow for both infrastructure and applications is the embodiment of the DevOps spirit.\n\n\nIf you want to learn more about [GitOps](https://codefresh.io/gitops/) and how Codefresh has embraced it, check out the [Codefresh DevOps platform for Argo](https://codefresh.io/codefresh-argo-platform/). For more information about Crossplane, see [the official site](https://crossplane.io/) and the hosted solution by [Upbound](https://www.upbound.io/).\n\n\n\n\n\n\n\n\n",a.user={name:"Kostis Kapelonis",username:"kostiscodefresh",twitter_username:e,github_username:"kostis-codefresh",website_url:"https://codefresh.io/",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--NAvfio9P--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/437938/7b372728-0ca1-4d45-961a-b170001a220d.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--PeaKTpE1--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/437938/7b372728-0ca1-4d45-961a-b170001a220d.png"},a.organization={name:"Codefresh",username:n,slug:n,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--eVMCUH5x--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3138/a894848c-dd79-44fd-b477-3af28338d874.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--iHuWL-6D--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3138/a894848c-dd79-44fd-b477-3af28338d874.jpg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:e,state:{currentArticle:a},serverRendered:!0,routePath:"/kostiscodefresh/925024",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:e}}}}(null,"2021-12-13T13:43:05Z",{},"codefreshio")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
