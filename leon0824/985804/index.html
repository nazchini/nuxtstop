<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>用 2Captcha 通過 CAPTCHA 人機驗證</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>用 2Captcha 通過 CAPTCHA 人機驗證</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/2captcha" class="tag" data-v-70afb46a>
          #2captcha
        </a><a href="/nuxtstop/t/captch" class="tag" data-v-70afb46a>
          #captch
        </a><a href="/nuxtstop/t/recaptch" class="tag" data-v-70afb46a>
          #recaptch
        </a><a href="/nuxtstop/t/crawler" class="tag" data-v-70afb46a>
          #crawler
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--tGZ3-WiI--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5dy24pcv68f08ulemzh9.png" alt="用 2Captcha 通過 CAPTCHA 人機驗證" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            3
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Feb 11</time></div></header> <div class="content" data-v-70afb46a><p>往往我們在做爬蟲或 bot 的時候，最難跨過的問題之一大概就是那 <a href="http://www.captcha.net/">CAPTCHA</a> 人機驗證了，有的團隊會選擇自行開發辨識技術來通過 CAPTCHA 人機驗證，然而面對越來越難的人機考驗，例如 Google 的 reCAPTCHA，若真要自行開發，那得付出相當程度的時間與精神，本文要介紹的 <a href="https://2captcha.com?from=12933116">2Captcha</a> 是幫助我們通過 CAPTCHA 人機驗證的服務，透過 2Captcha API，讓我們可以方便快速的通過那些 CAPTCHA 考驗，省去大量自行開發的時間與金錢。</p>

<p>在介紹 2Captcha 前，先簡單的認識一下 CAPTCHA。</p>

<h2>
  <a name="captcha" href="#captcha">
  </a>
  CAPTCHA
</h2>

<p><strong>CAPTCHA</strong> 全稱是「<strong>C</strong>ompletely <strong>A</strong>utomated <strong>P</strong>ublic <strong>T</strong>uring test to tell <strong>C</strong>omputers and <strong>H</strong>umans <strong>A</strong>part」，翻譯成華文是超級繞口的「<strong>全自動區分電腦和人類的公開圖靈測試</strong>」，這串無敵長的文字簡單講就是<strong>人機驗證</strong>，CAPTCHA 人機驗證存在的目的通常是為了遏止網站被外部的程式惡意的大量操作，然而這樣的機制也擋住了我們家從事無害工作的可愛小爬蟲 🐛 或小機器人 🤖，所以我輩開發者就需要像 2Captcha 這樣的服務幫我們通過那 CAPTCHA 考驗。</p>

<h3>
  <a name="%E5%B8%B8%E8%A6%8B%E7%9A%84-captcha" href="#%E5%B8%B8%E8%A6%8B%E7%9A%84-captcha">
  </a>
  常見的 CAPTCHA
</h3>

<p>在台灣常見到的 CAPTCHA 的場合大概有這些：</p>

<p><strong>台灣高鐵</strong></p>

<p>台灣高鐵的 CAPTCHA 是較為傳統的文字混淆型：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--c5b9qVCP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/95yjgk9phycfdkywraev.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--c5b9qVCP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/95yjgk9phycfdkywraev.png" alt="台灣高鐵" loading="lazy" width="800" height="650"></a></p>

<p><strong>臺灣鐵路</strong></p>

<p>臺鐵的則是用 Google 的 reCAPTCHA：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Zo5SSjML--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/77pj2nh4opjuor4efqpu.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Zo5SSjML--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/77pj2nh4opjuor4efqpu.png" alt="臺灣鐵路" loading="lazy" width="880" height="682"></a></p>

<p><strong>網路銀行</strong></p>

<p>除了訂票外，網銀也很常看到 CAPTCHA：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--gR9S66in--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xvcs095gmu8keo8sxc2g.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--gR9S66in--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xvcs095gmu8keo8sxc2g.png" alt="網路銀行" loading="lazy" width="800" height="710"></a></p>

<p>特別要說明的是，上面的舉例僅是用於說明 CAPTCHA 的使用場景，請不要動搶票的歪腦筋，那有可能是違法的，請諮詢專業法律人士獲得正確的法律知識，也歡迎留言共同討論。</p>

<h2>
  <a name="2captcha" href="#2captcha">
  </a>
  2Captcha
</h2>

<figure><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--f8iRkg3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8ei2iviy4zvlnwbf0dwl.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--f8iRkg3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8ei2iviy4zvlnwbf0dwl.png" alt="2Captcha" loading="lazy" width="880" height="194"></a></p>
<figcaption>來源：<a href="https://2captcha.com/">2Captcha</a></figcaption></figure>



<p>先簡單認識 <a href="https://2captcha.com?from=12933116">2Captcha</a>，做為一個辨識 CAPTCHA 的服務，2Captcha 背後的辨識機制其實是由人工完成的，我們傳送給 2Captcha 的圖片，都會轉送給分散在全世界的 2Captcha worker 們，經過人工辨識後再把結果回傳，而那些辛苦的 worker 們也可以透過 2Captcha 的仲介機制獲得報酬，因為是人工辨識，所以我們可以預期：</p>

<ul>
<li>正確率應該是高的，2Captcha 也有自己的品質把關機制，剃除掉不適任的 worker，一般來說正確率在九成以上。</li>
<li>應該會有些許的等待時間，才能得到辨識後的結果，在 2Captcha API 文件有提到，一般形式的 CAPTAHA 建議等待 5 秒，而較難的 reCAPTCHA 則建議等待 20 秒。</li>
</ul>

<h3>
  <a name="2captcha-%E7%9A%84%E6%94%B6%E8%B2%BB" href="#2captcha-%E7%9A%84%E6%94%B6%E8%B2%BB">
  </a>
  2Captcha 的收費
</h3>

<p>在費用方面，2Captcha 是採用動態計價，動態的基準是當前 2Captcha 與 worker 們的工作負荷，當負荷量大時會升價、負荷量小時會降價，當前的費率會顯示在 <a href="https://2captcha.com/public_statistics">Statistics</a> 頁面，例如下面是本文撰寫時的費率：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LG6rtsvC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1gtwaf9adnm7kjxwfj7n.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LG6rtsvC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1gtwaf9adnm7kjxwfj7n.png" alt="2Captcha customers statistics" loading="lazy" width="880" height="367"></a></p>

<p>上圖可以看到，普通的 CAPTCHA 每<strong>一千個</strong>收費僅 0.74 美金，而較難的 reCAPTCHA 每<strong>一千個</strong>則收費 2.99 美金，相較於自行開發各種花式 AI 辨識系統所要花費的人力物力，2Captcha 算是相當低廉的價格了。</p>

<p>在 Statistics 頁面，除了費率外，還有目前 2Captcha 服務的負載程度，以及解題的速度，上圖顯示一般的 CAPTCHA 花 15 秒，而 reCAPTCHA 要花 46 秒，儘管與 2Captcha 文件內的 5 秒、20 秒有差距，看起來還在可以接受的程度內。</p>

<p>在簡單的認識 2Captcha 的機制與收費之後，下面就來實際玩玩看 2Captcha 吧！</p>

<h2>
  <a name="2captcha-%E8%BE%A8%E8%AD%98%E4%B8%80%E8%88%AC-captcha" href="#2captcha-%E8%BE%A8%E8%AD%98%E4%B8%80%E8%88%AC-captcha">
  </a>
  2Captcha 辨識一般 CAPTCHA
</h2>

<p>在這個範例中，我們會示範用 Playwright 登入一個網站，並且用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 協助我們辨識登入時的 CAPTCHA 驗證碼。</p>

<h3>
  <a name="%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">
  </a>
  事前準備
</h3>

<p>在開始前簡單的介紹一下 Playwright，Playwright 是微軟開發的瀏覽器自動化套件，類似於陳年的 Selenium，Playwright 的優點有：</p>

<ul>
<li>自帶瀏覽器，包括 Firefox、WebKit、Chromium，Playwright 一行指令就都幫我們配置到好。</li>
<li>跨語言，Playwright 有 Node.js、Python、.NET、Java 版本，並且不同的語言有著共通的邏輯與相似的 API。</li>
<li>自動等待元素現身，才執行相關敘述，相當大程度的省去了手動調試等待時間的心力。</li>
</ul>

<p>做為一個瀏覽器自動化工具，當然是最適合拿來開發爬蟲或 bot 了，特別是 client side rendering 當道的現在，很難在不使用真正的瀏覽器的條件下做出爬蟲或bot。</p>

<p>在 2Captcha 方面，開立帳號後，登入可以看到 2Captcha API key：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ua4K9Jx4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gy7yilf0gm193r8l14ia.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ua4K9Jx4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gy7yilf0gm193r8l14ia.png" alt="2Captcha API Key" loading="lazy" width="648" height="300"></a></p>

<p>這組 API key 用於與 2Captcha 程式交互，下面的範例程式中的 API key 是無效的，請務必換成您個人的 API key。</p>

<h3>
  <a name="%E7%99%BB%E5%85%A5%E8%88%87-captcha-%E8%BE%A8%E8%AD%98" href="#%E7%99%BB%E5%85%A5%E8%88%87-captcha-%E8%BE%A8%E8%AD%98">
  </a>
  登入與 CAPTCHA 辨識
</h3>

<p>回到範例的主題上，下面我們會用 Playwright for Python 以及 <a href="https://github.com/2captcha/2captcha-python">2Captcha 的 Python 套件</a>，示範通過下面這個登入頁面：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MA-VKjdx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tsc6k1cxib3pujiystb6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MA-VKjdx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tsc6k1cxib3pujiystb6.png" alt="TWO'S 創意束胸" loading="lazy" width="880" height="713"></a></p>

<p>在這個典型的登入表單中，我們的腳本會用 Playwright 輸入帳密，並且把那 CAPTCHA 圖片透過 2Captcha API 取得驗證碼，最後點按「登入」：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">base64</span>

<span class="kn">from</span> <span class="nn">playwright.sync_api</span> <span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">from</span> <span class="nn">twocaptcha</span> <span class="kn">import</span> <span class="n">TwoCaptcha</span>


<span class="n">CAPTCHA_API_KEY</span> <span class="o">=</span> <span class="s">'5c0f7e0306aa2e0398510ef9ce6dbca'</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">apiKey</span><span class="o">=</span><span class="n">CAPTCHA_API_KEY</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span>
      <span class="nb">file</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
      <span class="n">numeric</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
      <span class="n">minLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
      <span class="n">maxLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
      <span class="n">caseSensitive</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

  <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
      <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">firefox</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">slow_mo</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
      <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">new_context</span><span class="p">()</span>
      <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">new_page</span><span class="p">()</span>
      <span class="n">page</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="s">"http://www.twoas.idv.tw/user.php"</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=username]"</span><span class="p">,</span> <span class="s">"RSOB"</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=password]"</span><span class="p">,</span> <span class="s">"RSOBPassword"</span><span class="p">)</span>  
      <span class="n">screenshot_bytes</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">locator</span><span class="p">(</span><span class="s">"img[alt=captcha]"</span><span class="p">).</span><span class="n">screenshot</span><span class="p">()</span>
      <span class="n">captcha_image</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">screenshot_bytes</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">captcha_image</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=captcha]"</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">'code'</span><span class="p">])</span>
      <span class="n">page</span><span class="p">.</span><span class="n">click</span><span class="p">(</span><span class="s">"text=立即登入"</span><span class="p">)</span>
      <span class="n">login_message</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">text_content</span><span class="p">(</span><span class="s">"div.tips"</span><span class="p">)</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">login_message</span> <span class="o">==</span> <span class="s">"登入成功"</span>
      <span class="k">except</span> <span class="nb">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'captchaId'</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">continue</span>

      <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'captchaId'</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
      <span class="n">context</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="k">break</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>上面的腳本，可以分成 Playwright 操控瀏覽器的部份與 2Captcha 交互的部份。</p>

<p>Playwright 的部份，我們用 <code>page</code> 物件操控大多數的瀏覽器行為，相信即使是對 Playwright 不熟悉的朋友也可以望文生義：</p>

<ul>
<li>用 <code>goto()</code> 函式前往指定網址。</li>
<li>用 <code>type()</code> 函式找到特定元素，並輸入字元。</li>
<li>用 <code>locator()</code> 函式找到元素並操控它。</li>
<li>用 <code>screenshot()</code> 函式對元素截圖。</li>
<li>用 <code>click()</code> 函式點按特定元素。</li>
</ul>

<p>在用 <code>screenshot()</code> 取得 CAPTCHA 圖片後，用 <code>base64</code> 模組轉換成 Base64 編碼，交給 <code>solve()</code> 函式處理。</p>

<p>在 CAPTCHA 辨識部份，此網站的 CAPTCHA 如下例：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oJ1P3OYN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h53duv5n0z5p5x5hjr8t.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oJ1P3OYN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h53duv5n0z5p5x5hjr8t.png" alt="CAPTCHA" loading="lazy" width="106" height="36"></a></p>

<p>這是一種相對普通的 CAPTCHA，在 2Captcha 的分類上，屬於 normal 型。</p>

<p>在 2Captcha 的部份，先定義一個 2Captcha 的 <code>solver</code> 物件，並用下面的敘述得到辨識後的文字：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span>
  <span class="nb">file</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
  <span class="n">numeric</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
  <span class="n">minLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
  <span class="n">maxLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
  <span class="n">caseSensitive</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>因為 CAPTCHA 屬於 normal 型，所以我們調用的是 <code>normal()</code> 函式，函式內的參數，除了 <code>file</code> 是必填，其他都是可選用的：</p>

<ul>
<li>
<code>file</code> 可接受一個經 Base64 編碼的 CAPTCHA 圖片物件，也可以是本地的圖片檔案，或圖片的 URL。</li>
<li>
<code>numeric</code> CAPTCHA 的字元型態，<code>4</code> 表示會有字母與數字，其他的定義請參閱 <a href="https://2captcha.com/2captcha-api">2Captcha API 文件</a>。</li>
<li>
<code>minLength</code> 最小字元長度，以此例而言，都是固定四個字元。</li>
<li>
<code>maxLength</code> 最大字元長度，以此例而言，都是固定四個字元。</li>
<li>
<code>caseSensitive</code> 設為 <code>1</code> 表示區分大小寫。</li>
</ul>

<p>經過上面的交互，取得 <code>result</code>，<code>result</code> 是一個結構如下的 dict 物件：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="p">{</span><span class="s">'captchaId'</span><span class="p">:</span> <span class="s">'69475003267'</span><span class="p">,</span> <span class="s">'code'</span><span class="p">:</span> <span class="s">'4QR5'</span><span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>其中的 <code>cpatchaId</code> 是 2Captcha API 賦予的交互 ID，而 <code>code</code> 當然就是辨識後的答案啦！</p>

<h3>
  <a name="%E5%9B%9E%E9%A5%8B%E8%BE%A8%E8%AD%98%E8%88%87%E5%90%A6" href="#%E5%9B%9E%E9%A5%8B%E8%BE%A8%E8%AD%98%E8%88%87%E5%90%A6">
  </a>
  回饋辨識與否
</h3>

<p>取得 <code>result['code']</code> 後，填入表單，若正確登入，我們用 <code>report()</code> 回饋成功紀錄給 2Captcha，並在最後的 <code>break</code> 語句完全結束 <code>while</code> 迴圈。</p>

<p>反之若是失敗，則用 <code>report()</code> 回饋失敗紀錄給 2Captcha，並在後續的 <code>continue</code> 語句中斷這次的 <code>while</code> 迴圈，進入下一個 <code>while</code> 迴圈，藉此做出重試的效果。</p>

<h3>
  <a name="%E6%88%90%E6%9E%9C" href="#%E6%88%90%E6%9E%9C">
  </a>
  成果
</h3>

<p>最後的成果可以參考這個影片：</p>

<p><iframe width="710" height="399" src="https://www.youtube.com/embed/ECXhkH2WZOA" allowfullscreen loading="lazy">
</iframe>
</p>

<h2>
  <a name="%E7%94%A8-2captcha-%E9%80%9A%E9%81%8E-recaptcha" href="#%E7%94%A8-2captcha-%E9%80%9A%E9%81%8E-recaptcha">
  </a>
  用 2Captcha 通過 reCAPTCHA
</h2>

<p>完成前一個較簡單的例子後，我們來玩玩看如何用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 通過難一點的 reCAPTCHA，也就是那著名的靈魂考驗「我不是機器人」：</p>

<figure><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--0f56pUvi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fr8bxfqk6ecbkxqx249w.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--0f56pUvi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fr8bxfqk6ecbkxqx249w.png" alt="我不是機器人" loading="lazy" width="880" height="495"></a></p>
<figcaption>來源：網路</figcaption></figure>



<p>要用 2Captcha 通過 reCAPTCHA 的「我不是機器人」考驗，必須先取得目標頁面的 site key，在原始碼裡面就可以找到這把公開的 site key：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--H63_RsDt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rccaxr8yeltgjau949b1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--H63_RsDt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rccaxr8yeltgjau949b1.png" alt="reCAPTCHA Site Key" loading="lazy" width="880" height="550"></a></p>

<p>有了 site key 之後，就可以依樣畫葫蘆，呼叫 2Captcha API 得到 reCAPTCHA 的通關密語。</p>

<p>與 2Captcha 交互的部份改成這樣：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">recaptcha</span><span class="p">(</span>
  <span class="n">sitekey</span><span class="o">=</span><span class="s">'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ'</span><span class="p">,</span>
  <span class="n">url</span><span class="o">=</span><span class="s">"https://naweeklytimes.com/login-2/"</span><span class="p">,</span>
  <span class="n">version</span><span class="o">=</span><span class="s">"v2"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>拿到的 result 也是同樣的 dict 結構，只是變成超長的 token：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="p">{</span><span class="s">'captchaId'</span><span class="p">:</span> <span class="s">'69482081140'</span><span class="p">,</span> <span class="s">'code'</span><span class="p">:</span> <span class="s">'03AGdBq252s4QsHsrr9CqzkkswdnHsUPLXIcE4OI1pEX4FUP9rNY8p760yLBsd9goaMn61vw95x981lU0...'</span><span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>然後我們要把那組 <code>code</code> 填入一個名為 <code>g-recaptcha-response</code> 的文字框，然而這個文字框是隱藏的，所以得先用 Playwright 跑一小段 JS 讓它顯示出來：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">page</span><span class="p">.</span><span class="n">eval_on_selector</span><span class="p">(</span>
  <span class="n">selector</span><span class="o">=</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">,</span>
  <span class="n">expression</span><span class="o">=</span><span class="s">"(el) => el.style.display = 'inline-block'"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>上面的函式中，JS 的 <code>el</code> 就是來自 <code>selector</code> 抓到的元素。</p>

<p>文字框顯示出來會像這樣：</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--TlB1WNlG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ac4v7h8uqjpn43q3pijy.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--TlB1WNlG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ac4v7h8uqjpn43q3pijy.png" alt="g-recaptcha-response" loading="lazy" width="880" height="550"></a></p>

<p>然後就比照第一個範例，帳號、密碼、reCAPTCHA 通關密語填一填，就可以成功登入囉！</p>

<h3>
  <a name="%E6%88%90%E6%9E%9C" href="#%E6%88%90%E6%9E%9C">
  </a>
  成果
</h3>

<p>完整的程式碼如下：<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">playwright.sync_api</span> <span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">from</span> <span class="nn">twocaptcha</span> <span class="kn">import</span> <span class="n">TwoCaptcha</span>


<span class="n">URL</span> <span class="o">=</span> <span class="s">"https://naweeklytimes.com/login-2/"</span>
<span class="n">SITEKEY</span> <span class="o">=</span> <span class="s">'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ'</span>
<span class="n">CAPTCHA_API_KEY</span> <span class="o">=</span> <span class="s">'5c0f7e0306aa2e0398510ef9ce6dbca'</span>


<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">apiKey</span><span class="o">=</span><span class="n">CAPTCHA_API_KEY</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">recaptcha</span><span class="p">(</span>
      <span class="n">sitekey</span><span class="o">=</span><span class="n">SITEKEY</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">"v2"</span><span class="p">,</span>
    <span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">raise</span> <span class="nb">Exception</span>

  <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
      <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">firefox</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">slow_mo</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
      <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">new_context</span><span class="p">()</span>
      <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">new_page</span><span class="p">()</span>
      <span class="n">page</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=log]"</span><span class="p">,</span> <span class="s">"RSOB"</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=pwd]"</span><span class="p">,</span> <span class="s">"RSOBPassword"</span><span class="p">)</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">URL</span><span class="p">)</span>
      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">continue</span>

      <span class="n">page</span><span class="p">.</span><span class="n">eval_on_selector</span><span class="p">(</span>
        <span class="n">selector</span><span class="o">=</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">,</span>
        <span class="n">expression</span><span class="o">=</span><span class="s">"(el) => el.style.display = 'inline-block'"</span><span class="p">,</span>
      <span class="p">)</span>
      <span class="n">textarea</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">locator</span><span class="p">(</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">)</span>
      <span class="n">textarea</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'code'</span><span class="p">])</span>
      <span class="n">page</span><span class="p">.</span><span class="n">click</span><span class="p">(</span><span class="s">"input[type=submit]"</span><span class="p">)</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">page</span><span class="p">.</span><span class="n">url</span> <span class="o">==</span> <span class="s">"https://naweeklytimes.com/"</span>
      <span class="k">except</span> <span class="nb">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'captchaId'</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">continue</span>

      <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'captchaId'</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
      <span class="n">page</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
      <span class="n">context</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="k">break</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>看起來有點長，不過和黑科技 AI 相比應該是小巫見大巫。</p>

<p>下面是執行的影片：</p>

<p><iframe width="710" height="399" src="https://www.youtube.com/embed/gZSA-h7QEgA" allowfullscreen loading="lazy">
</iframe>
</p>

<h2>
  <a name="%E7%B5%90%E8%AA%9E" href="#%E7%B5%90%E8%AA%9E">
  </a>
  結語
</h2>

<p>本文我們示範用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 通過普通的 CAPTCHA 及 reCAPTCHA，在這兩種最常見的 CAPTCHA 外，2Captcha 還支援其他各式各樣的 CAPTCHA，形式眾多，可以參考 <a href="https://2captcha.com/2captcha-api">2Captcha 的文件</a>與 <a href="https://2captcha.com/demo">demo</a> 頁。</p>

<p>在 API 方面，2Captcha 有提供封裝好的 Python、GO、PHP、Java、C#、C++ 套件，即使是沒有現成套件的語言，直接呼叫 2Captcha API 也不是太困難的事。</p>

<p>至於 2Captcha 的費用，除了真的很便宜的費率外，在設計 bot 時，只要保留住登入後的 cookie 或 local storage，即可省下每次都要重新登入的時間以及 CAPTCHA 的費用，以 Playwright 為例，它就有 <a href="https://playwright.dev/python/docs/auth#reuse-authentication-state">reuse authentication state</a> 的機制，可以多加利用。</p>

<h2>
  <a name="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">
  </a>
  參考資料
</h2>

<ul>
<li>維基百科〈<a href="https://zh.wikipedia.org/zh-tw/%E9%AA%8C%E8%AF%81%E7%A0%81">驗證碼</a>〉</li>
</ul>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/leon0824/yong-2captcha-tong-guo-captcha-ren-ji-yan-zheng-5f72" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,a,n){return n.type_of="article",n.id=985804,n.title="用 2Captcha 通過 CAPTCHA 人機驗證",n.description="往往我們在做爬蟲或 bot 的時候，最難跨過的問題之一大概就是那 CAPTCHA 人機驗證了，有的團隊會選擇自行開發辨識技術來通過 CAPTCHA 人機驗證，然而面對越來越難的人機考驗，例如...",n.readable_publish_date="Feb 11",n.slug="yong-2captcha-tong-guo-captcha-ren-ji-yan-zheng-5f72",n.path="/leon0824/yong-2captcha-tong-guo-captcha-ren-ji-yan-zheng-5f72",n.url="https://dev.to/leon0824/yong-2captcha-tong-guo-captcha-ren-ji-yan-zheng-5f72",n.comments_count=0,n.public_reactions_count=3,n.collection_id=s,n.published_timestamp=a,n.positive_reactions_count=3,n.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--tGZ3-WiI--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5dy24pcv68f08ulemzh9.png",n.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--lu_bi9fL--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5dy24pcv68f08ulemzh9.png",n.canonical_url="https://editor.leonh.space/2022/2captcha/",n.created_at="2022-02-11T07:59:14Z",n.edited_at="2022-03-05T12:28:17Z",n.crossposted_at=s,n.published_at=a,n.last_comment_at=a,n.reading_time_minutes=4,n.tag_list="2captcha, captch, recaptch, crawler",n.tags=["2captcha","captch","recaptch","crawler"],n.body_html='<p>往往我們在做爬蟲或 bot 的時候，最難跨過的問題之一大概就是那 <a href="http://www.captcha.net/">CAPTCHA</a> 人機驗證了，有的團隊會選擇自行開發辨識技術來通過 CAPTCHA 人機驗證，然而面對越來越難的人機考驗，例如 Google 的 reCAPTCHA，若真要自行開發，那得付出相當程度的時間與精神，本文要介紹的 <a href="https://2captcha.com?from=12933116">2Captcha</a> 是幫助我們通過 CAPTCHA 人機驗證的服務，透過 2Captcha API，讓我們可以方便快速的通過那些 CAPTCHA 考驗，省去大量自行開發的時間與金錢。</p>\n\n<p>在介紹 2Captcha 前，先簡單的認識一下 CAPTCHA。</p>\n\n<h2>\n  <a name="captcha" href="#captcha">\n  </a>\n  CAPTCHA\n</h2>\n\n<p><strong>CAPTCHA</strong> 全稱是「<strong>C</strong>ompletely <strong>A</strong>utomated <strong>P</strong>ublic <strong>T</strong>uring test to tell <strong>C</strong>omputers and <strong>H</strong>umans <strong>A</strong>part」，翻譯成華文是超級繞口的「<strong>全自動區分電腦和人類的公開圖靈測試</strong>」，這串無敵長的文字簡單講就是<strong>人機驗證</strong>，CAPTCHA 人機驗證存在的目的通常是為了遏止網站被外部的程式惡意的大量操作，然而這樣的機制也擋住了我們家從事無害工作的可愛小爬蟲 🐛 或小機器人 🤖，所以我輩開發者就需要像 2Captcha 這樣的服務幫我們通過那 CAPTCHA 考驗。</p>\n\n<h3>\n  <a name="%E5%B8%B8%E8%A6%8B%E7%9A%84-captcha" href="#%E5%B8%B8%E8%A6%8B%E7%9A%84-captcha">\n  </a>\n  常見的 CAPTCHA\n</h3>\n\n<p>在台灣常見到的 CAPTCHA 的場合大概有這些：</p>\n\n<p><strong>台灣高鐵</strong></p>\n\n<p>台灣高鐵的 CAPTCHA 是較為傳統的文字混淆型：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--c5b9qVCP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/95yjgk9phycfdkywraev.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--c5b9qVCP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/95yjgk9phycfdkywraev.png" alt="台灣高鐵" loading="lazy" width="800" height="650"></a></p>\n\n<p><strong>臺灣鐵路</strong></p>\n\n<p>臺鐵的則是用 Google 的 reCAPTCHA：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Zo5SSjML--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/77pj2nh4opjuor4efqpu.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Zo5SSjML--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/77pj2nh4opjuor4efqpu.png" alt="臺灣鐵路" loading="lazy" width="880" height="682"></a></p>\n\n<p><strong>網路銀行</strong></p>\n\n<p>除了訂票外，網銀也很常看到 CAPTCHA：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--gR9S66in--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xvcs095gmu8keo8sxc2g.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--gR9S66in--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xvcs095gmu8keo8sxc2g.png" alt="網路銀行" loading="lazy" width="800" height="710"></a></p>\n\n<p>特別要說明的是，上面的舉例僅是用於說明 CAPTCHA 的使用場景，請不要動搶票的歪腦筋，那有可能是違法的，請諮詢專業法律人士獲得正確的法律知識，也歡迎留言共同討論。</p>\n\n<h2>\n  <a name="2captcha" href="#2captcha">\n  </a>\n  2Captcha\n</h2>\n\n<figure><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--f8iRkg3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8ei2iviy4zvlnwbf0dwl.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--f8iRkg3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8ei2iviy4zvlnwbf0dwl.png" alt="2Captcha" loading="lazy" width="880" height="194"></a></p>\n<figcaption>來源：<a href="https://2captcha.com/">2Captcha</a></figcaption></figure>\n\n\n\n<p>先簡單認識 <a href="https://2captcha.com?from=12933116">2Captcha</a>，做為一個辨識 CAPTCHA 的服務，2Captcha 背後的辨識機制其實是由人工完成的，我們傳送給 2Captcha 的圖片，都會轉送給分散在全世界的 2Captcha worker 們，經過人工辨識後再把結果回傳，而那些辛苦的 worker 們也可以透過 2Captcha 的仲介機制獲得報酬，因為是人工辨識，所以我們可以預期：</p>\n\n<ul>\n<li>正確率應該是高的，2Captcha 也有自己的品質把關機制，剃除掉不適任的 worker，一般來說正確率在九成以上。</li>\n<li>應該會有些許的等待時間，才能得到辨識後的結果，在 2Captcha API 文件有提到，一般形式的 CAPTAHA 建議等待 5 秒，而較難的 reCAPTCHA 則建議等待 20 秒。</li>\n</ul>\n\n<h3>\n  <a name="2captcha-%E7%9A%84%E6%94%B6%E8%B2%BB" href="#2captcha-%E7%9A%84%E6%94%B6%E8%B2%BB">\n  </a>\n  2Captcha 的收費\n</h3>\n\n<p>在費用方面，2Captcha 是採用動態計價，動態的基準是當前 2Captcha 與 worker 們的工作負荷，當負荷量大時會升價、負荷量小時會降價，當前的費率會顯示在 <a href="https://2captcha.com/public_statistics">Statistics</a> 頁面，例如下面是本文撰寫時的費率：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LG6rtsvC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1gtwaf9adnm7kjxwfj7n.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LG6rtsvC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1gtwaf9adnm7kjxwfj7n.png" alt="2Captcha customers statistics" loading="lazy" width="880" height="367"></a></p>\n\n<p>上圖可以看到，普通的 CAPTCHA 每<strong>一千個</strong>收費僅 0.74 美金，而較難的 reCAPTCHA 每<strong>一千個</strong>則收費 2.99 美金，相較於自行開發各種花式 AI 辨識系統所要花費的人力物力，2Captcha 算是相當低廉的價格了。</p>\n\n<p>在 Statistics 頁面，除了費率外，還有目前 2Captcha 服務的負載程度，以及解題的速度，上圖顯示一般的 CAPTCHA 花 15 秒，而 reCAPTCHA 要花 46 秒，儘管與 2Captcha 文件內的 5 秒、20 秒有差距，看起來還在可以接受的程度內。</p>\n\n<p>在簡單的認識 2Captcha 的機制與收費之後，下面就來實際玩玩看 2Captcha 吧！</p>\n\n<h2>\n  <a name="2captcha-%E8%BE%A8%E8%AD%98%E4%B8%80%E8%88%AC-captcha" href="#2captcha-%E8%BE%A8%E8%AD%98%E4%B8%80%E8%88%AC-captcha">\n  </a>\n  2Captcha 辨識一般 CAPTCHA\n</h2>\n\n<p>在這個範例中，我們會示範用 Playwright 登入一個網站，並且用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 協助我們辨識登入時的 CAPTCHA 驗證碼。</p>\n\n<h3>\n  <a name="%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">\n  </a>\n  事前準備\n</h3>\n\n<p>在開始前簡單的介紹一下 Playwright，Playwright 是微軟開發的瀏覽器自動化套件，類似於陳年的 Selenium，Playwright 的優點有：</p>\n\n<ul>\n<li>自帶瀏覽器，包括 Firefox、WebKit、Chromium，Playwright 一行指令就都幫我們配置到好。</li>\n<li>跨語言，Playwright 有 Node.js、Python、.NET、Java 版本，並且不同的語言有著共通的邏輯與相似的 API。</li>\n<li>自動等待元素現身，才執行相關敘述，相當大程度的省去了手動調試等待時間的心力。</li>\n</ul>\n\n<p>做為一個瀏覽器自動化工具，當然是最適合拿來開發爬蟲或 bot 了，特別是 client side rendering 當道的現在，很難在不使用真正的瀏覽器的條件下做出爬蟲或bot。</p>\n\n<p>在 2Captcha 方面，開立帳號後，登入可以看到 2Captcha API key：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ua4K9Jx4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gy7yilf0gm193r8l14ia.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ua4K9Jx4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gy7yilf0gm193r8l14ia.png" alt="2Captcha API Key" loading="lazy" width="648" height="300"></a></p>\n\n<p>這組 API key 用於與 2Captcha 程式交互，下面的範例程式中的 API key 是無效的，請務必換成您個人的 API key。</p>\n\n<h3>\n  <a name="%E7%99%BB%E5%85%A5%E8%88%87-captcha-%E8%BE%A8%E8%AD%98" href="#%E7%99%BB%E5%85%A5%E8%88%87-captcha-%E8%BE%A8%E8%AD%98">\n  </a>\n  登入與 CAPTCHA 辨識\n</h3>\n\n<p>回到範例的主題上，下面我們會用 Playwright for Python 以及 <a href="https://github.com/2captcha/2captcha-python">2Captcha 的 Python 套件</a>，示範通過下面這個登入頁面：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MA-VKjdx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tsc6k1cxib3pujiystb6.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MA-VKjdx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tsc6k1cxib3pujiystb6.png" alt="TWO\'S 創意束胸" loading="lazy" width="880" height="713"></a></p>\n\n<p>在這個典型的登入表單中，我們的腳本會用 Playwright 輸入帳密，並且把那 CAPTCHA 圖片透過 2Captcha API 取得驗證碼，最後點按「登入」：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">base64</span>\n\n<span class="kn">from</span> <span class="nn">playwright.sync_api</span> <span class="kn">import</span> <span class="n">sync_playwright</span>\n<span class="kn">from</span> <span class="nn">twocaptcha</span> <span class="kn">import</span> <span class="n">TwoCaptcha</span>\n\n\n<span class="n">CAPTCHA_API_KEY</span> <span class="o">=</span> <span class="s">\'5c0f7e0306aa2e0398510ef9ce6dbca\'</span>\n<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">apiKey</span><span class="o">=</span><span class="n">CAPTCHA_API_KEY</span><span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>\n  <span class="k">try</span><span class="p">:</span>\n    <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span>\n      <span class="nb">file</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>\n      <span class="n">numeric</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n      <span class="n">minLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n      <span class="n">maxLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n      <span class="n">caseSensitive</span><span class="o">=</span><span class="mi">1</span>\n    <span class="p">)</span>\n  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>\n    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>\n\n  <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>\n  <span class="k">return</span> <span class="n">result</span>\n\n\n<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>\n  <span class="n">solver</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>\n  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>\n    <span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>\n      <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">firefox</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">slow_mo</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>\n      <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">new_context</span><span class="p">()</span>\n      <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">new_page</span><span class="p">()</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="s">"http://www.twoas.idv.tw/user.php"</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=username]"</span><span class="p">,</span> <span class="s">"RSOB"</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=password]"</span><span class="p">,</span> <span class="s">"RSOBPassword"</span><span class="p">)</span>  \n      <span class="n">screenshot_bytes</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">locator</span><span class="p">(</span><span class="s">"img[alt=captcha]"</span><span class="p">).</span><span class="n">screenshot</span><span class="p">()</span>\n      <span class="n">captcha_image</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">screenshot_bytes</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">\'utf-8\'</span><span class="p">)</span>\n      <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">captcha_image</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=captcha]"</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">\'code\'</span><span class="p">])</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">click</span><span class="p">(</span><span class="s">"text=立即登入"</span><span class="p">)</span>\n      <span class="n">login_message</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">text_content</span><span class="p">(</span><span class="s">"div.tips"</span><span class="p">)</span>\n\n      <span class="k">try</span><span class="p">:</span>\n        <span class="k">assert</span> <span class="n">login_message</span> <span class="o">==</span> <span class="s">"登入成功"</span>\n      <span class="k">except</span> <span class="nb">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>\n        <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">\'captchaId\'</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>\n        <span class="k">continue</span>\n\n      <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">\'captchaId\'</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>\n      <span class="n">context</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>\n      <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>\n      <span class="k">break</span>\n\n<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">\'__main__\'</span><span class="p">:</span>\n  <span class="n">main</span><span class="p">()</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>上面的腳本，可以分成 Playwright 操控瀏覽器的部份與 2Captcha 交互的部份。</p>\n\n<p>Playwright 的部份，我們用 <code>page</code> 物件操控大多數的瀏覽器行為，相信即使是對 Playwright 不熟悉的朋友也可以望文生義：</p>\n\n<ul>\n<li>用 <code>goto()</code> 函式前往指定網址。</li>\n<li>用 <code>type()</code> 函式找到特定元素，並輸入字元。</li>\n<li>用 <code>locator()</code> 函式找到元素並操控它。</li>\n<li>用 <code>screenshot()</code> 函式對元素截圖。</li>\n<li>用 <code>click()</code> 函式點按特定元素。</li>\n</ul>\n\n<p>在用 <code>screenshot()</code> 取得 CAPTCHA 圖片後，用 <code>base64</code> 模組轉換成 Base64 編碼，交給 <code>solve()</code> 函式處理。</p>\n\n<p>在 CAPTCHA 辨識部份，此網站的 CAPTCHA 如下例：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oJ1P3OYN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h53duv5n0z5p5x5hjr8t.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oJ1P3OYN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h53duv5n0z5p5x5hjr8t.png" alt="CAPTCHA" loading="lazy" width="106" height="36"></a></p>\n\n<p>這是一種相對普通的 CAPTCHA，在 2Captcha 的分類上，屬於 normal 型。</p>\n\n<p>在 2Captcha 的部份，先定義一個 2Captcha 的 <code>solver</code> 物件，並用下面的敘述得到辨識後的文字：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span>\n  <span class="nb">file</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>\n  <span class="n">numeric</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n  <span class="n">minLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n  <span class="n">maxLength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>\n  <span class="n">caseSensitive</span><span class="o">=</span><span class="mi">1</span>\n<span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>因為 CAPTCHA 屬於 normal 型，所以我們調用的是 <code>normal()</code> 函式，函式內的參數，除了 <code>file</code> 是必填，其他都是可選用的：</p>\n\n<ul>\n<li>\n<code>file</code> 可接受一個經 Base64 編碼的 CAPTCHA 圖片物件，也可以是本地的圖片檔案，或圖片的 URL。</li>\n<li>\n<code>numeric</code> CAPTCHA 的字元型態，<code>4</code> 表示會有字母與數字，其他的定義請參閱 <a href="https://2captcha.com/2captcha-api">2Captcha API 文件</a>。</li>\n<li>\n<code>minLength</code> 最小字元長度，以此例而言，都是固定四個字元。</li>\n<li>\n<code>maxLength</code> 最大字元長度，以此例而言，都是固定四個字元。</li>\n<li>\n<code>caseSensitive</code> 設為 <code>1</code> 表示區分大小寫。</li>\n</ul>\n\n<p>經過上面的交互，取得 <code>result</code>，<code>result</code> 是一個結構如下的 dict 物件：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="p">{</span><span class="s">\'captchaId\'</span><span class="p">:</span> <span class="s">\'69475003267\'</span><span class="p">,</span> <span class="s">\'code\'</span><span class="p">:</span> <span class="s">\'4QR5\'</span><span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>其中的 <code>cpatchaId</code> 是 2Captcha API 賦予的交互 ID，而 <code>code</code> 當然就是辨識後的答案啦！</p>\n\n<h3>\n  <a name="%E5%9B%9E%E9%A5%8B%E8%BE%A8%E8%AD%98%E8%88%87%E5%90%A6" href="#%E5%9B%9E%E9%A5%8B%E8%BE%A8%E8%AD%98%E8%88%87%E5%90%A6">\n  </a>\n  回饋辨識與否\n</h3>\n\n<p>取得 <code>result[\'code\']</code> 後，填入表單，若正確登入，我們用 <code>report()</code> 回饋成功紀錄給 2Captcha，並在最後的 <code>break</code> 語句完全結束 <code>while</code> 迴圈。</p>\n\n<p>反之若是失敗，則用 <code>report()</code> 回饋失敗紀錄給 2Captcha，並在後續的 <code>continue</code> 語句中斷這次的 <code>while</code> 迴圈，進入下一個 <code>while</code> 迴圈，藉此做出重試的效果。</p>\n\n<h3>\n  <a name="%E6%88%90%E6%9E%9C" href="#%E6%88%90%E6%9E%9C">\n  </a>\n  成果\n</h3>\n\n<p>最後的成果可以參考這個影片：</p>\n\n<p><iframe width="710" height="399" src="https://www.youtube.com/embed/ECXhkH2WZOA" allowfullscreen loading="lazy">\n</iframe>\n</p>\n\n<h2>\n  <a name="%E7%94%A8-2captcha-%E9%80%9A%E9%81%8E-recaptcha" href="#%E7%94%A8-2captcha-%E9%80%9A%E9%81%8E-recaptcha">\n  </a>\n  用 2Captcha 通過 reCAPTCHA\n</h2>\n\n<p>完成前一個較簡單的例子後，我們來玩玩看如何用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 通過難一點的 reCAPTCHA，也就是那著名的靈魂考驗「我不是機器人」：</p>\n\n<figure><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--0f56pUvi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fr8bxfqk6ecbkxqx249w.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--0f56pUvi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fr8bxfqk6ecbkxqx249w.png" alt="我不是機器人" loading="lazy" width="880" height="495"></a></p>\n<figcaption>來源：網路</figcaption></figure>\n\n\n\n<p>要用 2Captcha 通過 reCAPTCHA 的「我不是機器人」考驗，必須先取得目標頁面的 site key，在原始碼裡面就可以找到這把公開的 site key：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--H63_RsDt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rccaxr8yeltgjau949b1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--H63_RsDt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rccaxr8yeltgjau949b1.png" alt="reCAPTCHA Site Key" loading="lazy" width="880" height="550"></a></p>\n\n<p>有了 site key 之後，就可以依樣畫葫蘆，呼叫 2Captcha API 得到 reCAPTCHA 的通關密語。</p>\n\n<p>與 2Captcha 交互的部份改成這樣：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">recaptcha</span><span class="p">(</span>\n  <span class="n">sitekey</span><span class="o">=</span><span class="s">\'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ\'</span><span class="p">,</span>\n  <span class="n">url</span><span class="o">=</span><span class="s">"https://naweeklytimes.com/login-2/"</span><span class="p">,</span>\n  <span class="n">version</span><span class="o">=</span><span class="s">"v2"</span><span class="p">,</span>\n<span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>拿到的 result 也是同樣的 dict 結構，只是變成超長的 token：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="p">{</span><span class="s">\'captchaId\'</span><span class="p">:</span> <span class="s">\'69482081140\'</span><span class="p">,</span> <span class="s">\'code\'</span><span class="p">:</span> <span class="s">\'03AGdBq252s4QsHsrr9CqzkkswdnHsUPLXIcE4OI1pEX4FUP9rNY8p760yLBsd9goaMn61vw95x981lU0...\'</span><span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>然後我們要把那組 <code>code</code> 填入一個名為 <code>g-recaptcha-response</code> 的文字框，然而這個文字框是隱藏的，所以得先用 Playwright 跑一小段 JS 讓它顯示出來：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="n">page</span><span class="p">.</span><span class="n">eval_on_selector</span><span class="p">(</span>\n  <span class="n">selector</span><span class="o">=</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">,</span>\n  <span class="n">expression</span><span class="o">=</span><span class="s">"(el) =&gt; el.style.display = \'inline-block\'"</span><span class="p">,</span>\n<span class="p">)</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>上面的函式中，JS 的 <code>el</code> 就是來自 <code>selector</code> 抓到的元素。</p>\n\n<p>文字框顯示出來會像這樣：</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--TlB1WNlG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ac4v7h8uqjpn43q3pijy.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--TlB1WNlG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ac4v7h8uqjpn43q3pijy.png" alt="g-recaptcha-response" loading="lazy" width="880" height="550"></a></p>\n\n<p>然後就比照第一個範例，帳號、密碼、reCAPTCHA 通關密語填一填，就可以成功登入囉！</p>\n\n<h3>\n  <a name="%E6%88%90%E6%9E%9C" href="#%E6%88%90%E6%9E%9C">\n  </a>\n  成果\n</h3>\n\n<p>完整的程式碼如下：<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">playwright.sync_api</span> <span class="kn">import</span> <span class="n">sync_playwright</span>\n<span class="kn">from</span> <span class="nn">twocaptcha</span> <span class="kn">import</span> <span class="n">TwoCaptcha</span>\n\n\n<span class="n">URL</span> <span class="o">=</span> <span class="s">"https://naweeklytimes.com/login-2/"</span>\n<span class="n">SITEKEY</span> <span class="o">=</span> <span class="s">\'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ\'</span>\n<span class="n">CAPTCHA_API_KEY</span> <span class="o">=</span> <span class="s">\'5c0f7e0306aa2e0398510ef9ce6dbca\'</span>\n\n\n<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">apiKey</span><span class="o">=</span><span class="n">CAPTCHA_API_KEY</span><span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>\n  <span class="k">try</span><span class="p">:</span>\n    <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">recaptcha</span><span class="p">(</span>\n      <span class="n">sitekey</span><span class="o">=</span><span class="n">SITEKEY</span><span class="p">,</span>\n      <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>\n      <span class="n">version</span><span class="o">=</span><span class="s">"v2"</span><span class="p">,</span>\n    <span class="p">)</span>\n  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>\n    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>\n    <span class="k">raise</span> <span class="nb">Exception</span>\n\n  <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>\n  <span class="k">return</span> <span class="n">result</span>\n\n\n<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>\n  <span class="n">solver</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="n">captcha_id</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>\n  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>\n    <span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>\n      <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">firefox</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">slow_mo</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>\n      <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">new_context</span><span class="p">()</span>\n      <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">new_page</span><span class="p">()</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=log]"</span><span class="p">,</span> <span class="s">"RSOB"</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="s">"input[name=pwd]"</span><span class="p">,</span> <span class="s">"RSOBPassword"</span><span class="p">)</span>\n\n      <span class="k">try</span><span class="p">:</span>\n        <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">URL</span><span class="p">)</span>\n      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>\n        <span class="k">continue</span>\n\n      <span class="n">page</span><span class="p">.</span><span class="n">eval_on_selector</span><span class="p">(</span>\n        <span class="n">selector</span><span class="o">=</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">,</span>\n        <span class="n">expression</span><span class="o">=</span><span class="s">"(el) =&gt; el.style.display = \'inline-block\'"</span><span class="p">,</span>\n      <span class="p">)</span>\n      <span class="n">textarea</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="n">locator</span><span class="p">(</span><span class="s">"textarea[name=g-recaptcha-response]"</span><span class="p">)</span>\n      <span class="n">textarea</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">\'code\'</span><span class="p">])</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">click</span><span class="p">(</span><span class="s">"input[type=submit]"</span><span class="p">)</span>\n\n      <span class="k">try</span><span class="p">:</span>\n        <span class="k">assert</span> <span class="n">page</span><span class="p">.</span><span class="n">url</span> <span class="o">==</span> <span class="s">"https://naweeklytimes.com/"</span>\n      <span class="k">except</span> <span class="nb">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>\n        <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">\'captchaId\'</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>\n        <span class="k">continue</span>\n\n      <span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">\'captchaId\'</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>\n      <span class="n">page</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>\n      <span class="n">context</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>\n      <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>\n      <span class="k">break</span>\n\n\n<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">\'__main__\'</span><span class="p">:</span>\n  <span class="n">main</span><span class="p">()</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>看起來有點長，不過和黑科技 AI 相比應該是小巫見大巫。</p>\n\n<p>下面是執行的影片：</p>\n\n<p><iframe width="710" height="399" src="https://www.youtube.com/embed/gZSA-h7QEgA" allowfullscreen loading="lazy">\n</iframe>\n</p>\n\n<h2>\n  <a name="%E7%B5%90%E8%AA%9E" href="#%E7%B5%90%E8%AA%9E">\n  </a>\n  結語\n</h2>\n\n<p>本文我們示範用 <a href="https://2captcha.com?from=12933116">2Captcha</a> 通過普通的 CAPTCHA 及 reCAPTCHA，在這兩種最常見的 CAPTCHA 外，2Captcha 還支援其他各式各樣的 CAPTCHA，形式眾多，可以參考 <a href="https://2captcha.com/2captcha-api">2Captcha 的文件</a>與 <a href="https://2captcha.com/demo">demo</a> 頁。</p>\n\n<p>在 API 方面，2Captcha 有提供封裝好的 Python、GO、PHP、Java、C#、C++ 套件，即使是沒有現成套件的語言，直接呼叫 2Captcha API 也不是太困難的事。</p>\n\n<p>至於 2Captcha 的費用，除了真的很便宜的費率外，在設計 bot 時，只要保留住登入後的 cookie 或 local storage，即可省下每次都要重新登入的時間以及 CAPTCHA 的費用，以 Playwright 為例，它就有 <a href="https://playwright.dev/python/docs/auth#reuse-authentication-state">reuse authentication state</a> 的機制，可以多加利用。</p>\n\n<h2>\n  <a name="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">\n  </a>\n  參考資料\n</h2>\n\n<ul>\n<li>維基百科〈<a href="https://zh.wikipedia.org/zh-tw/%E9%AA%8C%E8%AF%81%E7%A0%81">驗證碼</a>〉</li>\n</ul>\n\n',n.body_markdown='往往我們在做爬蟲或 bot 的時候，最難跨過的問題之一大概就是那 [CAPTCHA](http://www.captcha.net/) 人機驗證了，有的團隊會選擇自行開發辨識技術來通過 CAPTCHA 人機驗證，然而面對越來越難的人機考驗，例如 Google 的 reCAPTCHA，若真要自行開發，那得付出相當程度的時間與精神，本文要介紹的 [2Captcha](https://2captcha.com?from=12933116) 是幫助我們通過 CAPTCHA 人機驗證的服務，透過 2Captcha API，讓我們可以方便快速的通過那些 CAPTCHA 考驗，省去大量自行開發的時間與金錢。\n\n在介紹 2Captcha 前，先簡單的認識一下 CAPTCHA。\n\n## CAPTCHA\n\n**CAPTCHA** 全稱是「**C**ompletely **A**utomated **P**ublic **T**uring test to tell **C**omputers and **H**umans **A**part」，翻譯成華文是超級繞口的「**全自動區分電腦和人類的公開圖靈測試**」，這串無敵長的文字簡單講就是**人機驗證**，CAPTCHA 人機驗證存在的目的通常是為了遏止網站被外部的程式惡意的大量操作，然而這樣的機制也擋住了我們家從事無害工作的可愛小爬蟲 🐛 或小機器人 🤖，所以我輩開發者就需要像 2Captcha 這樣的服務幫我們通過那 CAPTCHA 考驗。\n\n### 常見的 CAPTCHA\n\n在台灣常見到的 CAPTCHA 的場合大概有這些：\n\n**台灣高鐵**\n\n台灣高鐵的 CAPTCHA 是較為傳統的文字混淆型：\n\n![台灣高鐵](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/95yjgk9phycfdkywraev.png)\n\n**臺灣鐵路**\n\n臺鐵的則是用 Google 的 reCAPTCHA：\n\n![臺灣鐵路](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/77pj2nh4opjuor4efqpu.png)\n\n**網路銀行**\n\n除了訂票外，網銀也很常看到 CAPTCHA：\n\n![網路銀行](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xvcs095gmu8keo8sxc2g.png)\n\n特別要說明的是，上面的舉例僅是用於說明 CAPTCHA 的使用場景，請不要動搶票的歪腦筋，那有可能是違法的，請諮詢專業法律人士獲得正確的法律知識，也歡迎留言共同討論。\n\n## 2Captcha\n\n<figure>\n\n![2Captcha](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8ei2iviy4zvlnwbf0dwl.png)\n<figcaption>來源：<a href="https://2captcha.com/">2Captcha</a></figcaption>\n</figure>\n\n先簡單認識 [2Captcha](https://2captcha.com?from=12933116)，做為一個辨識 CAPTCHA 的服務，2Captcha 背後的辨識機制其實是由人工完成的，我們傳送給 2Captcha 的圖片，都會轉送給分散在全世界的 2Captcha worker 們，經過人工辨識後再把結果回傳，而那些辛苦的 worker 們也可以透過 2Captcha 的仲介機制獲得報酬，因為是人工辨識，所以我們可以預期：\n\n- 正確率應該是高的，2Captcha 也有自己的品質把關機制，剃除掉不適任的 worker，一般來說正確率在九成以上。\n- 應該會有些許的等待時間，才能得到辨識後的結果，在 2Captcha API 文件有提到，一般形式的 CAPTAHA 建議等待 5 秒，而較難的 reCAPTCHA 則建議等待 20 秒。\n\n### 2Captcha 的收費\n\n在費用方面，2Captcha 是採用動態計價，動態的基準是當前 2Captcha 與 worker 們的工作負荷，當負荷量大時會升價、負荷量小時會降價，當前的費率會顯示在 [Statistics](https://2captcha.com/public_statistics) 頁面，例如下面是本文撰寫時的費率：\n\n![2Captcha customers statistics](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1gtwaf9adnm7kjxwfj7n.png)\n\n上圖可以看到，普通的 CAPTCHA 每**一千個**收費僅 0.74 美金，而較難的 reCAPTCHA 每**一千個**則收費 2.99 美金，相較於自行開發各種花式 AI 辨識系統所要花費的人力物力，2Captcha 算是相當低廉的價格了。\n\n在 Statistics 頁面，除了費率外，還有目前 2Captcha 服務的負載程度，以及解題的速度，上圖顯示一般的 CAPTCHA 花 15 秒，而 reCAPTCHA 要花 46 秒，儘管與 2Captcha 文件內的 5 秒、20 秒有差距，看起來還在可以接受的程度內。\n\n在簡單的認識 2Captcha 的機制與收費之後，下面就來實際玩玩看 2Captcha 吧！\n\n## 2Captcha 辨識一般 CAPTCHA\n\n在這個範例中，我們會示範用 Playwright 登入一個網站，並且用 [2Captcha](https://2captcha.com?from=12933116) 協助我們辨識登入時的 CAPTCHA 驗證碼。\n\n### 事前準備\n\n在開始前簡單的介紹一下 Playwright，Playwright 是微軟開發的瀏覽器自動化套件，類似於陳年的 Selenium，Playwright 的優點有：\n\n- 自帶瀏覽器，包括 Firefox、WebKit、Chromium，Playwright 一行指令就都幫我們配置到好。\n- 跨語言，Playwright 有 Node.js、Python、.NET、Java 版本，並且不同的語言有著共通的邏輯與相似的 API。\n- 自動等待元素現身，才執行相關敘述，相當大程度的省去了手動調試等待時間的心力。\n\n做為一個瀏覽器自動化工具，當然是最適合拿來開發爬蟲或 bot 了，特別是 client side rendering 當道的現在，很難在不使用真正的瀏覽器的條件下做出爬蟲或bot。\n\n在 2Captcha 方面，開立帳號後，登入可以看到 2Captcha API key：\n\n![2Captcha API Key](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gy7yilf0gm193r8l14ia.png)\n\n這組 API key 用於與 2Captcha 程式交互，下面的範例程式中的 API key 是無效的，請務必換成您個人的 API key。\n\n### 登入與 CAPTCHA 辨識\n\n回到範例的主題上，下面我們會用 Playwright for Python 以及 [2Captcha 的 Python 套件](https://github.com/2captcha/2captcha-python)，示範通過下面這個登入頁面：\n\n![TWO\'S 創意束胸](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tsc6k1cxib3pujiystb6.png)\n\n在這個典型的登入表單中，我們的腳本會用 Playwright 輸入帳密，並且把那 CAPTCHA 圖片透過 2Captcha API 取得驗證碼，最後點按「登入」：\n\n```py\nimport base64\n\nfrom playwright.sync_api import sync_playwright\nfrom twocaptcha import TwoCaptcha\n\n\nCAPTCHA_API_KEY = \'5c0f7e0306aa2e0398510ef9ce6dbca\'\nsolver = TwoCaptcha(apiKey=CAPTCHA_API_KEY)\n\n\ndef solve(image):\n  try:\n    result = solver.normal(\n      file=image,\n      numeric=4,\n      minLength=4,\n      maxLength=4,\n      caseSensitive=1\n    )\n  except Exception as e:\n    print(e)\n    \n  print(result)\n  return result\n\n\ndef report(captcha_id: str, success: bool):\n  solver.report(captcha_id, success)\n\n\ndef main():\n  while True:\n    with sync_playwright() as p:\n      browser = p.firefox.launch(headless=False, slow_mo=500)\n      context = browser.new_context()\n      page = context.new_page()\n      page.goto("http://www.twoas.idv.tw/user.php")\n      page.type("input[name=username]", "RSOB")\n      page.type("input[name=password]", "RSOBPassword")  \n      screenshot_bytes = page.locator("img[alt=captcha]").screenshot()\n      captcha_image = base64.b64encode(s=screenshot_bytes).decode(\'utf-8\')\n      result = solve(image=captcha_image)\n      page.type("input[name=captcha]", result[\'code\'])\n      page.click("text=立即登入")\n      login_message = page.text_content("div.tips")\n      \n      try:\n        assert login_message == "登入成功"\n      except AssertionError as e:\n        report(result[\'captchaId\'], False)\n        continue\n        \n      report(result[\'captchaId\'], True)\n      page.pause()\n      context.close()\n      browser.close()\n      break\n  \nif __name__ == \'__main__\':\n  main()\n```\n\n上面的腳本，可以分成 Playwright 操控瀏覽器的部份與 2Captcha 交互的部份。\n\nPlaywright 的部份，我們用 `page` 物件操控大多數的瀏覽器行為，相信即使是對 Playwright 不熟悉的朋友也可以望文生義：\n\n- 用 `goto()` 函式前往指定網址。\n- 用 `type()` 函式找到特定元素，並輸入字元。\n- 用 `locator()` 函式找到元素並操控它。\n- 用 `screenshot()` 函式對元素截圖。\n- 用 `click()` 函式點按特定元素。\n\n在用 `screenshot()` 取得 CAPTCHA 圖片後，用 `base64` 模組轉換成 Base64 編碼，交給 `solve()` 函式處理。\n\n在 CAPTCHA 辨識部份，此網站的 CAPTCHA 如下例：\n\n![CAPTCHA](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h53duv5n0z5p5x5hjr8t.png)\n\n這是一種相對普通的 CAPTCHA，在 2Captcha 的分類上，屬於 normal 型。\n\n在 2Captcha 的部份，先定義一個 2Captcha 的 `solver` 物件，並用下面的敘述得到辨識後的文字：\n\n```py\nresult = solver.normal(\n  file=image,\n  numeric=4,\n  minLength=4,\n  maxLength=4,\n  caseSensitive=1\n)\n```\n\n因為 CAPTCHA 屬於 normal 型，所以我們調用的是 `normal()` 函式，函式內的參數，除了 `file` 是必填，其他都是可選用的：\n\n- `file` 可接受一個經 Base64 編碼的 CAPTCHA 圖片物件，也可以是本地的圖片檔案，或圖片的 URL。\n- `numeric` CAPTCHA 的字元型態，`4` 表示會有字母與數字，其他的定義請參閱 [2Captcha API 文件](https://2captcha.com/2captcha-api)。\n- `minLength` 最小字元長度，以此例而言，都是固定四個字元。\n- `maxLength` 最大字元長度，以此例而言，都是固定四個字元。\n- `caseSensitive` 設為 `1` 表示區分大小寫。\n\n經過上面的交互，取得 `result`，`result` 是一個結構如下的 dict 物件：\n\n```py\n{\'captchaId\': \'69475003267\', \'code\': \'4QR5\'}\n```\n\n其中的 `cpatchaId` 是 2Captcha API 賦予的交互 ID，而 `code` 當然就是辨識後的答案啦！\n\n### 回饋辨識與否\n\n取得 `result[\'code\']` 後，填入表單，若正確登入，我們用 `report()` 回饋成功紀錄給 2Captcha，並在最後的 `break` 語句完全結束 `while` 迴圈。\n\n反之若是失敗，則用 `report()` 回饋失敗紀錄給 2Captcha，並在後續的 `continue` 語句中斷這次的 `while` 迴圈，進入下一個 `while` 迴圈，藉此做出重試的效果。\n\n### 成果\n\n最後的成果可以參考這個影片：\n\n<iframe frameborder="0" src="https://www.dailymotion.com/embed/video/x87tr9m" allow="autoplay" allowfullscreen></iframe>\n\n<iframe id="odysee-iframe" src="https://odysee.com/$/embed/2Captcha-demo-1/b2f38a25503eca65af7a2fcdd953d827fae757af" allowfullscreen></iframe>\n\n{% youtube ECXhkH2WZOA %}\n\n## 用 2Captcha 通過 reCAPTCHA\n\n完成前一個較簡單的例子後，我們來玩玩看如何用 [2Captcha](https://2captcha.com?from=12933116) 通過難一點的 reCAPTCHA，也就是那著名的靈魂考驗「我不是機器人」：\n\n<figure>\n\n![我不是機器人](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fr8bxfqk6ecbkxqx249w.png)\n<figcaption>來源：網路</figcaption>\n</figure>\n\n要用 2Captcha 通過 reCAPTCHA 的「我不是機器人」考驗，必須先取得目標頁面的 site key，在原始碼裡面就可以找到這把公開的 site key：\n\n![reCAPTCHA Site Key](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rccaxr8yeltgjau949b1.png)\n\n有了 site key 之後，就可以依樣畫葫蘆，呼叫 2Captcha API 得到 reCAPTCHA 的通關密語。\n\n與 2Captcha 交互的部份改成這樣：\n\n```py\nresult = solver.recaptcha(\n  sitekey=\'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ\',\n  url="https://naweeklytimes.com/login-2/",\n  version="v2",\n)\n```\n\n拿到的 result 也是同樣的 dict 結構，只是變成超長的 token：\n\n```py\n{\'captchaId\': \'69482081140\', \'code\': \'03AGdBq252s4QsHsrr9CqzkkswdnHsUPLXIcE4OI1pEX4FUP9rNY8p760yLBsd9goaMn61vw95x981lU0...\'}\n```\n\n然後我們要把那組 `code` 填入一個名為 `g-recaptcha-response` 的文字框，然而這個文字框是隱藏的，所以得先用 Playwright 跑一小段 JS 讓它顯示出來：\n\n```py\npage.eval_on_selector(\n  selector="textarea[name=g-recaptcha-response]",\n  expression="(el) => el.style.display = \'inline-block\'",\n)\n```\n\n上面的函式中，JS 的 `el` 就是來自 `selector` 抓到的元素。\n\n文字框顯示出來會像這樣：\n\n![g-recaptcha-response](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ac4v7h8uqjpn43q3pijy.png)\n\n然後就比照第一個範例，帳號、密碼、reCAPTCHA 通關密語填一填，就可以成功登入囉！\n\n### 成果\n\n完整的程式碼如下：\n\n```py\nfrom playwright.sync_api import sync_playwright\nfrom twocaptcha import TwoCaptcha\n\n\nURL = "https://naweeklytimes.com/login-2/"\nSITEKEY = \'6LflqMEUAAAAAANhC6kkXmSLiBOLiLFsHw_anYWZ\'\nCAPTCHA_API_KEY = \'5c0f7e0306aa2e0398510ef9ce6dbca\'\n\n\nsolver = TwoCaptcha(apiKey=CAPTCHA_API_KEY)\n\n\ndef solve(url: str):\n  try:\n    result = solver.recaptcha(\n      sitekey=SITEKEY,\n      url=url,\n      version="v2",\n    )\n  except Exception as e:\n    print(e)\n    raise Exception\n    \n  print(result)\n  return result\n\n\ndef report(captcha_id: str, success: bool):\n  solver.report(captcha_id, success)\n\n\ndef main():\n  while True:\n    with sync_playwright() as p:\n      browser = p.firefox.launch(headless=False, slow_mo=500)\n      context = browser.new_context()\n      page = context.new_page()\n      page.goto(URL)\n      page.type("input[name=log]", "RSOB")\n      page.type("input[name=pwd]", "RSOBPassword")\n    \n      try:\n        result = solve(url=URL)\n      except Exception as e:\n        continue\n        \n      page.eval_on_selector(\n        selector="textarea[name=g-recaptcha-response]",\n        expression="(el) => el.style.display = \'inline-block\'",\n      )\n      textarea = page.locator("textarea[name=g-recaptcha-response]")\n      textarea.fill(result[\'code\'])\n      page.click("input[type=submit]")\n      \n      try:\n        assert page.url == "https://naweeklytimes.com/"\n      except AssertionError as e:\n        report(result[\'captchaId\'], False)\n        continue\n        \n      report(result[\'captchaId\'], True)\n      page.pause()\n      context.close()\n      browser.close()\n      break\n  \n\nif __name__ == \'__main__\':\n  main()\n```\n\n看起來有點長，不過和黑科技 AI 相比應該是小巫見大巫。\n\n下面是執行的影片：\n\n{% youtube gZSA-h7QEgA %}\n\n## 結語\n\n本文我們示範用 [2Captcha](https://2captcha.com?from=12933116) 通過普通的 CAPTCHA 及 reCAPTCHA，在這兩種最常見的 CAPTCHA 外，2Captcha 還支援其他各式各樣的 CAPTCHA，形式眾多，可以參考 [2Captcha 的文件](https://2captcha.com/2captcha-api)與 [demo](https://2captcha.com/demo) 頁。\n\n在 API 方面，2Captcha 有提供封裝好的 Python、GO、PHP、Java、C#、C++ 套件，即使是沒有現成套件的語言，直接呼叫 2Captcha API 也不是太困難的事。\n\n至於 2Captcha 的費用，除了真的很便宜的費率外，在設計 bot 時，只要保留住登入後的 cookie 或 local storage，即可省下每次都要重新登入的時間以及 CAPTCHA 的費用，以 Playwright 為例，它就有 [reuse authentication state](https://playwright.dev/python/docs/auth#reuse-authentication-state) 的機制，可以多加利用。\n\n## 參考資料\n\n- 維基百科〈[驗證碼](https://zh.wikipedia.org/zh-tw/%E9%AA%8C%E8%AF%81%E7%A0%81)〉\n\n\n',n.user={name:"Leon",username:"leon0824",twitter_username:"LeonH",github_username:"Leon0824",website_url:"https://leonh.space/",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--kH9qgwls--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/92118/0ba206fe-abb3-4220-9aad-65732e2d40b5.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--QxTU8QFA--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/92118/0ba206fe-abb3-4220-9aad-65732e2d40b5.jpeg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:n}},error:s,state:{currentArticle:n},serverRendered:!0,routePath:"/leon0824/985804",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"2022-02-11T14:54:31Z",{})</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
