<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>[Beginner's guide] Understanding mapping with Elasticsearch and Kibana</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>[Beginner's guide] Understanding mapping with Elasticsearch and Kibana</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/beginners" class="tag" data-v-70afb46a>
          #beginners
        </a><a href="/nuxtstop/t/elasticsearch" class="tag" data-v-70afb46a>
          #elasticsearch
        </a><a href="/nuxtstop/t/database" class="tag" data-v-70afb46a>
          #database
        </a><a href="/nuxtstop/t/datascience" class="tag" data-v-70afb46a>
          #datascience
        </a></div> <!----> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            83
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Aug 13 '21</time></div></header> <div class="content" data-v-70afb46a><p>Have you ever encountered the error “Field type is not supported for [whatever you are trying to do with Elasticsearch]”?</p>

<p><a href="https://i.giphy.com/media/HaR4OfLvNtHqr4TwB9/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/HaR4OfLvNtHqr4TwB9/giphy.gif" alt="image" loading="lazy"></a></p>

<p>The most likely culprit of this error is the <code>mapping</code> of your index!</p>

<p><code>Mapping</code> is the process of defining how a document and its fields are indexed and stored. It defines the type and format of the fields in the documents. As a result, <code>mapping</code> can significantly affect how Elasticsearch searches and stores data.</p>

<p>Understanding how <code>mapping</code> works will help you define <code>mapping</code> that best serves your use case.</p>

<p>By the end of this blog, you will be able to define what a <code>mapping</code> is and customize your own <code>mapping</code> to make indexing and searching more efficient. </p>

<h2>
  <a name="prerequisite-work" href="#prerequisite-work">
  </a>
  Prerequisite work
</h2>

<p>Watch this <a href="https://www.youtube.com/watch?v=CCTgroOcyfM">video</a> from time stamp 14:28-19:00. This video will show you how to complete steps 1 and 2.</p>

<ol>
<li>Set up Elasticsearch and Kibana* </li>
<li>Open the Kibana console(AKA Dev Tools)
</li>
<li>Keep two windows open side by side(this blog and the Kibana console)</li>
</ol>

<p>We will be sending requests from Kibana to Elasticsearch to learn how <code>mapping</code> works! </p>

<p><strong>Note</strong><br>
If you would rather download Elasticsearch and Kibana on your own machine, follow the steps outlined in <a href="https://dev.to/elastic/downloading-elasticsearch-and-kibana-macos-linux-and-windows-1mmo">Downloading Elasticsearch and Kibana(macOS/Linux and Windows)</a>. </p>
<h2>
  <a name="additional-resources" href="#additional-resources">
  </a>
  Additional Resources
</h2>

<p>Interested in beginner friendly workshops on Elasticsearch and Kibana? Check out my Beginner's Crash Course to Elastic Stack series!</p>

<p>1) <a href="https://www.youtube.com/watch?v=FQAHDrVwfok&list=PL_mJOmq4zsHZYAyK606y7wjQtC0aoE6Es&index=5&t=598s">Part 5 Workshop Recording</a></p>

<p>This blog is a complementary blog to Part 5 of the Beginner's Crash Course to Elastic Stack. If you prefer learning by watching videos instead, check out the recording!</p>

<p>2) <a href="https://github.com/LisaHJung/Beginners-Crash-Course-to-the-Elastic-Stack-Series">Beginner's Crash Course to Elastic Stack Table of Contents</a></p>

<p>This table of contents includes repos from all workshops in the series. Each repo includes resources shared during the workshop including the video recording, presentation slides, related blogs, Elasticsearch requests and more!</p>
<h2>
  <a name="what-is-a-mapping" href="#what-is-a-mapping">
  </a>
  What is a Mapping?
</h2>

<p>Imagine you are building an app that requires you to store and search data. Naturally, you will want to store data using the smallest disk space while maximizing your search performance. </p>

<p>This is where <code>mapping</code> comes into play! </p>

<p><code>Mapping</code> defines how a document and its fields are indexed and stored. </p>

<p>It does that by defining field types. Depending on its type, the fields are stored and indexed accordingly. </p>

<p>Learning how to define your own mapping will help you:</p>

<ol>
<li>optimize the performance of Elasticsearch</li>
<li>save disk space</li>
</ol>

<p>Before we delve into mapping, let's review a few concepts!</p>
<h2>
  <a name="review-from-previous-blogs" href="#review-from-previous-blogs">
  </a>
  Review from previous blogs
</h2>

<p>In the previous blogs, we learned how to <a href="https://dev.to/lisahjung/beginner-s-guide-to-running-queries-with-elasticsearch-and-kibana-4kn9">query</a> and <a href="https://dev.to/lisahjung/beginner-s-guide-running-aggregations-with-elasticsearch-and-kibana-16bn">aggregate</a> data to gain insights.   </p>

<p>But before we could run queries or aggregations, we had to first add data to Elasticsearch. </p>

<p>Let’s say we are creating an app for a produce warehouse. You want to store data about produce in Elasticsearch so you can search for it.</p>

<p>In Elasticsearch, data is stored as documents. A document is a JSON object that contains whatever data you want to store in Elasticsearch. </p>

<p>Take a look at the following document about a produce item. In a JSON object, it contains a list of fields such as "name", "botanical_name", "produce_type" and etc. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s---0gxBB-V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121580744-55909100-c9ea-11eb-98fe-8c8491b0a7a1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---0gxBB-V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121580744-55909100-c9ea-11eb-98fe-8c8491b0a7a1.png" alt="image" loading="lazy"></a></p>

<p>When you take a closer look at the fields, you will see that each field is of a different JSON data type. </p>

<p>For example, for the field "name", the JSON data type is  string. For the field "quantity", the JSON data type is integer. For the field "preferred_vendor", the JSON data type is boolean. </p>
<h3>
  <a name="indexing-a-document" href="#indexing-a-document">
  </a>
  Indexing a Document
</h3>

<p>Let’s say we want to index the document above. We would send the following request.  </p>

<p>For requests we will go over, the syntax is included for you so you can customize this for your own use case. </p>

<p><strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">Enter</span><span class="o">-</span><span class="nx">name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">the</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>But for our tutorial, we will use the example instead. </p>

<p>The following example asks Elasticsearch to create a new index called the <code>temp_index</code>, then index the following document into it. </p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">temp_index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the console and send the request. </p>

<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch will confirm that this document has been successfully indexed into the <code>temp_index</code>. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MwOSSYFi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120387213-d5ca3e80-c2e6-11eb-8ca8-731222174724.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MwOSSYFi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120387213-d5ca3e80-c2e6-11eb-8ca8-731222174724.png" alt="image" loading="lazy"></a></p>

<p>What we have covered so far is a review from previous blogs. What we have not gone over is what actually goes on behind the scenes when you index a document. </p>

<p>This is where <code>mapping</code> comes into play!</p>
<h2>
  <a name="mapping-explained" href="#mapping-explained">
  </a>
  Mapping Explained
</h2>

<p><code>Mapping</code> determines how a document and its fields are indexed and stored by defining the type of each field.  </p>

<p>The <code>mapping</code> of an index look something like the following:<br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BzRbQ4lJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121219417-e7f53100-c840-11eb-9848-7acb3df84227.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BzRbQ4lJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121219417-e7f53100-c840-11eb-9848-7acb3df84227.png" alt="image" loading="lazy"></a></p>

<p>It contains a list of the names and types of fields in an index. Depending on its type, each field is indexed and stored differently in Elasticsearch.  </p>

<p>Therefore, <code>mapping</code> plays an important role in how Elasticsearch stores and searches for data. </p>
<h3>
  <a name="dynamic-mapping" href="#dynamic-mapping">
  </a>
  Dynamic Mapping
</h3>

<p>In the previous request we sent, we had created a new index called the <code>temp_index</code>, then we indexed a document into it. </p>

<p><code>Mapping</code> determines how a document and its fields should be indexed and stored. But we did not define the <code>mapping</code> ahead of time. </p>

<p>So how did this document get indexed?</p>

<p><a href="https://i.giphy.com/media/Qe5oD5aXjEbKw/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/Qe5oD5aXjEbKw/giphy.gif" alt="image" loading="lazy"></a></p>

<p>When a user does not define the <code>mapping</code> in advance, Elasticsearch creates or updates the <code>mapping</code> as needed by default. This is known as <code>dynamic mapping</code>. </p>

<p>Take a look at the following diagram. It illustrates what happens when a user asks Elasticsearch to create a new index without defining the <code>mapping</code> ahead of time.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JAOmmV2p--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121590398-83c79e00-c9f5-11eb-95f8-e32654447359.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JAOmmV2p--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121590398-83c79e00-c9f5-11eb-95f8-e32654447359.png" alt="image" loading="lazy"></a></p>

<p>When a user does not define the <code>mapping</code> in advance, Elasticsearch creates or updates the <code>mapping</code> as needed by default. This is known as <code>dynamic mapping</code>. </p>

<p>With <code>dynamic mapping</code>, Elasticsearch looks at each field and tries to infer the data type from the field content. Then, it assigns a type to each field and creates a list of field names and types known as <code>mapping</code>.  </p>

<p>Depending on the assigned field type, each field is indexed and primed for different types of requests(full text search, aggregations, sorting). This is why <code>mapping</code> plays an important role in how Elasticsearch stores and searches for data. </p>
<h3>
  <a name="view-the-mapping" href="#view-the-mapping">
  </a>
  View the Mapping
</h3>

<p>Now that we have indexed a document without defining the mapping in advance, let's take a look at the <code>dyanmic mapping</code> that Elasticsearch has created for us. </p>

<p>To view the <code>mapping</code> of an index, you send the following request. </p>

<p><strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Enter_name_of_the_index_here</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The following example asks Elasticsearch to retrieve the <code>mapping</code> of the <code>temp_index</code>.</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">temp_index</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the Kibana console and send the request. </p>

<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch returns the <code>mapping</code> of the temp_index. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--SaTY_sio--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121591969-5c71d080-c9f7-11eb-95dc-70f04276929a.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--SaTY_sio--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121591969-5c71d080-c9f7-11eb-95dc-70f04276929a.png" alt="image" loading="lazy"></a><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cL9zSof8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592051-76131800-c9f7-11eb-8820-d3d2b39e1e4f.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cL9zSof8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592051-76131800-c9f7-11eb-8820-d3d2b39e1e4f.png" alt="image" loading="lazy"></a><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cT6_vEpE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592106-83c89d80-c9f7-11eb-97fc-56d23b0242ae.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cT6_vEpE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592106-83c89d80-c9f7-11eb-97fc-56d23b0242ae.png" alt="image" loading="lazy"></a></p>

<p>It lists all the fields of the document in an alphabetical order and lists the type of each field(text, keyword, long, float, date, boolean and etc). These are a few of many field types that are recognized by Elasticsearch. For the list of all field types, click <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">here</a>!</p>

<p>At a first glance, this <code>mapping</code> may look really complicated. Rest assured. We are going to break this down into bite sized pieces! </p>

<p>Depending on what your use case is, the <code>mapping</code> can be customized to make storage and indexing more efficient.</p>

<p>The rest of the blog will cover what type of <code>mapping</code> is best for different types of requests. Then, we will learn how to define our own <code>mapping</code>!</p>
<h3>
  <a name="indexing-strings" href="#indexing-strings">
  </a>
  Indexing Strings
</h3>

<p>Let's take a look at our document again.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--QCKYOU1n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gus3ibdip5v8ekwneovi.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QCKYOU1n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gus3ibdip5v8ekwneovi.png" alt="image" loading="lazy"></a></p>

<p>Many of these fields such as "botanical_name", "produce_type", and "country_of_origin"(teal box) contain strings. </p>

<p>Let's examine the mapping of the string fields "botanical_name","country_of_origin", and "description" below. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Npu1u111--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/u8nglbt98ys7bpr1c89w.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Npu1u111--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/u8nglbt98ys7bpr1c89w.png" alt="image" loading="lazy"></a></p>

<p>You will see that these string fields(orange lines) have been mapped as both <code>text</code> and <code>keyword</code>(green lines) by default. </p>

<p>There are two kinds of string data types:</p>

<ol>
<li>Text</li>
<li>Keyword</li>
</ol>

<p>By default, every string gets mapped twice as a <code>text</code> field and as a <code>keyword</code> multi-field. Each field type is primed for different types of requests. </p>

<p><code>Text</code> field type is designed for full-text searches. One of the benefits of full text search is that you can search for individual terms in a non-case sensitive manner. </p>

<p><code>Keyword</code> field type is designed for exact searches, aggregations, and sorting. This field type becomes handy when you are searching for original strings. </p>

<p>Depending on what type of request you want to run on each field, you can assign the field type as either <code>text</code> or <code>keyword</code> or both! </p>

<p>Let's delve into <code>text</code> field type first.</p>
<h4>
  <a name="text-field-type" href="#text-field-type">
  </a>
  Text Field Type
</h4>
<h5>
  <a name="text-analysis" href="#text-analysis">
  </a>
  Text Analysis
</h5>

<p>Ever notice that when you search in Elasticsearch, it is not case sensitive or the punctuation does not seem to matter? This is because <code>text analysis</code> occurs when your fields are indexed. </p>

<p>The diagram below illustrates how the string "These pineapples are sourced from New Zealand." would be analyzed in Elasticsearch. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--8nnBpRhW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120847933-672cf100-c531-11eb-9b9c-522c354b0e10.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--8nnBpRhW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120847933-672cf100-c531-11eb-9b9c-522c354b0e10.png" alt="image" loading="lazy"></a></p>

<p>By default, strings are analyzed when it is indexed. When the string is analyzed, the string is broken up into individual words also known as tokens. The analyzer further lowercases each token and removes punctuations. </p>

<p><strong>Inverted Index</strong><br>
Take a look at the following request shown in the diagram. It asks Elasticsearch to index a document with the field "description" and assign the document an id of 1. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--w1Aq__c3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121099236-b33b9800-c7b4-11eb-837b-a914ed8e3725.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--w1Aq__c3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121099236-b33b9800-c7b4-11eb-837b-a914ed8e3725.png" alt="image" loading="lazy"></a></p>

<p>When this request is sent, Elasticsearch will look at the field "description" and see that this field contains a string. Therefore, it will map the field "description" as both <code>text</code> and <code>keyword</code> by default. </p>

<p>When a field is mapped as type <code>text</code>, the content of the field passes through an analyzer.</p>

<p>Once the string is analyzed, the individual tokens are stored in a sorted list known as the <code>inverted index</code>(see table above). Each unique token is stored in an <code>inverted index</code> with its associated ID(red numbers in the table above). </p>

<p>The same process occurs every time you index a new document. </p>

<p>Let's say we indexed a new document with identical content as document 1. But we gave this document an id of 2(pink box).</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--_HfqpQuo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119940-0d58e080-cde7-11eb-903b-54a628b8de60.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_HfqpQuo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119940-0d58e080-cde7-11eb-903b-54a628b8de60.png" alt="image" loading="lazy"></a><br>
The content of the field "description" will go through the same process where it is split into individual tokens. However, if these tokens already exist in the <code>inverted index</code>, only the document IDs are updated(red numbers in the table above).</p>

<p>Look at the diagram below. If we add another document with an id of 3(pink box) with one new token(red box), then the new token(caledonia)is added to the <code>inverted index</code>. Also, the doc ids are updated for existing tokens(red numbers in the table below).</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--PfCgBGwC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119962-147fee80-cde7-11eb-915e-3531c405a315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--PfCgBGwC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119962-147fee80-cde7-11eb-915e-3531c405a315.png" alt="image" loading="lazy"></a></p>

<p>This is what happens in the background when you index fields that are typed as <code>text</code>.  </p>

<p>Fields that are assigned the type <code>text</code> are optimal for full text search.</p>

<p>Take a look at this diagram below. The client is asking to fetch all documents containing the terms "new" or "zealand". </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--csXIINUT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119979-19dd3900-cde7-11eb-86e4-274b5e44fec2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--csXIINUT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119979-19dd3900-cde7-11eb-86e4-274b5e44fec2.png" alt="image" loading="lazy"></a></p>

<p>When this request is sent, Elasticsearch does not read through every document for the search terms. It goes straight to the <code>inverted index</code> to look up the search terms, finds the matching document ids and sends the ids back to the user. </p>

<p>The <code>inverted index</code> is the reason Elasticsearch is able to search with speed.</p>

<p>Moreover, since all the terms in the <code>inverted index</code> are lowercase and your search queries are also analyzed, you can search for things in a non-case sensitive manner, and still get the same results.</p>

<p>Let's do another review. </p>

<p>Take a look at the diagram below. We send three requests to index three documents. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--tJbGfbze--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120075-324d5380-cde7-11eb-9b4e-744dfa6d527d.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--tJbGfbze--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120075-324d5380-cde7-11eb-9b4e-744dfa6d527d.png" alt="image" loading="lazy"></a></p>

<p>Each document has a field called "country" with a string value. By default, the field "country" is mapped twice as text(teal arrow) and keyword(yellow arrow). </p>

<p><code>Text</code> fields(teal arrow) are analyzed and the tokens are stored in an <code>inverted index</code>(teal table). This is great for full text search but it is not optimized for performing aggregations, sorting or exact searches. </p>

<p>For the types of actions mentioned above, Elasticsearch depends on the <code>keyword</code> field(yellow arrow). </p>

<p>When a <code>keyword</code> field(yellow arrow) is created, the content of the field is not analyzed and is not stored in an inverted index. </p>

<p>Instead, <code>keyword</code> field uses a data structure called <code>doc values</code>(yellow table) to store data.  </p>
<h4>
  <a name="keyword-field-type" href="#keyword-field-type">
  </a>
  Keyword Field Type
</h4>

<p><code>Keyword</code> field type is used for aggregations, sorting, and exact searches. These actions look up the document ID to find the values it has in its fields. </p>

<p><code>Keyword</code> field is suited to perform these actions because it uses a data structure called <code>doc values</code> to store data. </p>

<p>Take a look at the diagram below that illustrates <code>doc values</code>. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KPx91tzn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121603436-fccef180-ca05-11eb-817e-cb77b46ae969.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KPx91tzn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121603436-fccef180-ca05-11eb-817e-cb77b46ae969.png" alt="image" loading="lazy"></a></p>

<p>For each document, the document id along with the field value(the original string) are added to a table. This data structure(<code>doc values</code>) is designed for actions that require looking up the document ID to find the values it has in its fields. Therefore, the fields that are typed as <code>keyword</code> are best suited for actions such as aggregations, sorting, and exact searches.  </p>

<p>When Elasticsearch dynamically creates a <code>mapping</code> for you, it does not know what you want to use a string for. As a result, Elasticsearch maps all strings to both field types(<code>text</code> and <code>keyword</code>). </p>

<p>In cases where you do not need both field types, the default setting is wasteful. Since both field types require creating either an <code>inverted index</code> or <code>doc values</code>, creating both field types for unnecessary fields will slow down indexing and take up more disk space.  </p>

<p>This is why we define our own <code>mapping</code> as it helps us store and search data more efficiently. </p>

<p>Doing so takes more planning because we need to decide what type of requests we want to run on these fields. The decisions we make will allow us to designate which string fields will:</p>

<ul>
<li>only be full text searchable or</li>
<li>only be used in aggregation or </li>
<li>be able to support both options </li>
</ul>
<h3>
  <a name="mapping-exercise" href="#mapping-exercise">
  </a>
  Mapping Exercise
</h3>

<p>Now that we understand the field types <code>text</code> and <code>keyword</code>, let’s go over how we can optimize our <code>mapping</code>. </p>

<p>To do so, we are going to do an exercise! </p>

<p><strong>Project</strong>: Build an app for a client who manages a produce warehouse </p>

<p><strong>This app must enable users to:</strong> </p>

<ol>
<li>search for produce name, country of origin and description</li>
<li>identify top countries of origin with the most frequent purchase history</li>
<li>sort produce by produce type(fruit or vegetable)</li>
<li>get the summary of monthly expense</li>
</ol>

<p><strong>Goals</strong></p>

<ol>
<li>Figure out the optimal <code>mapping</code> for desired features</li>
<li>Create an index with the optimal <code>mapping</code> and index documents into it</li>
<li>Learn how you should approach a situation that requires changing the <code>mapping</code> of an existing field</li>
<li>Learn how to use the <code>runtime field</code>
</li>
</ol>

<p>The following is a sample document we will be working with for this exercise. Pay attention to the field names as these field names will come up frequently during this exercise! </p>

<p><strong>Sample data</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Plan of Action</strong><br>
The figures below outline the plan of action for each feature requested by the client. Explanations regarding each bullet point are provided in the blog.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>

<p>The first feature allows the user to search for produce name, country of origin and description. </p>

<p>Let's take a look at the sample document shared with you earlier.</p>

<p><strong>Sample data</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The first feature involves working with the fields "name", "country_of_origin", and "description"(first bullet point in the figure below). </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>

<p>All of these fields contain strings. By default, these fields will get mapped twice as <code>text</code> and <code>keyword</code>. </p>

<p>Let’s see if we need both field types. </p>

<p>Our client wants to search on these fields. But it is unlikely that the user will send search terms that are exactly the way it is written in our documents. </p>

<p>So the user should be able to run a search for individual terms in a non-case sensitive manner. Therefore, the fields "name", "country_of_origin" and "description" should be full text searchable(second bullet point in the figure below). </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>

<p>Let’s say our client does not want to run aggregation, sorting, or exact searches on the fields "name" and "description"(third bullet point in the figure above). </p>

<p>For these fields, we do not need the <code>keyword</code> type. To avoid mapping these fields twice, we will specify that we only want the <code>text</code> type for these fields(blue bullet point in the figure above). </p>

<p>At this point, we know that the field "country_of_origin" should be full text searchable(<code>text</code>). But it is unclear whether we will need aggregation, sorting, or exact searches to be performed on this field(fourth bullet point in the figure above). </p>

<p>Let’s leave that for now. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--s9Y3lGiZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120548-cc150080-cde7-11eb-8613-a4ec5a5c115e.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--s9Y3lGiZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120548-cc150080-cde7-11eb-8613-a4ec5a5c115e.png" alt="image" loading="lazy"></a></p>

<p>If you look at the second feature, the user should be able to identify top countries of origin with the most frequent purchase history.</p>

<p>This feature involves the field "country_of_origin"(first bullet point in the figure above). </p>

<p>For this type of request, we need to run the terms aggregations on this field(second bullet point in the figure above), which means that we need a <code>keyword</code> field.</p>

<p>Since we need to perform full text search(first feature) and aggregations(second feature) on this field, we will map this field twice as <code>text</code> and <code>keyword</code>(third bullet point in the figure above). </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Z1xdC8X7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121604184-4c61ed00-ca07-11eb-84f8-208c3e927a08.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Z1xdC8X7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121604184-4c61ed00-ca07-11eb-84f8-208c3e927a08.png" alt="image" loading="lazy"></a></p>

<p>The third feature allows the user to sort by produce type. This feature involves the field "produce_type" which contains a string(first bullet point in the figure above).  </p>

<p>Since this feature requires sorting(second bullet point in the figure above), we need a <code>keyword</code> type for this field.  </p>

<p>Let’s say the client does not want to run a full text search for this field. </p>

<p>As a result, we will need to map this field as <code>keyword</code> type only(third bullet point in the figure above). </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" alt="image" loading="lazy"></a></p>

<p>The fourth feature allows the user to get the summary of monthly expense.</p>

<p>This feature involves the fields "date_purchased", "quantity", and "unit_price"(first bullet point in the figure above).</p>

<p>So let’s break this down.</p>

<p>This feature requires splitting the data into monthly buckets. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" alt="image" loading="lazy"></a></p>

<p>Then, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" alt="image" loading="lazy"></a></p>

<p>The next diagram shows you the April bucket. The documents of all produce purchased during April are included in this bucket. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" alt="image" loading="lazy"></a></p>

<p>Let's zoom in on one of the documents to look at its fields(json object highlighted with pink lines). </p>

<p>You will notice that our documents do not have a field called "total".</p>

<p>However, we do have fields called "quantity" and "unit_price"(pink box). </p>

<p>In order to get the total for each document, we need to multiply the values of the fields "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense.</p>

<p>The following figure shows the summary of optimal <code>mapping</code> for all string fields that we have just discussed. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--4lgkPeuy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100826-d972c080-cdd0-11eb-995c-048e6709ef57.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4lgkPeuy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100826-d972c080-cdd0-11eb-995c-048e6709ef57.png" alt="image" loading="lazy"></a></p>

<p>Take a look at the first bullet point in the figure above. It states that for the fourth feature, we need to calculate the total for each produce so it can be used to calculate the monthly expense.</p>

<p>The second bullet point in the figure outlines the additional step we are going to take to make our <code>mapping</code> more efficient. </p>

<p>The following is the reason why we are disabling the field "botanical_name" and the object "vendor_details"(second bullet point).</p>

<p>Our document contains multiple fields. </p>

<p><strong>Sample data</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>After going through each feature, we know that the string field "botanical_name" and the object "vendor_details" will not be used.</p>

<p>Since we do not need the <code>inverted index</code> or the <code>doc values</code> of these fields, we are going to disable these fields. This in turn prevents the <code>inverted index</code> and the <code>doc values</code> of these fields from being created.</p>

<p>Disabling these fields will help us save disk space and minimize the number of fields in the <code>mapping</code>. </p>

<h3>
  <a name="defining-your-own-mapping" href="#defining-your-own-mapping">
  </a>
  Defining your own mapping
</h3>

<p>Now that we have thought through the optimal <code>mapping</code>, let’s define our own! </p>

<p>Before we get to that, there are a few rules about <code>mapping</code> you need to know. </p>

<p><strong>Rules</strong></p>

<ol>
<li>If you do not define a <code>mapping</code> ahead of time, Elasticsearch dynamically creates a <code>mapping</code> for you.</li>
<li>If you do decide to define your own <code>mapping</code>, you can do so at index creation.</li>
<li>ONE <code>mapping</code> is defined per index. Once the index has been created, we can only add <em>new</em> fields to a <code>mapping</code>. We CANNOT change the <code>mapping</code> of an <em>existing</em> field. </li>
<li>If you must change the type of an existing field, you must create a new index with the desired <code>mapping</code>, then reindex all documents into the new index. </li>
</ol>

<p>We will go over how these rules work as we go over the steps of defining our own <code>mapping</code>! </p>

<p><strong>Step 1: Index a sample document into a test index.</strong><br>
<strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">test</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The first thing we are going to do is to create a new index called <code>test_index</code> and index a sample document. </p>

<p>The document in the following example is the same sample document we have seen earlier. The sample document must contain the fields that you want to define. These fields must also contain values that map closely to the field types you want. </p>

<p>Copy and paste the following example into the Kibana console and send the request.</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">test_index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
The <code>test_index</code> is successfully created. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--3EtzMjH1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121616770-c81c6380-ca20-11eb-9f3a-593e61eff319.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--3EtzMjH1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121616770-c81c6380-ca20-11eb-9f3a-593e61eff319.png" alt="image" loading="lazy"></a></p>

<p>By default, Elasticsearch will create a <code>dynamic mapping</code> based on the sample document. </p>

<p>What is the point of step 1?</p>

<p>Earlier in the blog, we have indexed the sample document and viewed the <code>dynamic mapping</code>. If you remember, the <code>mapping</code> for our sample document was pretty lengthy. </p>

<p>Since we do not want to write our optimized <code>mapping</code> from scratch, we are indexing a sample document so that Elasticsearch will create the <code>dynamic mapping</code>. </p>

<p>We will use the <code>dynamic mapping</code> as a template and make changes to it to avoid writing out the whole <code>mapping</code> for our index!</p>

<p><strong>Step 2: View the dynamic mapping</strong> <br>
<strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Name</span><span class="o">-</span><span class="nx">the</span><span class="o">-</span><span class="nx">index</span><span class="o">-</span><span class="nx">whose</span><span class="o">-</span><span class="nx">mapping</span><span class="o">-</span><span class="nx">you</span><span class="o">-</span><span class="nx">want</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">view</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's view the mapping of the <code>test_index</code> by sending the following request. </p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">test_index</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch will display the <code>dynamic mapping</code> it has created. It lists the fields in an alphabetical order. The sample document is identical to the one we previously indexed into the<code>temp_index</code>. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--mRsEX4Eb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/218zpdhuuzwd65q7xafm.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--mRsEX4Eb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/218zpdhuuzwd65q7xafm.png" alt="image" loading="lazy"></a><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BmTAbusJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4xtorujpgspurl82n8ut.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BmTAbusJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4xtorujpgspurl82n8ut.png" alt="image" loading="lazy"></a><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Ge8Pgz18--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rnucdz4c0w53gimjjvph.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Ge8Pgz18--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rnucdz4c0w53gimjjvph.png" alt="image" loading="lazy"></a></p>

<p><strong>Step 3: Edit the mapping</strong><br>
Copy and paste the entire <code>mapping</code> from step 2 into the Kibana console. Then, make the changes specified below. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--3Baxr-eL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fhj4b12mtwwrrinwvjh.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--3Baxr-eL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fhj4b12mtwwrrinwvjh.png" alt="image" loading="lazy"></a></p>

<p>From the pasted results, remove the "test_index" along with its opening and closing brackets. Then, edit the <code>mapping</code> to satisfy the requirements outlined in the diagram below.   </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--GuTaMoFY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103275-ad0c7380-cdd3-11eb-9a74-babe7442e5b3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--GuTaMoFY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103275-ad0c7380-cdd3-11eb-9a74-babe7442e5b3.png" alt="image" loading="lazy"></a></p>

<p>Your optimized <code>mapping</code> should look like the following: <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--rVJRSp-Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fjn8ljtostx5mk301p1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--rVJRSp-Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fjn8ljtostx5mk301p1.png" alt="image" loading="lazy"></a></p>

<p>You will see that the field "country_of_origin"(2) has been typed as both <code>text</code> and <code>keyword</code>. </p>

<p>The fields "description"(3) and "name"(4) have been typed as <code>text</code> only. </p>

<p>The field field "produce_type"(5) has been typed as <code>keyword</code> only. </p>

<p>In the field "botanical_name"(1), a parameter called "enabled" was added and was set to "false". This prevents the <code>inverted index</code> and <code>doc values</code> from being created for this field. </p>

<p>The same has been done for the object "vendor_details"(6). </p>

<p>The <code>mapping</code> above defines the optimal <code>mapping</code> for all of our desired features except for the one marked a red x in the figure below. </p>

<p>Don't worry about the unaddressed feature yet as we are saving this for later! </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oiD5hQf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103954-68350c80-cdd4-11eb-82c4-83b47bc364dc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oiD5hQf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103954-68350c80-cdd4-11eb-82c4-83b47bc364dc.png" alt="image" loading="lazy"></a></p>

<p><strong>Step 4: Create a new index with the optimized mapping from step 3.</strong> <br>
<strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">your</span><span class="o">-</span><span class="nx">final</span><span class="o">-</span><span class="nx">index</span>
<span class="p">{</span>
  <span class="nx">copy</span> <span class="nx">and</span> <span class="nx">paste</span> <span class="nx">your</span> <span class="nx">optimized</span> <span class="nx">mapping</span> <span class="nx">here</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, we will create a new index called <code>produce_index</code> with the optimized <code>mapping</code> we just worked on. </p>

<p>If you still have the <code>mapping</code> from step 3 in the Kibana console, delete the <code>mapping</code> from the Kibana console. </p>

<p>Then, copy and paste the following example into the Kibana console and send the request!</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_index</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">properties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">long</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">float</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch creates the <code>produce_index</code> with the optimized <code>mapping</code> we defined above! </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MkIKKa67--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121618138-89d47380-ca23-11eb-96e3-68204da782dc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MkIKKa67--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121618138-89d47380-ca23-11eb-96e3-68204da782dc.png" alt="image" loading="lazy"></a></p>

<p><strong>Step 5: Check the mapping of the new index to make sure the all the fields have been mapped correctly</strong></p>

<p><strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">test</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's check the mapping of the <code>produce_index</code> to make sure that all the fields have been mapped correctly.</p>

<p>Copy and paste the following example into the Kibana console and send the request!</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
Compared to the dynamic mapping, our optimized <code>mapping</code> looks more simple and concise!  </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oYA1q-nD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eeff2rqq7q1kv9gkrv3c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oYA1q-nD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eeff2rqq7q1kv9gkrv3c.png" alt="image" loading="lazy"></a></p>

<p>The current <code>mapping</code> satisfies the requirements that are marked with green check marks in the figure below.<br><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--YyN_Xarm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121619679-3879b380-ca26-11eb-9ac9-ed19a52c05c2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YyN_Xarm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121619679-3879b380-ca26-11eb-9ac9-ed19a52c05c2.png" alt="image" loading="lazy"></a></p>

<p>Just by defining our own <code>mapping</code>, we prevented unnecessary <code>inverted index</code> and <code>doc values</code> from being created which saved a lot of disk space. </p>

<p>The type of each field has been customized to serve specific client requests. As a result, we also optimized the performance of Elasticsearch as well!</p>

<p><strong>Step 6: Index your dataset into the new index</strong><br>
Now that we have created a new index(<code>produce_index</code>) with the optimal <code>mapping</code>, it is time to add data to the <code>produce_index</code>.</p>

<p>For simplicity's sake, we will index two documents by sending the following requests.  </p>

<p><em>Index the first document</em><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the Kibana console and send the request!</p>

<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch successfully indexes the first document. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qP7pyVqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621403-5563b600-ca29-11eb-8ee9-83686a937fd2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qP7pyVqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621403-5563b600-ca29-11eb-8ee9-83686a937fd2.png" alt="image" loading="lazy"></a></p>

<p><em>Index the second document</em><br>
The second document has almost identical fields as the first document except that it has an extra field called "organic" set to true!<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_doc</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mango</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Harum Manis</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Indonesia</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">organic</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-05-02T07:15:35</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mango Arumanis or Harum Manis is originated from East Java. Arumanis means harum dan manis or fragrant and sweet just like its taste. The ripe Mango Arumanis has dark green skin coated with thin grayish natural wax. The flesh is deep yellow, thick, and soft with little to no fiber. Mango Arumanis is best eaten when ripe.</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ayra Shezan Trading</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suharto</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Binjai, Indonesia</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the Kibana console and send the request!</p>

<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch successfully indexes the second document. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--kw0uT6n2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621463-73c9b180-ca29-11eb-9849-955b8d7872fb.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--kw0uT6n2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621463-73c9b180-ca29-11eb-9849-955b8d7872fb.png" alt="image" loading="lazy"></a></p>

<p>Let's see what happens to the <code>mapping</code> by sending this request below:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
The new field("organic") and its field type(boolean) have been added to the <code>mapping</code>(orange box). This is in line with the rules of <code>mapping</code> we discussed earlier since you can add <em>new</em> fields to the <code>mapping</code>. We just cannot change the <code>mapping</code> of an <em>existing</em> field! </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CjNUVdcU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fk2v520lnbwoprh6x7ry.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--CjNUVdcU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fk2v520lnbwoprh6x7ry.png" alt="image" loading="lazy"></a></p>
<h4>
  <a name="what-if-you-do-need-to-make-changes-to-the-existing-field-type" href="#what-if-you-do-need-to-make-changes-to-the-existing-field-type">
  </a>
  What if you do need to make changes to the existing field type?
</h4>

<p>Let's say you have added a huge produce dataset to the <code>produce_index</code>. </p>

<p>Then, your client asks for an additional feature where the user can run a full text search on the field "botanical_name".  </p>

<p>This is a dilemma since we disabled the field "botanical_name" when we created the <code>produce_index</code>. </p>

<p><a href="https://i.giphy.com/media/UnyGF7evFkN04X24tI/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/UnyGF7evFkN04X24tI/giphy.gif" alt="image" loading="lazy"></a></p>

<p>What are we to do?</p>

<p>Remember, you CANNOT change the <code>mapping</code> of an <em>existing</em> field. If you do need to make changes to the existing field, you must create a new index with the desired <code>mapping</code>, then reindex all documents into the new index. </p>

<p><strong>STEP 1: Create a new index(produce_v2) with the latest mapping.</strong><br>
This step is very similar to what we just did with the <code>test_index</code> and the <code>produce_index</code>. </p>

<p>We are just creating a new index(<code>produce_v2</code>) with a new <code>mapping</code> where we remove the "enabled" parameter from the field "botanical_name" and change its type to "text". </p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_v2</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">properties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">ignore_above</span><span class="dl">"</span><span class="p">:</span> <span class="mi">256</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">organic</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">long</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">float</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the Kibana console and send the request!</p>

<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch creates a new index(produce_v2) with the latest <code>mapping</code>. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--H8hOfzjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121725821-fb093a80-caa6-11eb-8e76-aa84704fb951.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--H8hOfzjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121725821-fb093a80-caa6-11eb-8e76-aa84704fb951.png" alt="image" loading="lazy"></a></p>

<p>Check the <code>mapping</code> of the <code>produce_v2</code> index by sending the following request. </p>

<p><strong>View the mapping of produce_v2:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
You will see that the field "botanical_name" has been typed as <code>text</code>(orange box). <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ZUbCxwjz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eg119a3hmcu4cwmosg5p.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ZUbCxwjz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eg119a3hmcu4cwmosg5p.png" alt="image" loading="lazy"></a></p>

<p><strong>STEP 2: Reindex the data from the original index(<code>produce_index</code>) to the one you just created(<code>produce_v2</code>).</strong></p>

<p>We just created a new index(<code>produce_v2</code>) with the desired <code>mapping</code>. The next step is to reindex the data from the <code>produce_index</code> to the <code>produce_v2</code> index. </p>

<p>To do so, we send the following request:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">_reindex</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">produce_index</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">dest</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">produce_v2</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The field "source" refers to the original index that contains the dataset we want to reindex. The field "dest"(destination) refers to the new index with the optimized <code>mapping</code>. The example requests for the data to be reindexed to the new index.</p>

<p>Copy and paste the request above into the Kibana console and send the request!</p>

<p><strong>Expected response form Elasticsearch:</strong><br>
This request reindexes data from the <code>produce_index</code> to the <code>produce_v2</code> index. The <code>produce_v2</code> index can now be used to run the requests that the client has specified. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cg9yCB-I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121726550-ee391680-caa7-11eb-89a9-be1d4416e0e3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cg9yCB-I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121726550-ee391680-caa7-11eb-89a9-be1d4416e0e3.png" alt="image" loading="lazy"></a></p>
<h4>
  <a name="runtime-field" href="#runtime-field">
  </a>
  Runtime Field
</h4>

<p>We have one last feature to work on! <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" alt="image" loading="lazy"></a></p>

<p>Our client wants to be able to get the summary of monthly expense.</p>

<p>This feature requires splitting the data into monthly buckets. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" alt="image" loading="lazy"></a></p>

<p>Then, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" alt="image" loading="lazy"></a></p>

<p>The problem is that our documents do not have a field called "total". However, we do have fields called "quantity" and "unit_price". </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" alt="image" loading="lazy"></a></p>

<p>In order to get the total for each document, we need to multiply the values of the field "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense. </p>

<p>At this point, you might be thinking we will have to calculate the total and store this in a new field called "total". Then, add the field "total" to the existing documents and run the sum aggregation on this field. </p>

<p>This can get kinda hairy because it involves adding a new field to the existing documents in your index. This requires reindexing your data and starting all over again. </p>

<p>But there is a new feature that helps you get around this issue. It is called the <code>runtime field</code>! </p>

<p><strong>What is <code>runtime</code>?</strong><br>
A <code>runtime</code> is that moment in time when Elasticsearch is executing your requests. During <code>runtime</code>, you can actually create a temporary field and calculate a value within it. This field then can be used to run whatever request that was sent during runtime. </p>

<p>This may sound very abstract to you at this point so let’s break this down.</p>

<p>For our last feature, the missing ingredient is the field "total". We must calculate the total by multiplying the values of the fields "quantity" and "unit_price". </p>

<p>Right now the field "total" does not exist in our dataset so we cannot aggregate on this field. </p>

<p>What we are going to do is to create a <code>runtime field</code> called "total" and add it to the <code>mapping</code> of the existing index. </p>

<p><strong>Step 1: Create a runtime field and add it to the mapping of the existing index.</strong> </p>

<p><strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">Enter</span><span class="o">-</span><span class="nx">name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_mapping</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">runtime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Name-your-runtime-field-here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Specify-field-type-here</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Specify the formula you want executed</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The following request asks Elasticsearch to create a <code>runtime field</code> called "total" and add it to the mapping of <code>produce_v2</code> index. </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--pYSghArJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6jhoa0wbl5i7pbjepv5p.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--pYSghArJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6jhoa0wbl5i7pbjepv5p.png" alt="image" loading="lazy"></a></p>

<p>The <code>runtime</code> field(1) is created only when a user runs a request against this field. </p>

<p>We know that the field "total"(2) will contain decimal points so we will set the field "type" to "double"(3). </p>

<p>In the "script"(4), we write out the formula to calculate the value for the field "total". The "script" instructs Elasticsearch to do the following(5): For each document, multiply the value of the field "unit_price" by the value of the field "quantity".</p>

<p>Copy and paste the following example into the Kibana console and send the request!</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">runtime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">total</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">double</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">emit(doc['unit_price'].value* doc['quantity'].value)</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong> <br>
Elasticsearch successfully adds the <code>runtime field</code> to the mapping. <br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jHyCRCsw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121744031-8393d500-cabf-11eb-850c-2e13cf79a92a.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jHyCRCsw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121744031-8393d500-cabf-11eb-850c-2e13cf79a92a.png" alt="image" loading="lazy"></a></p>

<p><strong>Step 2: Check the mapping:</strong><br>
Let's check the mapping of the <code>produce_v2</code> index by sending the following request.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Expected response from Elasticsearch:</strong><br>
Elasticsearch adds a <code>runtime field</code> to the mapping(red box).  </p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--vrDE1lX9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yi1u4cpx7gl65udiuvr3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--vrDE1lX9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yi1u4cpx7gl65udiuvr3.png" alt="image" loading="lazy"></a></p>

<p>Note that the <code>runtime field</code> is not listed under "properties" object which includes the fields in our documents. This is because the <code>runtime field</code> "total" is not indexed! </p>

<p><strong>The <code>runtime field</code> is only created and calculated at <code>runtime</code> as you execute your request!</strong></p>

<p>Remember, our indexed documents do not have a field "total". But by adding a <code>runtime field</code> to our <code>mapping</code>, we are leaving some instructions for Elasticsearch.</p>

<p>The <code>mapping</code> tells Elasticsearch that if it were to receive a request on the field "total", it should create a temporary field called "total" for each document and calculate its value by running the "script". Then, run the request on the field "total" and send the results to the user.</p>

<p><strong>Step 3: Run a request on the <code>runtime field</code> to see it perform its magic!</strong> <br>
Let's put <code>runtime field</code> to the test. </p>

<p>We are going to send the following request to perform a sum aggregation on the <code>runtime field</code> "total". </p>

<p>Note that the following request does not aggregate the monthly expense here. We are running a simple aggregation request to demonstrate how the <code>runtime field</code> works!  </p>

<p><strong>Syntax:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Enter_name_of_the_index_here</span><span class="o">/</span><span class="nx">_search</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">aggs</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Name your aggregations here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">Specify the aggregation type here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name the field you want to aggregate on here</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The following request runs a sum aggregation against the <code>runtime field</code> "total" over all documents in our index.</p>

<p><strong>Example:</strong><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_search</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">aggs</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">total_expense</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">sum</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">total</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Copy and paste the example into the Kibana console and send the request!</p>

<p><strong>Expected response from Elasticsearch:</strong><br>
When this request is sent, a <code>runtime field</code> called "total" is created and calculated for documents within the scope of our request(entire index). Then, the sum aggregation is ran on the field "total" over all documents in our index.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--vaaDp2NN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121815555-50268700-cc34-11eb-8fb4-8112cb8e0806.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--vaaDp2NN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121815555-50268700-cc34-11eb-8fb4-8112cb8e0806.png" alt="image" loading="lazy"></a></p>

<p><strong>What are some of the benefits of using the <code>runtime field</code>?</strong><br>
The <code>runtime field</code> is only created and calculated when a request made on the <code>runtime field</code> is being executed. <code>Runtime fields</code> are not indexed so these do not take up disk space.  </p>

<p>We also did not have to reindex in order to add a new field to existing documents. For more information on runtime fields, check out this <a href="https://www.elastic.co/blog/introducing-elasticsearch-runtime-fields">blog</a>! </p>

<p>There you have it. You have now mastered the basics of <code>mapping</code>! </p>

<p><a href="https://i.giphy.com/media/qLHzYjlA2FW8g/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/qLHzYjlA2FW8g/giphy.gif" alt="image" loading="lazy"></a></p>

<p>Play around with <code>mapping</code> on your own and come up with the optimal <code>mapping</code> for your use case! </p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/lisahjung/beginner-s-guide-understanding-mapping-with-elasticsearch-and-kibana-3646" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(s,e,a,n,t){return a.type_of="article",a.id=791151,a.title="[Beginner's guide] Understanding mapping with Elasticsearch and Kibana",a.description="Have you ever encountered the error “Field type is not supported for [whatever you are trying to do...",a.readable_publish_date="Aug 13 '21",a.slug="beginner-s-guide-understanding-mapping-with-elasticsearch-and-kibana-3646",a.path="/lisahjung/beginner-s-guide-understanding-mapping-with-elasticsearch-and-kibana-3646",a.url=n,a.comments_count=0,a.public_reactions_count=83,a.collection_id=s,a.published_timestamp=e,a.positive_reactions_count=83,a.cover_image=s,a.social_image="https://dev.to/social_previews/article/791151.png",a.canonical_url=n,a.created_at="2021-08-13T18:12:23Z",a.edited_at="2021-08-13T20:08:48Z",a.crossposted_at=s,a.published_at=e,a.last_comment_at=e,a.reading_time_minutes=26,a.tag_list="beginners, elasticsearch, database, datascience",a.tags=["beginners","elasticsearch","database","datascience"],a.body_html='<p>Have you ever encountered the error “Field type is not supported for [whatever you are trying to do with Elasticsearch]”?</p>\n\n<p><a href="https://i.giphy.com/media/HaR4OfLvNtHqr4TwB9/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/HaR4OfLvNtHqr4TwB9/giphy.gif" alt="image" loading="lazy"></a></p>\n\n<p>The most likely culprit of this error is the <code>mapping</code> of your index!</p>\n\n<p><code>Mapping</code> is the process of defining how a document and its fields are indexed and stored. It defines the type and format of the fields in the documents. As a result, <code>mapping</code> can significantly affect how Elasticsearch searches and stores data.</p>\n\n<p>Understanding how <code>mapping</code> works will help you define <code>mapping</code> that best serves your use case.</p>\n\n<p>By the end of this blog, you will be able to define what a <code>mapping</code> is and customize your own <code>mapping</code> to make indexing and searching more efficient. </p>\n\n<h2>\n  <a name="prerequisite-work" href="#prerequisite-work">\n  </a>\n  Prerequisite work\n</h2>\n\n<p>Watch this <a href="https://www.youtube.com/watch?v=CCTgroOcyfM">video</a> from time stamp 14:28-19:00. This video will show you how to complete steps 1 and 2.</p>\n\n<ol>\n<li>Set up Elasticsearch and Kibana* </li>\n<li>Open the Kibana console(AKA Dev Tools)\n</li>\n<li>Keep two windows open side by side(this blog and the Kibana console)</li>\n</ol>\n\n<p>We will be sending requests from Kibana to Elasticsearch to learn how <code>mapping</code> works! </p>\n\n<p><strong>Note</strong><br>\nIf you would rather download Elasticsearch and Kibana on your own machine, follow the steps outlined in <a href="https://dev.to/elastic/downloading-elasticsearch-and-kibana-macos-linux-and-windows-1mmo">Downloading Elasticsearch and Kibana(macOS/Linux and Windows)</a>. </p>\n<h2>\n  <a name="additional-resources" href="#additional-resources">\n  </a>\n  Additional Resources\n</h2>\n\n<p>Interested in beginner friendly workshops on Elasticsearch and Kibana? Check out my Beginner\'s Crash Course to Elastic Stack series!</p>\n\n<p>1) <a href="https://www.youtube.com/watch?v=FQAHDrVwfok&amp;list=PL_mJOmq4zsHZYAyK606y7wjQtC0aoE6Es&amp;index=5&amp;t=598s">Part 5 Workshop Recording</a></p>\n\n<p>This blog is a complementary blog to Part 5 of the Beginner\'s Crash Course to Elastic Stack. If you prefer learning by watching videos instead, check out the recording!</p>\n\n<p>2) <a href="https://github.com/LisaHJung/Beginners-Crash-Course-to-the-Elastic-Stack-Series">Beginner\'s Crash Course to Elastic Stack Table of Contents</a></p>\n\n<p>This table of contents includes repos from all workshops in the series. Each repo includes resources shared during the workshop including the video recording, presentation slides, related blogs, Elasticsearch requests and more!</p>\n<h2>\n  <a name="what-is-a-mapping" href="#what-is-a-mapping">\n  </a>\n  What is a Mapping?\n</h2>\n\n<p>Imagine you are building an app that requires you to store and search data. Naturally, you will want to store data using the smallest disk space while maximizing your search performance. </p>\n\n<p>This is where <code>mapping</code> comes into play! </p>\n\n<p><code>Mapping</code> defines how a document and its fields are indexed and stored. </p>\n\n<p>It does that by defining field types. Depending on its type, the fields are stored and indexed accordingly. </p>\n\n<p>Learning how to define your own mapping will help you:</p>\n\n<ol>\n<li>optimize the performance of Elasticsearch</li>\n<li>save disk space</li>\n</ol>\n\n<p>Before we delve into mapping, let\'s review a few concepts!</p>\n<h2>\n  <a name="review-from-previous-blogs" href="#review-from-previous-blogs">\n  </a>\n  Review from previous blogs\n</h2>\n\n<p>In the previous blogs, we learned how to <a href="https://dev.to/lisahjung/beginner-s-guide-to-running-queries-with-elasticsearch-and-kibana-4kn9">query</a> and <a href="https://dev.to/lisahjung/beginner-s-guide-running-aggregations-with-elasticsearch-and-kibana-16bn">aggregate</a> data to gain insights.   </p>\n\n<p>But before we could run queries or aggregations, we had to first add data to Elasticsearch. </p>\n\n<p>Let’s say we are creating an app for a produce warehouse. You want to store data about produce in Elasticsearch so you can search for it.</p>\n\n<p>In Elasticsearch, data is stored as documents. A document is a JSON object that contains whatever data you want to store in Elasticsearch. </p>\n\n<p>Take a look at the following document about a produce item. In a JSON object, it contains a list of fields such as "name", "botanical_name", "produce_type" and etc. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s---0gxBB-V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121580744-55909100-c9ea-11eb-98fe-8c8491b0a7a1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---0gxBB-V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121580744-55909100-c9ea-11eb-98fe-8c8491b0a7a1.png" alt="image" loading="lazy"></a></p>\n\n<p>When you take a closer look at the fields, you will see that each field is of a different JSON data type. </p>\n\n<p>For example, for the field "name", the JSON data type is  string. For the field "quantity", the JSON data type is integer. For the field "preferred_vendor", the JSON data type is boolean. </p>\n<h3>\n  <a name="indexing-a-document" href="#indexing-a-document">\n  </a>\n  Indexing a Document\n</h3>\n\n<p>Let’s say we want to index the document above. We would send the following request.  </p>\n\n<p>For requests we will go over, the syntax is included for you so you can customize this for your own use case. </p>\n\n<p><strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">Enter</span><span class="o">-</span><span class="nx">name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">the</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>But for our tutorial, we will use the example instead. </p>\n\n<p>The following example asks Elasticsearch to create a new index called the <code>temp_index</code>, then index the following document into it. </p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">temp_index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the console and send the request. </p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch will confirm that this document has been successfully indexed into the <code>temp_index</code>. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MwOSSYFi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120387213-d5ca3e80-c2e6-11eb-8ca8-731222174724.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MwOSSYFi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120387213-d5ca3e80-c2e6-11eb-8ca8-731222174724.png" alt="image" loading="lazy"></a></p>\n\n<p>What we have covered so far is a review from previous blogs. What we have not gone over is what actually goes on behind the scenes when you index a document. </p>\n\n<p>This is where <code>mapping</code> comes into play!</p>\n<h2>\n  <a name="mapping-explained" href="#mapping-explained">\n  </a>\n  Mapping Explained\n</h2>\n\n<p><code>Mapping</code> determines how a document and its fields are indexed and stored by defining the type of each field.  </p>\n\n<p>The <code>mapping</code> of an index look something like the following:<br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BzRbQ4lJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121219417-e7f53100-c840-11eb-9848-7acb3df84227.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BzRbQ4lJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121219417-e7f53100-c840-11eb-9848-7acb3df84227.png" alt="image" loading="lazy"></a></p>\n\n<p>It contains a list of the names and types of fields in an index. Depending on its type, each field is indexed and stored differently in Elasticsearch.  </p>\n\n<p>Therefore, <code>mapping</code> plays an important role in how Elasticsearch stores and searches for data. </p>\n<h3>\n  <a name="dynamic-mapping" href="#dynamic-mapping">\n  </a>\n  Dynamic Mapping\n</h3>\n\n<p>In the previous request we sent, we had created a new index called the <code>temp_index</code>, then we indexed a document into it. </p>\n\n<p><code>Mapping</code> determines how a document and its fields should be indexed and stored. But we did not define the <code>mapping</code> ahead of time. </p>\n\n<p>So how did this document get indexed?</p>\n\n<p><a href="https://i.giphy.com/media/Qe5oD5aXjEbKw/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/Qe5oD5aXjEbKw/giphy.gif" alt="image" loading="lazy"></a></p>\n\n<p>When a user does not define the <code>mapping</code> in advance, Elasticsearch creates or updates the <code>mapping</code> as needed by default. This is known as <code>dynamic mapping</code>. </p>\n\n<p>Take a look at the following diagram. It illustrates what happens when a user asks Elasticsearch to create a new index without defining the <code>mapping</code> ahead of time.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--JAOmmV2p--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121590398-83c79e00-c9f5-11eb-95f8-e32654447359.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--JAOmmV2p--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121590398-83c79e00-c9f5-11eb-95f8-e32654447359.png" alt="image" loading="lazy"></a></p>\n\n<p>When a user does not define the <code>mapping</code> in advance, Elasticsearch creates or updates the <code>mapping</code> as needed by default. This is known as <code>dynamic mapping</code>. </p>\n\n<p>With <code>dynamic mapping</code>, Elasticsearch looks at each field and tries to infer the data type from the field content. Then, it assigns a type to each field and creates a list of field names and types known as <code>mapping</code>.  </p>\n\n<p>Depending on the assigned field type, each field is indexed and primed for different types of requests(full text search, aggregations, sorting). This is why <code>mapping</code> plays an important role in how Elasticsearch stores and searches for data. </p>\n<h3>\n  <a name="view-the-mapping" href="#view-the-mapping">\n  </a>\n  View the Mapping\n</h3>\n\n<p>Now that we have indexed a document without defining the mapping in advance, let\'s take a look at the <code>dyanmic mapping</code> that Elasticsearch has created for us. </p>\n\n<p>To view the <code>mapping</code> of an index, you send the following request. </p>\n\n<p><strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Enter_name_of_the_index_here</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The following example asks Elasticsearch to retrieve the <code>mapping</code> of the <code>temp_index</code>.</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">temp_index</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the Kibana console and send the request. </p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch returns the <code>mapping</code> of the temp_index. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--SaTY_sio--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121591969-5c71d080-c9f7-11eb-95dc-70f04276929a.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--SaTY_sio--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121591969-5c71d080-c9f7-11eb-95dc-70f04276929a.png" alt="image" loading="lazy"></a><br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cL9zSof8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592051-76131800-c9f7-11eb-8820-d3d2b39e1e4f.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cL9zSof8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592051-76131800-c9f7-11eb-8820-d3d2b39e1e4f.png" alt="image" loading="lazy"></a><br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cT6_vEpE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592106-83c89d80-c9f7-11eb-97fc-56d23b0242ae.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cT6_vEpE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121592106-83c89d80-c9f7-11eb-97fc-56d23b0242ae.png" alt="image" loading="lazy"></a></p>\n\n<p>It lists all the fields of the document in an alphabetical order and lists the type of each field(text, keyword, long, float, date, boolean and etc). These are a few of many field types that are recognized by Elasticsearch. For the list of all field types, click <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">here</a>!</p>\n\n<p>At a first glance, this <code>mapping</code> may look really complicated. Rest assured. We are going to break this down into bite sized pieces! </p>\n\n<p>Depending on what your use case is, the <code>mapping</code> can be customized to make storage and indexing more efficient.</p>\n\n<p>The rest of the blog will cover what type of <code>mapping</code> is best for different types of requests. Then, we will learn how to define our own <code>mapping</code>!</p>\n<h3>\n  <a name="indexing-strings" href="#indexing-strings">\n  </a>\n  Indexing Strings\n</h3>\n\n<p>Let\'s take a look at our document again.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--QCKYOU1n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gus3ibdip5v8ekwneovi.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QCKYOU1n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gus3ibdip5v8ekwneovi.png" alt="image" loading="lazy"></a></p>\n\n<p>Many of these fields such as "botanical_name", "produce_type", and "country_of_origin"(teal box) contain strings. </p>\n\n<p>Let\'s examine the mapping of the string fields "botanical_name","country_of_origin", and "description" below. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Npu1u111--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/u8nglbt98ys7bpr1c89w.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Npu1u111--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/u8nglbt98ys7bpr1c89w.png" alt="image" loading="lazy"></a></p>\n\n<p>You will see that these string fields(orange lines) have been mapped as both <code>text</code> and <code>keyword</code>(green lines) by default. </p>\n\n<p>There are two kinds of string data types:</p>\n\n<ol>\n<li>Text</li>\n<li>Keyword</li>\n</ol>\n\n<p>By default, every string gets mapped twice as a <code>text</code> field and as a <code>keyword</code> multi-field. Each field type is primed for different types of requests. </p>\n\n<p><code>Text</code> field type is designed for full-text searches. One of the benefits of full text search is that you can search for individual terms in a non-case sensitive manner. </p>\n\n<p><code>Keyword</code> field type is designed for exact searches, aggregations, and sorting. This field type becomes handy when you are searching for original strings. </p>\n\n<p>Depending on what type of request you want to run on each field, you can assign the field type as either <code>text</code> or <code>keyword</code> or both! </p>\n\n<p>Let\'s delve into <code>text</code> field type first.</p>\n<h4>\n  <a name="text-field-type" href="#text-field-type">\n  </a>\n  Text Field Type\n</h4>\n<h5>\n  <a name="text-analysis" href="#text-analysis">\n  </a>\n  Text Analysis\n</h5>\n\n<p>Ever notice that when you search in Elasticsearch, it is not case sensitive or the punctuation does not seem to matter? This is because <code>text analysis</code> occurs when your fields are indexed. </p>\n\n<p>The diagram below illustrates how the string "These pineapples are sourced from New Zealand." would be analyzed in Elasticsearch. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--8nnBpRhW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120847933-672cf100-c531-11eb-9b9c-522c354b0e10.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--8nnBpRhW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/120847933-672cf100-c531-11eb-9b9c-522c354b0e10.png" alt="image" loading="lazy"></a></p>\n\n<p>By default, strings are analyzed when it is indexed. When the string is analyzed, the string is broken up into individual words also known as tokens. The analyzer further lowercases each token and removes punctuations. </p>\n\n<p><strong>Inverted Index</strong><br>\nTake a look at the following request shown in the diagram. It asks Elasticsearch to index a document with the field "description" and assign the document an id of 1. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--w1Aq__c3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121099236-b33b9800-c7b4-11eb-837b-a914ed8e3725.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--w1Aq__c3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121099236-b33b9800-c7b4-11eb-837b-a914ed8e3725.png" alt="image" loading="lazy"></a></p>\n\n<p>When this request is sent, Elasticsearch will look at the field "description" and see that this field contains a string. Therefore, it will map the field "description" as both <code>text</code> and <code>keyword</code> by default. </p>\n\n<p>When a field is mapped as type <code>text</code>, the content of the field passes through an analyzer.</p>\n\n<p>Once the string is analyzed, the individual tokens are stored in a sorted list known as the <code>inverted index</code>(see table above). Each unique token is stored in an <code>inverted index</code> with its associated ID(red numbers in the table above). </p>\n\n<p>The same process occurs every time you index a new document. </p>\n\n<p>Let\'s say we indexed a new document with identical content as document 1. But we gave this document an id of 2(pink box).</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--_HfqpQuo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119940-0d58e080-cde7-11eb-903b-54a628b8de60.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_HfqpQuo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119940-0d58e080-cde7-11eb-903b-54a628b8de60.png" alt="image" loading="lazy"></a><br>\nThe content of the field "description" will go through the same process where it is split into individual tokens. However, if these tokens already exist in the <code>inverted index</code>, only the document IDs are updated(red numbers in the table above).</p>\n\n<p>Look at the diagram below. If we add another document with an id of 3(pink box) with one new token(red box), then the new token(caledonia)is added to the <code>inverted index</code>. Also, the doc ids are updated for existing tokens(red numbers in the table below).</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--PfCgBGwC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119962-147fee80-cde7-11eb-915e-3531c405a315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--PfCgBGwC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119962-147fee80-cde7-11eb-915e-3531c405a315.png" alt="image" loading="lazy"></a></p>\n\n<p>This is what happens in the background when you index fields that are typed as <code>text</code>.  </p>\n\n<p>Fields that are assigned the type <code>text</code> are optimal for full text search.</p>\n\n<p>Take a look at this diagram below. The client is asking to fetch all documents containing the terms "new" or "zealand". </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--csXIINUT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119979-19dd3900-cde7-11eb-86e4-274b5e44fec2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--csXIINUT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122119979-19dd3900-cde7-11eb-86e4-274b5e44fec2.png" alt="image" loading="lazy"></a></p>\n\n<p>When this request is sent, Elasticsearch does not read through every document for the search terms. It goes straight to the <code>inverted index</code> to look up the search terms, finds the matching document ids and sends the ids back to the user. </p>\n\n<p>The <code>inverted index</code> is the reason Elasticsearch is able to search with speed.</p>\n\n<p>Moreover, since all the terms in the <code>inverted index</code> are lowercase and your search queries are also analyzed, you can search for things in a non-case sensitive manner, and still get the same results.</p>\n\n<p>Let\'s do another review. </p>\n\n<p>Take a look at the diagram below. We send three requests to index three documents. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--tJbGfbze--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120075-324d5380-cde7-11eb-9b4e-744dfa6d527d.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--tJbGfbze--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120075-324d5380-cde7-11eb-9b4e-744dfa6d527d.png" alt="image" loading="lazy"></a></p>\n\n<p>Each document has a field called "country" with a string value. By default, the field "country" is mapped twice as text(teal arrow) and keyword(yellow arrow). </p>\n\n<p><code>Text</code> fields(teal arrow) are analyzed and the tokens are stored in an <code>inverted index</code>(teal table). This is great for full text search but it is not optimized for performing aggregations, sorting or exact searches. </p>\n\n<p>For the types of actions mentioned above, Elasticsearch depends on the <code>keyword</code> field(yellow arrow). </p>\n\n<p>When a <code>keyword</code> field(yellow arrow) is created, the content of the field is not analyzed and is not stored in an inverted index. </p>\n\n<p>Instead, <code>keyword</code> field uses a data structure called <code>doc values</code>(yellow table) to store data.  </p>\n<h4>\n  <a name="keyword-field-type" href="#keyword-field-type">\n  </a>\n  Keyword Field Type\n</h4>\n\n<p><code>Keyword</code> field type is used for aggregations, sorting, and exact searches. These actions look up the document ID to find the values it has in its fields. </p>\n\n<p><code>Keyword</code> field is suited to perform these actions because it uses a data structure called <code>doc values</code> to store data. </p>\n\n<p>Take a look at the diagram below that illustrates <code>doc values</code>. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KPx91tzn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121603436-fccef180-ca05-11eb-817e-cb77b46ae969.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KPx91tzn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121603436-fccef180-ca05-11eb-817e-cb77b46ae969.png" alt="image" loading="lazy"></a></p>\n\n<p>For each document, the document id along with the field value(the original string) are added to a table. This data structure(<code>doc values</code>) is designed for actions that require looking up the document ID to find the values it has in its fields. Therefore, the fields that are typed as <code>keyword</code> are best suited for actions such as aggregations, sorting, and exact searches.  </p>\n\n<p>When Elasticsearch dynamically creates a <code>mapping</code> for you, it does not know what you want to use a string for. As a result, Elasticsearch maps all strings to both field types(<code>text</code> and <code>keyword</code>). </p>\n\n<p>In cases where you do not need both field types, the default setting is wasteful. Since both field types require creating either an <code>inverted index</code> or <code>doc values</code>, creating both field types for unnecessary fields will slow down indexing and take up more disk space.  </p>\n\n<p>This is why we define our own <code>mapping</code> as it helps us store and search data more efficiently. </p>\n\n<p>Doing so takes more planning because we need to decide what type of requests we want to run on these fields. The decisions we make will allow us to designate which string fields will:</p>\n\n<ul>\n<li>only be full text searchable or</li>\n<li>only be used in aggregation or </li>\n<li>be able to support both options </li>\n</ul>\n<h3>\n  <a name="mapping-exercise" href="#mapping-exercise">\n  </a>\n  Mapping Exercise\n</h3>\n\n<p>Now that we understand the field types <code>text</code> and <code>keyword</code>, let’s go over how we can optimize our <code>mapping</code>. </p>\n\n<p>To do so, we are going to do an exercise! </p>\n\n<p><strong>Project</strong>: Build an app for a client who manages a produce warehouse </p>\n\n<p><strong>This app must enable users to:</strong> </p>\n\n<ol>\n<li>search for produce name, country of origin and description</li>\n<li>identify top countries of origin with the most frequent purchase history</li>\n<li>sort produce by produce type(fruit or vegetable)</li>\n<li>get the summary of monthly expense</li>\n</ol>\n\n<p><strong>Goals</strong></p>\n\n<ol>\n<li>Figure out the optimal <code>mapping</code> for desired features</li>\n<li>Create an index with the optimal <code>mapping</code> and index documents into it</li>\n<li>Learn how you should approach a situation that requires changing the <code>mapping</code> of an existing field</li>\n<li>Learn how to use the <code>runtime field</code>\n</li>\n</ol>\n\n<p>The following is a sample document we will be working with for this exercise. Pay attention to the field names as these field names will come up frequently during this exercise! </p>\n\n<p><strong>Sample data</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Plan of Action</strong><br>\nThe figures below outline the plan of action for each feature requested by the client. Explanations regarding each bullet point are provided in the blog.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>\n\n<p>The first feature allows the user to search for produce name, country of origin and description. </p>\n\n<p>Let\'s take a look at the sample document shared with you earlier.</p>\n\n<p><strong>Sample data</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The first feature involves working with the fields "name", "country_of_origin", and "description"(first bullet point in the figure below). </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>\n\n<p>All of these fields contain strings. By default, these fields will get mapped twice as <code>text</code> and <code>keyword</code>. </p>\n\n<p>Let’s see if we need both field types. </p>\n\n<p>Our client wants to search on these fields. But it is unlikely that the user will send search terms that are exactly the way it is written in our documents. </p>\n\n<p>So the user should be able to run a search for individual terms in a non-case sensitive manner. Therefore, the fields "name", "country_of_origin" and "description" should be full text searchable(second bullet point in the figure below). </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5-o68DbX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png" alt="image" loading="lazy"></a></p>\n\n<p>Let’s say our client does not want to run aggregation, sorting, or exact searches on the fields "name" and "description"(third bullet point in the figure above). </p>\n\n<p>For these fields, we do not need the <code>keyword</code> type. To avoid mapping these fields twice, we will specify that we only want the <code>text</code> type for these fields(blue bullet point in the figure above). </p>\n\n<p>At this point, we know that the field "country_of_origin" should be full text searchable(<code>text</code>). But it is unclear whether we will need aggregation, sorting, or exact searches to be performed on this field(fourth bullet point in the figure above). </p>\n\n<p>Let’s leave that for now. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--s9Y3lGiZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120548-cc150080-cde7-11eb-8613-a4ec5a5c115e.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--s9Y3lGiZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122120548-cc150080-cde7-11eb-8613-a4ec5a5c115e.png" alt="image" loading="lazy"></a></p>\n\n<p>If you look at the second feature, the user should be able to identify top countries of origin with the most frequent purchase history.</p>\n\n<p>This feature involves the field "country_of_origin"(first bullet point in the figure above). </p>\n\n<p>For this type of request, we need to run the terms aggregations on this field(second bullet point in the figure above), which means that we need a <code>keyword</code> field.</p>\n\n<p>Since we need to perform full text search(first feature) and aggregations(second feature) on this field, we will map this field twice as <code>text</code> and <code>keyword</code>(third bullet point in the figure above). </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Z1xdC8X7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121604184-4c61ed00-ca07-11eb-84f8-208c3e927a08.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Z1xdC8X7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121604184-4c61ed00-ca07-11eb-84f8-208c3e927a08.png" alt="image" loading="lazy"></a></p>\n\n<p>The third feature allows the user to sort by produce type. This feature involves the field "produce_type" which contains a string(first bullet point in the figure above).  </p>\n\n<p>Since this feature requires sorting(second bullet point in the figure above), we need a <code>keyword</code> type for this field.  </p>\n\n<p>Let’s say the client does not want to run a full text search for this field. </p>\n\n<p>As a result, we will need to map this field as <code>keyword</code> type only(third bullet point in the figure above). </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" alt="image" loading="lazy"></a></p>\n\n<p>The fourth feature allows the user to get the summary of monthly expense.</p>\n\n<p>This feature involves the fields "date_purchased", "quantity", and "unit_price"(first bullet point in the figure above).</p>\n\n<p>So let’s break this down.</p>\n\n<p>This feature requires splitting the data into monthly buckets. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" alt="image" loading="lazy"></a></p>\n\n<p>Then, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" alt="image" loading="lazy"></a></p>\n\n<p>The next diagram shows you the April bucket. The documents of all produce purchased during April are included in this bucket. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" alt="image" loading="lazy"></a></p>\n\n<p>Let\'s zoom in on one of the documents to look at its fields(json object highlighted with pink lines). </p>\n\n<p>You will notice that our documents do not have a field called "total".</p>\n\n<p>However, we do have fields called "quantity" and "unit_price"(pink box). </p>\n\n<p>In order to get the total for each document, we need to multiply the values of the fields "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense.</p>\n\n<p>The following figure shows the summary of optimal <code>mapping</code> for all string fields that we have just discussed. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--4lgkPeuy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100826-d972c080-cdd0-11eb-995c-048e6709ef57.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4lgkPeuy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100826-d972c080-cdd0-11eb-995c-048e6709ef57.png" alt="image" loading="lazy"></a></p>\n\n<p>Take a look at the first bullet point in the figure above. It states that for the fourth feature, we need to calculate the total for each produce so it can be used to calculate the monthly expense.</p>\n\n<p>The second bullet point in the figure outlines the additional step we are going to take to make our <code>mapping</code> more efficient. </p>\n\n<p>The following is the reason why we are disabling the field "botanical_name" and the object "vendor_details"(second bullet point).</p>\n\n<p>Our document contains multiple fields. </p>\n\n<p><strong>Sample data</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>After going through each feature, we know that the string field "botanical_name" and the object "vendor_details" will not be used.</p>\n\n<p>Since we do not need the <code>inverted index</code> or the <code>doc values</code> of these fields, we are going to disable these fields. This in turn prevents the <code>inverted index</code> and the <code>doc values</code> of these fields from being created.</p>\n\n<p>Disabling these fields will help us save disk space and minimize the number of fields in the <code>mapping</code>. </p>\n\n<h3>\n  <a name="defining-your-own-mapping" href="#defining-your-own-mapping">\n  </a>\n  Defining your own mapping\n</h3>\n\n<p>Now that we have thought through the optimal <code>mapping</code>, let’s define our own! </p>\n\n<p>Before we get to that, there are a few rules about <code>mapping</code> you need to know. </p>\n\n<p><strong>Rules</strong></p>\n\n<ol>\n<li>If you do not define a <code>mapping</code> ahead of time, Elasticsearch dynamically creates a <code>mapping</code> for you.</li>\n<li>If you do decide to define your own <code>mapping</code>, you can do so at index creation.</li>\n<li>ONE <code>mapping</code> is defined per index. Once the index has been created, we can only add <em>new</em> fields to a <code>mapping</code>. We CANNOT change the <code>mapping</code> of an <em>existing</em> field. </li>\n<li>If you must change the type of an existing field, you must create a new index with the desired <code>mapping</code>, then reindex all documents into the new index. </li>\n</ol>\n\n<p>We will go over how these rules work as we go over the steps of defining our own <code>mapping</code>! </p>\n\n<p><strong>Step 1: Index a sample document into a test index.</strong><br>\n<strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">test</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The first thing we are going to do is to create a new index called <code>test_index</code> and index a sample document. </p>\n\n<p>The document in the following example is the same sample document we have seen earlier. The sample document must contain the fields that you want to define. These fields must also contain values that map closely to the field types you want. </p>\n\n<p>Copy and paste the following example into the Kibana console and send the request.</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">test_index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nThe <code>test_index</code> is successfully created. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--3EtzMjH1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121616770-c81c6380-ca20-11eb-9f3a-593e61eff319.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--3EtzMjH1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121616770-c81c6380-ca20-11eb-9f3a-593e61eff319.png" alt="image" loading="lazy"></a></p>\n\n<p>By default, Elasticsearch will create a <code>dynamic mapping</code> based on the sample document. </p>\n\n<p>What is the point of step 1?</p>\n\n<p>Earlier in the blog, we have indexed the sample document and viewed the <code>dynamic mapping</code>. If you remember, the <code>mapping</code> for our sample document was pretty lengthy. </p>\n\n<p>Since we do not want to write our optimized <code>mapping</code> from scratch, we are indexing a sample document so that Elasticsearch will create the <code>dynamic mapping</code>. </p>\n\n<p>We will use the <code>dynamic mapping</code> as a template and make changes to it to avoid writing out the whole <code>mapping</code> for our index!</p>\n\n<p><strong>Step 2: View the dynamic mapping</strong> <br>\n<strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Name</span><span class="o">-</span><span class="nx">the</span><span class="o">-</span><span class="nx">index</span><span class="o">-</span><span class="nx">whose</span><span class="o">-</span><span class="nx">mapping</span><span class="o">-</span><span class="nx">you</span><span class="o">-</span><span class="nx">want</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">view</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s view the mapping of the <code>test_index</code> by sending the following request. </p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">test_index</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch will display the <code>dynamic mapping</code> it has created. It lists the fields in an alphabetical order. The sample document is identical to the one we previously indexed into the<code>temp_index</code>. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--mRsEX4Eb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/218zpdhuuzwd65q7xafm.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--mRsEX4Eb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/218zpdhuuzwd65q7xafm.png" alt="image" loading="lazy"></a><br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BmTAbusJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4xtorujpgspurl82n8ut.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BmTAbusJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4xtorujpgspurl82n8ut.png" alt="image" loading="lazy"></a><br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Ge8Pgz18--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rnucdz4c0w53gimjjvph.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Ge8Pgz18--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rnucdz4c0w53gimjjvph.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>Step 3: Edit the mapping</strong><br>\nCopy and paste the entire <code>mapping</code> from step 2 into the Kibana console. Then, make the changes specified below. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--3Baxr-eL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fhj4b12mtwwrrinwvjh.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--3Baxr-eL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fhj4b12mtwwrrinwvjh.png" alt="image" loading="lazy"></a></p>\n\n<p>From the pasted results, remove the "test_index" along with its opening and closing brackets. Then, edit the <code>mapping</code> to satisfy the requirements outlined in the diagram below.   </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--GuTaMoFY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103275-ad0c7380-cdd3-11eb-9a74-babe7442e5b3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--GuTaMoFY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103275-ad0c7380-cdd3-11eb-9a74-babe7442e5b3.png" alt="image" loading="lazy"></a></p>\n\n<p>Your optimized <code>mapping</code> should look like the following: <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--rVJRSp-Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fjn8ljtostx5mk301p1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--rVJRSp-Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fjn8ljtostx5mk301p1.png" alt="image" loading="lazy"></a></p>\n\n<p>You will see that the field "country_of_origin"(2) has been typed as both <code>text</code> and <code>keyword</code>. </p>\n\n<p>The fields "description"(3) and "name"(4) have been typed as <code>text</code> only. </p>\n\n<p>The field field "produce_type"(5) has been typed as <code>keyword</code> only. </p>\n\n<p>In the field "botanical_name"(1), a parameter called "enabled" was added and was set to "false". This prevents the <code>inverted index</code> and <code>doc values</code> from being created for this field. </p>\n\n<p>The same has been done for the object "vendor_details"(6). </p>\n\n<p>The <code>mapping</code> above defines the optimal <code>mapping</code> for all of our desired features except for the one marked a red x in the figure below. </p>\n\n<p>Don\'t worry about the unaddressed feature yet as we are saving this for later! </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oiD5hQf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103954-68350c80-cdd4-11eb-82c4-83b47bc364dc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oiD5hQf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122103954-68350c80-cdd4-11eb-82c4-83b47bc364dc.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>Step 4: Create a new index with the optimized mapping from step 3.</strong> <br>\n<strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">your</span><span class="o">-</span><span class="nx">final</span><span class="o">-</span><span class="nx">index</span>\n<span class="p">{</span>\n  <span class="nx">copy</span> <span class="nx">and</span> <span class="nx">paste</span> <span class="nx">your</span> <span class="nx">optimized</span> <span class="nx">mapping</span> <span class="nx">here</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, we will create a new index called <code>produce_index</code> with the optimized <code>mapping</code> we just worked on. </p>\n\n<p>If you still have the <code>mapping</code> from step 3 in the Kibana console, delete the <code>mapping</code> from the Kibana console. </p>\n\n<p>Then, copy and paste the following example into the Kibana console and send the request!</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_index</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">properties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>\n        <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n          <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>\n          <span class="p">}</span>\n        <span class="p">}</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">long</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">float</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch creates the <code>produce_index</code> with the optimized <code>mapping</code> we defined above! </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--MkIKKa67--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121618138-89d47380-ca23-11eb-96e3-68204da782dc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MkIKKa67--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121618138-89d47380-ca23-11eb-96e3-68204da782dc.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>Step 5: Check the mapping of the new index to make sure the all the fields have been mapped correctly</strong></p>\n\n<p><strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">test</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s check the mapping of the <code>produce_index</code> to make sure that all the fields have been mapped correctly.</p>\n\n<p>Copy and paste the following example into the Kibana console and send the request!</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nCompared to the dynamic mapping, our optimized <code>mapping</code> looks more simple and concise!  </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--oYA1q-nD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eeff2rqq7q1kv9gkrv3c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oYA1q-nD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eeff2rqq7q1kv9gkrv3c.png" alt="image" loading="lazy"></a></p>\n\n<p>The current <code>mapping</code> satisfies the requirements that are marked with green check marks in the figure below.<br><br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--YyN_Xarm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121619679-3879b380-ca26-11eb-9ac9-ed19a52c05c2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YyN_Xarm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121619679-3879b380-ca26-11eb-9ac9-ed19a52c05c2.png" alt="image" loading="lazy"></a></p>\n\n<p>Just by defining our own <code>mapping</code>, we prevented unnecessary <code>inverted index</code> and <code>doc values</code> from being created which saved a lot of disk space. </p>\n\n<p>The type of each field has been customized to serve specific client requests. As a result, we also optimized the performance of Elasticsearch as well!</p>\n\n<p><strong>Step 6: Index your dataset into the new index</strong><br>\nNow that we have created a new index(<code>produce_index</code>) with the optimal <code>mapping</code>, it is time to add data to the <code>produce_index</code>.</p>\n\n<p>For simplicity\'s sake, we will index two documents by sending the following requests.  </p>\n\n<p><em>Index the first document</em><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pineapple</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ananas comosus</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New Zealand</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-06-02T12:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">3.11</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tropical Fruit Growers of New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hugh Rose</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Whangarei, New Zealand</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the Kibana console and send the request!</p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch successfully indexes the first document. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qP7pyVqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621403-5563b600-ca29-11eb-8ee9-83686a937fd2.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qP7pyVqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621403-5563b600-ca29-11eb-8ee9-83686a937fd2.png" alt="image" loading="lazy"></a></p>\n\n<p><em>Index the second document</em><br>\nThe second document has almost identical fields as the first document except that it has an extra field called "organic" set to true!<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_doc</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mango</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Harum Manis</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fruit</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Indonesia</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">organic</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-05-02T07:15:35</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mango Arumanis or Harum Manis is originated from East Java. Arumanis means harum dan manis or fragrant and sweet just like its taste. The ripe Mango Arumanis has dark green skin coated with thin grayish natural wax. The flesh is deep yellow, thick, and soft with little to no fiber. Mango Arumanis is best eaten when ripe.</span><span class="dl">"</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">vendor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ayra Shezan Trading</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">main_contact</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suharto</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">vendor_location</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Binjai, Indonesia</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">preferred_vendor</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the Kibana console and send the request!</p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch successfully indexes the second document. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--kw0uT6n2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621463-73c9b180-ca29-11eb-9849-955b8d7872fb.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--kw0uT6n2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121621463-73c9b180-ca29-11eb-9849-955b8d7872fb.png" alt="image" loading="lazy"></a></p>\n\n<p>Let\'s see what happens to the <code>mapping</code> by sending this request below:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_index</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nThe new field("organic") and its field type(boolean) have been added to the <code>mapping</code>(orange box). This is in line with the rules of <code>mapping</code> we discussed earlier since you can add <em>new</em> fields to the <code>mapping</code>. We just cannot change the <code>mapping</code> of an <em>existing</em> field! </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CjNUVdcU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fk2v520lnbwoprh6x7ry.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--CjNUVdcU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fk2v520lnbwoprh6x7ry.png" alt="image" loading="lazy"></a></p>\n<h4>\n  <a name="what-if-you-do-need-to-make-changes-to-the-existing-field-type" href="#what-if-you-do-need-to-make-changes-to-the-existing-field-type">\n  </a>\n  What if you do need to make changes to the existing field type?\n</h4>\n\n<p>Let\'s say you have added a huge produce dataset to the <code>produce_index</code>. </p>\n\n<p>Then, your client asks for an additional feature where the user can run a full text search on the field "botanical_name".  </p>\n\n<p>This is a dilemma since we disabled the field "botanical_name" when we created the <code>produce_index</code>. </p>\n\n<p><a href="https://i.giphy.com/media/UnyGF7evFkN04X24tI/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/UnyGF7evFkN04X24tI/giphy.gif" alt="image" loading="lazy"></a></p>\n\n<p>What are we to do?</p>\n\n<p>Remember, you CANNOT change the <code>mapping</code> of an <em>existing</em> field. If you do need to make changes to the existing field, you must create a new index with the desired <code>mapping</code>, then reindex all documents into the new index. </p>\n\n<p><strong>STEP 1: Create a new index(produce_v2) with the latest mapping.</strong><br>\nThis step is very similar to what we just did with the <code>test_index</code> and the <code>produce_index</code>. </p>\n\n<p>We are just creating a new index(<code>produce_v2</code>) with a new <code>mapping</code> where we remove the "enabled" parameter from the field "botanical_name" and change its type to "text". </p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_v2</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">properties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">botanical_name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">country_of_origin</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>\n        <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n          <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>\n            <span class="dl">"</span><span class="s2">ignore_above</span><span class="dl">"</span><span class="p">:</span> <span class="mi">256</span>\n          <span class="p">}</span>\n        <span class="p">}</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">date_purchased</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">organic</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">produce_type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">quantity</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">long</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">unit_price</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">float</span><span class="dl">"</span>\n      <span class="p">},</span>\n      <span class="dl">"</span><span class="s2">vendor_details</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span><span class="p">,</span>\n        <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the Kibana console and send the request!</p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch creates a new index(produce_v2) with the latest <code>mapping</code>. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--H8hOfzjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121725821-fb093a80-caa6-11eb-8e76-aa84704fb951.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--H8hOfzjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121725821-fb093a80-caa6-11eb-8e76-aa84704fb951.png" alt="image" loading="lazy"></a></p>\n\n<p>Check the <code>mapping</code> of the <code>produce_v2</code> index by sending the following request. </p>\n\n<p><strong>View the mapping of produce_v2:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nYou will see that the field "botanical_name" has been typed as <code>text</code>(orange box). <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ZUbCxwjz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eg119a3hmcu4cwmosg5p.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ZUbCxwjz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eg119a3hmcu4cwmosg5p.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>STEP 2: Reindex the data from the original index(<code>produce_index</code>) to the one you just created(<code>produce_v2</code>).</strong></p>\n\n<p>We just created a new index(<code>produce_v2</code>) with the desired <code>mapping</code>. The next step is to reindex the data from the <code>produce_index</code> to the <code>produce_v2</code> index. </p>\n\n<p>To do so, we send the following request:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">POST</span> <span class="nx">_reindex</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">produce_index</span><span class="dl">"</span>\n  <span class="p">},</span>\n  <span class="dl">"</span><span class="s2">dest</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">produce_v2</span><span class="dl">"</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The field "source" refers to the original index that contains the dataset we want to reindex. The field "dest"(destination) refers to the new index with the optimized <code>mapping</code>. The example requests for the data to be reindexed to the new index.</p>\n\n<p>Copy and paste the request above into the Kibana console and send the request!</p>\n\n<p><strong>Expected response form Elasticsearch:</strong><br>\nThis request reindexes data from the <code>produce_index</code> to the <code>produce_v2</code> index. The <code>produce_v2</code> index can now be used to run the requests that the client has specified. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--cg9yCB-I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121726550-ee391680-caa7-11eb-89a9-be1d4416e0e3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cg9yCB-I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121726550-ee391680-caa7-11eb-89a9-be1d4416e0e3.png" alt="image" loading="lazy"></a></p>\n<h4>\n  <a name="runtime-field" href="#runtime-field">\n  </a>\n  Runtime Field\n</h4>\n\n<p>We have one last feature to work on! <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jJIQ91Nj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png" alt="image" loading="lazy"></a></p>\n\n<p>Our client wants to be able to get the summary of monthly expense.</p>\n\n<p>This feature requires splitting the data into monthly buckets. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OHyg5YoW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png" alt="image" loading="lazy"></a></p>\n\n<p>Then, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--BVyzYgCI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png" alt="image" loading="lazy"></a></p>\n\n<p>The problem is that our documents do not have a field called "total". However, we do have fields called "quantity" and "unit_price". </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5RpWLaAn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png" alt="image" loading="lazy"></a></p>\n\n<p>In order to get the total for each document, we need to multiply the values of the field "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense. </p>\n\n<p>At this point, you might be thinking we will have to calculate the total and store this in a new field called "total". Then, add the field "total" to the existing documents and run the sum aggregation on this field. </p>\n\n<p>This can get kinda hairy because it involves adding a new field to the existing documents in your index. This requires reindexing your data and starting all over again. </p>\n\n<p>But there is a new feature that helps you get around this issue. It is called the <code>runtime field</code>! </p>\n\n<p><strong>What is <code>runtime</code>?</strong><br>\nA <code>runtime</code> is that moment in time when Elasticsearch is executing your requests. During <code>runtime</code>, you can actually create a temporary field and calculate a value within it. This field then can be used to run whatever request that was sent during runtime. </p>\n\n<p>This may sound very abstract to you at this point so let’s break this down.</p>\n\n<p>For our last feature, the missing ingredient is the field "total". We must calculate the total by multiplying the values of the fields "quantity" and "unit_price". </p>\n\n<p>Right now the field "total" does not exist in our dataset so we cannot aggregate on this field. </p>\n\n<p>What we are going to do is to create a <code>runtime field</code> called "total" and add it to the <code>mapping</code> of the existing index. </p>\n\n<p><strong>Step 1: Create a runtime field and add it to the mapping of the existing index.</strong> </p>\n\n<p><strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">Enter</span><span class="o">-</span><span class="nx">name</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">index</span><span class="o">/</span><span class="nx">_mapping</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">runtime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">Name-your-runtime-field-here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Specify-field-type-here</span><span class="dl">"</span><span class="p">,</span>\n      <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Specify the formula you want executed</span><span class="dl">"</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The following request asks Elasticsearch to create a <code>runtime field</code> called "total" and add it to the mapping of <code>produce_v2</code> index. </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--pYSghArJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6jhoa0wbl5i7pbjepv5p.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--pYSghArJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6jhoa0wbl5i7pbjepv5p.png" alt="image" loading="lazy"></a></p>\n\n<p>The <code>runtime</code> field(1) is created only when a user runs a request against this field. </p>\n\n<p>We know that the field "total"(2) will contain decimal points so we will set the field "type" to "double"(3). </p>\n\n<p>In the "script"(4), we write out the formula to calculate the value for the field "total". The "script" instructs Elasticsearch to do the following(5): For each document, multiply the value of the field "unit_price" by the value of the field "quantity".</p>\n\n<p>Copy and paste the following example into the Kibana console and send the request!</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">PUT</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">runtime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">total</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">double</span><span class="dl">"</span><span class="p">,</span>\n      <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">source</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">emit(doc[\'unit_price\'].value* doc[\'quantity\'].value)</span><span class="dl">"</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong> <br>\nElasticsearch successfully adds the <code>runtime field</code> to the mapping. <br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jHyCRCsw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121744031-8393d500-cabf-11eb-850c-2e13cf79a92a.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jHyCRCsw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121744031-8393d500-cabf-11eb-850c-2e13cf79a92a.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>Step 2: Check the mapping:</strong><br>\nLet\'s check the mapping of the <code>produce_v2</code> index by sending the following request.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_mapping</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nElasticsearch adds a <code>runtime field</code> to the mapping(red box).  </p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--vrDE1lX9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yi1u4cpx7gl65udiuvr3.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--vrDE1lX9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yi1u4cpx7gl65udiuvr3.png" alt="image" loading="lazy"></a></p>\n\n<p>Note that the <code>runtime field</code> is not listed under "properties" object which includes the fields in our documents. This is because the <code>runtime field</code> "total" is not indexed! </p>\n\n<p><strong>The <code>runtime field</code> is only created and calculated at <code>runtime</code> as you execute your request!</strong></p>\n\n<p>Remember, our indexed documents do not have a field "total". But by adding a <code>runtime field</code> to our <code>mapping</code>, we are leaving some instructions for Elasticsearch.</p>\n\n<p>The <code>mapping</code> tells Elasticsearch that if it were to receive a request on the field "total", it should create a temporary field called "total" for each document and calculate its value by running the "script". Then, run the request on the field "total" and send the results to the user.</p>\n\n<p><strong>Step 3: Run a request on the <code>runtime field</code> to see it perform its magic!</strong> <br>\nLet\'s put <code>runtime field</code> to the test. </p>\n\n<p>We are going to send the following request to perform a sum aggregation on the <code>runtime field</code> "total". </p>\n\n<p>Note that the following request does not aggregate the monthly expense here. We are running a simple aggregation request to demonstrate how the <code>runtime field</code> works!  </p>\n\n<p><strong>Syntax:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">Enter_name_of_the_index_here</span><span class="o">/</span><span class="nx">_search</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">aggs</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">Name your aggregations here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">Specify the aggregation type here</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name the field you want to aggregate on here</span><span class="dl">"</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The following request runs a sum aggregation against the <code>runtime field</code> "total" over all documents in our index.</p>\n\n<p><strong>Example:</strong><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight javascript"><code><span class="nx">GET</span> <span class="nx">produce_v2</span><span class="o">/</span><span class="nx">_search</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>\n  <span class="dl">"</span><span class="s2">aggs</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">total_expense</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n      <span class="dl">"</span><span class="s2">sum</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">total</span><span class="dl">"</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Copy and paste the example into the Kibana console and send the request!</p>\n\n<p><strong>Expected response from Elasticsearch:</strong><br>\nWhen this request is sent, a <code>runtime field</code> called "total" is created and calculated for documents within the scope of our request(entire index). Then, the sum aggregation is ran on the field "total" over all documents in our index.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--vaaDp2NN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121815555-50268700-cc34-11eb-8fb4-8112cb8e0806.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--vaaDp2NN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/60980933/121815555-50268700-cc34-11eb-8fb4-8112cb8e0806.png" alt="image" loading="lazy"></a></p>\n\n<p><strong>What are some of the benefits of using the <code>runtime field</code>?</strong><br>\nThe <code>runtime field</code> is only created and calculated when a request made on the <code>runtime field</code> is being executed. <code>Runtime fields</code> are not indexed so these do not take up disk space.  </p>\n\n<p>We also did not have to reindex in order to add a new field to existing documents. For more information on runtime fields, check out this <a href="https://www.elastic.co/blog/introducing-elasticsearch-runtime-fields">blog</a>! </p>\n\n<p>There you have it. You have now mastered the basics of <code>mapping</code>! </p>\n\n<p><a href="https://i.giphy.com/media/qLHzYjlA2FW8g/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/qLHzYjlA2FW8g/giphy.gif" alt="image" loading="lazy"></a></p>\n\n<p>Play around with <code>mapping</code> on your own and come up with the optimal <code>mapping</code> for your use case! </p>\n\n',a.body_markdown='Have you ever encountered the error “Field type is not supported for [whatever you are trying to do with Elasticsearch]”?\n\n![image](https://media.giphy.com/media/HaR4OfLvNtHqr4TwB9/giphy.gif)\n\nThe most likely culprit of this error is the `mapping` of your index!\n\n`Mapping` is the process of defining how a document and its fields are indexed and stored. It defines the type and format of the fields in the documents. As a result, `mapping` can significantly affect how Elasticsearch searches and stores data.\n\nUnderstanding how `mapping` works will help you define `mapping` that best serves your use case.\n\nBy the end of this blog, you will be able to define what a `mapping` is and customize your own `mapping` to make indexing and searching more efficient. \n\n## Prerequisite work\nWatch this [video](https://www.youtube.com/watch?v=CCTgroOcyfM) from time stamp 14:28-19:00. This video will show you how to complete steps 1 and 2.\n\n1. Set up Elasticsearch and Kibana* \n2. Open the Kibana console(AKA Dev Tools)  \n3. Keep two windows open side by side(this blog and the Kibana console)\n\nWe will be sending requests from Kibana to Elasticsearch to learn how `mapping` works! \n\n**Note**\nIf you would rather download Elasticsearch and Kibana on your own machine, follow the steps outlined in [Downloading Elasticsearch and Kibana(macOS/Linux and Windows)](https://dev.to/elastic/downloading-elasticsearch-and-kibana-macos-linux-and-windows-1mmo). \n\n## Additional Resources\nInterested in beginner friendly workshops on Elasticsearch and Kibana? Check out my Beginner\'s Crash Course to Elastic Stack series!\n\n1) [Part 5 Workshop Recording](https://www.youtube.com/watch?v=FQAHDrVwfok&list=PL_mJOmq4zsHZYAyK606y7wjQtC0aoE6Es&index=5&t=598s)\n\nThis blog is a complementary blog to Part 5 of the Beginner\'s Crash Course to Elastic Stack. If you prefer learning by watching videos instead, check out the recording!\n\n2) [Beginner\'s Crash Course to Elastic Stack Table of Contents](https://github.com/LisaHJung/Beginners-Crash-Course-to-the-Elastic-Stack-Series)\n\nThis table of contents includes repos from all workshops in the series. Each repo includes resources shared during the workshop including the video recording, presentation slides, related blogs, Elasticsearch requests and more!\n\n## What is a Mapping?\nImagine you are building an app that requires you to store and search data. Naturally, you will want to store data using the smallest disk space while maximizing your search performance. \n\nThis is where `mapping` comes into play! \n\n`Mapping` defines how a document and its fields are indexed and stored. \n\nIt does that by defining field types. Depending on its type, the fields are stored and indexed accordingly. \n\nLearning how to define your own mapping will help you:\n1. optimize the performance of Elasticsearch\n2. save disk space\n\nBefore we delve into mapping, let\'s review a few concepts!\n\n## Review from previous blogs\nIn the previous blogs, we learned how to [query](https://dev.to/lisahjung/beginner-s-guide-to-running-queries-with-elasticsearch-and-kibana-4kn9) and [aggregate](https://dev.to/lisahjung/beginner-s-guide-running-aggregations-with-elasticsearch-and-kibana-16bn) data to gain insights.   \n\nBut before we could run queries or aggregations, we had to first add data to Elasticsearch. \n\nLet’s say we are creating an app for a produce warehouse. You want to store data about produce in Elasticsearch so you can search for it.\n\nIn Elasticsearch, data is stored as documents. A document is a JSON object that contains whatever data you want to store in Elasticsearch. \n\nTake a look at the following document about a produce item. In a JSON object, it contains a list of fields such as "name", "botanical_name", "produce_type" and etc. \n\n![image](https://user-images.githubusercontent.com/60980933/121580744-55909100-c9ea-11eb-98fe-8c8491b0a7a1.png)\n\nWhen you take a closer look at the fields, you will see that each field is of a different JSON data type. \n\nFor example, for the field "name", the JSON data type is  string. For the field "quantity", the JSON data type is integer. For the field "preferred_vendor", the JSON data type is boolean. \n\n### Indexing a Document\nLet’s say we want to index the document above. We would send the following request.  \n\nFor requests we will go over, the syntax is included for you so you can customize this for your own use case. \n \n**Syntax:** \n```javascript\nPOST Enter-name-of-the-index/_doc\n{\n  "field": "value"\n}\n```\n\nBut for our tutorial, we will use the example instead. \n\nThe following example asks Elasticsearch to create a new index called the `temp_index`, then index the following document into it. \n\n**Example:** \n```javascript\nPOST temp_index/_doc\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n```\nCopy and paste the example into the console and send the request. \n\n**Expected response from Elasticsearch:**\nElasticsearch will confirm that this document has been successfully indexed into the `temp_index`. \n\n![image](https://user-images.githubusercontent.com/60980933/120387213-d5ca3e80-c2e6-11eb-8ca8-731222174724.png)\n\nWhat we have covered so far is a review from previous blogs. What we have not gone over is what actually goes on behind the scenes when you index a document. \n \nThis is where `mapping` comes into play!\n\n## Mapping Explained\n`Mapping` determines how a document and its fields are indexed and stored by defining the type of each field.  \n\nThe `mapping` of an index look something like the following:\n![image](https://user-images.githubusercontent.com/60980933/121219417-e7f53100-c840-11eb-9848-7acb3df84227.png)\n\nIt contains a list of the names and types of fields in an index. Depending on its type, each field is indexed and stored differently in Elasticsearch.  \n\nTherefore, `mapping` plays an important role in how Elasticsearch stores and searches for data. \n\n### Dynamic Mapping\nIn the previous request we sent, we had created a new index called the `temp_index`, then we indexed a document into it. \n\n`Mapping` determines how a document and its fields should be indexed and stored. But we did not define the `mapping` ahead of time. \n\nSo how did this document get indexed?\n\n![image](https://media.giphy.com/media/Qe5oD5aXjEbKw/giphy.gif)\n\nWhen a user does not define the `mapping` in advance, Elasticsearch creates or updates the `mapping` as needed by default. This is known as `dynamic mapping`. \n\nTake a look at the following diagram. It illustrates what happens when a user asks Elasticsearch to create a new index without defining the `mapping` ahead of time.\n \n![image](https://user-images.githubusercontent.com/60980933/121590398-83c79e00-c9f5-11eb-95f8-e32654447359.png)\n\nWhen a user does not define the `mapping` in advance, Elasticsearch creates or updates the `mapping` as needed by default. This is known as `dynamic mapping`. \n\nWith `dynamic mapping`, Elasticsearch looks at each field and tries to infer the data type from the field content. Then, it assigns a type to each field and creates a list of field names and types known as `mapping`.  \n\nDepending on the assigned field type, each field is indexed and primed for different types of requests(full text search, aggregations, sorting). This is why `mapping` plays an important role in how Elasticsearch stores and searches for data. \n\n### View the Mapping \nNow that we have indexed a document without defining the mapping in advance, let\'s take a look at the `dyanmic mapping` that Elasticsearch has created for us. \n\nTo view the `mapping` of an index, you send the following request. \n\n**Syntax:**\n```javascript\nGET Enter_name_of_the_index_here/_mapping\n```\nThe following example asks Elasticsearch to retrieve the `mapping` of the `temp_index`.\n\n**Example:**\n```javascript\nGET temp_index/_mapping\n```\nCopy and paste the example into the Kibana console and send the request. \n\n**Expected response from Elasticsearch:**\nElasticsearch returns the `mapping` of the temp_index. \n\n![image](https://user-images.githubusercontent.com/60980933/121591969-5c71d080-c9f7-11eb-95dc-70f04276929a.png)\n![image](https://user-images.githubusercontent.com/60980933/121592051-76131800-c9f7-11eb-8820-d3d2b39e1e4f.png)\n![image](https://user-images.githubusercontent.com/60980933/121592106-83c89d80-c9f7-11eb-97fc-56d23b0242ae.png)\n\nIt lists all the fields of the document in an alphabetical order and lists the type of each field(text, keyword, long, float, date, boolean and etc). These are a few of many field types that are recognized by Elasticsearch. For the list of all field types, click [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html)!\n\nAt a first glance, this `mapping` may look really complicated. Rest assured. We are going to break this down into bite sized pieces! \n\nDepending on what your use case is, the `mapping` can be customized to make storage and indexing more efficient.\n \nThe rest of the blog will cover what type of `mapping` is best for different types of requests. Then, we will learn how to define our own `mapping`!\n\n### Indexing Strings\nLet\'s take a look at our document again.\n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gus3ibdip5v8ekwneovi.png)\n\nMany of these fields such as "botanical_name", "produce_type", and "country_of_origin"(teal box) contain strings. \n\nLet\'s examine the mapping of the string fields "botanical_name","country_of_origin", and "description" below. \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/u8nglbt98ys7bpr1c89w.png)\n \nYou will see that these string fields(orange lines) have been mapped as both `text` and `keyword`(green lines) by default. \n    \nThere are two kinds of string data types:\n1. Text\n2. Keyword\n\nBy default, every string gets mapped twice as a `text` field and as a `keyword` multi-field. Each field type is primed for different types of requests. \n\n`Text` field type is designed for full-text searches. One of the benefits of full text search is that you can search for individual terms in a non-case sensitive manner. \n\n`Keyword` field type is designed for exact searches, aggregations, and sorting. This field type becomes handy when you are searching for original strings. \n\nDepending on what type of request you want to run on each field, you can assign the field type as either `text` or `keyword` or both! \n\nLet\'s delve into `text` field type first.\n\n#### Text Field Type\n##### Text Analysis\nEver notice that when you search in Elasticsearch, it is not case sensitive or the punctuation does not seem to matter? This is because `text analysis` occurs when your fields are indexed. \n\nThe diagram below illustrates how the string "These pineapples are sourced from New Zealand." would be analyzed in Elasticsearch. \n\n![image](https://user-images.githubusercontent.com/60980933/120847933-672cf100-c531-11eb-9b9c-522c354b0e10.png)\n\nBy default, strings are analyzed when it is indexed. When the string is analyzed, the string is broken up into individual words also known as tokens. The analyzer further lowercases each token and removes punctuations. \n\n**Inverted Index**\nTake a look at the following request shown in the diagram. It asks Elasticsearch to index a document with the field "description" and assign the document an id of 1. \n \n![image](https://user-images.githubusercontent.com/60980933/121099236-b33b9800-c7b4-11eb-837b-a914ed8e3725.png)\n\nWhen this request is sent, Elasticsearch will look at the field "description" and see that this field contains a string. Therefore, it will map the field "description" as both `text` and `keyword` by default. \n\nWhen a field is mapped as type `text`, the content of the field passes through an analyzer.\n\nOnce the string is analyzed, the individual tokens are stored in a sorted list known as the `inverted index`(see table above). Each unique token is stored in an `inverted index` with its associated ID(red numbers in the table above). \n\nThe same process occurs every time you index a new document. \n\nLet\'s say we indexed a new document with identical content as document 1. But we gave this document an id of 2(pink box).\n \n![image](https://user-images.githubusercontent.com/60980933/122119940-0d58e080-cde7-11eb-903b-54a628b8de60.png)\nThe content of the field "description" will go through the same process where it is split into individual tokens. However, if these tokens already exist in the `inverted index`, only the document IDs are updated(red numbers in the table above).\n\nLook at the diagram below. If we add another document with an id of 3(pink box) with one new token(red box), then the new token(caledonia)is added to the `inverted index`. Also, the doc ids are updated for existing tokens(red numbers in the table below).\n   \n![image](https://user-images.githubusercontent.com/60980933/122119962-147fee80-cde7-11eb-915e-3531c405a315.png)\n\nThis is what happens in the background when you index fields that are typed as `text`.  \n\nFields that are assigned the type `text` are optimal for full text search.\n\nTake a look at this diagram below. The client is asking to fetch all documents containing the terms "new" or "zealand". \n\n![image](https://user-images.githubusercontent.com/60980933/122119979-19dd3900-cde7-11eb-86e4-274b5e44fec2.png)\n\nWhen this request is sent, Elasticsearch does not read through every document for the search terms. It goes straight to the `inverted index` to look up the search terms, finds the matching document ids and sends the ids back to the user. \n\nThe `inverted index` is the reason Elasticsearch is able to search with speed.\n\nMoreover, since all the terms in the `inverted index` are lowercase and your search queries are also analyzed, you can search for things in a non-case sensitive manner, and still get the same results.\n\nLet\'s do another review. \n\nTake a look at the diagram below. We send three requests to index three documents. \n\n![image](https://user-images.githubusercontent.com/60980933/122120075-324d5380-cde7-11eb-9b4e-744dfa6d527d.png)\n\nEach document has a field called "country" with a string value. By default, the field "country" is mapped twice as text(teal arrow) and keyword(yellow arrow). \n\n`Text` fields(teal arrow) are analyzed and the tokens are stored in an `inverted index`(teal table). This is great for full text search but it is not optimized for performing aggregations, sorting or exact searches. \n\nFor the types of actions mentioned above, Elasticsearch depends on the `keyword` field(yellow arrow). \n\nWhen a `keyword` field(yellow arrow) is created, the content of the field is not analyzed and is not stored in an inverted index. \n\nInstead, `keyword` field uses a data structure called `doc values`(yellow table) to store data.  \n\n#### Keyword Field Type\n`Keyword` field type is used for aggregations, sorting, and exact searches. These actions look up the document ID to find the values it has in its fields. \n\n`Keyword` field is suited to perform these actions because it uses a data structure called `doc values` to store data. \n\nTake a look at the diagram below that illustrates `doc values`. \n\n![image](https://user-images.githubusercontent.com/60980933/121603436-fccef180-ca05-11eb-817e-cb77b46ae969.png)\n\nFor each document, the document id along with the field value(the original string) are added to a table. This data structure(`doc values`) is designed for actions that require looking up the document ID to find the values it has in its fields. Therefore, the fields that are typed as `keyword` are best suited for actions such as aggregations, sorting, and exact searches.  \n\nWhen Elasticsearch dynamically creates a `mapping` for you, it does not know what you want to use a string for. As a result, Elasticsearch maps all strings to both field types(`text` and `keyword`). \n\nIn cases where you do not need both field types, the default setting is wasteful. Since both field types require creating either an `inverted index` or `doc values`, creating both field types for unnecessary fields will slow down indexing and take up more disk space.  \n\nThis is why we define our own `mapping` as it helps us store and search data more efficiently. \n\nDoing so takes more planning because we need to decide what type of requests we want to run on these fields. The decisions we make will allow us to designate which string fields will:\n- only be full text searchable or\n- only be used in aggregation or \n- be able to support both options \n\n### Mapping Exercise\nNow that we understand the field types `text` and `keyword`, let’s go over how we can optimize our `mapping`. \n\nTo do so, we are going to do an exercise! \n\n**Project**: Build an app for a client who manages a produce warehouse \n\n**This app must enable users to:** \n1. search for produce name, country of origin and description\n2. identify top countries of origin with the most frequent purchase history\n3. sort produce by produce type(fruit or vegetable)\n4. get the summary of monthly expense\n\n**Goals**\n1. Figure out the optimal `mapping` for desired features\n2. Create an index with the optimal `mapping` and index documents into it\n3. Learn how you should approach a situation that requires changing the `mapping` of an existing field\n4. Learn how to use the `runtime field`\n\nThe following is a sample document we will be working with for this exercise. Pay attention to the field names as these field names will come up frequently during this exercise! \n\n**Sample data**\n```javascript\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n```\n**Plan of Action**\nThe figures below outline the plan of action for each feature requested by the client. Explanations regarding each bullet point are provided in the blog.\n\n![image](https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png)\n\nThe first feature allows the user to search for produce name, country of origin and description. \n\nLet\'s take a look at the sample document shared with you earlier.\n\n**Sample data**\n```javascript\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n``` \nThe first feature involves working with the fields "name", "country_of_origin", and "description"(first bullet point in the figure below). \n\n![image](https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png)\n\nAll of these fields contain strings. By default, these fields will get mapped twice as `text` and `keyword`. \n\nLet’s see if we need both field types. \n\nOur client wants to search on these fields. But it is unlikely that the user will send search terms that are exactly the way it is written in our documents. \n\nSo the user should be able to run a search for individual terms in a non-case sensitive manner. Therefore, the fields "name", "country_of_origin" and "description" should be full text searchable(second bullet point in the figure below). \n\n![image](https://user-images.githubusercontent.com/60980933/121710560-f89ee480-ca96-11eb-98c5-ba9a535e4360.png)\n\nLet’s say our client does not want to run aggregation, sorting, or exact searches on the fields "name" and "description"(third bullet point in the figure above). \n\nFor these fields, we do not need the `keyword` type. To avoid mapping these fields twice, we will specify that we only want the `text` type for these fields(blue bullet point in the figure above). \n\nAt this point, we know that the field "country_of_origin" should be full text searchable(`text`). But it is unclear whether we will need aggregation, sorting, or exact searches to be performed on this field(fourth bullet point in the figure above). \n\nLet’s leave that for now. \n\n![image](https://user-images.githubusercontent.com/60980933/122120548-cc150080-cde7-11eb-8613-a4ec5a5c115e.png)\n\nIf you look at the second feature, the user should be able to identify top countries of origin with the most frequent purchase history.\n\nThis feature involves the field "country_of_origin"(first bullet point in the figure above). \n\nFor this type of request, we need to run the terms aggregations on this field(second bullet point in the figure above), which means that we need a `keyword` field.\n\nSince we need to perform full text search(first feature) and aggregations(second feature) on this field, we will map this field twice as `text` and `keyword`(third bullet point in the figure above). \n\n![image](https://user-images.githubusercontent.com/60980933/121604184-4c61ed00-ca07-11eb-84f8-208c3e927a08.png)\n\nThe third feature allows the user to sort by produce type. This feature involves the field "produce_type" which contains a string(first bullet point in the figure above).  \n\nSince this feature requires sorting(second bullet point in the figure above), we need a `keyword` type for this field.  \n\nLet’s say the client does not want to run a full text search for this field. \n\nAs a result, we will need to map this field as `keyword` type only(third bullet point in the figure above). \n\n![image](https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png)\n\nThe fourth feature allows the user to get the summary of monthly expense.\n\nThis feature involves the fields "date_purchased", "quantity", and "unit_price"(first bullet point in the figure above).\n\nSo let’s break this down.\n\nThis feature requires splitting the data into monthly buckets. \n\n![image](https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png)\n\nThen, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. \n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png)\n  \nThe next diagram shows you the April bucket. The documents of all produce purchased during April are included in this bucket. \n\n![image](https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png)\n\nLet\'s zoom in on one of the documents to look at its fields(json object highlighted with pink lines). \n\nYou will notice that our documents do not have a field called "total".\n\nHowever, we do have fields called "quantity" and "unit_price"(pink box). \n\nIn order to get the total for each document, we need to multiply the values of the fields "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense.\n\nThe following figure shows the summary of optimal `mapping` for all string fields that we have just discussed. \n\n![image](https://user-images.githubusercontent.com/60980933/122100826-d972c080-cdd0-11eb-995c-048e6709ef57.png)\n\nTake a look at the first bullet point in the figure above. It states that for the fourth feature, we need to calculate the total for each produce so it can be used to calculate the monthly expense.\n\nThe second bullet point in the figure outlines the additional step we are going to take to make our `mapping` more efficient. \n\nThe following is the reason why we are disabling the field "botanical_name" and the object "vendor_details"(second bullet point).\n\nOur document contains multiple fields. \n\n**Sample data**\n```javascript\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n``` \nAfter going through each feature, we know that the string field "botanical_name" and the object "vendor_details" will not be used.\n \nSince we do not need the `inverted index` or the `doc values` of these fields, we are going to disable these fields. This in turn prevents the `inverted index` and the `doc values` of these fields from being created.\n\nDisabling these fields will help us save disk space and minimize the number of fields in the `mapping`. \n\n### Defining your own mapping\nNow that we have thought through the optimal `mapping`, let’s define our own! \n\nBefore we get to that, there are a few rules about `mapping` you need to know. \n\n**Rules**\n1. If you do not define a `mapping` ahead of time, Elasticsearch dynamically creates a `mapping` for you.\n2. If you do decide to define your own `mapping`, you can do so at index creation.\n3. ONE `mapping` is defined per index. Once the index has been created, we can only add *new* fields to a `mapping`. We CANNOT change the `mapping` of an *existing* field. \n4. If you must change the type of an existing field, you must create a new index with the desired `mapping`, then reindex all documents into the new index. \n\nWe will go over how these rules work as we go over the steps of defining our own `mapping`! \n\n**Step 1: Index a sample document into a test index.**\n**Syntax:**\n```javascript\nPOST Name-of-test-index/_doc\n{\n  "field": "value"\n}\n```\nThe first thing we are going to do is to create a new index called `test_index` and index a sample document. \n\nThe document in the following example is the same sample document we have seen earlier. The sample document must contain the fields that you want to define. These fields must also contain values that map closely to the field types you want. \n\nCopy and paste the following example into the Kibana console and send the request.\n\n**Example:**\n```javascript\nPOST test_index/_doc\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n```\n**Expected response from Elasticsearch:**\nThe `test_index` is successfully created. \n![image](https://user-images.githubusercontent.com/60980933/121616770-c81c6380-ca20-11eb-9f3a-593e61eff319.png)\n\nBy default, Elasticsearch will create a `dynamic mapping` based on the sample document. \n\nWhat is the point of step 1?\n\nEarlier in the blog, we have indexed the sample document and viewed the `dynamic mapping`. If you remember, the `mapping` for our sample document was pretty lengthy. \n\nSince we do not want to write our optimized `mapping` from scratch, we are indexing a sample document so that Elasticsearch will create the `dynamic mapping`. \n\nWe will use the `dynamic mapping` as a template and make changes to it to avoid writing out the whole `mapping` for our index!\n\n**Step 2: View the dynamic mapping** \n**Syntax:**\n```javascript\nGET Name-the-index-whose-mapping-you-want-to-view/_mapping\n```\nLet\'s view the mapping of the `test_index` by sending the following request. \n\n**Example:**\n```javascript\nGET test_index/_mapping\n```\n**Expected response from Elasticsearch:**\nElasticsearch will display the `dynamic mapping` it has created. It lists the fields in an alphabetical order. The sample document is identical to the one we previously indexed into the`temp_index`. \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/218zpdhuuzwd65q7xafm.png)\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4xtorujpgspurl82n8ut.png)\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rnucdz4c0w53gimjjvph.png)\n  \n**Step 3: Edit the mapping**\nCopy and paste the entire `mapping` from step 2 into the Kibana console. Then, make the changes specified below. \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fhj4b12mtwwrrinwvjh.png)\n  \nFrom the pasted results, remove the "test_index" along with its opening and closing brackets. Then, edit the `mapping` to satisfy the requirements outlined in the diagram below.   \n\n![image](https://user-images.githubusercontent.com/60980933/122103275-ad0c7380-cdd3-11eb-9a74-babe7442e5b3.png)\n\nYour optimized `mapping` should look like the following: \n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fjn8ljtostx5mk301p1.png)\n \nYou will see that the field "country_of_origin"(2) has been typed as both `text` and `keyword`. \n\nThe fields "description"(3) and "name"(4) have been typed as `text` only. \n\nThe field field "produce_type"(5) has been typed as `keyword` only. \n\nIn the field "botanical_name"(1), a parameter called "enabled" was added and was set to "false". This prevents the `inverted index` and `doc values` from being created for this field. \n\nThe same has been done for the object "vendor_details"(6). \n\nThe `mapping` above defines the optimal `mapping` for all of our desired features except for the one marked a red x in the figure below. \n\nDon\'t worry about the unaddressed feature yet as we are saving this for later! \n\n![image](https://user-images.githubusercontent.com/60980933/122103954-68350c80-cdd4-11eb-82c4-83b47bc364dc.png)\n\n**Step 4: Create a new index with the optimized mapping from step 3.** \n**Syntax:**\n```javascript\nPUT Name-of-your-final-index\n{\n  copy and paste your optimized mapping here\n}\n```\nNext, we will create a new index called `produce_index` with the optimized `mapping` we just worked on. \n\nIf you still have the `mapping` from step 3 in the Kibana console, delete the `mapping` from the Kibana console. \n\nThen, copy and paste the following example into the Kibana console and send the request!\n\n**Example:** \n```javascript\nPUT produce_index\n{\n  "mappings": {\n    "properties": {\n      "botanical_name": {\n        "enabled": false\n      },\n      "country_of_origin": {\n        "type": "text",\n        "fields": {\n          "keyword": {\n            "type": "keyword"\n          }\n        }\n      },\n      "date_purchased": {\n        "type": "date"\n      },\n      "description": {\n        "type": "text"\n      },\n      "name": {\n        "type": "text"\n      },\n      "produce_type": {\n        "type": "keyword"\n      },\n      "quantity": {\n        "type": "long"\n      },\n      "unit_price": {\n        "type": "float"\n      },\n      "vendor_details": {\n        "enabled": false\n      }\n    }\n  }\n}\n```\n**Expected response from Elasticsearch:**\nElasticsearch creates the `produce_index` with the optimized `mapping` we defined above! \n\n![image](https://user-images.githubusercontent.com/60980933/121618138-89d47380-ca23-11eb-96e3-68204da782dc.png)\n\n**Step 5: Check the mapping of the new index to make sure the all the fields have been mapped correctly**\n\n**Syntax:**\n```javascript\nGET Name-of-test-index/_mapping\n```\nLet\'s check the mapping of the `produce_index` to make sure that all the fields have been mapped correctly.\n\nCopy and paste the following example into the Kibana console and send the request!\n\n**Example:**\n```javascript\nGET produce_index/_mapping\n```\n**Expected response from Elasticsearch:**\nCompared to the dynamic mapping, our optimized `mapping` looks more simple and concise!  \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eeff2rqq7q1kv9gkrv3c.png)\n  \nThe current `mapping` satisfies the requirements that are marked with green check marks in the figure below.  \n![image](https://user-images.githubusercontent.com/60980933/121619679-3879b380-ca26-11eb-9ac9-ed19a52c05c2.png)\n\nJust by defining our own `mapping`, we prevented unnecessary `inverted index` and `doc values` from being created which saved a lot of disk space. \n\nThe type of each field has been customized to serve specific client requests. As a result, we also optimized the performance of Elasticsearch as well!\n\n**Step 6: Index your dataset into the new index**\nNow that we have created a new index(`produce_index`) with the optimal `mapping`, it is time to add data to the `produce_index`.\n\nFor simplicity\'s sake, we will index two documents by sending the following requests.  \n\n*Index the first document*\n\n```javascript\nPOST produce_index/_doc\n{\n  "name": "Pineapple",\n  "botanical_name": "Ananas comosus",\n  "produce_type": "Fruit",\n  "country_of_origin": "New Zealand",\n  "date_purchased": "2020-06-02T12:15:35",\n  "quantity": 200,\n  "unit_price": 3.11,\n  "description": "a large juicy tropical fruit consisting of aromatic edible yellow flesh surrounded by a tough segmented skin and topped with a tuft of stiff leaves.These pineapples are sourced from New Zealand.",\n  "vendor_details": {\n    "vendor": "Tropical Fruit Growers of New Zealand",\n    "main_contact": "Hugh Rose",\n    "vendor_location": "Whangarei, New Zealand",\n    "preferred_vendor": true\n  }\n}\n```\nCopy and paste the example into the Kibana console and send the request!\n\n**Expected response from Elasticsearch:**\nElasticsearch successfully indexes the first document. \n![image](https://user-images.githubusercontent.com/60980933/121621403-5563b600-ca29-11eb-8ee9-83686a937fd2.png)\n\n*Index the second document*\nThe second document has almost identical fields as the first document except that it has an extra field called "organic" set to true!\n```javascript\nPOST produce_index/_doc\n{\n  "name": "Mango",\n  "botanical_name": "Harum Manis",\n  "produce_type": "Fruit",\n  "country_of_origin": "Indonesia",\n  "organic": true,\n  "date_purchased": "2020-05-02T07:15:35",\n  "quantity": 500,\n  "unit_price": 1.5,\n  "description": "Mango Arumanis or Harum Manis is originated from East Java. Arumanis means harum dan manis or fragrant and sweet just like its taste. The ripe Mango Arumanis has dark green skin coated with thin grayish natural wax. The flesh is deep yellow, thick, and soft with little to no fiber. Mango Arumanis is best eaten when ripe.",\n  "vendor_details": {\n    "vendor": "Ayra Shezan Trading",\n    "main_contact": "Suharto",\n    "vendor_location": "Binjai, Indonesia",\n    "preferred_vendor": true\n  }\n}\n```\nCopy and paste the example into the Kibana console and send the request!\n\n**Expected response from Elasticsearch:**\nElasticsearch successfully indexes the second document. \n![image](https://user-images.githubusercontent.com/60980933/121621463-73c9b180-ca29-11eb-9849-955b8d7872fb.png)\n\nLet\'s see what happens to the `mapping` by sending this request below: \n```javascript\nGET produce_index/_mapping\n```\n**Expected response from Elasticsearch:**\nThe new field("organic") and its field type(boolean) have been added to the `mapping`(orange box). This is in line with the rules of `mapping` we discussed earlier since you can add *new* fields to the `mapping`. We just cannot change the `mapping` of an *existing* field! \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fk2v520lnbwoprh6x7ry.png)\n \n#### What if you do need to make changes to the existing field type? \nLet\'s say you have added a huge produce dataset to the `produce_index`. \n\nThen, your client asks for an additional feature where the user can run a full text search on the field "botanical_name".  \n\nThis is a dilemma since we disabled the field "botanical_name" when we created the `produce_index`. \n\n![image](https://media.giphy.com/media/UnyGF7evFkN04X24tI/giphy.gif)\n\nWhat are we to do?\n\nRemember, you CANNOT change the `mapping` of an *existing* field. If you do need to make changes to the existing field, you must create a new index with the desired `mapping`, then reindex all documents into the new index. \n\n**STEP 1: Create a new index(produce_v2) with the latest mapping.**\nThis step is very similar to what we just did with the `test_index` and the `produce_index`. \n\nWe are just creating a new index(`produce_v2`) with a new `mapping` where we remove the "enabled" parameter from the field "botanical_name" and change its type to "text". \n\n**Example:**\n```javascript\nPUT produce_v2\n{\n  "mappings": {\n    "properties": {\n      "botanical_name": {\n        "type": "text"\n      },\n      "country_of_origin": {\n        "type": "text",\n        "fields": {\n          "keyword": {\n            "type": "keyword",\n            "ignore_above": 256\n          }\n        }\n      },\n      "date_purchased": {\n        "type": "date"\n      },\n      "description": {\n        "type": "text"\n      },\n      "name": {\n        "type": "text"\n      },\n      "organic": {\n        "type": "boolean"\n      },\n      "produce_type": {\n        "type": "keyword"\n      },\n      "quantity": {\n        "type": "long"\n      },\n      "unit_price": {\n        "type": "float"\n      },\n      "vendor_details": {\n        "type": "object",\n        "enabled": false\n      }\n    }\n  }\n}\n```\nCopy and paste the example into the Kibana console and send the request!\n\n**Expected response from Elasticsearch:**\nElasticsearch creates a new index(produce_v2) with the latest `mapping`. \n![image](https://user-images.githubusercontent.com/60980933/121725821-fb093a80-caa6-11eb-8e76-aa84704fb951.png)\n\nCheck the `mapping` of the `produce_v2` index by sending the following request. \n\n**View the mapping of produce_v2:**\n```javascript\nGET produce_v2/_mapping\n```\n**Expected response from Elasticsearch:**\nYou will see that the field "botanical_name" has been typed as `text`(orange box). \n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eg119a3hmcu4cwmosg5p.png)\n  \n**STEP 2: Reindex the data from the original index(`produce_index`) to the one you just created(`produce_v2`).**\n\nWe just created a new index(`produce_v2`) with the desired `mapping`. The next step is to reindex the data from the `produce_index` to the `produce_v2` index. \n\nTo do so, we send the following request: \n```javascript\nPOST _reindex\n{\n  "source": {\n    "index": "produce_index"\n  },\n  "dest": {\n    "index": "produce_v2"\n  }\n}\n```\nThe field "source" refers to the original index that contains the dataset we want to reindex. The field "dest"(destination) refers to the new index with the optimized `mapping`. The example requests for the data to be reindexed to the new index.\n\nCopy and paste the request above into the Kibana console and send the request!\n\n**Expected response form Elasticsearch:**\nThis request reindexes data from the `produce_index` to the `produce_v2` index. The `produce_v2` index can now be used to run the requests that the client has specified. \n\n![image](https://user-images.githubusercontent.com/60980933/121726550-ee391680-caa7-11eb-89a9-be1d4416e0e3.png)\n\n#### Runtime Field\nWe have one last feature to work on! \n![image](https://user-images.githubusercontent.com/60980933/122100555-8ac52680-cdd0-11eb-843f-556fa5313e15.png)\n\nOur client wants to be able to get the summary of monthly expense.\n\nThis feature requires splitting the data into monthly buckets. \n\n![image](https://user-images.githubusercontent.com/60980933/121749036-3b78b080-cac7-11eb-8706-561a1bb61315.png)\n\nThen, calculating the monthly revenue for each bucket by adding up the total of each document in the bucket. \n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5rqm7d7nunpkfd9vw0u4.png)\n\nThe problem is that our documents do not have a field called "total". However, we do have fields called "quantity" and "unit_price". \n\n![image](https://user-images.githubusercontent.com/60980933/121749523-09b41980-cac8-11eb-8214-e986760e5d96.png)\n\nIn order to get the total for each document, we need to multiply the values of the field "quantity" by "unit_price". Then, add up the total of all documents in each bucket. This will yield the monthly expense. \n\nAt this point, you might be thinking we will have to calculate the total and store this in a new field called "total". Then, add the field "total" to the existing documents and run the sum aggregation on this field. \n\nThis can get kinda hairy because it involves adding a new field to the existing documents in your index. This requires reindexing your data and starting all over again. \n\nBut there is a new feature that helps you get around this issue. It is called the `runtime field`! \n\n**What is `runtime`?**\nA `runtime` is that moment in time when Elasticsearch is executing your requests. During `runtime`, you can actually create a temporary field and calculate a value within it. This field then can be used to run whatever request that was sent during runtime. \n\nThis may sound very abstract to you at this point so let’s break this down.\n\nFor our last feature, the missing ingredient is the field "total". We must calculate the total by multiplying the values of the fields "quantity" and "unit_price". \n\nRight now the field "total" does not exist in our dataset so we cannot aggregate on this field. \n\nWhat we are going to do is to create a `runtime field` called "total" and add it to the `mapping` of the existing index. \n\n**Step 1: Create a runtime field and add it to the mapping of the existing index.** \n\n**Syntax:**\n```javascript\nPUT Enter-name-of-index/_mapping\n{\n  "runtime": {\n    "Name-your-runtime-field-here": {\n      "type": "Specify-field-type-here",\n      "script": {\n        "source": "Specify the formula you want executed"\n      }\n    }\n  }\n}\n```\nThe following request asks Elasticsearch to create a `runtime field` called "total" and add it to the mapping of `produce_v2` index. \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6jhoa0wbl5i7pbjepv5p.png)\n \nThe `runtime` field(1) is created only when a user runs a request against this field. \n\nWe know that the field "total"(2) will contain decimal points so we will set the field "type" to "double"(3). \n\nIn the "script"(4), we write out the formula to calculate the value for the field "total". The "script" instructs Elasticsearch to do the following(5): For each document, multiply the value of the field "unit_price" by the value of the field "quantity".\n\nCopy and paste the following example into the Kibana console and send the request!\n\n**Example:**\n```javascript\nPUT produce_v2/_mapping\n{\n  "runtime": {\n    "total": {\n      "type": "double",\n      "script": {\n        "source": "emit(doc[\'unit_price\'].value* doc[\'quantity\'].value)"\n      }\n    }\n  }\n}\n```\n**Expected response from Elasticsearch:** \nElasticsearch successfully adds the `runtime field` to the mapping. \n![image](https://user-images.githubusercontent.com/60980933/121744031-8393d500-cabf-11eb-850c-2e13cf79a92a.png)\n\n**Step 2: Check the mapping:**\nLet\'s check the mapping of the `produce_v2` index by sending the following request. \n```javascript\nGET produce_v2/_mapping\n```\n**Expected response from Elasticsearch:**\nElasticsearch adds a `runtime field` to the mapping(red box).  \n\n![image](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yi1u4cpx7gl65udiuvr3.png)\n \nNote that the `runtime field` is not listed under "properties" object which includes the fields in our documents. This is because the `runtime field` "total" is not indexed! \n\n**The `runtime field` is only created and calculated at `runtime` as you execute your request!**\n\nRemember, our indexed documents do not have a field "total". But by adding a `runtime field` to our `mapping`, we are leaving some instructions for Elasticsearch.\n\nThe `mapping` tells Elasticsearch that if it were to receive a request on the field "total", it should create a temporary field called "total" for each document and calculate its value by running the "script". Then, run the request on the field "total" and send the results to the user.\n\n**Step 3: Run a request on the `runtime field` to see it perform its magic!** \nLet\'s put `runtime field` to the test. \n\nWe are going to send the following request to perform a sum aggregation on the `runtime field` "total". \n\nNote that the following request does not aggregate the monthly expense here. We are running a simple aggregation request to demonstrate how the `runtime field` works!  \n \n**Syntax:**\n```javascript\nGET Enter_name_of_the_index_here/_search\n{\n  "size": 0,\n  "aggs": {\n    "Name your aggregations here": {\n      "Specify the aggregation type here": {\n        "field": "Name the field you want to aggregate on here"\n      }\n    }\n  }\n}\n```\nThe following request runs a sum aggregation against the `runtime field` "total" over all documents in our index.\n\n**Example:**\n```javascript\nGET produce_v2/_search\n{\n  "size": 0,\n  "aggs": {\n    "total_expense": {\n      "sum": {\n        "field": "total"\n      }\n    }\n  }\n}\n```\nCopy and paste the example into the Kibana console and send the request!\n\n**Expected response from Elasticsearch:**\nWhen this request is sent, a `runtime field` called "total" is created and calculated for documents within the scope of our request(entire index). Then, the sum aggregation is ran on the field "total" over all documents in our index.\n\n![image](https://user-images.githubusercontent.com/60980933/121815555-50268700-cc34-11eb-8fb4-8112cb8e0806.png)\n\n**What are some of the benefits of using the `runtime field`?**\nThe `runtime field` is only created and calculated when a request made on the `runtime field` is being executed. `Runtime fields` are not indexed so these do not take up disk space.  \n\nWe also did not have to reindex in order to add a new field to existing documents. For more information on runtime fields, check out this [blog](https://www.elastic.co/blog/introducing-elasticsearch-runtime-fields)! \n\nThere you have it. You have now mastered the basics of `mapping`! \n\n![image](https://media.giphy.com/media/qLHzYjlA2FW8g/giphy.gif)\n\nPlay around with `mapping` on your own and come up with the optimal `mapping` for your use case! ',a.user={name:"Lisa",username:"lisahjung",twitter_username:t,github_username:t,website_url:s,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--HUw_ww6E--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/370682/46ab80b5-f9c5-48e3-81ad-61dca12c2b67.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--XbZX2IKR--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/370682/46ab80b5-f9c5-48e3-81ad-61dca12c2b67.jpeg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:s,state:{currentArticle:a},serverRendered:!0,routePath:"/lisahjung/791151",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:s}}}}(null,"2021-08-13T18:20:16Z",{},"https://dev.to/lisahjung/beginner-s-guide-understanding-mapping-with-elasticsearch-and-kibana-3646","LisaHJung")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
