<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>An HTTP request parser with rust and pest.rs</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>An HTTP request parser with rust and pest.rs</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/rust" class="tag" data-v-70afb46a>
          #rust
        </a><a href="/nuxtstop/t/peg" class="tag" data-v-70afb46a>
          #peg
        </a><a href="/nuxtstop/t/http" class="tag" data-v-70afb46a>
          #http
        </a><a href="/nuxtstop/t/rest" class="tag" data-v-70afb46a>
          #rest
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--b27a_C-G--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2in8oygqmescdf9j6bom.png" alt="An HTTP request parser with rust and pest.rs" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            9
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>May 23</time></div></header> <div class="content" data-v-70afb46a><h2>
  <a name="introduction" href="#introduction">
  </a>
  Introduction
</h2>

<p>I happened to have learned about <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">parsing expression grammars</a> a few days ago and got really excited about writing my own grammar.<br>
As I was missing this <a href="https://github.com/Huachao/vscode-restclient">VS Code extension</a> when working on <code>neovim</code>, an idea popped up:<br>
<strong>What if I write an HTTP grammar and an execute request from an interactive prompt?</strong></p>

<p>Preview:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--smkff6Ci--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/preview.gif" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--smkff6Ci--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/preview.gif" alt="preview" loading="lazy" width="647" height="379" data-animated="true"></a></p>
<h2>
  <a name="preparation" href="#preparation">
  </a>
  Preparation
</h2>

<p>For our grammar, we need to make sure we understand the HTTP standard defined <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html">here</a>.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Request = Request-Line ; Section 5.1
        *(( general-header        ; Section 4.5
         | request-header         ; Section 5.3
         | entity-header ) CRLF)  ; Section 7.1
        CRLF
        [ message-body ]          ; Section 4.3
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's breakout the definition</p>

<h3>
  <a name="request" href="#request">
  </a>
  Request
</h3>

<p>A <code>Request</code> is conformed by a <code>Request-Line</code> optionally followed by <code>headers</code> and a new line (a <strong>Carriage Return</strong> and <strong>Line Feed</strong>) then another new line. After the <code>headers</code> we find the <code>message-body</code>.</p>

<h3>
  <a name="requestline" href="#requestline">
  </a>
  Request-Line
</h3>



<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Request-Line = Method SP Request-URI SP HTTP-Version CRLF
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Here we should fine a <code>Method</code> followed by a white space. Then the <code>Request-URI</code> followed by a white space. Finally the <code>HTTP-Version</code>.</p>

<p>An example of a request can be <code>GET http://www.w3.org/pub/WWW/TheProject.html HTTP/1.\r\n</code> (note the end of the line)</p>

<h3>
  <a name="requestheader" href="#requestheader">
  </a>
  Request-Header
</h3>

<p>Defined as<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>equest-header = Accept                   ; Section 14.1
      | Accept-Charset           ; Section 14.2
      | Accept-Encoding          ; Section 14.3
      | Accept-Language          ; Section 14.4
      | Authorization            ; Section 14.8
      | Expect                   ; Section 14.20
      | From                     ; Section 14.22
      | Host                     ; Section 14.23
      | If-Match                 ; Section 14.24
      | If-Modified-Since        ; Section 14.25
      | If-None-Match            ; Section 14.26
      | If-Range                 ; Section 14.27
      | If-Unmodified-Since      ; Section 14.28
      | Max-Forwards             ; Section 14.31
      | Proxy-Authorization      ; Section 14.34
      | Range                    ; Section 14.35
      | Referer                  ; Section 14.36
      | TE                       ; Section 14.39
      | User-Agent               ; Section 14.43
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>let's open one of those sections to check the format.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Authorization = "Authorization" ":" credentials
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Basically this header is the word <code>Authorization</code> followed by <code>:</code> and then the <code>credentials</code>.</p>

<h3>
  <a name="messagebody" href="#messagebody">
  </a>
  Message-Body
</h3>



<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>message-body = entity-body
                    | &lt;entity-body encoded as per Transfer-Encoding>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>For simplicity let's assume that the <code>body</code> can be <strong>anything</strong> that is not a request line nor a header.</p>

<p>Now we have enough information to write our http grammar, more specific a set of <strong>rules</strong>.</p>

<h2>
  <a name="pest" href="#pest">
  </a>
  Pest
</h2>

<p>To write our grammar we will use <a href="https://pest.rs/">pest</a>. From the website:</p>

<blockquote>
<p>pest is a general purpose parser written in Rust with a focus on <strong>accessibility</strong>, <strong>correctness</strong>, and <strong>performance</strong>. It uses <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">parsing expression grammars (or PEG)</a> as input, which are similar in spirit to regular expressions, but which offer the enhanced expressivity needed to parse complex languages.</p>
</blockquote>

<p>Sounds great!</p>

<p>Pest has its <a href="https://pest.rs/book/grammars/syntax.html">own syntax</a> for writing grammar rules. A <strong>rule</strong> is defined as follows:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>my_rule = { ... }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's create a new rule <code>my_rule= { "test" }</code>. This rule will match the word <code>test</code> inside an <strong>input</strong>. So if we want to parse a file that only contains "test" or new lines  we need to define the shape of a line with the delimiters <code>SOI</code> and <code>EOI</code> (start and end of input respectively)<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>testy_file = {
    SOI
    ~ (my_rule | NEWLINE)*
    ~ EOI
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's test this out in the online grammar editor:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Gfsst_RL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/pest-editor.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Gfsst_RL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/pest-editor.png" alt="editor" loading="lazy" width="774" height="642"></a></p>

<p>The parser has identified a <code>testy_file</code> that contains to matches for the rule <code>my_rule</code>. So far so good.</p>

<h2>
  <a name="http-grammar" href="#http-grammar">
  </a>
  HTTP Grammar
</h2>

<p>Now we are ready for writing our grammar (are we?). We need to write this grammar as close as possible to the standard, since it's defined in a similar way, with <strong>rules</strong>. We can imagine something like this<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>request = { 
    request_line ~
    headers? ~
    NEWLINE ~
    body?
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Our <code>request</code> rule says: a <code>request_line</code> optionally followed by <code>headers</code> followed by a new line, then optionally followed by the <code>body</code>. With optionally I make reference to the <code>?</code> mark which is a repetition operator (those who are familiar with regex expressions should understand this right away) and means that something <code>can occur zero or one times</code>. <br>
For our <code>request_line</code> we will match the standard as follows:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>request_line = _{ method ~ " "+ ~ uri ~ " "+ ~ "HTTP/" ~ version ~ NEWLINE }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We are talking about a <code>method</code> followed by a blank space then the <code>uri</code> then another blank space then the <code>http version</code> followed by a <code>NEWLINE</code>. <code>NEWLINE</code> is a pest built-in rule that matches <code>"\n" | "\r\n" | "\r"</code>.</p>

<p>Let's break the request line.</p>

<p>For <code>method</code> we just need to match any of the http methods defined in the standard<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Method = "OPTIONS"                ; Section 9.2
        | "GET"                    ; Section 9.3
        | "HEAD"                   ; Section 9.4
        | "POST"                   ; Section 9.5
        | "PUT"                    ; Section 9.6
        | "DELETE"                 ; Section 9.7
        | "TRACE"                  ; Section 9.8
        | "CONNECT"                ; Section 9.9
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Therefore our method rule should be<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>method = { ("GET" | "DELETE" | "POST" | "PUT" | ...) }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Here our rule says: match the exact word <code>GET</code> or <code>DELETE</code> or ... you get the idea.</p>

<p>Next, for simplicity purpuses, we will say that the <code>uri</code> is anything that is <strong>not</strong> a blank space<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>uri = { (!whitespace ~ ANY)+ }
whitespace = _{ " " | "\t" }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Note:</strong> here we also defined that the <code>white space</code> can be a space or a tab. Note that <code>_</code> means that the rule is <a href="https://pest.rs/book/grammars/syntax.html#silent-and-atomic-rules">silent</a>; it does not produce tokens.</p>

<p>The HTTP version goes like:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>version = { (ASCII_DIGIT | ".")+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Meaning: any digit or a dot character. In our <code>request_line</code> the version is defined as the word "HTTP/" followed by the <code>version</code>.</p>

<p>Finally, we require a <code>NEWLINE</code> at the end of our request line.</p>

<p>Let's test this out on the editor.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--O4mEC2sW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/request-line.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--O4mEC2sW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/request-line.png" alt="request line" loading="lazy" width="774" height="642"></a></p>

<p>Perfect! Note that the <code>whitespace</code> rule does not produce a token, we only see <code>method</code>, <code>uri</code> and <code>version</code>. Let's continue with the headers.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>header = { header_name ~ ":" ~ whitespace ~ header_value ~ NEWLINE }
header_name = { (!(":" | NEWLINE) ~ ANY)+ }
header_value = { (!NEWLINE ~ ANY)+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In here we say that a <code>header_name</code> is anything except for <code>:</code> , because this character is a <strong>header separator</strong>, it delimits the header name. We also don't want a new line, we will see why bellow.<br>
The name is followed by the separator <code>:</code> and then 1 white space.<br>
The <code>header_value</code> is anything except for a <strong>new line</strong>, because the new line delimits a <code>header</code>. After the value we encounter a new line.</p>

<p>Let's test this again:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--lBG4Nx94--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/headers.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--lBG4Nx94--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/headers.png" alt="headers" loading="lazy" width="774" height="642"></a></p>

<p>Here we can se that the parser matches 1 header as <code>{ header_name: "auth", header_value: "token" }</code>. Did you notice that it also say <code>headers > header</code> ? That is because we also want a rule that can matches a 1 or more <code>header</code> rules. We define this rule as:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>headers = { header+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This way the pest parser will produce a token <code>headers</code> with a list of <code>header</code> matches.</p>

<p>Lastly the body:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>body = { ANY+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The body is anything after the headers</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--1SofwpnQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/body.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1SofwpnQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/body.png" alt="body" loading="lazy" width="774" height="642"></a></p>

<p>So far our grammar can parse 1 request from the input. Coming back to the original idea for this post, we want to be able to parse multiple http requests from a file. But here we have a conflict because our <code>body</code> rule will match anything after the headers, and that anything can be another request.<br>
To solve this problem we need the help of a ✨ delimiter ✨</p>
<h2>
  <a name="the-http-file-syntax" href="#the-http-file-syntax">
  </a>
  The .http file syntax
</h2>

<p>To delimit each http request in our file we will make use of 3 <code>#</code> symbols (as the VS Code rest client does).<br>
Let's go add this to our grammar:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>delimiter = { "#"{3} ~ NEWLINE+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Our delimiter is exactly 3 number signs followed by 1 or more new lines. Then we can say that the <code>body</code> is anything except for a delimiter:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>body = { (!delimiter ~ ANY)+ }
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's test this:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qo1cVbS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/multiple.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qo1cVbS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/multiple.png" alt="multiple requests" loading="lazy" width="774" height="932"></a></p>

<p>Nice! So finally we can define what our http file should look like:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>file = { SOI ~ (delimiter | request)* ~ EOI}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Our http file is composed by delimiters or requests, 0 or more of them.<br>
We have completed our http grammar, now it's time to get <strong>rusty</strong></p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--2c6heN2L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/schwifty.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--2c6heN2L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/schwifty.jpeg" alt="get schwifty" loading="lazy" width="500" height="500"></a></p>
<h2>
  <a name="parsing-http-files" href="#parsing-http-files">
  </a>
  Parsing http files
</h2>

<p>We will refer to <a href="https://pest.rs/book/examples/ini.html">this example</a> for setting up the base code<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">extern</span> <span class="k">crate</span> <span class="n">pest</span><span class="p">;</span>
<span class="nd">#[macro_use]</span>
<span class="k">extern</span> <span class="k">crate</span> <span class="n">pest_derive</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">pest</span><span class="p">::</span><span class="n">Parser</span><span class="p">;</span>

<span class="nd">#[derive(Parser)]</span>
<span class="nd">#[grammar</span> <span class="nd">=</span> <span class="s">"grammar.pest"</span><span class="nd">]</span>
<span class="k">struct</span> <span class="n">HttpParser</span><span class="p">;</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>We will use the following file for testing<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>GET https://protiumx.github.io HTTP/1.1
authorization: token

###

POST https://rq-rust.free.beeceptor.com/api HTTP/1.1

{
  "hello": "hola"
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Note:</strong> I set up a mock api in <a href="https://beeceptor.com/">https://beeceptor.com/</a>. It might not be available by the time you are reading this. But you can use any endpoint that accepts <strong>POST</strong>.</p>

<p>Let's go ahead an parse the file<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">unparsed_file</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"test.http"</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"cannot read file"</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="nn">HttpParser</span><span class="p">::</span><span class="nf">parse</span><span class="p">(</span><span class="nn">Rule</span><span class="p">::</span><span class="n">file</span><span class="p">,</span> <span class="o">&</span><span class="n">unparsed_file</span><span class="p">)</span>
        <span class="nf">.expect</span><span class="p">(</span><span class="s">"unsuccessful parse"</span><span class="p">)</span> <span class="c1">// unwrap the parse result</span>
        <span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// get and unwrap the `file` rule; never fails</span>

        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:#?}"</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>we get:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>Pair {
    rule: file,
    span: Span {
        str: "GET https://protiumx.github.io HTTP/1.1\nauthorzation: token\n\n###\n\nPOST https://rq-rust.free.beeceptor.com/api HTTP/1.1\n\n{\n  \"hello\": \"hola\"\n}\n",
        start: 0,
        end: 142,
    },
    inner: [
        Pair {
            rule: request,
            span: Span {
                str: "GET https://protiumx.github.io HTTP/1.1\nauthorzation: token\n\n",
                start: 0,
                end: 61,
            },
            inner: [
                Pair {
                    rule: method,
                    span: Span {
                        str: "GET",
                        start: 0,
                        end: 3,
                    },
                    inner: [],
                },
...
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The <code>Pair</code> struct has a pretty clear structure and we could use to print each inner <code>Pair</code>. But we want to get rusty so we will put some effort.</p>

<p>We will define an <code>HttpFile</code> struct. This struct will contain a vector of <code>HttpRequest</code>.<br>
Let's define them:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">HttpMethod</span> <span class="p">{</span>
    <span class="n">Get</span><span class="p">,</span>
    <span class="n">Post</span><span class="p">,</span>
    <span class="n">Put</span><span class="p">,</span>
    <span class="n">Delete</span><span class="p">,</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpRequest</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">method</span><span class="p">:</span> <span class="n">HttpMethod</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">url</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">version</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">headers</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nb">String</span><span class="o">></span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">body</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpFile</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">requests</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">HttpRequest</span><span class="o">></span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And to get even more rusty we will implement the <code>TryFrom</code> trait to each struct. Let's implement it for the <code>HttpFile</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">impl</span><span class="o">&lt;</span><span class="nv">'i</span><span class="o">></span> <span class="n">TryFrom</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="nv">'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">>></span> <span class="k">for</span> <span class="n">HttpFile</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">></span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">></span><span class="p">)</span> <span class="k">-></span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">></span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">pair</span><span class="nf">.into_inner</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">requests</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iterator</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">item</span><span class="nf">.as_rule</span><span class="p">()</span> <span class="p">{</span>
                <span class="nn">Rule</span><span class="p">::</span><span class="n">EOI</span> <span class="k">=></span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nn">Rule</span><span class="p">::</span><span class="n">request</span> <span class="k">=></span> <span class="p">{</span>
                    <span class="n">requests</span><span class="nf">.push</span><span class="p">(</span><span class="n">item</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">_</span> <span class="k">=></span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span> <span class="p">{</span> <span class="n">requests</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><strong>Note:</strong> <code>Pair&lt;'i, Rule></code> has the lifetime of the <code>input</code>.<br>
As we know, the <code>file</code> rule can contain 0 or more of (delimiter | request). This means that in its content we can find: delimiter, request or End of File.<br>
Here we will <strong>try</strong> to parse each request, so we need the <code>TryFrom</code> trait for the <code>HttpRequest</code> struct<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">impl</span><span class="o">&lt;</span><span class="nv">'i</span><span class="o">></span> <span class="n">TryFrom</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="nv">'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">>></span> <span class="k">for</span> <span class="n">HttpRequest</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">></span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="nv">'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">></span><span class="p">)</span> <span class="k">-></span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">></span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">pair</span><span class="nf">.into_inner</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">ret</span> <span class="o">=</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="n">method</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>
            <span class="n">url</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">(),</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">(),</span>
            <span class="n">headers</span><span class="p">:</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>
            <span class="n">body</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>
        <span class="p">};</span>

        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iterator</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">item</span><span class="nf">.as_rule</span><span class="p">()</span> <span class="p">{</span>
                <span class="nn">Rule</span><span class="p">::</span><span class="n">headers</span> <span class="k">=></span> <span class="p">{</span>
                    <span class="n">ret</span><span class="nf">.parse_headers</span><span class="p">(</span><span class="n">item</span><span class="nf">.into_inner</span><span class="p">());</span>
                <span class="p">}</span>
                <span class="nn">Rule</span><span class="p">::</span><span class="n">body</span> <span class="k">=></span> <span class="p">{</span>
                    <span class="n">ret</span><span class="py">.body</span> <span class="o">=</span> <span class="n">item</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="n">_</span> <span class="k">=></span> <span class="p">{</span>
                    <span class="nd">unreachable!</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--w0w-zzKH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/egghead.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--w0w-zzKH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/egghead.jpeg" alt="egghead" loading="lazy" width="600" height="421"></a></p>

<p>Each <code>request</code> can have 5 inner matches: method, url, version, headers and body.<br>
The first 3 do not have inner rules, so we can just extract them as <code>&str</code>. After this, the iterator can only have <code>headers</code> or <code>body</code> pairs. For the <code>headers</code> we perform a similar operation:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="k">impl</span> <span class="n">HttpRequest</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">parse_headers</span><span class="p">(</span><span class="o">&</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">pairs</span><span class="p">:</span> <span class="n">Pairs</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">></span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">pairs</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">item</span><span class="nf">.into_inner</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">key</span> <span class="o">=</span> <span class="n">kv</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="n">kv</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>
            <span class="k">self</span><span class="py">.headers</span><span class="nf">.insert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Grapes! We are pretty much done with the parser. Now let's use the parsed content to make the requests.</p>

<h2>
  <a name="reqwest" href="#reqwest">
  </a>
  reqwest
</h2>

<p>After a quick check of the available rust http client libraries I opted for <a href="https://crates.io/crates/reqwest">reqwest</a>. It has a pretty simple API and it seems to be among the most used libraries for this matters. But I'm a bit concerned about all its dependencies so I might try <a href="https://github.com/algesten/ureq">ureq</a> later.</p>

<p>For this part I just followed the examples on the docs website and ended up with this code:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code><span class="nd">#[derive(Default)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpClient</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">client</span><span class="p">:</span> <span class="nn">reqwest</span><span class="p">::</span><span class="nn">blocking</span><span class="p">::</span><span class="n">Client</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">HttpClient</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-></span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">headers</span> <span class="o">=</span> <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="n">headers</span><span class="nf">.insert</span><span class="p">(</span>
            <span class="nn">header</span><span class="p">::</span><span class="n">CONTENT_TYPE</span><span class="p">,</span>
            <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderValue</span><span class="p">::</span><span class="nf">from_static</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">),</span>
        <span class="p">);</span>
        <span class="n">headers</span><span class="nf">.insert</span><span class="p">(</span>
            <span class="nn">header</span><span class="p">::</span><span class="n">ACCEPT</span><span class="p">,</span>
            <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderValue</span><span class="p">::</span><span class="nf">from_static</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">),</span>
        <span class="p">);</span>

        <span class="k">let</span> <span class="n">client</span> <span class="o">=</span> <span class="nn">reqwest</span><span class="p">::</span><span class="nn">blocking</span><span class="p">::</span><span class="nn">Client</span><span class="p">::</span><span class="nf">builder</span><span class="p">()</span>
            <span class="nf">.timeout</span><span class="p">(</span><span class="nn">Duration</span><span class="p">::</span><span class="nf">from_secs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="nf">.default_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="nf">.no_gzip</span><span class="p">()</span>
            <span class="nf">.build</span><span class="p">()</span>
            <span class="nf">.unwrap</span><span class="p">();</span>
        <span class="n">HttpClient</span> <span class="p">{</span> <span class="n">client</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">execute</span><span class="p">(</span><span class="o">&</span><span class="k">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="o">&</span><span class="n">HttpRequest</span><span class="p">)</span> <span class="k">-></span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">>></span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">request</span> <span class="o">=</span> <span class="k">self</span>
            <span class="py">.client</span>
            <span class="nf">.request</span><span class="p">(</span><span class="nn">Method</span><span class="p">::</span><span class="nf">from_str</span><span class="p">(</span><span class="n">req</span><span class="py">.method</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">())</span><span class="o">?</span><span class="p">,</span> <span class="o">&</span><span class="n">req</span><span class="py">.url</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">headers</span><span class="p">:</span> <span class="nn">header</span><span class="p">::</span><span class="n">HeaderMap</span> <span class="o">=</span> <span class="p">(</span><span class="o">&</span><span class="n">req</span><span class="py">.headers</span><span class="p">)</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

        <span class="k">let</span> <span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="py">.body</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">res</span> <span class="o">=</span> <span class="n">request</span><span class="nf">.headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="nf">.body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="nf">.send</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">res</span><span class="nf">.text</span><span class="p">()</span><span class="o">?</span><span class="p">);</span>

        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>What we can see in here:</p>

<ul>
<li>Use the <code>ClientBuilder</code> to add some default headers and config for the request</li>
<li>Parse our <code>HttpMethod</code> into <code>reqwest::Method</code>. <strong>Note:</strong> <code>HttpMethod</code> implements the <code>Display</code> trait.</li>
<li>Parse our <code>HashMap&lt;String, String</code> of headers into <code>reqwest::header::HeaderMap</code>. This is possible because it implements the <code>TryFrom&lt;HashMap&lt;String, String>></code> trait.</li>
<li>Finally clone the body and send the request. We output the body of the request as <code>text</code> (this consumes the body)</li>
</ul>

<p><strong>Note:</strong> We are not trimming the body, perhaps we should.</p>

<p>No we are ready for the last part: the interactive prompt</p>

<h2>
  <a name="lazyness-kicks-in" href="#lazyness-kicks-in">
  </a>
  Lazyness kicks in
</h2>

<p>At this point I felt a bit lazy to implement the prompt so I searched for existing solutions, one of them being <a href="https://github.com/mikaelmello/inquire">inquire</a>. It has a pretty straight forward API, so to show an interactive select we just need this lines:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight rust"><code>    <span class="k">let</span> <span class="n">http_file</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="o">&</span><span class="n">file_content</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">request</span> <span class="o">=</span> <span class="nn">Select</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"Select requests to execute:"</span><span class="p">,</span> <span class="n">http_file</span><span class="py">.requests</span><span class="p">)</span>
        <span class="nf">.prompt</span><span class="p">()</span>
        <span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">client</span> <span class="o">=</span> <span class="nn">HttpClient</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">client</span><span class="nf">.execute</span><span class="p">(</span><span class="o">&</span><span class="n">request</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Note that the <code>HttpRequest</code> implements the <code>Display</code> trait. </p>

<p>The result:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5SSy2T4O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/prompt.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5SSy2T4O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/prompt.png" alt="prompt" loading="lazy" width="880" height="226"></a></p>

<p>Gorgeous.</p>

<h2>
  <a name="unintroduction" href="#unintroduction">
  </a>
  Unintroduction
</h2>

<p>This project turned out to be quite fun! I ended up naming it <code>rq</code> and you can see its source <a href="https://github.com/protiumx/rq/">here</a></p>

<p>My goal is to have a full interactive prompt that allows you to execute many request without existing the prompt mode.<br>
If you would like to collaborate I have created a few TODO cards <a href="https://github.com/protiumx/rq/projects/1">here</a>.</p>

<p>That's it. Thanks for reading 👽</p>

<p>Others posts:</p>

<ul>
<li><a href="https://dev.to/protium/publish-your-blog-articles-everywhere-with-this-github-action-3g6k">Publish your blog articles everywhere with this github action</a></li>
<li><a href="https://dev.to/protium/coding-problems-tdd-and-ci-282n">Coding Problems, TDD, and CI</a></li>
<li><a href="https://dev.to/protium/your-new-pretty-and-minimalist-resume-with-latex-421j">Your new pretty and minimalist resume with LaTex</a></li>
</ul>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/protium/an-http-request-parser-with-rust-and-pestrs-2p" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(n,s,a,e,t){return a.type_of="article",a.id=1093951,a.title="An HTTP request parser with rust and pest.rs",a.description="Introduction   I happened to have learned about parsing expression grammars a few days ago...",a.readable_publish_date="May 23",a.slug="an-http-request-parser-with-rust-and-pestrs-2p",a.path="/protium/an-http-request-parser-with-rust-and-pestrs-2p",a.url=e,a.comments_count=0,a.public_reactions_count=9,a.collection_id=n,a.published_timestamp=s,a.positive_reactions_count=9,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--b27a_C-G--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2in8oygqmescdf9j6bom.png",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--2jeUtpzR--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2in8oygqmescdf9j6bom.png",a.canonical_url=e,a.created_at=s,a.edited_at="2022-05-24T00:30:51Z",a.crossposted_at=n,a.published_at=s,a.last_comment_at=s,a.reading_time_minutes=10,a.tag_list="rust, peg, http, rest",a.tags=["rust","peg","http","rest"],a.body_html='<h2>\n  <a name="introduction" href="#introduction">\n  </a>\n  Introduction\n</h2>\n\n<p>I happened to have learned about <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">parsing expression grammars</a> a few days ago and got really excited about writing my own grammar.<br>\nAs I was missing this <a href="https://github.com/Huachao/vscode-restclient">VS Code extension</a> when working on <code>neovim</code>, an idea popped up:<br>\n<strong>What if I write an HTTP grammar and an execute request from an interactive prompt?</strong></p>\n\n<p>Preview:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--smkff6Ci--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/preview.gif" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--smkff6Ci--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/preview.gif" alt="preview" loading="lazy" width="647" height="379" data-animated="true"></a></p>\n<h2>\n  <a name="preparation" href="#preparation">\n  </a>\n  Preparation\n</h2>\n\n<p>For our grammar, we need to make sure we understand the HTTP standard defined <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html">here</a>.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Request = Request-Line ; Section 5.1\n        *(( general-header        ; Section 4.5\n         | request-header         ; Section 5.3\n         | entity-header ) CRLF)  ; Section 7.1\n        CRLF\n        [ message-body ]          ; Section 4.3\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s breakout the definition</p>\n\n<h3>\n  <a name="request" href="#request">\n  </a>\n  Request\n</h3>\n\n<p>A <code>Request</code> is conformed by a <code>Request-Line</code> optionally followed by <code>headers</code> and a new line (a <strong>Carriage Return</strong> and <strong>Line Feed</strong>) then another new line. After the <code>headers</code> we find the <code>message-body</code>.</p>\n\n<h3>\n  <a name="requestline" href="#requestline">\n  </a>\n  Request-Line\n</h3>\n\n\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Request-Line = Method SP Request-URI SP HTTP-Version CRLF\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Here we should fine a <code>Method</code> followed by a white space. Then the <code>Request-URI</code> followed by a white space. Finally the <code>HTTP-Version</code>.</p>\n\n<p>An example of a request can be <code>GET http://www.w3.org/pub/WWW/TheProject.html HTTP/1.\\r\\n</code> (note the end of the line)</p>\n\n<h3>\n  <a name="requestheader" href="#requestheader">\n  </a>\n  Request-Header\n</h3>\n\n<p>Defined as<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>equest-header = Accept                   ; Section 14.1\n      | Accept-Charset           ; Section 14.2\n      | Accept-Encoding          ; Section 14.3\n      | Accept-Language          ; Section 14.4\n      | Authorization            ; Section 14.8\n      | Expect                   ; Section 14.20\n      | From                     ; Section 14.22\n      | Host                     ; Section 14.23\n      | If-Match                 ; Section 14.24\n      | If-Modified-Since        ; Section 14.25\n      | If-None-Match            ; Section 14.26\n      | If-Range                 ; Section 14.27\n      | If-Unmodified-Since      ; Section 14.28\n      | Max-Forwards             ; Section 14.31\n      | Proxy-Authorization      ; Section 14.34\n      | Range                    ; Section 14.35\n      | Referer                  ; Section 14.36\n      | TE                       ; Section 14.39\n      | User-Agent               ; Section 14.43\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>let\'s open one of those sections to check the format.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Authorization = "Authorization" ":" credentials\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Basically this header is the word <code>Authorization</code> followed by <code>:</code> and then the <code>credentials</code>.</p>\n\n<h3>\n  <a name="messagebody" href="#messagebody">\n  </a>\n  Message-Body\n</h3>\n\n\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>message-body = entity-body\n                    | &lt;entity-body encoded as per Transfer-Encoding&gt;\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>For simplicity let\'s assume that the <code>body</code> can be <strong>anything</strong> that is not a request line nor a header.</p>\n\n<p>Now we have enough information to write our http grammar, more specific a set of <strong>rules</strong>.</p>\n\n<h2>\n  <a name="pest" href="#pest">\n  </a>\n  Pest\n</h2>\n\n<p>To write our grammar we will use <a href="https://pest.rs/">pest</a>. From the website:</p>\n\n<blockquote>\n<p>pest is a general purpose parser written in Rust with a focus on <strong>accessibility</strong>, <strong>correctness</strong>, and <strong>performance</strong>. It uses <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">parsing expression grammars (or PEG)</a> as input, which are similar in spirit to regular expressions, but which offer the enhanced expressivity needed to parse complex languages.</p>\n</blockquote>\n\n<p>Sounds great!</p>\n\n<p>Pest has its <a href="https://pest.rs/book/grammars/syntax.html">own syntax</a> for writing grammar rules. A <strong>rule</strong> is defined as follows:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>my_rule = { ... }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s create a new rule <code>my_rule= { "test" }</code>. This rule will match the word <code>test</code> inside an <strong>input</strong>. So if we want to parse a file that only contains "test" or new lines  we need to define the shape of a line with the delimiters <code>SOI</code> and <code>EOI</code> (start and end of input respectively)<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>testy_file = {\n    SOI\n    ~ (my_rule | NEWLINE)*\n    ~ EOI\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s test this out in the online grammar editor:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Gfsst_RL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/pest-editor.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Gfsst_RL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/pest-editor.png" alt="editor" loading="lazy" width="774" height="642"></a></p>\n\n<p>The parser has identified a <code>testy_file</code> that contains to matches for the rule <code>my_rule</code>. So far so good.</p>\n\n<h2>\n  <a name="http-grammar" href="#http-grammar">\n  </a>\n  HTTP Grammar\n</h2>\n\n<p>Now we are ready for writing our grammar (are we?). We need to write this grammar as close as possible to the standard, since it\'s defined in a similar way, with <strong>rules</strong>. We can imagine something like this<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>request = { \n    request_line ~\n    headers? ~\n    NEWLINE ~\n    body?\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Our <code>request</code> rule says: a <code>request_line</code> optionally followed by <code>headers</code> followed by a new line, then optionally followed by the <code>body</code>. With optionally I make reference to the <code>?</code> mark which is a repetition operator (those who are familiar with regex expressions should understand this right away) and means that something <code>can occur zero or one times</code>. <br>\nFor our <code>request_line</code> we will match the standard as follows:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>request_line = _{ method ~ " "+ ~ uri ~ " "+ ~ "HTTP/" ~ version ~ NEWLINE }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We are talking about a <code>method</code> followed by a blank space then the <code>uri</code> then another blank space then the <code>http version</code> followed by a <code>NEWLINE</code>. <code>NEWLINE</code> is a pest built-in rule that matches <code>"\\n" | "\\r\\n" | "\\r"</code>.</p>\n\n<p>Let\'s break the request line.</p>\n\n<p>For <code>method</code> we just need to match any of the http methods defined in the standard<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Method = "OPTIONS"                ; Section 9.2\n        | "GET"                    ; Section 9.3\n        | "HEAD"                   ; Section 9.4\n        | "POST"                   ; Section 9.5\n        | "PUT"                    ; Section 9.6\n        | "DELETE"                 ; Section 9.7\n        | "TRACE"                  ; Section 9.8\n        | "CONNECT"                ; Section 9.9\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Therefore our method rule should be<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>method = { ("GET" | "DELETE" | "POST" | "PUT" | ...) }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Here our rule says: match the exact word <code>GET</code> or <code>DELETE</code> or ... you get the idea.</p>\n\n<p>Next, for simplicity purpuses, we will say that the <code>uri</code> is anything that is <strong>not</strong> a blank space<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>uri = { (!whitespace ~ ANY)+ }\nwhitespace = _{ " " | "\\t" }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> here we also defined that the <code>white space</code> can be a space or a tab. Note that <code>_</code> means that the rule is <a href="https://pest.rs/book/grammars/syntax.html#silent-and-atomic-rules">silent</a>; it does not produce tokens.</p>\n\n<p>The HTTP version goes like:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>version = { (ASCII_DIGIT | ".")+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Meaning: any digit or a dot character. In our <code>request_line</code> the version is defined as the word "HTTP/" followed by the <code>version</code>.</p>\n\n<p>Finally, we require a <code>NEWLINE</code> at the end of our request line.</p>\n\n<p>Let\'s test this out on the editor.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--O4mEC2sW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/request-line.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--O4mEC2sW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/request-line.png" alt="request line" loading="lazy" width="774" height="642"></a></p>\n\n<p>Perfect! Note that the <code>whitespace</code> rule does not produce a token, we only see <code>method</code>, <code>uri</code> and <code>version</code>. Let\'s continue with the headers.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>header = { header_name ~ ":" ~ whitespace ~ header_value ~ NEWLINE }\nheader_name = { (!(":" | NEWLINE) ~ ANY)+ }\nheader_value = { (!NEWLINE ~ ANY)+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In here we say that a <code>header_name</code> is anything except for <code>:</code> , because this character is a <strong>header separator</strong>, it delimits the header name. We also don\'t want a new line, we will see why bellow.<br>\nThe name is followed by the separator <code>:</code> and then 1 white space.<br>\nThe <code>header_value</code> is anything except for a <strong>new line</strong>, because the new line delimits a <code>header</code>. After the value we encounter a new line.</p>\n\n<p>Let\'s test this again:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--lBG4Nx94--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/headers.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--lBG4Nx94--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/headers.png" alt="headers" loading="lazy" width="774" height="642"></a></p>\n\n<p>Here we can se that the parser matches 1 header as <code>{ header_name: "auth", header_value: "token" }</code>. Did you notice that it also say <code>headers &gt; header</code> ? That is because we also want a rule that can matches a 1 or more <code>header</code> rules. We define this rule as:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>headers = { header+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This way the pest parser will produce a token <code>headers</code> with a list of <code>header</code> matches.</p>\n\n<p>Lastly the body:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>body = { ANY+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The body is anything after the headers</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--1SofwpnQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/body.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1SofwpnQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/body.png" alt="body" loading="lazy" width="774" height="642"></a></p>\n\n<p>So far our grammar can parse 1 request from the input. Coming back to the original idea for this post, we want to be able to parse multiple http requests from a file. But here we have a conflict because our <code>body</code> rule will match anything after the headers, and that anything can be another request.<br>\nTo solve this problem we need the help of a ✨ delimiter ✨</p>\n<h2>\n  <a name="the-http-file-syntax" href="#the-http-file-syntax">\n  </a>\n  The .http file syntax\n</h2>\n\n<p>To delimit each http request in our file we will make use of 3 <code>#</code> symbols (as the VS Code rest client does).<br>\nLet\'s go add this to our grammar:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>delimiter = { "#"{3} ~ NEWLINE+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Our delimiter is exactly 3 number signs followed by 1 or more new lines. Then we can say that the <code>body</code> is anything except for a delimiter:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>body = { (!delimiter ~ ANY)+ }\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Let\'s test this:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--qo1cVbS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/multiple.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qo1cVbS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/multiple.png" alt="multiple requests" loading="lazy" width="774" height="932"></a></p>\n\n<p>Nice! So finally we can define what our http file should look like:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>file = { SOI ~ (delimiter | request)* ~ EOI}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Our http file is composed by delimiters or requests, 0 or more of them.<br>\nWe have completed our http grammar, now it\'s time to get <strong>rusty</strong></p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--2c6heN2L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/schwifty.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--2c6heN2L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/schwifty.jpeg" alt="get schwifty" loading="lazy" width="500" height="500"></a></p>\n<h2>\n  <a name="parsing-http-files" href="#parsing-http-files">\n  </a>\n  Parsing http files\n</h2>\n\n<p>We will refer to <a href="https://pest.rs/book/examples/ini.html">this example</a> for setting up the base code<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">extern</span> <span class="k">crate</span> <span class="n">pest</span><span class="p">;</span>\n<span class="nd">#[macro_use]</span>\n<span class="k">extern</span> <span class="k">crate</span> <span class="n">pest_derive</span><span class="p">;</span>\n\n<span class="k">use</span> <span class="nn">pest</span><span class="p">::</span><span class="n">Parser</span><span class="p">;</span>\n\n<span class="nd">#[derive(Parser)]</span>\n<span class="nd">#[grammar</span> <span class="nd">=</span> <span class="s">"grammar.pest"</span><span class="nd">]</span>\n<span class="k">struct</span> <span class="n">HttpParser</span><span class="p">;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We will use the following file for testing<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>GET https://protiumx.github.io HTTP/1.1\nauthorization: token\n\n###\n\nPOST https://rq-rust.free.beeceptor.com/api HTTP/1.1\n\n{\n  "hello": "hola"\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> I set up a mock api in <a href="https://beeceptor.com/">https://beeceptor.com/</a>. It might not be available by the time you are reading this. But you can use any endpoint that accepts <strong>POST</strong>.</p>\n\n<p>Let\'s go ahead an parse the file<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">let</span> <span class="n">unparsed_file</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"test.http"</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"cannot read file"</span><span class="p">);</span>\n\n    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="nn">HttpParser</span><span class="p">::</span><span class="nf">parse</span><span class="p">(</span><span class="nn">Rule</span><span class="p">::</span><span class="n">file</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unparsed_file</span><span class="p">)</span>\n        <span class="nf">.expect</span><span class="p">(</span><span class="s">"unsuccessful parse"</span><span class="p">)</span> <span class="c1">// unwrap the parse result</span>\n        <span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// get and unwrap the `file` rule; never fails</span>\n\n        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:#?}"</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>we get:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>Pair {\n    rule: file,\n    span: Span {\n        str: "GET https://protiumx.github.io HTTP/1.1\\nauthorzation: token\\n\\n###\\n\\nPOST https://rq-rust.free.beeceptor.com/api HTTP/1.1\\n\\n{\\n  \\"hello\\": \\"hola\\"\\n}\\n",\n        start: 0,\n        end: 142,\n    },\n    inner: [\n        Pair {\n            rule: request,\n            span: Span {\n                str: "GET https://protiumx.github.io HTTP/1.1\\nauthorzation: token\\n\\n",\n                start: 0,\n                end: 61,\n            },\n            inner: [\n                Pair {\n                    rule: method,\n                    span: Span {\n                        str: "GET",\n                        start: 0,\n                        end: 3,\n                    },\n                    inner: [],\n                },\n...\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The <code>Pair</code> struct has a pretty clear structure and we could use to print each inner <code>Pair</code>. But we want to get rusty so we will put some effort.</p>\n\n<p>We will define an <code>HttpFile</code> struct. This struct will contain a vector of <code>HttpRequest</code>.<br>\nLet\'s define them:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>\n\n<span class="nd">#[derive(Debug)]</span>\n<span class="k">pub</span> <span class="k">enum</span> <span class="n">HttpMethod</span> <span class="p">{</span>\n    <span class="n">Get</span><span class="p">,</span>\n    <span class="n">Post</span><span class="p">,</span>\n    <span class="n">Put</span><span class="p">,</span>\n    <span class="n">Delete</span><span class="p">,</span>\n    <span class="c1">// ...</span>\n<span class="p">}</span>\n\n<span class="nd">#[derive(Debug)]</span>\n<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpRequest</span> <span class="p">{</span>\n    <span class="k">pub</span> <span class="n">method</span><span class="p">:</span> <span class="n">HttpMethod</span><span class="p">,</span>\n    <span class="k">pub</span> <span class="n">url</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n    <span class="k">pub</span> <span class="n">version</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n    <span class="k">pub</span> <span class="n">headers</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>\n    <span class="k">pub</span> <span class="n">body</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n<span class="p">}</span>\n\n<span class="nd">#[derive(Debug)]</span>\n<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpFile</span> <span class="p">{</span>\n    <span class="k">pub</span> <span class="n">requests</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">HttpRequest</span><span class="o">&gt;</span><span class="p">,</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>And to get even more rusty we will implement the <code>TryFrom</code> trait to each struct. Let\'s implement it for the <code>HttpFile</code><br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">impl</span><span class="o">&lt;</span><span class="nv">\'i</span><span class="o">&gt;</span> <span class="n">TryFrom</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="nv">\'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">HttpFile</span> <span class="p">{</span>\n    <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="p">;</span>\n\n    <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>\n        <span class="k">let</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">pair</span><span class="nf">.into_inner</span><span class="p">();</span>\n        <span class="k">let</span> <span class="k">mut</span> <span class="n">requests</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>\n        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iterator</span> <span class="p">{</span>\n            <span class="k">match</span> <span class="n">item</span><span class="nf">.as_rule</span><span class="p">()</span> <span class="p">{</span>\n                <span class="nn">Rule</span><span class="p">::</span><span class="n">EOI</span> <span class="k">=&gt;</span> <span class="p">{</span>\n                    <span class="k">break</span><span class="p">;</span>\n                <span class="p">}</span>\n                <span class="nn">Rule</span><span class="p">::</span><span class="n">request</span> <span class="k">=&gt;</span> <span class="p">{</span>\n                    <span class="n">requests</span><span class="nf">.push</span><span class="p">(</span><span class="n">item</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">);</span>\n                <span class="p">}</span>\n                <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">{}</span>\n            <span class="p">}</span>\n        <span class="p">}</span>\n        <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span> <span class="p">{</span> <span class="n">requests</span> <span class="p">})</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> <code>Pair&lt;\'i, Rule&gt;</code> has the lifetime of the <code>input</code>.<br>\nAs we know, the <code>file</code> rule can contain 0 or more of (delimiter | request). This means that in its content we can find: delimiter, request or End of File.<br>\nHere we will <strong>try</strong> to parse each request, so we need the <code>TryFrom</code> trait for the <code>HttpRequest</code> struct<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">impl</span><span class="o">&lt;</span><span class="nv">\'i</span><span class="o">&gt;</span> <span class="n">TryFrom</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="nv">\'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">HttpRequest</span> <span class="p">{</span>\n    <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="p">;</span>\n\n    <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="nv">\'i</span><span class="p">,</span> <span class="n">Rule</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>\n        <span class="k">let</span> <span class="k">mut</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">pair</span><span class="nf">.into_inner</span><span class="p">();</span>\n        <span class="k">let</span> <span class="k">mut</span> <span class="n">ret</span> <span class="o">=</span> <span class="k">Self</span> <span class="p">{</span>\n            <span class="n">method</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>\n            <span class="n">url</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">(),</span>\n            <span class="n">version</span><span class="p">:</span> <span class="n">iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">(),</span>\n            <span class="n">headers</span><span class="p">:</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>\n            <span class="n">body</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>\n        <span class="p">};</span>\n\n        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iterator</span> <span class="p">{</span>\n            <span class="k">match</span> <span class="n">item</span><span class="nf">.as_rule</span><span class="p">()</span> <span class="p">{</span>\n                <span class="nn">Rule</span><span class="p">::</span><span class="n">headers</span> <span class="k">=&gt;</span> <span class="p">{</span>\n                    <span class="n">ret</span><span class="nf">.parse_headers</span><span class="p">(</span><span class="n">item</span><span class="nf">.into_inner</span><span class="p">());</span>\n                <span class="p">}</span>\n                <span class="nn">Rule</span><span class="p">::</span><span class="n">body</span> <span class="k">=&gt;</span> <span class="p">{</span>\n                    <span class="n">ret</span><span class="py">.body</span> <span class="o">=</span> <span class="n">item</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>\n                <span class="p">}</span>\n                <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">{</span>\n                    <span class="nd">unreachable!</span><span class="p">();</span>\n                <span class="p">}</span>\n            <span class="p">}</span>\n        <span class="p">}</span>\n\n        <span class="nf">Ok</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--w0w-zzKH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/egghead.jpeg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--w0w-zzKH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/egghead.jpeg" alt="egghead" loading="lazy" width="600" height="421"></a></p>\n\n<p>Each <code>request</code> can have 5 inner matches: method, url, version, headers and body.<br>\nThe first 3 do not have inner rules, so we can just extract them as <code>&amp;str</code>. After this, the iterator can only have <code>headers</code> or <code>body</code> pairs. For the <code>headers</code> we perform a similar operation:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="k">impl</span> <span class="n">HttpRequest</span> <span class="p">{</span>\n    <span class="k">fn</span> <span class="nf">parse_headers</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">pairs</span><span class="p">:</span> <span class="n">Pairs</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">pairs</span> <span class="p">{</span>\n            <span class="k">let</span> <span class="k">mut</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">item</span><span class="nf">.into_inner</span><span class="p">();</span>\n            <span class="k">let</span> <span class="n">key</span> <span class="o">=</span> <span class="n">kv</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>\n            <span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="n">kv</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">();</span>\n            <span class="k">self</span><span class="py">.headers</span><span class="nf">.insert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>\n        <span class="p">}</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Grapes! We are pretty much done with the parser. Now let\'s use the parsed content to make the requests.</p>\n\n<h2>\n  <a name="reqwest" href="#reqwest">\n  </a>\n  reqwest\n</h2>\n\n<p>After a quick check of the available rust http client libraries I opted for <a href="https://crates.io/crates/reqwest">reqwest</a>. It has a pretty simple API and it seems to be among the most used libraries for this matters. But I\'m a bit concerned about all its dependencies so I might try <a href="https://github.com/algesten/ureq">ureq</a> later.</p>\n\n<p>For this part I just followed the examples on the docs website and ended up with this code:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code><span class="nd">#[derive(Default)]</span>\n<span class="k">pub</span> <span class="k">struct</span> <span class="n">HttpClient</span> <span class="p">{</span>\n    <span class="k">pub</span> <span class="n">client</span><span class="p">:</span> <span class="nn">reqwest</span><span class="p">::</span><span class="nn">blocking</span><span class="p">::</span><span class="n">Client</span><span class="p">,</span>\n<span class="p">}</span>\n\n<span class="k">impl</span> <span class="n">HttpClient</span> <span class="p">{</span>\n    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>\n        <span class="k">let</span> <span class="k">mut</span> <span class="n">headers</span> <span class="o">=</span> <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>\n        <span class="n">headers</span><span class="nf">.insert</span><span class="p">(</span>\n            <span class="nn">header</span><span class="p">::</span><span class="n">CONTENT_TYPE</span><span class="p">,</span>\n            <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderValue</span><span class="p">::</span><span class="nf">from_static</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">),</span>\n        <span class="p">);</span>\n        <span class="n">headers</span><span class="nf">.insert</span><span class="p">(</span>\n            <span class="nn">header</span><span class="p">::</span><span class="n">ACCEPT</span><span class="p">,</span>\n            <span class="nn">header</span><span class="p">::</span><span class="nn">HeaderValue</span><span class="p">::</span><span class="nf">from_static</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">),</span>\n        <span class="p">);</span>\n\n        <span class="k">let</span> <span class="n">client</span> <span class="o">=</span> <span class="nn">reqwest</span><span class="p">::</span><span class="nn">blocking</span><span class="p">::</span><span class="nn">Client</span><span class="p">::</span><span class="nf">builder</span><span class="p">()</span>\n            <span class="nf">.timeout</span><span class="p">(</span><span class="nn">Duration</span><span class="p">::</span><span class="nf">from_secs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>\n            <span class="nf">.default_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>\n            <span class="nf">.no_gzip</span><span class="p">()</span>\n            <span class="nf">.build</span><span class="p">()</span>\n            <span class="nf">.unwrap</span><span class="p">();</span>\n        <span class="n">HttpClient</span> <span class="p">{</span> <span class="n">client</span> <span class="p">}</span>\n    <span class="p">}</span>\n\n    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">execute</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">HttpRequest</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>\n        <span class="k">let</span> <span class="n">request</span> <span class="o">=</span> <span class="k">self</span>\n            <span class="py">.client</span>\n            <span class="nf">.request</span><span class="p">(</span><span class="nn">Method</span><span class="p">::</span><span class="nf">from_str</span><span class="p">(</span><span class="n">req</span><span class="py">.method</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">())</span><span class="o">?</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">req</span><span class="py">.url</span><span class="p">);</span>\n\n        <span class="k">let</span> <span class="n">headers</span><span class="p">:</span> <span class="nn">header</span><span class="p">::</span><span class="n">HeaderMap</span> <span class="o">=</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="py">.headers</span><span class="p">)</span><span class="nf">.try_into</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>\n\n        <span class="k">let</span> <span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="py">.body</span><span class="nf">.clone</span><span class="p">();</span>\n        <span class="k">let</span> <span class="n">res</span> <span class="o">=</span> <span class="n">request</span><span class="nf">.headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="nf">.body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="nf">.send</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>\n\n        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}</span><span class="se">\\n</span><span class="s">"</span><span class="p">,</span> <span class="n">res</span><span class="nf">.text</span><span class="p">()</span><span class="o">?</span><span class="p">);</span>\n\n        <span class="nf">Ok</span><span class="p">(())</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>What we can see in here:</p>\n\n<ul>\n<li>Use the <code>ClientBuilder</code> to add some default headers and config for the request</li>\n<li>Parse our <code>HttpMethod</code> into <code>reqwest::Method</code>. <strong>Note:</strong> <code>HttpMethod</code> implements the <code>Display</code> trait.</li>\n<li>Parse our <code>HashMap&lt;String, String</code> of headers into <code>reqwest::header::HeaderMap</code>. This is possible because it implements the <code>TryFrom&lt;HashMap&lt;String, String&gt;&gt;</code> trait.</li>\n<li>Finally clone the body and send the request. We output the body of the request as <code>text</code> (this consumes the body)</li>\n</ul>\n\n<p><strong>Note:</strong> We are not trimming the body, perhaps we should.</p>\n\n<p>No we are ready for the last part: the interactive prompt</p>\n\n<h2>\n  <a name="lazyness-kicks-in" href="#lazyness-kicks-in">\n  </a>\n  Lazyness kicks in\n</h2>\n\n<p>At this point I felt a bit lazy to implement the prompt so I searched for existing solutions, one of them being <a href="https://github.com/mikaelmello/inquire">inquire</a>. It has a pretty straight forward API, so to show an interactive select we just need this lines:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight rust"><code>    <span class="k">let</span> <span class="n">http_file</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_content</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>\n\n    <span class="k">let</span> <span class="n">request</span> <span class="o">=</span> <span class="nn">Select</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"Select requests to execute:"</span><span class="p">,</span> <span class="n">http_file</span><span class="py">.requests</span><span class="p">)</span>\n        <span class="nf">.prompt</span><span class="p">()</span>\n        <span class="nf">.unwrap</span><span class="p">();</span>\n\n    <span class="k">let</span> <span class="n">client</span> <span class="o">=</span> <span class="nn">HttpClient</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>\n    <span class="n">client</span><span class="nf">.execute</span><span class="p">(</span><span class="o">&amp;</span><span class="n">request</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Note that the <code>HttpRequest</code> implements the <code>Display</code> trait. </p>\n\n<p>The result:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5SSy2T4O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/prompt.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5SSy2T4O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/protiumx/blog/main/articles/005/prompt.png" alt="prompt" loading="lazy" width="880" height="226"></a></p>\n\n<p>Gorgeous.</p>\n\n<h2>\n  <a name="unintroduction" href="#unintroduction">\n  </a>\n  Unintroduction\n</h2>\n\n<p>This project turned out to be quite fun! I ended up naming it <code>rq</code> and you can see its source <a href="https://github.com/protiumx/rq/">here</a></p>\n\n<p>My goal is to have a full interactive prompt that allows you to execute many request without existing the prompt mode.<br>\nIf you would like to collaborate I have created a few TODO cards <a href="https://github.com/protiumx/rq/projects/1">here</a>.</p>\n\n<p>That\'s it. Thanks for reading 👽</p>\n\n<p>Others posts:</p>\n\n<ul>\n<li><a href="https://dev.to/protium/publish-your-blog-articles-everywhere-with-this-github-action-3g6k">Publish your blog articles everywhere with this github action</a></li>\n<li><a href="https://dev.to/protium/coding-problems-tdd-and-ci-282n">Coding Problems, TDD, and CI</a></li>\n<li><a href="https://dev.to/protium/your-new-pretty-and-minimalist-resume-with-latex-421j">Your new pretty and minimalist resume with LaTex</a></li>\n</ul>\n\n',a.body_markdown='## Introduction\n\nI happened to have learned about [parsing expression grammars](https://en.wikipedia.org/wiki/Parsing_expression_grammar) a few days ago and got really excited about writing my own grammar.\nAs I was missing this [VS Code extension](https://github.com/Huachao/vscode-restclient) when working on `neovim`, an idea popped up:\n**What if I write an HTTP grammar and an execute request from an interactive prompt?**\n\nPreview:\n\n![preview](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/preview.gif)\n\n## Preparation\n\nFor our grammar, we need to make sure we understand the HTTP standard defined [here](https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html).\n```\nRequest = Request-Line ; Section 5.1\n        *(( general-header        ; Section 4.5\n         | request-header         ; Section 5.3\n         | entity-header ) CRLF)  ; Section 7.1\n        CRLF\n        [ message-body ]          ; Section 4.3\n```\n\nLet\'s breakout the definition\n\n### Request\n\nA `Request` is conformed by a `Request-Line` optionally followed by `headers` and a new line (a **Carriage Return** and **Line Feed**) then another new line. After the `headers` we find the `message-body`.\n\n### Request-Line\n\n```\nRequest-Line = Method SP Request-URI SP HTTP-Version CRLF\n```\n\nHere we should fine a `Method` followed by a white space. Then the `Request-URI` followed by a white space. Finally the `HTTP-Version`.\n\nAn example of a request can be `GET http://www.w3.org/pub/WWW/TheProject.html HTTP/1.\\r\\n` (note the end of the line)\n\n### Request-Header\n\nDefined as\n\n```\nequest-header = Accept                   ; Section 14.1\n      | Accept-Charset           ; Section 14.2\n      | Accept-Encoding          ; Section 14.3\n      | Accept-Language          ; Section 14.4\n      | Authorization            ; Section 14.8\n      | Expect                   ; Section 14.20\n      | From                     ; Section 14.22\n      | Host                     ; Section 14.23\n      | If-Match                 ; Section 14.24\n      | If-Modified-Since        ; Section 14.25\n      | If-None-Match            ; Section 14.26\n      | If-Range                 ; Section 14.27\n      | If-Unmodified-Since      ; Section 14.28\n      | Max-Forwards             ; Section 14.31\n      | Proxy-Authorization      ; Section 14.34\n      | Range                    ; Section 14.35\n      | Referer                  ; Section 14.36\n      | TE                       ; Section 14.39\n      | User-Agent               ; Section 14.43\n```\n\nlet\'s open one of those sections to check the format.\n\n```\nAuthorization = "Authorization" ":" credentials\n```\n\nBasically this header is the word `Authorization` followed by `:` and then the `credentials`.\n\n### Message-Body\n\n```\nmessage-body = entity-body\n                    | <entity-body encoded as per Transfer-Encoding>\n```\n\nFor simplicity let\'s assume that the `body` can be **anything** that is not a request line nor a header.\n\nNow we have enough information to write our http grammar, more specific a set of **rules**.\n\n## Pest\n\nTo write our grammar we will use [pest](https://pest.rs/). From the website:\n\n> pest is a general purpose parser written in Rust with a focus on **accessibility**, **correctness**, and **performance**. It uses [parsing expression grammars (or PEG)](https://en.wikipedia.org/wiki/Parsing_expression_grammar) as input, which are similar in spirit to regular expressions, but which offer the enhanced expressivity needed to parse complex languages.\n\nSounds great!\n\nPest has its [own syntax](https://pest.rs/book/grammars/syntax.html) for writing grammar rules. A **rule** is defined as follows:\n\n```\nmy_rule = { ... }\n```\n\nLet\'s create a new rule `my_rule= { "test" }`. This rule will match the word `test` inside an **input**. So if we want to parse a file that only contains "test" or new lines  we need to define the shape of a line with the delimiters `SOI` and `EOI` (start and end of input respectively)\n\n```\ntesty_file = {\n    SOI\n    ~ (my_rule | NEWLINE)*\n    ~ EOI\n}\n```\n\nLet\'s test this out in the online grammar editor:\n\n![editor](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/pest-editor.png)\n\nThe parser has identified a `testy_file` that contains to matches for the rule `my_rule`. So far so good.\n\n## HTTP Grammar\n\nNow we are ready for writing our grammar (are we?). We need to write this grammar as close as possible to the standard, since it\'s defined in a similar way, with **rules**. We can imagine something like this\n\n```\nrequest = {\t\n\trequest_line ~\n    headers? ~\n    NEWLINE ~\n    body?\n}\n```\n\nOur `request` rule says: a `request_line` optionally followed by `headers` followed by a new line, then optionally followed by the `body`. With optionally I make reference to the `?` mark which is a repetition operator (those who are familiar with regex expressions should understand this right away) and means that something ` can occur zero or one times`. \nFor our `request_line` we will match the standard as follows:\n\n```\nrequest_line = _{ method ~ " "+ ~ uri ~ " "+ ~ "HTTP/" ~ version ~ NEWLINE }\n```\n\nWe are talking about a `method` followed by a blank space then the `uri` then another blank space then the `http version` followed by a `NEWLINE`. `NEWLINE` is a pest built-in rule that matches `"\\n" | "\\r\\n" | "\\r"`.\n\nLet\'s break the request line.\n\nFor `method` we just need to match any of the http methods defined in the standard\n```\nMethod = "OPTIONS"                ; Section 9.2\n        | "GET"                    ; Section 9.3\n        | "HEAD"                   ; Section 9.4\n        | "POST"                   ; Section 9.5\n        | "PUT"                    ; Section 9.6\n        | "DELETE"                 ; Section 9.7\n        | "TRACE"                  ; Section 9.8\n        | "CONNECT"                ; Section 9.9\n```\n\nTherefore our method rule should be\n\n```\nmethod = { ("GET" | "DELETE" | "POST" | "PUT" | ...) }\n```\n\nHere our rule says: match the exact word `GET` or `DELETE` or ... you get the idea.\n\nNext, for simplicity purpuses, we will say that the `uri` is anything that is **not** a blank space\n\n```\nuri = { (!whitespace ~ ANY)+ }\nwhitespace = _{ " " | "\\t" }\n```\n\n**Note:** here we also defined that the `white space` can be a space or a tab. Note that `_` means that the rule is [silent](https://pest.rs/book/grammars/syntax.html#silent-and-atomic-rules); it does not produce tokens.\n\nThe HTTP version goes like:\n\n```\nversion = { (ASCII_DIGIT | ".")+ }\n```\n\nMeaning: any digit or a dot character. In our `request_line` the version is defined as the word "HTTP/" followed by the `version`.\n\nFinally, we require a `NEWLINE` at the end of our request line.\n\nLet\'s test this out on the editor.\n\n![request line](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/request-line.png)\n\nPerfect! Note that the `whitespace` rule does not produce a token, we only see `method`, `uri` and `version`. Let\'s continue with the headers.\n\n```\nheader = { header_name ~ ":" ~ whitespace ~ header_value ~ NEWLINE }\nheader_name = { (!(":" | NEWLINE) ~ ANY)+ }\nheader_value = { (!NEWLINE ~ ANY)+ }\n```\n\nIn here we say that a `header_name` is anything except for `:` , because this character is a **header separator**, it delimits the header name. We also don\'t want a new line, we will see why bellow.\nThe name is followed by the separator `:` and then 1 white space.\nThe `header_value` is anything except for a **new line**, because the new line delimits a `header`. After the value we encounter a new line.\n\nLet\'s test this again:\n\n![headers](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/headers.png)\n\nHere we can se that the parser matches 1 header as `{ header_name: "auth", header_value: "token" }`. Did you notice that it also say `headers > header` ? That is because we also want a rule that can matches a 1 or more `header` rules. We define this rule as:\n\n```\nheaders = { header+ }\n```\n\nThis way the pest parser will produce a token `headers` with a list of `header` matches.\n\nLastly the body:\n\n```\nbody = { ANY+ }\n```\n\nThe body is anything after the headers\n\n![body](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/body.png)\n\nSo far our grammar can parse 1 request from the input. Coming back to the original idea for this post, we want to be able to parse multiple http requests from a file. But here we have a conflict because our `body` rule will match anything after the headers, and that anything can be another request.\nTo solve this problem we need the help of a :sparkles: delimiter :sparkles:\n\n## The .http file syntax\n\nTo delimit each http request in our file we will make use of 3 `#` symbols (as the VS Code rest client does).\nLet\'s go add this to our grammar:\n\n```\ndelimiter = { "#"{3} ~ NEWLINE+ }\n```\n\nOur delimiter is exactly 3 number signs followed by 1 or more new lines. Then we can say that the `body` is anything except for a delimiter:\n\n```\nbody = { (!delimiter ~ ANY)+ }\n```\n\nLet\'s test this:\n\n![multiple requests](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/multiple.png)\n\nNice! So finally we can define what our http file should look like:\n\n```\nfile = { SOI ~ (delimiter | request)* ~ EOI}\n```\n\nOur http file is composed by delimiters or requests, 0 or more of them.\nWe have completed our http grammar, now it\'s time to get **rusty**\n\n![get schwifty](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/schwifty.jpeg)\n\n## Parsing http files\n\nWe will refer to [this example](https://pest.rs/book/examples/ini.html) for setting up the base code \n\n```rust\nextern crate pest;\n#[macro_use]\nextern crate pest_derive;\n\nuse pest::Parser;\n\n#[derive(Parser)]\n#[grammar = "grammar.pest"]\nstruct HttpParser;\n```\n\nWe will use the following file for testing\n\n```\nGET https://protiumx.github.io HTTP/1.1\nauthorization: token\n\n###\n\nPOST https://rq-rust.free.beeceptor.com/api HTTP/1.1\n\n{\n  "hello": "hola"\n}\n```\n\n**Note:** I set up a mock api in https://beeceptor.com/. It might not be available by the time you are reading this. But you can use any endpoint that accepts **POST**.\n\nLet\'s go ahead an parse the file\n\n```rust\nfn main() {\n    let unparsed_file = fs::read_to_string("test.http").expect("cannot read file");\n\n    let file = HttpParser::parse(Rule::file, &unparsed_file)\n        .expect("unsuccessful parse") // unwrap the parse result\n        .next().unwrap(); // get and unwrap the `file` rule; never fails\n\n\t\tprintln!("{:#?}", file);\n}\n```\n\nwe get: \n\n```\nPair {\n    rule: file,\n    span: Span {\n        str: "GET https://protiumx.github.io HTTP/1.1\\nauthorzation: token\\n\\n###\\n\\nPOST https://rq-rust.free.beeceptor.com/api HTTP/1.1\\n\\n{\\n  \\"hello\\": \\"hola\\"\\n}\\n",\n        start: 0,\n        end: 142,\n    },\n    inner: [\n        Pair {\n            rule: request,\n            span: Span {\n                str: "GET https://protiumx.github.io HTTP/1.1\\nauthorzation: token\\n\\n",\n                start: 0,\n                end: 61,\n            },\n            inner: [\n                Pair {\n                    rule: method,\n                    span: Span {\n                        str: "GET",\n                        start: 0,\n                        end: 3,\n                    },\n                    inner: [],\n                },\n...\n```\n\nThe `Pair` struct has a pretty clear structure and we could use to print each inner `Pair`. But we want to get rusty so we will put some effort.\n\nWe will define an `HttpFile` struct. This struct will contain a vector of `HttpRequest`.\nLet\'s define them:\n\n```rust\nuse std::collections::HashMap;\n\n#[derive(Debug)]\npub enum HttpMethod {\n    Get,\n    Post,\n    Put,\n    Delete,\n  \t// ...\n}\n\n#[derive(Debug)]\npub struct HttpRequest {\n    pub method: HttpMethod,\n    pub url: String,\n    pub version: String,\n    pub headers: HashMap<String, String>,\n    pub body: String,\n}\n\n#[derive(Debug)]\npub struct HttpFile {\n    pub requests: Vec<HttpRequest>,\n}\n```\n\nAnd to get even more rusty we will implement the `TryFrom` trait to each struct. Let\'s implement it for the `HttpFile`\n\n```rust\nimpl<\'i> TryFrom<Pair<\'i, Rule>> for HttpFile {\n    type Error = Error<Rule>;\n\n    fn try_from(pair: Pair<Rule>) -> Result<Self, Self::Error> {\n        let iterator = pair.into_inner();\n        let mut requests = vec![];\n        for item in iterator {\n            match item.as_rule() {\n                Rule::EOI => {\n                    break;\n                }\n                Rule::request => {\n                    requests.push(item.try_into()?);\n                }\n                _ => {}\n            }\n        }\n        Ok(Self { requests })\n    }\n}\n```\n\n**Note:** `Pair<\'i, Rule>` has the lifetime of the `input`.\nAs we know, the `file` rule can contain 0 or more of (delimiter | request). This means that in its content we can find: delimiter, request or End of File.\nHere we will **try** to parse each request, so we need the `TryFrom` trait for the `HttpRequest` struct\n\n```rust\nimpl<\'i> TryFrom<Pair<\'i, Rule>> for HttpRequest {\n    type Error = Error<Rule>;\n\n    fn try_from(pair: Pair<\'i, Rule>) -> Result<Self, Self::Error> {\n        let mut iterator = pair.into_inner();\n        let mut ret = Self {\n            method: iterator.next().unwrap().try_into()?,\n            url: iterator.next().unwrap().as_str().to_string(),\n            version: iterator.next().unwrap().as_str().to_string(),\n            headers: HashMap::new(),\n            body: String::new(),\n        };\n\n        for item in iterator {\n            match item.as_rule() {\n                Rule::headers => {\n                    ret.parse_headers(item.into_inner());\n                }\n                Rule::body => {\n                    ret.body = item.as_str().to_string();\n                }\n                _ => {\n                    unreachable!();\n                }\n            }\n        }\n\n        Ok(ret)\n    }\n}\n```\n\n![egghead](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/egghead.jpeg)\n\nEach `request` can have 5 inner matches: method, url, version, headers and body.\nThe first 3 do not have inner rules, so we can just extract them as `&str`. After this, the iterator can only have `headers` or `body` pairs. For the `headers` we perform a similar operation:\n\n```rust\nimpl HttpRequest {\n    fn parse_headers(&mut self, pairs: Pairs<Rule>) {\n        for item in pairs {\n            let mut kv = item.into_inner();\n            let key = kv.next().unwrap().as_str().to_string();\n            let value = kv.next().unwrap().as_str().to_string();\n            self.headers.insert(key, value);\n        }\n    }\n}\n```\n\nGrapes! We are pretty much done with the parser. Now let\'s use the parsed content to make the requests.\n\n## reqwest\n\nAfter a quick check of the available rust http client libraries I opted for [reqwest](https://crates.io/crates/reqwest). It has a pretty simple API and it seems to be among the most used libraries for this matters. But I\'m a bit concerned about all its dependencies so I might try [ureq](https://github.com/algesten/ureq) later.\n\nFor this part I just followed the examples on the docs website and ended up with this code:\n\n```rust\n#[derive(Default)]\npub struct HttpClient {\n    pub client: reqwest::blocking::Client,\n}\n\nimpl HttpClient {\n    pub fn new() -> Self {\n        let mut headers = header::HeaderMap::new();\n        headers.insert(\n            header::CONTENT_TYPE,\n            header::HeaderValue::from_static("application/json"),\n        );\n        headers.insert(\n            header::ACCEPT,\n            header::HeaderValue::from_static("application/json"),\n        );\n\n        let client = reqwest::blocking::Client::builder()\n            .timeout(Duration::from_secs(10))\n            .default_headers(headers)\n            .no_gzip()\n            .build()\n            .unwrap();\n        HttpClient { client }\n    }\n\n    pub fn execute(&self, req: &HttpRequest) -> Result<(), Box<dyn std::error::Error>> {\n        let request = self\n            .client\n            .request(Method::from_str(req.method.to_string().as_str())?, &req.url);\n\n        let headers: header::HeaderMap = (&req.headers).try_into()?;\n\n        let body = req.body.clone();\n        let res = request.headers(headers).body(body).send()?;\n\n        println!("{}\\n", res.text()?);\n\n        Ok(())\n    }\n}\n```\n\nWhat we can see in here:\n\n- Use the `ClientBuilder` to add some default headers and config for the request\n- Parse our `HttpMethod` into `reqwest::Method`. **Note:** `HttpMethod` implements the `Display` trait.\n- Parse our `HashMap<String, String` of headers into `reqwest::header::HeaderMap`. This is possible because it implements the `TryFrom<HashMap<String, String>>` trait.\n- Finally clone the body and send the request. We output the body of the request as `text` (this consumes the body)\n\n**Note:** We are not trimming the body, perhaps we should.\n\nNo we are ready for the last part: the interactive prompt\n\n## Lazyness kicks in\n\nAt this point I felt a bit lazy to implement the prompt so I searched for existing solutions, one of them being [inquire](https://github.com/mikaelmello/inquire). It has a pretty straight forward API, so to show an interactive select we just need this lines:\n\n```rust\n    let http_file = parse(&file_content).unwrap();\n\n    let request = Select::new("Select requests to execute:", http_file.requests)\n        .prompt()\n        .unwrap();\n\n    let client = HttpClient::new();\n    client.execute(&request)?;\n```\n\nNote that the `HttpRequest` implements the `Display` trait. \n\nThe result:\n\n![prompt](https://raw.githubusercontent.com/protiumx/blog/main/articles/005/prompt.png)\n\nGorgeous.\n\n## Unintroduction\n\nThis project turned out to be quite fun! I ended up naming it `rq` and you can see its source [here](https://github.com/protiumx/rq/)\n\nMy goal is to have a full interactive prompt that allows you to execute many request without existing the prompt mode.\nIf you would like to collaborate I have created a few TODO cards [here](https://github.com/protiumx/rq/projects/1).\n\nThat\'s it. Thanks for reading :alien:\n\nOthers posts:\n- [Publish your blog articles everywhere with this github action](https://dev.to/protium/publish-your-blog-articles-everywhere-with-this-github-action-3g6k)\n- [Coding Problems, TDD, and CI](https://dev.to/protium/coding-problems-tdd-and-ci-282n)\n- [Your new pretty and minimalist resume with LaTex](https://dev.to/protium/your-new-pretty-and-minimalist-resume-with-latex-421j)\n',a.user={name:t,username:t,twitter_username:n,github_username:"protiumx",website_url:"https://protiumx.dev/",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--M6rrcnOK--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/57513/a942e705-8b47-4a00-ac4f-302983772dd5.jpeg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--mik8foYb--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/57513/a942e705-8b47-4a00-ac4f-302983772dd5.jpeg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:n,state:{currentArticle:a},serverRendered:!0,routePath:"/protium/1093951",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:n}}}}(null,"2022-05-23T21:43:05Z",{},"https://dev.to/protium/an-http-request-parser-with-rust-and-pestrs-2p","protium")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
