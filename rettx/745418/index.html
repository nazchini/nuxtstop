<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Data Replication for DBMS using the Commit Log</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Data Replication for DBMS using the Commit Log</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/guide" class="tag" data-v-70afb46a>
          #guide
        </a><a href="/nuxtstop/t/postgres" class="tag" data-v-70afb46a>
          #postgres
        </a><a href="/nuxtstop/t/replication" class="tag" data-v-70afb46a>
          #replication
        </a><a href="/nuxtstop/t/database" class="tag" data-v-70afb46a>
          #database
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--204UOseD--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ch2tokdotc7wj7j7i1c2.jpeg" alt="Data Replication for DBMS using the Commit Log" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            2
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Jul 1 '21</time></div></header> <div class="content" data-v-70afb46a><p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--NBHdwfUw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1750/2021/06/with_text.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--NBHdwfUw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1750/2021/06/with_text.jpg" alt="Data Replication" loading="lazy"></a></p>

<h2>
  <a name="introduction" href="#introduction">
  </a>
  Introduction
</h2>

<p>In this article, we will see how developers can break down information silos for their teams and business by replicating data across multiple systems. First we will review why developers will replicate data and considerations for the cloud. Second, <a href="https://stargate.fandom.com/wiki/Replicator">we will prepare for war with the replicators</a>. Then we will examine the architecture of Postgres and MySQL and how their commit logs enable us to make exact copies of the data. Finally, we will connect Debezium to Postgres for a complete data replication solution.</p>

<h3>
  <a name="introduction-to-data-replication" href="#introduction-to-data-replication">
  </a>
  Introduction to Data Replication.
</h3>

<p>Data replication is the process of moving data between different database systems for various business use cases. In a typical SaaS (Software As A Service) application, data is stored in an operational database such as MySQL, PostgreSQL, Oracle, etc. There are other database systems such as data warehouses and search systems built for specialized use cases. Moving data between these systems is known as data replication.</p>

<p><em>Note: Data replication between the same database systems is done for availability and should not be confused with the data replication being discussed in this article.</em></p>

<h3>
  <a name="why-do-we-need-replication" href="#why-do-we-need-replication">
  </a>
  Why do we need replication?
</h3>

<p>Information silos are one of the biggest impediments for businesses to unlock value from their data and protect their assets. </p>

<ul>
<li>Operational inefficiency is the first problem that originates with these silos. Information is locked up in one particular business unit/access is limited only to a few people, and it becomes tough to develop and extend the applications further.</li>
<li>Technical limitations kick in next where the underlying single database/application cannot extend and serve the business needs for analytics, search, and even artificial intelligence.</li>
<li>Disaster recovery when a critical failure occurs is much easier with backups and multiple database systems to pull from.</li>
</ul>

<h3>
  <a name="data-platforms-cloud-vs-onpremise" href="#data-platforms-cloud-vs-onpremise">
  </a>
  Data Platforms - Cloud vs. On-Premise
</h3>

<p>Depending on the underlying architecture, enabling democratized access to data can be very challenging. Cloud computing has evolved so much in the past decades that even some massive companies managing their own data centers have moved to the cloud. Cloud-native architectures such as data pipelines, data lakes, data warehouses, and fully managed data systems are common. No company wants to spend money on the maintenance of rudimentary systems but rather on building its core business. Saving a few dollars by hosting their own infrastructure (on-premise) is no longer lucrative. With that said, there are a different set of challenges that come with the cloud, such as </p>

<ul>
<li>Security.</li>
<li>Vendor lock-in.</li>
<li>Cloud enablement and overhead.</li>
</ul>

<p>Regardless of the underlying architecture, i.e., whether it is cloud or on-premise, one can choose abstract designs so that they can be easily moved across and even be hybrid.<br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--N8gdvstp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/Data_Platform_Architecture-1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--N8gdvstp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/Data_Platform_Architecture-1.png" alt="Data Platform Architecture" loading="lazy"></a></p>

<p>We are going to focus exclusively on the first part, i.e., the replication in this article. This layer is the key to enabling further layers for business. </p>

<h2>
  <a name="how-does-data-replication-work" href="#how-does-data-replication-work">
  </a>
  How Does Data Replication Work?
</h2>

<p>Before we dive into solutions, we need to understand how replication works with standard operational databases (relational databases). </p>

<h3>
  <a name="postgres-database-log-architecture" href="#postgres-database-log-architecture">
  </a>
  Postgres Database Log Architecture
</h3>

<p>Relational database systems maintain something called a commit log (in PostgreSQL, it is called a Write Ahead Log or WAL log). These commit logs are written whenever a database transaction commit happens. Regardless of the database we use, almost all database logs have the following properties,</p>

<ul>
<li>The database log is a physical file on the disk. </li>
<li>Writes into the database log are sequential and ordered.</li>
<li>WAL logs are append-only logs. Any edit to already existing data is presented as a new entry into the log.</li>
<li>An entry to the log always happens before the actual data is written to the disk.</li>
<li>Transactions are not committed unless the log file commit is completed regardless of how many records the transaction operates upon.</li>
<li>At any point in time, PostgreSQL maintains something called a REDO point. Upon a database restart, the records are played back from that point in the WAL log. </li>
</ul>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--umbPf5aP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL-1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--umbPf5aP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL-1.png" alt="PostgreSQL WAL" loading="lazy"></a></p>

<h3>
  <a name="what-are-database-consistency-guarantees" href="#what-are-database-consistency-guarantees">
  </a>
  What are Database Consistency Guarantees?
</h3>

<p>The logging architecture of relational database systems is one of the oldest and one of the most battle-tested engineering ideas that we have today. Many newer systems drew their ideas and inspiration from them. Why such a logging system exists? </p>

<ul>
<li>Memory/RAM is volatile. Databases are often regarded as a source of truth, and whenever a system restart occurs, the database needs to rely on a solid mechanism for restore to happen when it starts up. The table format is not really suited for this. It is more oriented towards serving queries. </li>
<li>Replica databases that feed off the main database also rely on the WAL log for syncing up with the main database. </li>
<li>It also enables online backup and point-in-time recoveries.</li>
<li>Since the logs are written to disk in a sequential fashion and provide REDO guarantees, the table records can be flushed to disk in a more organized/batch fashion much later. They need not be written to disk immediately upon every table change/transaction. This also helps in caching as well.</li>
</ul>

<p>These properties help us to establish a solid base upon which further systems are built.</p>

<h3>
  <a name="postgresql-walbinlog-files" href="#postgresql-walbinlog-files">
  </a>
  PostgreSQL WAL/Binlog files
</h3>

<p>MySQL's architecture is very similar to PostgreSQL, but the WAL log of PostgreSQL combines both InnoDB's transaction log and binary log. Since MySQL implements multiple storage engines, the usage is segregated into different logs. The storage engine part is not within the scope of this article, so I will stick to PostgreSQL examples henceforth.</p>

<p>WAL file is actually a binary file and is located in the <code>pg_wal</code> directory of your PostgreSQL installation. A typical directory structure is shown below.<br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LnZ-2rG---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL_Folder.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LnZ-2rG---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL_Folder.png" alt="PostgreSQL WAL Log Folder" loading="lazy"></a></p>

<p>When we try to see the content, it will be something like below,<br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KlEhPQUC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1600/2021/06/PostgreSQL_WAL_Text.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KlEhPQUC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1600/2021/06/PostgreSQL_WAL_Text.png" alt="PostgreSQL WAL Log Content" loading="lazy"></a></p>

<p>PostgreSQL provides a facility called <a href="https://www.postgresql.org/docs/current/pgwaldump.html"><code>pg_waldump</code></a> to read these files. We can use <code>pg_waldump /path/to/wal/file</code> and it will decode the entire file into human-readable text. An excerpt from the text is provided below.</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>rmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106698, prev 0/2F1065E8, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16
rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F1066E8, prev 0/2F106698, desc: INSERT_LEAF off 292, blkref #0: rel 1663/16385/2659 blk 10
rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106728, prev 0/2F1066E8, desc: INSERT off 43 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56
rmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F1067D8, prev 0/2F106728, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16
rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106820, prev 0/2F1067D8, desc: INSERT_LEAF off 293, blkref #0: rel 1663/16385/2659 blk 10
rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106860, prev 0/2F106820, desc: INSERT off 44 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56
rmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F106910, prev 0/2F106860, desc: INSERT_LEAF off 47, blkref #0: rel 1663/16385/2658 blk 16
rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106958, prev 0/2F106910, desc: INSERT_LEAF off 294, blkref #0: rel 1663/16385/2659 blk 10
rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106998, prev 0/2F106958, desc: INSERT off 45 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56
rmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106A48, prev 0/2F106998, desc: INSERT_LEAF off 42, blkref #0: rel 1663/16385/2658 blk 16
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<h2>
  <a name="database-replication-techniques" href="#database-replication-techniques">
  </a>
  Database Replication Techniques
</h2>

<p>So far, we have seen things in an abstract fashion. We started from why companies need to unlock the full potential of their database, which leads to data replication and data platforms. To understand how replication works, further sections of this article will focus on a specific database platform, PostgreSQL. Most of the concepts are similar for other database systems as well, so this can be used as a reference to form a mental framework around database replication itself.</p>

<p>We saw how WAL enables the database to maintain data integrity, consistency in case of system shutdowns, and even rolling back from data corruption. Like many other systems out there, PostgreSQL also evolved from the ground up, and as such, we need to understand how replication works within two nodes of the same database and how we can extend that to other data systems. Regardless of whatever replication mechanism we discuss below, it relies upon the WAL for replication.</p>
<h3>
  <a name="physical-replication" href="#physical-replication">
  </a>
  Physical Replication
</h3>

<p>Physical replication has been existing in PostgreSQL for quite a while. It is used to replicate the whole of the database by physical copy or byte-to-byte copy. Any change made to the main database is also reflected in the replica database without any changes. The replica can choose to be a hot standby node (i.e., the main database fails, and the replica takes over as the main/master).</p>

<p>There are several ways of physical replication, such as log shipping, streaming replication, etc., but they can largely be classified into two categories.</p>

<ul>
<li>Synchronous replication.</li>
<li>Asynchronous replication.</li>
</ul>

<p>There are several restrictions for this type of replication, such as the listening database should also be in the same major version; partial content cannot be replicated; and so on. For these reasons, physical replication is typically used to sync data between two PostgreSQL database systems, mainly for high availability reasons. </p>
<h3>
  <a name="logical-decoding" href="#logical-decoding">
  </a>
  Logical Decoding
</h3>

<p>Before version 10 (shown below), other options allowed developers/engineers to replicate without logical replication to other downstream systems. As the name suggests, logical decoding decodes the WAL content into a human-readable format and replicates it to different consumers. There are both advantages and disadvantages to this approach. Still, since this step requires plugins/installations in the host database system, it is often difficult to maintain, particularly in cloud environments.</p>
<h3>
  <a name="logical-replication" href="#logical-replication">
  </a>
  Logical Replication
</h3>

<p>Starting from PostgreSQL version 10, <a href="https://www.postgresql.org/docs/current/logical-replication.html">logical replication</a> is available to replicate data from PostgreSQL databases. As mentioned in the documentation, logical replication is based on a publish-subscribe model. One or more subscribers can choose to listen to the published data and publish and subscribe only to specific databases/tables.</p>

<p>It is clear that logical replication was targeted more towards replicating to other data systems such as a messaging system, data lakes, and data warehouses. It is much easier to also listen from multiple databases as well. We will choose an open-source tool called <a href="https://debezium.io/documentation/reference/1.5/postgres-plugins.html">Debezium</a> to build our replication pipeline.</p>
<h2>
  <a name="an-open-source-data-replication-architecture-based-on-debezium" href="#an-open-source-data-replication-architecture-based-on-debezium">
  </a>
  An Open Source Data Replication Architecture Based on Debezium.
</h2>

<p>In this section, we will see a demo on how to use Debezium for the Change Data Capture (CDC) happening in our PostgreSQL source database. We will use Docker to quickly set up the database and debezium connector to listen to the changes.</p>

<p>We wrote a full detailed tutorial on <a href="https://dev.to__GHOST_URL__/kafka-tutorial/1/#set-up-a-debezium-connector-for-postgresql">setting up Debezium and Postgres using Docker</a>. The most important parts are described below but please see the link above for all the details!</p>
<h3>
  <a name="set-up-a-debezium-connector-for-postgresql" href="#set-up-a-debezium-connector-for-postgresql">
  </a>
  Set Up A Debezium Connector for PostgreSQL
</h3>

<p>Before we activate Debezium, we need to prepare Postgres by making some configuration changes. Debezium utilizes the WAL that we described above. Postgres uses this log to ensure data integrity and manage row versions and transactions. Postgres' WAL has several modes you can configure it to, and for Debezium to work, the WAL level must be set to <code>replica</code>. Let's change that now.</p>
<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>psql> alter system set wal_level to 'replica';
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<p>You may need to restart the Postgres container for this change to take effect.</p>

<p>There is one Postgres plugin not included with the image we used that we will need: <code>wal2json</code>. Debezium can work with either <code>wal2json</code> or <code>protobuf</code>. For this tutorial, we will use <code>wal2json</code>. As its name implies, it converts Postgres' write-ahead logs to JSON format.</p>

<p>With our Docker app running, let's manually install wal2json using aptitude. To get to the shell of the Postgres container, first find the container ID and then run the following command to open bash:</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>$ docker ps

CONTAINER ID   IMAGE               
c429f6d35017   debezium/connect    
7d908378d1cf   debezium/kafka      
cc3b1f05e552   debezium/zookeeper  
4a10f43aad19   postgres:latest     

$ docker exec -ti 4a10f43aad19 bash
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<p>Now that we're inside the container, let's install wal2json:</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>$ apt-get update && apt-get install postgresql-13-wal2json
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<h3>
  <a name="activate-debezium" href="#activate-debezium">
  </a>
  Activate Debezium
</h3>

<p>We're ready to activate Debezium!</p>

<p>We can communicate with Debezium by making HTTP requests to it. We need to make a POST request whose data is a configuration in JSON format. This JSON defines the parameters of the connector we're attempting to create. We'll put the configuration JSON into a file and then use <code>curl</code> to send it to Debezium.</p>

<p>You have several configuration options at this point. This is where you can use a whitelist or blacklist if you only want Debezium to stream certain tables (or avoid certain tables).</p>
<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>$ echo '
{
    "name": "arctype-connector",
    "config": {
        "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
        "tasks.max": "1",
        "plugin.name": "wal2json",
        "database.hostname": "db",
        "database.port": "5432",
        "database.user": "postgres",
        "database.password": "arctype",
        "database.dbname": "postgres",
        "database.server.name": "ARCTYPE",
        "key.converter": "org.apache.kafka.connect.json.JsonConverter",
        "value.converter": "org.apache.kafka.connect.json.JsonConverter",
        "key.converter.schemas.enable": "false",
        "value.converter.schemas.enable": "false",
        "snapshot.mode": "always"
    }
}
' > debezium.json
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<p>Now we can send this configuration to Debezium.</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>$ curl -i -X POST \
         -H "Accept:application/json" \
         -H "Content-Type:application/json" \
         127.0.0.1:8083/connectors/ \
         --data "@debezium.json"
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<p>The response will be a JSON representation of the newly initiated connector.</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>{
  "name": "arctype-connector",
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
    "tasks.max": "1",
    "plugin.name": "wal2json",
    "database.hostname": "db",
    "database.port": "5432",
    "database.user": "postgres",
    "database.password": "arctype",
    "database.dbname": "postgres",
    "database.server.name": "ARCTYPE",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "false",
    "value.converter.schemas.enable": "false",
    "snapshot.mode": "always",
    "name": "arctype-connector"
  },
  "tasks": [],
  "type": "source"
}
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>

<p><a href="https://dev.to__GHOST_URL__/kafka-tutorial/1/">The installation, setup, and demo part has already been written in a separate article by the Arctype team</a>.</p>

<h2>
  <a name="data-quality-consistency-and-other-challenges" href="#data-quality-consistency-and-other-challenges">
  </a>
  Data Quality, Consistency and Other Challenges
</h2>

<p>It is important to understand that once we are using Debezium and listening through the logs, we have left the realm of relational databases with ACID guarantees and into the world of distributed systems. With our choice as Kafka for the messaging system, the <a href="https://kafka.apache.org/documentation/#semantics">semantics</a> it follows decides how we replicate/distribute data to further downstream systems.</p>

<ul>
<li>If we are making these changes and directly persisting it in a search index such as Elastic search, then - "<em>At least once—Messages are never lost but may be redelivered</em>" maybe more suitable.</li>
<li>If the data is being delivered to a machine learning algorithm, then - "<em>At most once—Messages may be lost but are never redelivered</em>."</li>
<li>If we are delivering to a data warehouse, then - "<em>Exactly once—Each message is delivered once and only once.</em>"</li>
</ul>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7odPb0pO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1625163311002/AVH3XnjpK.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7odPb0pO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1625163311002/AVH3XnjpK.png" alt="Screen Shot 2021-07-01 at 1.13.34 PM.png" loading="lazy"></a></p>

<p>The third message delivery mechanism is incredibly hard to solve in a distributed system. Kafka is one among the systems that has solved this at scale, but each has its own drawbacks regarding throughput, scale, and accuracy. One must make an informed choice to balance out what is necessary.</p>

<h2>
  <a name="conclusion" href="#conclusion">
  </a>
  Conclusion
</h2>

<p>As a business expands, the need to ethically leverage data is not a luxury anymore but a necessity. Data platforms are becoming increasingly common even across mid-sized businesses. They enable,</p>

<ul>
<li>Availability.</li>
<li>Governance.</li>
<li>Security.</li>
<li>Business strategy.</li>
</ul>

<p>There has never been a better time to unlock the value of data.</p>

<h2>
  <a name="references" href="#references">
  </a>
  References
</h2>

<ul>
<li><a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">The Log: What every software engineer should know about real-time data's unifying abstraction</a></li>
<li><a href="https://dev.to/arctype/streaming-data-with-postgresql-kafka-debezium-part-1-4e39">Streaming Data with PostgreSQL + Kafka + Debezium</a></li>
</ul>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/rettx/data-replication-for-dbms-using-the-commit-log-1pik" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(e,t,a,n){return a.type_of="article",a.id=745418,a.title="Data Replication for DBMS using the Commit Log",a.description="Introduction   In this article, we will see how developers can break down information...",a.readable_publish_date="Jul 1 '21",a.slug="data-replication-for-dbms-using-the-commit-log-1pik",a.path="/arctype/data-replication-for-dbms-using-the-commit-log-1pik",a.url="https://dev.to/arctype/data-replication-for-dbms-using-the-commit-log-1pik",a.comments_count=0,a.public_reactions_count=2,a.collection_id=e,a.published_timestamp=t,a.positive_reactions_count=2,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--204UOseD--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ch2tokdotc7wj7j7i1c2.jpeg",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--cIen-_0a--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ch2tokdotc7wj7j7i1c2.jpeg",a.canonical_url="https://arctype.com/blog/data-replication-process-dbms",a.created_at="2021-07-01T18:21:23Z",a.edited_at=e,a.crossposted_at=e,a.published_at=t,a.last_comment_at=t,a.reading_time_minutes=11,a.tag_list="guide, postgres, replication, database",a.tags=["guide","postgres","replication","database"],a.body_html='<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--NBHdwfUw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1750/2021/06/with_text.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--NBHdwfUw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1750/2021/06/with_text.jpg" alt="Data Replication" loading="lazy"></a></p>\n\n<h2>\n  <a name="introduction" href="#introduction">\n  </a>\n  Introduction\n</h2>\n\n<p>In this article, we will see how developers can break down information silos for their teams and business by replicating data across multiple systems. First we will review why developers will replicate data and considerations for the cloud. Second, <a href="https://stargate.fandom.com/wiki/Replicator">we will prepare for war with the replicators</a>. Then we will examine the architecture of Postgres and MySQL and how their commit logs enable us to make exact copies of the data. Finally, we will connect Debezium to Postgres for a complete data replication solution.</p>\n\n<h3>\n  <a name="introduction-to-data-replication" href="#introduction-to-data-replication">\n  </a>\n  Introduction to Data Replication.\n</h3>\n\n<p>Data replication is the process of moving data between different database systems for various business use cases. In a typical SaaS (Software As A Service) application, data is stored in an operational database such as MySQL, PostgreSQL, Oracle, etc. There are other database systems such as data warehouses and search systems built for specialized use cases. Moving data between these systems is known as data replication.</p>\n\n<p><em>Note: Data replication between the same database systems is done for availability and should not be confused with the data replication being discussed in this article.</em></p>\n\n<h3>\n  <a name="why-do-we-need-replication" href="#why-do-we-need-replication">\n  </a>\n  Why do we need replication?\n</h3>\n\n<p>Information silos are one of the biggest impediments for businesses to unlock value from their data and protect their assets. </p>\n\n<ul>\n<li>Operational inefficiency is the first problem that originates with these silos. Information is locked up in one particular business unit/access is limited only to a few people, and it becomes tough to develop and extend the applications further.</li>\n<li>Technical limitations kick in next where the underlying single database/application cannot extend and serve the business needs for analytics, search, and even artificial intelligence.</li>\n<li>Disaster recovery when a critical failure occurs is much easier with backups and multiple database systems to pull from.</li>\n</ul>\n\n<h3>\n  <a name="data-platforms-cloud-vs-onpremise" href="#data-platforms-cloud-vs-onpremise">\n  </a>\n  Data Platforms - Cloud vs. On-Premise\n</h3>\n\n<p>Depending on the underlying architecture, enabling democratized access to data can be very challenging. Cloud computing has evolved so much in the past decades that even some massive companies managing their own data centers have moved to the cloud. Cloud-native architectures such as data pipelines, data lakes, data warehouses, and fully managed data systems are common. No company wants to spend money on the maintenance of rudimentary systems but rather on building its core business. Saving a few dollars by hosting their own infrastructure (on-premise) is no longer lucrative. With that said, there are a different set of challenges that come with the cloud, such as </p>\n\n<ul>\n<li>Security.</li>\n<li>Vendor lock-in.</li>\n<li>Cloud enablement and overhead.</li>\n</ul>\n\n<p>Regardless of the underlying architecture, i.e., whether it is cloud or on-premise, one can choose abstract designs so that they can be easily moved across and even be hybrid.<br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--N8gdvstp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/Data_Platform_Architecture-1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--N8gdvstp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/Data_Platform_Architecture-1.png" alt="Data Platform Architecture" loading="lazy"></a></p>\n\n<p>We are going to focus exclusively on the first part, i.e., the replication in this article. This layer is the key to enabling further layers for business. </p>\n\n<h2>\n  <a name="how-does-data-replication-work" href="#how-does-data-replication-work">\n  </a>\n  How Does Data Replication Work?\n</h2>\n\n<p>Before we dive into solutions, we need to understand how replication works with standard operational databases (relational databases). </p>\n\n<h3>\n  <a name="postgres-database-log-architecture" href="#postgres-database-log-architecture">\n  </a>\n  Postgres Database Log Architecture\n</h3>\n\n<p>Relational database systems maintain something called a commit log (in PostgreSQL, it is called a Write Ahead Log or WAL log). These commit logs are written whenever a database transaction commit happens. Regardless of the database we use, almost all database logs have the following properties,</p>\n\n<ul>\n<li>The database log is a physical file on the disk. </li>\n<li>Writes into the database log are sequential and ordered.</li>\n<li>WAL logs are append-only logs. Any edit to already existing data is presented as a new entry into the log.</li>\n<li>An entry to the log always happens before the actual data is written to the disk.</li>\n<li>Transactions are not committed unless the log file commit is completed regardless of how many records the transaction operates upon.</li>\n<li>At any point in time, PostgreSQL maintains something called a REDO point. Upon a database restart, the records are played back from that point in the WAL log. </li>\n</ul>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--umbPf5aP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL-1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--umbPf5aP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL-1.png" alt="PostgreSQL WAL" loading="lazy"></a></p>\n\n<h3>\n  <a name="what-are-database-consistency-guarantees" href="#what-are-database-consistency-guarantees">\n  </a>\n  What are Database Consistency Guarantees?\n</h3>\n\n<p>The logging architecture of relational database systems is one of the oldest and one of the most battle-tested engineering ideas that we have today. Many newer systems drew their ideas and inspiration from them. Why such a logging system exists? </p>\n\n<ul>\n<li>Memory/RAM is volatile. Databases are often regarded as a source of truth, and whenever a system restart occurs, the database needs to rely on a solid mechanism for restore to happen when it starts up. The table format is not really suited for this. It is more oriented towards serving queries. </li>\n<li>Replica databases that feed off the main database also rely on the WAL log for syncing up with the main database. </li>\n<li>It also enables online backup and point-in-time recoveries.</li>\n<li>Since the logs are written to disk in a sequential fashion and provide REDO guarantees, the table records can be flushed to disk in a more organized/batch fashion much later. They need not be written to disk immediately upon every table change/transaction. This also helps in caching as well.</li>\n</ul>\n\n<p>These properties help us to establish a solid base upon which further systems are built.</p>\n\n<h3>\n  <a name="postgresql-walbinlog-files" href="#postgresql-walbinlog-files">\n  </a>\n  PostgreSQL WAL/Binlog files\n</h3>\n\n<p>MySQL\'s architecture is very similar to PostgreSQL, but the WAL log of PostgreSQL combines both InnoDB\'s transaction log and binary log. Since MySQL implements multiple storage engines, the usage is segregated into different logs. The storage engine part is not within the scope of this article, so I will stick to PostgreSQL examples henceforth.</p>\n\n<p>WAL file is actually a binary file and is located in the <code>pg_wal</code> directory of your PostgreSQL installation. A typical directory structure is shown below.<br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LnZ-2rG---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL_Folder.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LnZ-2rG---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL_Folder.png" alt="PostgreSQL WAL Log Folder" loading="lazy"></a></p>\n\n<p>When we try to see the content, it will be something like below,<br>\n<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KlEhPQUC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1600/2021/06/PostgreSQL_WAL_Text.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KlEhPQUC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://arctype.com/blog/content/images/size/w1600/2021/06/PostgreSQL_WAL_Text.png" alt="PostgreSQL WAL Log Content" loading="lazy"></a></p>\n\n<p>PostgreSQL provides a facility called <a href="https://www.postgresql.org/docs/current/pgwaldump.html"><code>pg_waldump</code></a> to read these files. We can use <code>pg_waldump /path/to/wal/file</code> and it will decode the entire file into human-readable text. An excerpt from the text is provided below.</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>rmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106698, prev 0/2F1065E8, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16\nrmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F1066E8, prev 0/2F106698, desc: INSERT_LEAF off 292, blkref #0: rel 1663/16385/2659 blk 10\nrmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106728, prev 0/2F1066E8, desc: INSERT off 43 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\nrmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F1067D8, prev 0/2F106728, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16\nrmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106820, prev 0/2F1067D8, desc: INSERT_LEAF off 293, blkref #0: rel 1663/16385/2659 blk 10\nrmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106860, prev 0/2F106820, desc: INSERT off 44 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\nrmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F106910, prev 0/2F106860, desc: INSERT_LEAF off 47, blkref #0: rel 1663/16385/2658 blk 16\nrmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106958, prev 0/2F106910, desc: INSERT_LEAF off 294, blkref #0: rel 1663/16385/2659 blk 10\nrmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106998, prev 0/2F106958, desc: INSERT off 45 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\nrmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106A48, prev 0/2F106998, desc: INSERT_LEAF off 42, blkref #0: rel 1663/16385/2658 blk 16\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n<h2>\n  <a name="database-replication-techniques" href="#database-replication-techniques">\n  </a>\n  Database Replication Techniques\n</h2>\n\n<p>So far, we have seen things in an abstract fashion. We started from why companies need to unlock the full potential of their database, which leads to data replication and data platforms. To understand how replication works, further sections of this article will focus on a specific database platform, PostgreSQL. Most of the concepts are similar for other database systems as well, so this can be used as a reference to form a mental framework around database replication itself.</p>\n\n<p>We saw how WAL enables the database to maintain data integrity, consistency in case of system shutdowns, and even rolling back from data corruption. Like many other systems out there, PostgreSQL also evolved from the ground up, and as such, we need to understand how replication works within two nodes of the same database and how we can extend that to other data systems. Regardless of whatever replication mechanism we discuss below, it relies upon the WAL for replication.</p>\n<h3>\n  <a name="physical-replication" href="#physical-replication">\n  </a>\n  Physical Replication\n</h3>\n\n<p>Physical replication has been existing in PostgreSQL for quite a while. It is used to replicate the whole of the database by physical copy or byte-to-byte copy. Any change made to the main database is also reflected in the replica database without any changes. The replica can choose to be a hot standby node (i.e., the main database fails, and the replica takes over as the main/master).</p>\n\n<p>There are several ways of physical replication, such as log shipping, streaming replication, etc., but they can largely be classified into two categories.</p>\n\n<ul>\n<li>Synchronous replication.</li>\n<li>Asynchronous replication.</li>\n</ul>\n\n<p>There are several restrictions for this type of replication, such as the listening database should also be in the same major version; partial content cannot be replicated; and so on. For these reasons, physical replication is typically used to sync data between two PostgreSQL database systems, mainly for high availability reasons. </p>\n<h3>\n  <a name="logical-decoding" href="#logical-decoding">\n  </a>\n  Logical Decoding\n</h3>\n\n<p>Before version 10 (shown below), other options allowed developers/engineers to replicate without logical replication to other downstream systems. As the name suggests, logical decoding decodes the WAL content into a human-readable format and replicates it to different consumers. There are both advantages and disadvantages to this approach. Still, since this step requires plugins/installations in the host database system, it is often difficult to maintain, particularly in cloud environments.</p>\n<h3>\n  <a name="logical-replication" href="#logical-replication">\n  </a>\n  Logical Replication\n</h3>\n\n<p>Starting from PostgreSQL version 10, <a href="https://www.postgresql.org/docs/current/logical-replication.html">logical replication</a> is available to replicate data from PostgreSQL databases. As mentioned in the documentation, logical replication is based on a publish-subscribe model. One or more subscribers can choose to listen to the published data and publish and subscribe only to specific databases/tables.</p>\n\n<p>It is clear that logical replication was targeted more towards replicating to other data systems such as a messaging system, data lakes, and data warehouses. It is much easier to also listen from multiple databases as well. We will choose an open-source tool called <a href="https://debezium.io/documentation/reference/1.5/postgres-plugins.html">Debezium</a> to build our replication pipeline.</p>\n<h2>\n  <a name="an-open-source-data-replication-architecture-based-on-debezium" href="#an-open-source-data-replication-architecture-based-on-debezium">\n  </a>\n  An Open Source Data Replication Architecture Based on Debezium.\n</h2>\n\n<p>In this section, we will see a demo on how to use Debezium for the Change Data Capture (CDC) happening in our PostgreSQL source database. We will use Docker to quickly set up the database and debezium connector to listen to the changes.</p>\n\n<p>We wrote a full detailed tutorial on <a href="https://dev.to__GHOST_URL__/kafka-tutorial/1/#set-up-a-debezium-connector-for-postgresql">setting up Debezium and Postgres using Docker</a>. The most important parts are described below but please see the link above for all the details!</p>\n<h3>\n  <a name="set-up-a-debezium-connector-for-postgresql" href="#set-up-a-debezium-connector-for-postgresql">\n  </a>\n  Set Up A Debezium Connector for PostgreSQL\n</h3>\n\n<p>Before we activate Debezium, we need to prepare Postgres by making some configuration changes. Debezium utilizes the WAL that we described above. Postgres uses this log to ensure data integrity and manage row versions and transactions. Postgres\' WAL has several modes you can configure it to, and for Debezium to work, the WAL level must be set to <code>replica</code>. Let\'s change that now.</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>psql&gt; alter system set wal_level to \'replica\';\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<p>You may need to restart the Postgres container for this change to take effect.</p>\n\n<p>There is one Postgres plugin not included with the image we used that we will need: <code>wal2json</code>. Debezium can work with either <code>wal2json</code> or <code>protobuf</code>. For this tutorial, we will use <code>wal2json</code>. As its name implies, it converts Postgres\' write-ahead logs to JSON format.</p>\n\n<p>With our Docker app running, let\'s manually install wal2json using aptitude. To get to the shell of the Postgres container, first find the container ID and then run the following command to open bash:</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>$ docker ps\n\nCONTAINER ID   IMAGE               \nc429f6d35017   debezium/connect    \n7d908378d1cf   debezium/kafka      \ncc3b1f05e552   debezium/zookeeper  \n4a10f43aad19   postgres:latest     \n\n$ docker exec -ti 4a10f43aad19 bash\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<p>Now that we\'re inside the container, let\'s install wal2json:</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>$ apt-get update &amp;&amp; apt-get install postgresql-13-wal2json\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n<h3>\n  <a name="activate-debezium" href="#activate-debezium">\n  </a>\n  Activate Debezium\n</h3>\n\n<p>We\'re ready to activate Debezium!</p>\n\n<p>We can communicate with Debezium by making HTTP requests to it. We need to make a POST request whose data is a configuration in JSON format. This JSON defines the parameters of the connector we\'re attempting to create. We\'ll put the configuration JSON into a file and then use <code>curl</code> to send it to Debezium.</p>\n\n<p>You have several configuration options at this point. This is where you can use a whitelist or blacklist if you only want Debezium to stream certain tables (or avoid certain tables).</p>\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>$ echo \'\n{\n    "name": "arctype-connector",\n    "config": {\n        "connector.class": "io.debezium.connector.postgresql.PostgresConnector",\n        "tasks.max": "1",\n        "plugin.name": "wal2json",\n        "database.hostname": "db",\n        "database.port": "5432",\n        "database.user": "postgres",\n        "database.password": "arctype",\n        "database.dbname": "postgres",\n        "database.server.name": "ARCTYPE",\n        "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n        "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n        "key.converter.schemas.enable": "false",\n        "value.converter.schemas.enable": "false",\n        "snapshot.mode": "always"\n    }\n}\n\' &gt; debezium.json\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<p>Now we can send this configuration to Debezium.</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>$ curl -i -X POST \\\n         -H "Accept:application/json" \\\n         -H "Content-Type:application/json" \\\n         127.0.0.1:8083/connectors/ \\\n         --data "@debezium.json"\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<p>The response will be a JSON representation of the newly initiated connector.</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight plaintext"><code>{\n  "name": "arctype-connector",\n  "config": {\n    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",\n    "tasks.max": "1",\n    "plugin.name": "wal2json",\n    "database.hostname": "db",\n    "database.port": "5432",\n    "database.user": "postgres",\n    "database.password": "arctype",\n    "database.dbname": "postgres",\n    "database.server.name": "ARCTYPE",\n    "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n    "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n    "key.converter.schemas.enable": "false",\n    "value.converter.schemas.enable": "false",\n    "snapshot.mode": "always",\n    "name": "arctype-connector"\n  },\n  "tasks": [],\n  "type": "source"\n}\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n<p><a href="https://dev.to__GHOST_URL__/kafka-tutorial/1/">The installation, setup, and demo part has already been written in a separate article by the Arctype team</a>.</p>\n\n<h2>\n  <a name="data-quality-consistency-and-other-challenges" href="#data-quality-consistency-and-other-challenges">\n  </a>\n  Data Quality, Consistency and Other Challenges\n</h2>\n\n<p>It is important to understand that once we are using Debezium and listening through the logs, we have left the realm of relational databases with ACID guarantees and into the world of distributed systems. With our choice as Kafka for the messaging system, the <a href="https://kafka.apache.org/documentation/#semantics">semantics</a> it follows decides how we replicate/distribute data to further downstream systems.</p>\n\n<ul>\n<li>If we are making these changes and directly persisting it in a search index such as Elastic search, then - "<em>At least once—Messages are never lost but may be redelivered</em>" maybe more suitable.</li>\n<li>If the data is being delivered to a machine learning algorithm, then - "<em>At most once—Messages may be lost but are never redelivered</em>."</li>\n<li>If we are delivering to a data warehouse, then - "<em>Exactly once—Each message is delivered once and only once.</em>"</li>\n</ul>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7odPb0pO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1625163311002/AVH3XnjpK.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7odPb0pO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1625163311002/AVH3XnjpK.png" alt="Screen Shot 2021-07-01 at 1.13.34 PM.png" loading="lazy"></a></p>\n\n<p>The third message delivery mechanism is incredibly hard to solve in a distributed system. Kafka is one among the systems that has solved this at scale, but each has its own drawbacks regarding throughput, scale, and accuracy. One must make an informed choice to balance out what is necessary.</p>\n\n<h2>\n  <a name="conclusion" href="#conclusion">\n  </a>\n  Conclusion\n</h2>\n\n<p>As a business expands, the need to ethically leverage data is not a luxury anymore but a necessity. Data platforms are becoming increasingly common even across mid-sized businesses. They enable,</p>\n\n<ul>\n<li>Availability.</li>\n<li>Governance.</li>\n<li>Security.</li>\n<li>Business strategy.</li>\n</ul>\n\n<p>There has never been a better time to unlock the value of data.</p>\n\n<h2>\n  <a name="references" href="#references">\n  </a>\n  References\n</h2>\n\n<ul>\n<li><a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">The Log: What every software engineer should know about real-time data\'s unifying abstraction</a></li>\n<li><a href="https://dev.to/arctype/streaming-data-with-postgresql-kafka-debezium-part-1-4e39">Streaming Data with PostgreSQL + Kafka + Debezium</a></li>\n</ul>\n\n',a.body_markdown='![Data Replication](https://arctype.com/blog/content/images/size/w1750/2021/06/with_text.jpg)\n\n## Introduction\n\nIn this article, we will see how developers can break down information silos for their teams and business by replicating data across multiple systems. First we will review why developers will replicate data and considerations for the cloud. Second, [we will prepare for war with the replicators](https://stargate.fandom.com/wiki/Replicator). Then we will examine the architecture of Postgres and MySQL and how their commit logs enable us to make exact copies of the data. Finally, we will connect Debezium to Postgres for a complete data replication solution.\n\n### Introduction to Data Replication.\n\nData replication is the process of moving data between different database systems for various business use cases. In a typical SaaS (Software As A Service) application, data is stored in an operational database such as MySQL, PostgreSQL, Oracle, etc. There are other database systems such as data warehouses and search systems built for specialized use cases. Moving data between these systems is known as data replication.\n\n*Note: Data replication between the same database systems is done for availability and should not be confused with the data replication being discussed in this article.*\n\n### Why do we need replication?\n\nInformation silos are one of the biggest impediments for businesses to unlock value from their data and protect their assets. \n\n- Operational inefficiency is the first problem that originates with these silos. Information is locked up in one particular business unit/access is limited only to a few people, and it becomes tough to develop and extend the applications further.\n- Technical limitations kick in next where the underlying single database/application cannot extend and serve the business needs for analytics, search, and even artificial intelligence.\n- Disaster recovery when a critical failure occurs is much easier with backups and multiple database systems to pull from.\n\n### Data Platforms - Cloud vs. On-Premise \n\nDepending on the underlying architecture, enabling democratized access to data can be very challenging. Cloud computing has evolved so much in the past decades that even some massive companies managing their own data centers have moved to the cloud. Cloud-native architectures such as data pipelines, data lakes, data warehouses, and fully managed data systems are common. No company wants to spend money on the maintenance of rudimentary systems but rather on building its core business. Saving a few dollars by hosting their own infrastructure (on-premise) is no longer lucrative. With that said, there are a different set of challenges that come with the cloud, such as \n\n- Security.\n- Vendor lock-in.\n- Cloud enablement and overhead.\n\nRegardless of the underlying architecture, i.e., whether it is cloud or on-premise, one can choose abstract designs so that they can be easily moved across and even be hybrid.\n![Data Platform Architecture](https://arctype.com/blog/content/images/2021/06/Data_Platform_Architecture-1.png)\n\nWe are going to focus exclusively on the first part, i.e., the replication in this article. This layer is the key to enabling further layers for business. \n\n## How Does Data Replication Work?\n\nBefore we dive into solutions, we need to understand how replication works with standard operational databases (relational databases). \n\n### Postgres Database Log Architecture\n\nRelational database systems maintain something called a commit log (in PostgreSQL, it is called a Write Ahead Log or WAL log). These commit logs are written whenever a database transaction commit happens. Regardless of the database we use, almost all database logs have the following properties,\n\n- The database log is a physical file on the disk. \n- Writes into the database log are sequential and ordered.\n- WAL logs are append-only logs. Any edit to already existing data is presented as a new entry into the log.\n- An entry to the log always happens before the actual data is written to the disk.\n- Transactions are not committed unless the log file commit is completed regardless of how many records the transaction operates upon.\n- At any point in time, PostgreSQL maintains something called a REDO point. Upon a database restart, the records are played back from that point in the WAL log. \n\n![PostgreSQL WAL](https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL-1.png)\n\n### What are Database Consistency Guarantees?\n\nThe logging architecture of relational database systems is one of the oldest and one of the most battle-tested engineering ideas that we have today. Many newer systems drew their ideas and inspiration from them. Why such a logging system exists? \n\n- Memory/RAM is volatile. Databases are often regarded as a source of truth, and whenever a system restart occurs, the database needs to rely on a solid mechanism for restore to happen when it starts up. The table format is not really suited for this. It is more oriented towards serving queries. \n- Replica databases that feed off the main database also rely on the WAL log for syncing up with the main database. \n- It also enables online backup and point-in-time recoveries.\n- Since the logs are written to disk in a sequential fashion and provide REDO guarantees, the table records can be flushed to disk in a more organized/batch fashion much later. They need not be written to disk immediately upon every table change/transaction. This also helps in caching as well.\n\nThese properties help us to establish a solid base upon which further systems are built.\n\n### PostgreSQL WAL/Binlog files\n\nMySQL\'s architecture is very similar to PostgreSQL, but the WAL log of PostgreSQL combines both InnoDB\'s transaction log and binary log. Since MySQL implements multiple storage engines, the usage is segregated into different logs. The storage engine part is not within the scope of this article, so I will stick to PostgreSQL examples henceforth.\n\nWAL file is actually a binary file and is located in the `pg_wal` directory of your PostgreSQL installation. A typical directory structure is shown below.\n![PostgreSQL WAL Log Folder](https://arctype.com/blog/content/images/2021/06/PostgreSQL_WAL_Folder.png)\n\nWhen we try to see the content, it will be something like below,\n![PostgreSQL WAL Log Content](https://arctype.com/blog/content/images/size/w1600/2021/06/PostgreSQL_WAL_Text.png)\n\nPostgreSQL provides a facility called [`pg_waldump`](https://www.postgresql.org/docs/current/pgwaldump.html) to read these files. We can use `pg_waldump /path/to/wal/file` and it will decode the entire file into human-readable text. An excerpt from the text is provided below.\n\n    rmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106698, prev 0/2F1065E8, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16\n    rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F1066E8, prev 0/2F106698, desc: INSERT_LEAF off 292, blkref #0: rel 1663/16385/2659 blk 10\n    rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106728, prev 0/2F1066E8, desc: INSERT off 43 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\n    rmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F1067D8, prev 0/2F106728, desc: INSERT_LEAF off 41, blkref #0: rel 1663/16385/2658 blk 16\n    rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106820, prev 0/2F1067D8, desc: INSERT_LEAF off 293, blkref #0: rel 1663/16385/2659 blk 10\n    rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106860, prev 0/2F106820, desc: INSERT off 44 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\n    rmgr: Btree       len (rec/tot):     72/    72, tx:        564, lsn: 0/2F106910, prev 0/2F106860, desc: INSERT_LEAF off 47, blkref #0: rel 1663/16385/2658 blk 16\n    rmgr: Btree       len (rec/tot):     64/    64, tx:        564, lsn: 0/2F106958, prev 0/2F106910, desc: INSERT_LEAF off 294, blkref #0: rel 1663/16385/2659 blk 10\n    rmgr: Heap        len (rec/tot):    175/   175, tx:        564, lsn: 0/2F106998, prev 0/2F106958, desc: INSERT off 45 flags 0x00, blkref #0: rel 1663/16385/1249 blk 56\n    rmgr: Btree       len (rec/tot):     80/    80, tx:        564, lsn: 0/2F106A48, prev 0/2F106998, desc: INSERT_LEAF off 42, blkref #0: rel 1663/16385/2658 blk 16\n\n## Database Replication Techniques\n\nSo far, we have seen things in an abstract fashion. We started from why companies need to unlock the full potential of their database, which leads to data replication and data platforms. To understand how replication works, further sections of this article will focus on a specific database platform, PostgreSQL. Most of the concepts are similar for other database systems as well, so this can be used as a reference to form a mental framework around database replication itself.\n\nWe saw how WAL enables the database to maintain data integrity, consistency in case of system shutdowns, and even rolling back from data corruption. Like many other systems out there, PostgreSQL also evolved from the ground up, and as such, we need to understand how replication works within two nodes of the same database and how we can extend that to other data systems. Regardless of whatever replication mechanism we discuss below, it relies upon the WAL for replication.\n\n### Physical Replication\n\nPhysical replication has been existing in PostgreSQL for quite a while. It is used to replicate the whole of the database by physical copy or byte-to-byte copy. Any change made to the main database is also reflected in the replica database without any changes. The replica can choose to be a hot standby node (i.e., the main database fails, and the replica takes over as the main/master).\n\nThere are several ways of physical replication, such as log shipping, streaming replication, etc., but they can largely be classified into two categories.\n\n- Synchronous replication.\n- Asynchronous replication.\n\nThere are several restrictions for this type of replication, such as the listening database should also be in the same major version; partial content cannot be replicated; and so on. For these reasons, physical replication is typically used to sync data between two PostgreSQL database systems, mainly for high availability reasons. \n\n### Logical Decoding\n\nBefore version 10 (shown below), other options allowed developers/engineers to replicate without logical replication to other downstream systems. As the name suggests, logical decoding decodes the WAL content into a human-readable format and replicates it to different consumers. There are both advantages and disadvantages to this approach. Still, since this step requires plugins/installations in the host database system, it is often difficult to maintain, particularly in cloud environments.\n\n### Logical Replication\n\nStarting from PostgreSQL version 10, [logical replication](https://www.postgresql.org/docs/current/logical-replication.html) is available to replicate data from PostgreSQL databases. As mentioned in the documentation, logical replication is based on a publish-subscribe model. One or more subscribers can choose to listen to the published data and publish and subscribe only to specific databases/tables.\n\nIt is clear that logical replication was targeted more towards replicating to other data systems such as a messaging system, data lakes, and data warehouses. It is much easier to also listen from multiple databases as well. We will choose an open-source tool called [Debezium](https://debezium.io/documentation/reference/1.5/postgres-plugins.html) to build our replication pipeline.\n\n## An Open Source Data Replication Architecture Based on Debezium.\n\nIn this section, we will see a demo on how to use Debezium for the Change Data Capture (CDC) happening in our PostgreSQL source database. We will use Docker to quickly set up the database and debezium connector to listen to the changes.\n\nWe wrote a full detailed tutorial on [setting up Debezium and Postgres using Docker](__GHOST_URL__/kafka-tutorial/1/#set-up-a-debezium-connector-for-postgresql). The most important parts are described below but please see the link above for all the details!\n\n### Set Up A Debezium Connector for PostgreSQL\n\nBefore we activate Debezium, we need to prepare Postgres by making some configuration changes. Debezium utilizes the WAL that we described above. Postgres uses this log to ensure data integrity and manage row versions and transactions. Postgres\' WAL has several modes you can configure it to, and for Debezium to work, the WAL level must be set to `replica`. Let\'s change that now.\n\n\n    psql> alter system set wal_level to \'replica\';\n\nYou may need to restart the Postgres container for this change to take effect.\n\nThere is one Postgres plugin not included with the image we used that we will need: `wal2json`. Debezium can work with either `wal2json` or `protobuf`. For this tutorial, we will use `wal2json`. As its name implies, it converts Postgres\' write-ahead logs to JSON format.\n\nWith our Docker app running, let\'s manually install wal2json using aptitude. To get to the shell of the Postgres container, first find the container ID and then run the following command to open bash:\n\n    $ docker ps\n    \n    CONTAINER ID   IMAGE               \n    c429f6d35017   debezium/connect    \n    7d908378d1cf   debezium/kafka      \n    cc3b1f05e552   debezium/zookeeper  \n    4a10f43aad19   postgres:latest     \n    \n    $ docker exec -ti 4a10f43aad19 bash\n\nNow that we\'re inside the container, let\'s install wal2json:\n\n    $ apt-get update && apt-get install postgresql-13-wal2json\n\n### Activate Debezium\n\nWe\'re ready to activate Debezium!\n\nWe can communicate with Debezium by making HTTP requests to it. We need to make a POST request whose data is a configuration in JSON format. This JSON defines the parameters of the connector we\'re attempting to create. We\'ll put the configuration JSON into a file and then use `curl` to send it to Debezium.\n\nYou have several configuration options at this point. This is where you can use a whitelist or blacklist if you only want Debezium to stream certain tables (or avoid certain tables).\n\n    $ echo \'\n    {\n        "name": "arctype-connector",\n        "config": {\n            "connector.class": "io.debezium.connector.postgresql.PostgresConnector",\n            "tasks.max": "1",\n            "plugin.name": "wal2json",\n            "database.hostname": "db",\n            "database.port": "5432",\n            "database.user": "postgres",\n            "database.password": "arctype",\n            "database.dbname": "postgres",\n            "database.server.name": "ARCTYPE",\n            "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n            "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n            "key.converter.schemas.enable": "false",\n            "value.converter.schemas.enable": "false",\n            "snapshot.mode": "always"\n        }\n    }\n    \' > debezium.json\n\nNow we can send this configuration to Debezium.\n\n    $ curl -i -X POST \\\n             -H "Accept:application/json" \\\n             -H "Content-Type:application/json" \\\n             127.0.0.1:8083/connectors/ \\\n             --data "@debezium.json"\n\nThe response will be a JSON representation of the newly initiated connector.\n\n    {\n      "name": "arctype-connector",\n      "config": {\n        "connector.class": "io.debezium.connector.postgresql.PostgresConnector",\n        "tasks.max": "1",\n        "plugin.name": "wal2json",\n        "database.hostname": "db",\n        "database.port": "5432",\n        "database.user": "postgres",\n        "database.password": "arctype",\n        "database.dbname": "postgres",\n        "database.server.name": "ARCTYPE",\n        "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n        "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n        "key.converter.schemas.enable": "false",\n        "value.converter.schemas.enable": "false",\n        "snapshot.mode": "always",\n        "name": "arctype-connector"\n      },\n      "tasks": [],\n      "type": "source"\n    }\n\n[The installation, setup, and demo part has already been written in a separate article by the Arctype team](__GHOST_URL__/kafka-tutorial/1/).\n\n## Data Quality, Consistency and Other Challenges\n\nIt is important to understand that once we are using Debezium and listening through the logs, we have left the realm of relational databases with ACID guarantees and into the world of distributed systems. With our choice as Kafka for the messaging system, the [semantics](https://kafka.apache.org/documentation/#semantics) it follows decides how we replicate/distribute data to further downstream systems.\n\n- If we are making these changes and directly persisting it in a search index such as Elastic search, then - "*At least once—Messages are never lost but may be redelivered*" maybe more suitable.\n- If the data is being delivered to a machine learning algorithm, then - "*At most once—Messages may be lost but are never redelivered*."\n- If we are delivering to a data warehouse, then - "*Exactly once—Each message is delivered once and only once.*"\n\n![Screen Shot 2021-07-01 at 1.13.34 PM.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1625163311002/AVH3XnjpK.png)\n\n\nThe third message delivery mechanism is incredibly hard to solve in a distributed system. Kafka is one among the systems that has solved this at scale, but each has its own drawbacks regarding throughput, scale, and accuracy. One must make an informed choice to balance out what is necessary.\n\n## Conclusion\n\nAs a business expands, the need to ethically leverage data is not a luxury anymore but a necessity. Data platforms are becoming increasingly common even across mid-sized businesses. They enable,\n\n- Availability.\n- Governance.\n- Security.\n- Business strategy.\n\nThere has never been a better time to unlock the value of data.\n\n## References\n\n- [The Log: What every software engineer should know about real-time data\'s unifying abstraction](https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying)\n- [Streaming Data with PostgreSQL + Kafka + Debezium](https://dev.to/arctype/streaming-data-with-postgresql-kafka-debezium-part-1-4e39)',a.user={name:"Arctype Team",username:"rettx",twitter_username:e,github_username:"EverettBerry",website_url:"http://arctype.com",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--jNwYZD8N--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/573089/c66c6aa6-b080-474e-ab8b-c49175222c5a.PNG",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--2PMYhCcM--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/573089/c66c6aa6-b080-474e-ab8b-c49175222c5a.PNG"},a.organization={name:"Arctype",username:n,slug:n,profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--KO96hFp3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3503/ad5a672f-94d1-446e-a49b-e601a61fdf9c.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--9rxqDtI4--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/organization/profile_image/3503/ad5a672f-94d1-446e-a49b-e601a61fdf9c.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:e,state:{currentArticle:a},serverRendered:!0,routePath:"/rettx/745418",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:e}}}}(null,"2021-07-01T18:24:30Z",{},"arctype")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
