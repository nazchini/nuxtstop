<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Creating a Well-Architected VPC</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>Creating a Well-Architected VPC</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/cloudformation" class="tag" data-v-70afb46a>
          #cloudformation
        </a><a href="/nuxtstop/t/tutorial" class="tag" data-v-70afb46a>
          #tutorial
        </a><a href="/nuxtstop/t/aws" class="tag" data-v-70afb46a>
          #aws
        </a><a href="/nuxtstop/t/architecture" class="tag" data-v-70afb46a>
          #architecture
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oTTkZpQF--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/boa4ifeu2lahfhlswgrq.jpg" alt="Creating a Well-Architected VPC" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            21
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>May 14</time></div></header> <div class="content" data-v-70afb46a><p>So this is the first in my posts walking through how to deploy a solution in AWS. Hopefully  you find it useful as VPCs are the foundation for private and secure networking in AWS and an area many struggle. This guide is designed to ensure that your VPC deployments can be Well-Architected and provide a base level of network security but is only one option for VPC layout. While it will meet a vast majority of workloads you might want to review the structure and reduce, or increase, the number of subnets as well as other components.</p>

<p>I will not go into CloudFormation templates structure, unless required, or deployment method. However, all templates are designed to be able to manually uploaded via the console and applied consecutively or the individual template you wish to deploy.</p>

<blockquote>
<p>All code for this project can be found at my git organisation under the VPC 101 repository <a href="https://github.com/myawsrocks/vpc101">myawsrocks/vpc101</a>.</p>
</blockquote>

<h3>
  <a name="what-youll-create" href="#what-youll-create">
  </a>
  What you'll create:
</h3>

<p>This solution will create the following topology with the option for a single (reduced redundancy) NAT Gateway. In addition we will enable encrypted VPC Flow logs that are stored in CloudWatch and S3. Generally the S3 bucket would be in a central security account but for our purpose we will create and secure it in the same account.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--nUtqBAFL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5bbpfi5cmgi5m1o22sw2.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nUtqBAFL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5bbpfi5cmgi5m1o22sw2.jpg" alt="Complete VPC" loading="lazy" width="880" height="620"></a></p>

<p>Well go through the each of the following steps with each step representing a unique CloudFormation template that you can deploy from my repo.</p>

<ol>
<li>Create an empty VPC with an IPv4 CIDR range.</li>
<li>Create an IPv6 CIDR range and associate to the VPC.</li>
<li>Create 9 private subnets with IPv4 and IPv6 IP ranges allocated.</li>
<li>Create private route tables and associate to the private subnets.</li>
<li>Enable VPC Flow Logs and send to encrypted S3 Bucket and CloudWatch Log Group:</li>
<li>Deploy VPC Endpoints for common AWS Services.</li>
<li>Create public subnets and internet access.</li>
<li>Option for single NAT Gateway</li>
</ol>


<hr>

<h3>
  <a name="creating-the-base-vpc" href="#creating-the-base-vpc">
  </a>
  Creating the base VPC
</h3>

<h5>
  <a name="cloudformation-template-vpc1yaml" href="#cloudformation-template-vpc1yaml">
  </a>
  CloudFormation template: vpc_1.yaml
</h5>

<p>Unlike with the VPC wizard in the console, creating a VPC in code or via CLI only creates an empty VPC with the IP4 range (CIDR) you provide. In my example we'll use the default in the template of 172.16.0.0/20 but you can replace this with any range. Unless you have a large public IP range you want to consume I'd suggest an RCF1918 range (Private IPv4) which only has minor AWS restrictions in relation to secondary IP ranges (see the docs - <a href="https://docs.aws.amazon.com/vpc/latest/userguide/working-with-vpcs.html">working with vpcs</a>).</p>

<blockquote>
<p>Remember: If you are going to be connecting to other VPC's via VPC Peering or a Transit Gateway you need to ensure you do not assign the same IP range to multiple VPCs.</p>
</blockquote>

<p>Once the CloudFormation Stack has completed you will be able to view your VPC in the console and see the attached IPv4 range.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Wbdgyr2y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1vfqurpmxo2dz63zn45c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Wbdgyr2y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1vfqurpmxo2dz63zn45c.png" alt="VPC with IPv4 range" loading="lazy" width="880" height="290"></a></p>


<hr>

<h3>
  <a name="creating-an-ipv6-range-and-associate-to-vpc" href="#creating-an-ipv6-range-and-associate-to-vpc">
  </a>
  Creating an IPv6 range and associate to VPC
</h3>

<h5>
  <a name="cloudformation-template-vpc2yaml" href="#cloudformation-template-vpc2yaml">
  </a>
  CloudFormation template: vpc_2.yaml
</h5>

<p>Although IPv6 adoption is low, I promote its use as it offers many benefits if you are able to adopt it. Assigning and using an IPv6 range is simple and most services in AWS are able to run IPv4 and IPv6 and some services can now run IPv6 only.</p>

<p>As with IPv4, while you can use your own public IPv6 range in AWS, unless you have requirements to advertise these internally or externally it is simpler to utilize an AWS IPv6 range. These are public ranges so globally unique both between VPCs and on the internet.</p>

<p>Updating the stack with IPv6 should only take a minute or two and once complete you will be able to see the assigned AWS IPv6 range in both the CloudFormation Stack outputs and in the VPC configuration in the console.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--J0_JvNaA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7foshh5219ig9g5ugpi.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--J0_JvNaA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7foshh5219ig9g5ugpi.png" alt="IPv6 range in outputs" loading="lazy" width="880" height="259"></a></p>


<hr>

<h3>
  <a name="creating-private-subnets" href="#creating-private-subnets">
  </a>
  Creating private subnets
</h3>

<h5>
  <a name="cloudformation-template-vpc3yaml" href="#cloudformation-template-vpc3yaml">
  </a>
  CloudFormation template: vpc_3.yaml
</h5>

<p>So we now have our VPC with both an IPv4 and IPv6 CIDR attached. However we have no where to place resources. In order to that we need to create subnets within the VPC. Subnets are linked to Availability Zones and are a small segment of the larger VPC IP ranges. Take a look at the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html">VPC User Guide - Subnets</a> for more details on subnetting.</p>

<p>Although there are many ways to create/design your subnets in a VPC, I tend to lean towards splitting in line with the three tier architecture model (<a href="https://en.wikipedia.org/wiki/Multitier_architecture#Three-tier_architecture">wiki article</a>) as this tends to be the most common and flexible way of allocating space.</p>

<blockquote>
<p>Note: It is not possible to resize a subnet one created. It has to be deleted and then recreated.</p>
</blockquote>

<p>Based on using 3 Availability Zones for resiliency we will create 3 subnets in each tier giving us a total of 9 private subnets. For each of these subnets we will allocate a IPv4 and IPv6 range.</p>

<p>Below are the IP allocations in the template (<a href="https://github.com/myawsrocks/vpc101/blob/main/subnetting.xlsx">available in excel in repo</a>). Generally the application/logic tier tends to have more components so these subnets are sized larger that the presentation and data tiers. I have split across application layer first then allocated to each Availability Zone. This allows easier security for items such as Network Access Control Lists (NACLs) or on-premise firewalls as if required an individual tier can be allowed.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--XFUOZafj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ucgt0y7d4g81futf3qyq.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XFUOZafj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ucgt0y7d4g81futf3qyq.png" alt="IPv4 Allocations" loading="lazy" width="849" height="119"></a></p>

<p>For IPv6 because this range is allocated by AWS we have to use calculation to allocate the subnet part of the IP range and add to the VPC allocation. In the IP allocation file I use a dummy IPv6 VPC range of <code>fc00:1234:5678:9a::/56</code> to show how the subnets ranges are allocated. As you can see we assign the last 2 digits of the subnet range (in bold) to the provided VPC CIDR.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KEqFYtw_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ra7muu2u3w98w37qvpvb.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KEqFYtw_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ra7muu2u3w98w37qvpvb.png" alt="IPv6 Allocations" loading="lazy" width="880" height="93"></a></p>

<blockquote>
<p>Note: Apart from the US West (Northern California) region all regions have 3 AZs for new customers</p>
</blockquote>

<p>Once complete you will be able to see all the subnets and their associated ranges in both the CloudFormation Stack outputs and in the console. You will notice in the CloudFormation Stack outputs there are also some extra keys. These are to enable easy reference via other stacks, if you use CloudFormation Nested Stack, or resources if you add to this template.</p>


<hr>

<h3>
  <a name="creating-routing" href="#creating-routing">
  </a>
  Creating routing
</h3>

<h5>
  <a name="cloudformation-template-vpc4yaml" href="#cloudformation-template-vpc4yaml">
  </a>
  CloudFormation template: vpc_4.yaml
</h5>

<p>So we now have our VPC and Subnets and can start creating resources if we wish. The resources would be able to talk to each other using the "Default Route Table" that is created when creating a VPC. However, this route table can not then be manipulated in code if we wish to modify those routes. In order to be able to create and amend routes we need to define route tables in code and attach it to the subnets we have created.</p>

<p>At this point we will only create a single private route table as it will only define a "local" route that can be used by all subnet to communicate between themselves. As the need for different routes per subnet/AZ is required we will create separate route tables and attach to the subnets required replacing this single route table.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LRZZHHC0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tbg57zbvbz852li8khe0.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LRZZHHC0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tbg57zbvbz852li8khe0.png" alt="Route Table and Associations in AWS Console" loading="lazy" width="880" height="626"></a></p>

<p>One completed you will be able to see the new route table in the VPC console along with the attachments to our 9 subnets.</p>


<hr>

<h3>
  <a name="enable-vpc-flow-logs" href="#enable-vpc-flow-logs">
  </a>
  Enable VPC Flow Logs
</h3>

<h5>
  <a name="cloudformation-template-vpc5yaml" href="#cloudformation-template-vpc5yaml">
  </a>
  CloudFormation template: vpc_5.yaml
</h5>

<p>One key item in becoming Well-Architected is ensuring security and operations are included in what we deploy. A key part for both of these items is knowing what is happening (observability) in the VPC. The first, and arguably most valuable, component in this is enabling VPC Flow Logs. Flow Logs can be enabled at the VPC, Subnet or Interface level but by enabling at the VPC level we ensure that logging is enabled on all traffic with out the need to be configured on subnets or components as they are deployed.</p>

<p>We will publish the logs to CloudWatch Logs, to enable easy analysis, as well as S3 for archive. Both CloudWatch Logs and S3 are encrypted using a Customer Managed Key (CMK) provided by KMS that we will create in the template.</p>

<p>The template defaults retention period for CloudWatch Log to 14 days and S3 to 365 days but as they are parameters these can easily be changed.</p>

<blockquote>
<p>In an organization, I would expect the S3 bucket to be created in a separate account that is used purely for logging to ensure segregation of duties.</p>
</blockquote>

<p>For more information on VPC Flow Logs take a look in the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html">VPC User Guide</a>.</p>

<p>Once the stack update is complete you will be able to see the flow log configuration against the VPC in the console. Usefully it also links to the CloudWatch Log Group and the S3 bucket where the logs are stored.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--4VOklRy0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/78zpi5rpr6bjv9ts6x9r.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4VOklRy0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/78zpi5rpr6bjv9ts6x9r.png" alt="VPC Flow Log configuration" loading="lazy" width="880" height="222"></a></p>

<p>If you look at the CloudFormation Stack outputs you will also see details of the IAM role and Policy as well as the KMS key id.</p>


<hr>

<h3>
  <a name="deploy-vpc-endpoints" href="#deploy-vpc-endpoints">
  </a>
  Deploy VPC Endpoints
</h3>

<h5>
  <a name="cloudformation-template-vpc6yaml" href="#cloudformation-template-vpc6yaml">
  </a>
  CloudFormation template: vpc_6.yaml
</h5>

<p>At present there is no access to components outside of the VPC. While this is extremely secure it does limit functionality. The easiest way to access AWS services is by using VPC Endpoints. These use the AWS network to connect to the services and are more secure than going over the internet. In addition endpoints have a security group and can have a resource policy to restrict access if required.</p>

<p>If you want to understand more about the benefits of endpoints I did a blog post on the subject <a href="https://myaws.rocks/well-architecting-connectivity-to-aws-services/">here</a>.</p>

<p>We will deploy all the VPC endpoints that would allow you to assign an IAM Role to an EC2 instance to interact with AWS if required, remote in to EC2 instances via Systems Manager - Session Manager, and use the CloudWatch Agent on EC2 instances to output OS metrics. Whilst there are over 170 service that support endpoints, these should give you enough to understand how they work and how you can provision them for your workloads.</p>

<p>As these are Interface Endpoints we have to create the network interface in a subnet. For these interfaces I will create them in the Application Subnet as this is primarily where the workloads using them will be created. If you chose to create a public subnet this would also be an ideal place to put all VPC endpoints.</p>

<p>Once the endpoints are created you can see them in the console and also the IP addresses of the interface within each subnet.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OpTXTaGJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qhann56rkpcpv5ltv25q.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OpTXTaGJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qhann56rkpcpv5ltv25q.png" alt="VPC Endpoints" loading="lazy" width="880" height="434"></a><br>
Now, it might seem that this would then take a lot to be able to use these endpoints. However, if you take a look at the Details tab of the endpoint you will see DNS names for the endpoint.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7cQAIbkA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p0121ajzik4nj8ptqprs.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7cQAIbkA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p0121ajzik4nj8ptqprs.png" alt="VPC Endpoint DNS" loading="lazy" width="880" height="577"></a></p>

<p>Again, the list of DNS looks daunting and while they can be used and will resolve to the endpoint IPs the item that is more critical is the Private DNS names. This will only resolve in the VPC but the name is the same as the public name for the service. So in this example the external resolution for the STS server sts.eu-west-2.amazonaws.com is 52.94.48.43. Within the VPC resources will use the private DNS resolution which would then resolve to the IPs in the VPC, in our case 172.16.4.206, 172.16.5.244, and 172.16.6.244.</p>

<hr>
<h3>
  <a name="deploy-internet-access" href="#deploy-internet-access">
  </a>
  Deploy Internet Access
</h3>
<h5>
  <a name="cloudformation-template-vpc7yaml" href="#cloudformation-template-vpc7yaml">
  </a>
  CloudFormation template: vpc_7.yaml
</h5>

<p>So we now have a VPC with Subnet and Routing along with access to AWS service that we might require and a way to remote in to EC2 instances. While this might be sufficient for some solutions such as data processing where the output is then in an S3 bucket or sent via SNS or some other servers it will not work for all workloads. In addition some workloads will deploy services that will need access to the internet to either download  and other workloads might need to be accessible in order to serve customers.</p>

<p>To enable this and increase security we will create separate public subnets to host internet facing components. For these components we will deploy an Internet Gateway with direct access.</p>

<p>For items in the private subnets that need internet access we will need to deploy a NAT Gateway for IPv4 traffic and an Egress Only Internet Gateway for IPv6 traffic. In addition we will need to create new route tables to allow subnets to access the relevant gateways. As NAT Gateways now support internet and private NAT options we have to specify that our gateway will be for public connectivity.</p>

<p>As mentioned above we will also move the VPC Endpoints to the Public Subnet.</p>

<hr>
<h3>
  <a name="reduce-nat-gateway-costs" href="#reduce-nat-gateway-costs">
  </a>
  Reduce NAT Gateway Costs
</h3>
<h5>
  <a name="cloudformation-template-vpc8yaml" href="#cloudformation-template-vpc8yaml">
  </a>
  CloudFormation template: vpc_8.yaml
</h5>

<p>While most components have no charge NAT Gateways cost between 4¢ and 7¢ an hour dependent on the region you deploy to. While this might not seem much, as we are deploying in 3AZs (good practice) this is up to 21¢ and hour.<br>
So in a month with 31 days (744 hours) that equates to $157 just to have them provisioned.</p>

<p>As such we will add an option to reduce this for workloads that do not need it. Using a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html">CloudFormation Conditions</a> we can decide which resources to build based on a input parameter. In our case we will have a parameter (ReducedNAT) that will then set whether we want a SingleNAT or MultiNAT solution. We have set the parameter input to only allow either Yes or No as an option to ensure that we always meet one of the 2 conditions.</p>

<p>If we select Yes we then only create a single NAT Gateway and private route table with all private subnets using the same route table pointing to the single NAT Gateway.</p>

<hr>
<h3>
  <a name="network-access-control-lists-nacls" href="#network-access-control-lists-nacls">
  </a>
  Network Access Control Lists (NACLs)
</h3>
<h3>
  <a name="cloudformation-template-vpc9yaml" href="#cloudformation-template-vpc9yaml">
  </a>
  CloudFormation template: vpc_9.yaml
</h3>

<p>To improve security at the network level, we are going to create 4 NACLs to control traffic between the Subnets as well as in/out of the VPC. We will create NACLs as follows and associate to the relevant subnets:</p>

<ol>
<li>Public Subnets NACL</li>
<li>Presentation Subnets NACL</li>
<li>Application Subnets NACL</li>
<li>Data Subnets NACL</li>
</ol>

<p>The diagram below shows the flows that will be enabled by the NACLs. I use common rule numbers across NACLs as I believe it is simpler to be able to match them up. For example rule 1xx is used for outbound internet IPv4 traffic and it's reply traffic in all NACLs. I also group IPv4 and IPv6 so NACL entries together. For example rule 200,201,202, all provide the same access between the presentation and applications subnets.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--YGHUNjo5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/511b1xfuuvn32pojy1k1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YGHUNjo5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/511b1xfuuvn32pojy1k1.png" alt="NACLS" loading="lazy" width="596" height="495"></a></p>

<p>In the <strong>Public Subnet NACL</strong> firstly we are going to create rules which will enable inbound traffic from the internet on port 443 (HTTPS) and its reply traffic on ports 1024 to 65535 (<a href="https://en.wikipedia.org/wiki/Ephemeral_port">Ephemeral Ports</a>) using IPv4 (<strong>rule10</strong>) or IPv6 (<strong>rule11</strong>). This will allow access to resources we might host in the public subnet such as load balancers or API Gateways, but only over the secure HTTPS protocol. Secondly we are going to create rules that allows all VPC components to access the public internet on port 443 (HTTPS) and the reply traffic on ports 1024 to 65535 using IPv4 (<strong>rule100</strong>) or IPv6 (<strong>rule105</strong>). This enables devices in any subnet to talk to the internet over HTTPS and the reply traffic. For those devices in the Private Subnets this is via the NAT devices.</p>

<p>In the <strong>Presentation Subnet NACL</strong> firstly we are going create the inbound internet rules that will allow devices in the public subnets to talk to the presentations subnet on port 443 and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule10, 11, 12</strong>) or IPv6 (<strong>rule15, 16, 17</strong>). This will allow devices such as load balancers that are routing internet traffic to talk to components in the presentation subnet only over HTTPS matching rules 10 and 11 in the <strong>Public Subnet NACL</strong>. Secondly we are going to create rules that correspond to rules 100 and 105 in the <strong>Public Subnet NACL</strong> for outbound internet traffic. For IPv4 this is rules 100, 101, 102, and for IPv6 this is rules 105, 106, 107. Finally we are going to allow devices in the presentation subnets to talk to the application subnet on ports 1 to 1023 (<a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports">Common Ports</a>) and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule200, 201, 202</strong>) or IPv6 (<strong>rule205, 206, 207</strong>). This will allow components such as web servers to talk to components in the application subnet and the reply traffic.</p>

<p>In the <strong>Application Subnet NACL</strong> firstly we are going to create the same outbound internet rules as in the presentation subnet (<strong>100, 101, 102, 105, 106, 107</strong>) that correspond to rules in the <strong>Public Subnet NACL</strong> for internet traffic. Secondly we are then going to create rules <strong>200, 201, 202, 205, 206, and 207</strong>, which correspond to the same rules in the <strong>Presentation Subnet NACL</strong> to allow traffic between the presentation and application subnets. Finally we are going to allow devices in the application subnets to talk to the data subnet on ports 1 to 1023 and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule300, 301, 302</strong>) or IPv6 (<strong>rule305, 306, 307</strong>). This will allow components such as application servers to talk to components in the application subnet such as databased and the reply traffic.</p>

<p>In the <strong>Data Subnet NACL</strong>, again we are firstly going to create rules <strong>100, 101, 102, 105, 106, 107</strong> for outbound internet traffic. that correspond to rules in the <strong>Public Subnet NACL</strong>. Secondly we are then going to create rules <strong>300, 301, 302, 305, 306, and 307</strong> that correspond to the same rules in the Application Subnet NACL to allow traffic between the application and data subnets.</p>

<p>Once deployed take a look at the NACLs, you should have the following rules in each list. Note, this relatively open but we would further control access with Security Groups around resources.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--W7W6eQbk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1n9o1rgokqdt1ptgpu2c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--W7W6eQbk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1n9o1rgokqdt1ptgpu2c.png" alt="NACL Rules diagram" loading="lazy" width="868" height="557"></a></p>

<hr>
<h3>
  <a name="whats-next" href="#whats-next">
  </a>
  What's Next?
</h3>
<h4>
  <a name="clean-up" href="#clean-up">
  </a>
  Clean Up
</h4>

<p>The cost of this solution according to the AWS Pricing Calculator is $126 for the London Region (see estimate). While that's not much it would equate to about $1,500 for the year. The reduced NAT option's estimate for the same region is $54/month or $650 a year. So, unless you need to use it I'd suggest deleting the stack once you've had a look at how a VPC and it's components work.</p>
<h4>
  <a name="future-updates" href="#future-updates">
  </a>
  Future Updates
</h4>

<p>If you take a look at the Git repository for this post you can see the current roadmap. Once those items are created I will come back and update this post. At present the items I have plans for are:</p>

<ul>
<li>IPv6 only subnets and networking devices.</li>
<li>Option for no NAT</li>
</ul>

<p>If you want to contribute or recommend updates on the solution please feel free to either leave a suggestion here or create a pull request on GitHub.</p>


<div class="ltag-github-readme-tag">
  <div class="readme-overview">
    <h2>
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--566lAguM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev.to/assets/github-logo-5a155e1f9a670af7944dd5e12375bc76ed542ea80224905ecaf878b9157cdefc.svg" alt="GitHub logo" loading="lazy">
      <a href="https://github.com/myawsrocks">
        myawsrocks
      </a> / <a style="font-weight:600" href="https://github.com/myawsrocks/vpc101">
        vpc101
      </a>
    </h2>
    <h3>
      Code to create a Well-Architected VPC
    </h3>
  </div>
  <div class="ltag-github-body">
    
<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://github.com/myawsrocks/vpc101/graphs/contributors"><img src="https://camo.githubusercontent.com/b3265f6e5c686cb876c99c8db249585e07462a4c5c6d80e848a8462857d35a09/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6e7472696275746f72732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Contributors" data-canonical-src="https://img.shields.io/github/contributors/myawsrocks/vpc101.svg?style=plastic&logo=appveyor" style="max-width:100%"></a>
<a href="https://github.com/myawsrocks/vpc101/network/members"><img src="https://camo.githubusercontent.com/8294e08be092126877924afc9904fcccd4fa49c0135f59770705ff31848deba8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f666f726b732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Forks" data-canonical-src="https://img.shields.io/github/forks/myawsrocks/vpc101.svg?style=plastic&logo=appveyor" style="max-width:100%"></a>
<a href="https://github.com/myawsrocks/vpc101/stargazers"><img src="https://camo.githubusercontent.com/077586eb91648d741ff91db647de4fd095b922feb742d031f67b0b3fa1d8420a/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Stargazers" data-canonical-src="https://img.shields.io/github/stars/myawsrocks/vpc101.svg?style=plastic&logo=appveyor" style="max-width:100%"></a>
<a href="https://github.com/myawsrocks/vpc101/issues"><img src="https://camo.githubusercontent.com/ab2f92430dd02817130b2caee486b8bcba8fb1d489293d679d09101ea20a770c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Issues" data-canonical-src="https://img.shields.io/github/issues/myawsrocks/vpc101.svg?style=plastic&logo=appveyor" style="max-width:100%"></a>
<a href="https://github.com/myawsrocks/vpc101/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/36c2301b4ed0513d3b16001929bd07465b887d8151e1db9cd3d86105da8004e5/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="License" data-canonical-src="https://img.shields.io/github/license/myawsrocks/vpc101.svg?style=plastic&logo=appveyor" style="max-width:100%"></a>
<br>
<a href="https://myaws.rocks/aws-vpc-101" rel="nofollow"><img src="https://camo.githubusercontent.com/d6e783d4539fc19c473265f153679223aaa4a0fd18fbfdb3baa0602d9514f5bd/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f50726f6a6563742532304c696e6b2d6d796177732e726f636b732532305650433130312d79656c6c6f77677265656e3f7374796c653d736f6369616c" alt="VPC 101 on myaws.rocks" data-canonical-src="https://img.shields.io/badge/Project%20Link-myaws.rocks%20VPC101-yellowgreen?style=social" style="max-width:100%"></a>
<a href="https://linkedin.com/in/robinwford/" rel="nofollow"><img src="https://camo.githubusercontent.com/2c36de0584a9ab3208c7ac55f34c467d29bd88008021090e0060e31f755a03dc/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d4c696e6b6564496e2d626c61636b2e7376673f7374796c653d736f6369616c266c6f676f3d6c696e6b6564696e26636f6c6f723d626c7565" alt="LinkedIn" data-canonical-src="https://img.shields.io/badge/-LinkedIn-black.svg?style=social&logo=linkedin&color=blue" style="max-width:100%"></a>
<a href="https://twitter.com/robinwford" rel="nofollow"><img src="https://camo.githubusercontent.com/0b57477caf8fa22426b213b6cac1a3b2ea2134a4fb11a845c79443ce6aa75074/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f666f6c6c6f772f726f62696e77666f72643f636f6c6f723d626c7565266c6f676f3d74776974746572267374796c653d736f6369616c" alt="Twitter" data-canonical-src="https://img.shields.io/twitter/follow/robinwford?color=blue&logo=twitter&style=social" style="max-width:100%"></a></p>
<br>
<div align="center" dir="auto">
  <a href="https://github.com/myawsrocks/vpc101">
    <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jWOD8s70--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/myawsrocks/vpc101images/minifig.png" alt="Logo" width="80" height="80" style="max-width:100%" loading="lazy">
  </a>
<h3 align="center" dir="auto">
myaws.rocks vpc 101</h3>
  <p align="center" dir="auto">
    How to build a VPC demo
    <br>
    <br>
    <a href="https://github.com/myawsrocks/vpc101/issues">Report Bug</a>
    ·
    <a href="https://github.com/myawsrocks/vpc101/issues">Request Feature</a>
  </p>
</div>
<details>
  <summary>Table of Contents</summary>
  <ol dir="auto">
    <li>
      <a href="https://github.com/myawsrocks/vpc101#about-the-project">About The Project</a>
    </li>
    <li>
      <a href="https://github.com/myawsrocks/vpc101#getting-started">Getting Started</a>
      <ul dir="auto">
        <li><a href="https://github.com/myawsrocks/vpc101#prerequisites">Prerequisites</a></li>
        <li><a href="https://github.com/myawsrocks/vpc101#installation">Installation</a></li>
      </ul>
    </li>
    <li><a href="https://github.com/myawsrocks/vpc101#usage">Usage</a></li>
    <li><a href="https://github.com/myawsrocks/vpc101#roadmap">Roadmap</a></li>
    <li><a href="https://github.com/myawsrocks/vpc101#contributing">Contributing</a></li>
    <li><a href="https://github.com/myawsrocks/vpc101#license">License</a></li>
    <li><a href="https://github.com/myawsrocks/vpc101#contact">Contact</a></li>
  </ol>
</details>
<h2 dir="auto">
About The Project</h2>
<p dir="auto">This solution walks through the building and securing of the following VPC.<br>
At the end of the deployment you will have a VPC spanning multiple Availability Zones (AZ) with both IPv4 and IPv6 ranges.<br></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/myawsrocks/vpc101images/VPC.jpg"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--bExAjOmq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/myawsrocks/vpc101images/VPC.jpg" alt="Product Name Screen Shot" style="max-width:100%" loading="lazy"></a></p>
<p dir="auto">###Components built with the solution are:</p>
<details>
  <ol dir="auto">
    <li>Create an empty VPC with an IPv4 CIDR range - vpc_1.yaml</li>
    <li>Create an IPv6 CIDR range and associate to the VPC - vpc_2.yaml</li>
    <li>Create 9 private subnets with IPv4 and IPv6 IP ranges allocated: - vpc_3.yaml
      <ul dir="auto">
        <li>3x Presentation</li>
        <li>3x Application</li>
        <li>3x Data</li>
      </ul>
    </li>
<li>Create a private route tables and associate to the private subnets - vpc_4.yaml</li>
    <li>Enable VPC Flow Logs and send to encrypted S3 Bucket and encrypted CloudWatch Log Group - vpc_5.yaml</li>
    <li>Deploy VPC Endpoints for common AWS…</li>
</ol></details></article></div>
  </div>
  <div class="gh-btn-container"><a class="gh-btn" href="https://github.com/myawsrocks/vpc101">View on GitHub</a></div>
</div>


</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/robinwford/creating-a-well-architected-vpc-34o7" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(e,t,a,o,n){return a.type_of="article",a.id=1085519,a.title="Creating a Well-Architected VPC",a.description="So this is the first in my posts walking through how to deploy a solution in AWS. Hopefully  you find...",a.readable_publish_date="May 14",a.slug="creating-a-well-architected-vpc-34o7",a.path="/robinwford/creating-a-well-architected-vpc-34o7",a.url=o,a.comments_count=0,a.public_reactions_count=21,a.collection_id=e,a.published_timestamp=t,a.positive_reactions_count=21,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--oTTkZpQF--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/boa4ifeu2lahfhlswgrq.jpg",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--3icKg3ri--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/boa4ifeu2lahfhlswgrq.jpg",a.canonical_url=o,a.created_at="2022-05-14T21:26:18Z",a.edited_at=e,a.crossposted_at=e,a.published_at=t,a.last_comment_at=t,a.reading_time_minutes=13,a.tag_list="cloudformation, tutorial, aws, architecture",a.tags=["cloudformation","tutorial","aws","architecture"],a.body_html='<p>So this is the first in my posts walking through how to deploy a solution in AWS. Hopefully  you find it useful as VPCs are the foundation for private and secure networking in AWS and an area many struggle. This guide is designed to ensure that your VPC deployments can be Well-Architected and provide a base level of network security but is only one option for VPC layout. While it will meet a vast majority of workloads you might want to review the structure and reduce, or increase, the number of subnets as well as other components.</p>\n\n<p>I will not go into CloudFormation templates structure, unless required, or deployment method. However, all templates are designed to be able to manually uploaded via the console and applied consecutively or the individual template you wish to deploy.</p>\n\n<blockquote>\n<p>All code for this project can be found at my git organisation under the VPC 101 repository <a href="https://github.com/myawsrocks/vpc101">myawsrocks/vpc101</a>.</p>\n</blockquote>\n\n<h3>\n  <a name="what-youll-create" href="#what-youll-create">\n  </a>\n  What you\'ll create:\n</h3>\n\n<p>This solution will create the following topology with the option for a single (reduced redundancy) NAT Gateway. In addition we will enable encrypted VPC Flow logs that are stored in CloudWatch and S3. Generally the S3 bucket would be in a central security account but for our purpose we will create and secure it in the same account.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--nUtqBAFL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5bbpfi5cmgi5m1o22sw2.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nUtqBAFL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5bbpfi5cmgi5m1o22sw2.jpg" alt="Complete VPC" loading="lazy" width="880" height="620"></a></p>\n\n<p>Well go through the each of the following steps with each step representing a unique CloudFormation template that you can deploy from my repo.</p>\n\n<ol>\n<li>Create an empty VPC with an IPv4 CIDR range.</li>\n<li>Create an IPv6 CIDR range and associate to the VPC.</li>\n<li>Create 9 private subnets with IPv4 and IPv6 IP ranges allocated.</li>\n<li>Create private route tables and associate to the private subnets.</li>\n<li>Enable VPC Flow Logs and send to encrypted S3 Bucket and CloudWatch Log Group:</li>\n<li>Deploy VPC Endpoints for common AWS Services.</li>\n<li>Create public subnets and internet access.</li>\n<li>Option for single NAT Gateway</li>\n</ol>\n\n\n<hr>\n\n<h3>\n  <a name="creating-the-base-vpc" href="#creating-the-base-vpc">\n  </a>\n  Creating the base VPC\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc1yaml" href="#cloudformation-template-vpc1yaml">\n  </a>\n  CloudFormation template: vpc_1.yaml\n</h5>\n\n<p>Unlike with the VPC wizard in the console, creating a VPC in code or via CLI only creates an empty VPC with the IP4 range (CIDR) you provide. In my example we\'ll use the default in the template of 172.16.0.0/20 but you can replace this with any range. Unless you have a large public IP range you want to consume I\'d suggest an RCF1918 range (Private IPv4) which only has minor AWS restrictions in relation to secondary IP ranges (see the docs - <a href="https://docs.aws.amazon.com/vpc/latest/userguide/working-with-vpcs.html">working with vpcs</a>).</p>\n\n<blockquote>\n<p>Remember: If you are going to be connecting to other VPC\'s via VPC Peering or a Transit Gateway you need to ensure you do not assign the same IP range to multiple VPCs.</p>\n</blockquote>\n\n<p>Once the CloudFormation Stack has completed you will be able to view your VPC in the console and see the attached IPv4 range.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Wbdgyr2y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1vfqurpmxo2dz63zn45c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Wbdgyr2y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1vfqurpmxo2dz63zn45c.png" alt="VPC with IPv4 range" loading="lazy" width="880" height="290"></a></p>\n\n\n<hr>\n\n<h3>\n  <a name="creating-an-ipv6-range-and-associate-to-vpc" href="#creating-an-ipv6-range-and-associate-to-vpc">\n  </a>\n  Creating an IPv6 range and associate to VPC\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc2yaml" href="#cloudformation-template-vpc2yaml">\n  </a>\n  CloudFormation template: vpc_2.yaml\n</h5>\n\n<p>Although IPv6 adoption is low, I promote its use as it offers many benefits if you are able to adopt it. Assigning and using an IPv6 range is simple and most services in AWS are able to run IPv4 and IPv6 and some services can now run IPv6 only.</p>\n\n<p>As with IPv4, while you can use your own public IPv6 range in AWS, unless you have requirements to advertise these internally or externally it is simpler to utilize an AWS IPv6 range. These are public ranges so globally unique both between VPCs and on the internet.</p>\n\n<p>Updating the stack with IPv6 should only take a minute or two and once complete you will be able to see the assigned AWS IPv6 range in both the CloudFormation Stack outputs and in the VPC configuration in the console.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--J0_JvNaA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7foshh5219ig9g5ugpi.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--J0_JvNaA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7foshh5219ig9g5ugpi.png" alt="IPv6 range in outputs" loading="lazy" width="880" height="259"></a></p>\n\n\n<hr>\n\n<h3>\n  <a name="creating-private-subnets" href="#creating-private-subnets">\n  </a>\n  Creating private subnets\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc3yaml" href="#cloudformation-template-vpc3yaml">\n  </a>\n  CloudFormation template: vpc_3.yaml\n</h5>\n\n<p>So we now have our VPC with both an IPv4 and IPv6 CIDR attached. However we have no where to place resources. In order to that we need to create subnets within the VPC. Subnets are linked to Availability Zones and are a small segment of the larger VPC IP ranges. Take a look at the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html">VPC User Guide - Subnets</a> for more details on subnetting.</p>\n\n<p>Although there are many ways to create/design your subnets in a VPC, I tend to lean towards splitting in line with the three tier architecture model (<a href="https://en.wikipedia.org/wiki/Multitier_architecture#Three-tier_architecture">wiki article</a>) as this tends to be the most common and flexible way of allocating space.</p>\n\n<blockquote>\n<p>Note: It is not possible to resize a subnet one created. It has to be deleted and then recreated.</p>\n</blockquote>\n\n<p>Based on using 3 Availability Zones for resiliency we will create 3 subnets in each tier giving us a total of 9 private subnets. For each of these subnets we will allocate a IPv4 and IPv6 range.</p>\n\n<p>Below are the IP allocations in the template (<a href="https://github.com/myawsrocks/vpc101/blob/main/subnetting.xlsx">available in excel in repo</a>). Generally the application/logic tier tends to have more components so these subnets are sized larger that the presentation and data tiers. I have split across application layer first then allocated to each Availability Zone. This allows easier security for items such as Network Access Control Lists (NACLs) or on-premise firewalls as if required an individual tier can be allowed.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--XFUOZafj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ucgt0y7d4g81futf3qyq.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XFUOZafj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ucgt0y7d4g81futf3qyq.png" alt="IPv4 Allocations" loading="lazy" width="849" height="119"></a></p>\n\n<p>For IPv6 because this range is allocated by AWS we have to use calculation to allocate the subnet part of the IP range and add to the VPC allocation. In the IP allocation file I use a dummy IPv6 VPC range of <code>fc00:1234:5678:9a::/56</code> to show how the subnets ranges are allocated. As you can see we assign the last 2 digits of the subnet range (in bold) to the provided VPC CIDR.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--KEqFYtw_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ra7muu2u3w98w37qvpvb.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KEqFYtw_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ra7muu2u3w98w37qvpvb.png" alt="IPv6 Allocations" loading="lazy" width="880" height="93"></a></p>\n\n<blockquote>\n<p>Note: Apart from the US West (Northern California) region all regions have 3 AZs for new customers</p>\n</blockquote>\n\n<p>Once complete you will be able to see all the subnets and their associated ranges in both the CloudFormation Stack outputs and in the console. You will notice in the CloudFormation Stack outputs there are also some extra keys. These are to enable easy reference via other stacks, if you use CloudFormation Nested Stack, or resources if you add to this template.</p>\n\n\n<hr>\n\n<h3>\n  <a name="creating-routing" href="#creating-routing">\n  </a>\n  Creating routing\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc4yaml" href="#cloudformation-template-vpc4yaml">\n  </a>\n  CloudFormation template: vpc_4.yaml\n</h5>\n\n<p>So we now have our VPC and Subnets and can start creating resources if we wish. The resources would be able to talk to each other using the "Default Route Table" that is created when creating a VPC. However, this route table can not then be manipulated in code if we wish to modify those routes. In order to be able to create and amend routes we need to define route tables in code and attach it to the subnets we have created.</p>\n\n<p>At this point we will only create a single private route table as it will only define a "local" route that can be used by all subnet to communicate between themselves. As the need for different routes per subnet/AZ is required we will create separate route tables and attach to the subnets required replacing this single route table.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--LRZZHHC0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tbg57zbvbz852li8khe0.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--LRZZHHC0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tbg57zbvbz852li8khe0.png" alt="Route Table and Associations in AWS Console" loading="lazy" width="880" height="626"></a></p>\n\n<p>One completed you will be able to see the new route table in the VPC console along with the attachments to our 9 subnets.</p>\n\n\n<hr>\n\n<h3>\n  <a name="enable-vpc-flow-logs" href="#enable-vpc-flow-logs">\n  </a>\n  Enable VPC Flow Logs\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc5yaml" href="#cloudformation-template-vpc5yaml">\n  </a>\n  CloudFormation template: vpc_5.yaml\n</h5>\n\n<p>One key item in becoming Well-Architected is ensuring security and operations are included in what we deploy. A key part for both of these items is knowing what is happening (observability) in the VPC. The first, and arguably most valuable, component in this is enabling VPC Flow Logs. Flow Logs can be enabled at the VPC, Subnet or Interface level but by enabling at the VPC level we ensure that logging is enabled on all traffic with out the need to be configured on subnets or components as they are deployed.</p>\n\n<p>We will publish the logs to CloudWatch Logs, to enable easy analysis, as well as S3 for archive. Both CloudWatch Logs and S3 are encrypted using a Customer Managed Key (CMK) provided by KMS that we will create in the template.</p>\n\n<p>The template defaults retention period for CloudWatch Log to 14 days and S3 to 365 days but as they are parameters these can easily be changed.</p>\n\n<blockquote>\n<p>In an organization, I would expect the S3 bucket to be created in a separate account that is used purely for logging to ensure segregation of duties.</p>\n</blockquote>\n\n<p>For more information on VPC Flow Logs take a look in the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html">VPC User Guide</a>.</p>\n\n<p>Once the stack update is complete you will be able to see the flow log configuration against the VPC in the console. Usefully it also links to the CloudWatch Log Group and the S3 bucket where the logs are stored.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--4VOklRy0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/78zpi5rpr6bjv9ts6x9r.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4VOklRy0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/78zpi5rpr6bjv9ts6x9r.png" alt="VPC Flow Log configuration" loading="lazy" width="880" height="222"></a></p>\n\n<p>If you look at the CloudFormation Stack outputs you will also see details of the IAM role and Policy as well as the KMS key id.</p>\n\n\n<hr>\n\n<h3>\n  <a name="deploy-vpc-endpoints" href="#deploy-vpc-endpoints">\n  </a>\n  Deploy VPC Endpoints\n</h3>\n\n<h5>\n  <a name="cloudformation-template-vpc6yaml" href="#cloudformation-template-vpc6yaml">\n  </a>\n  CloudFormation template: vpc_6.yaml\n</h5>\n\n<p>At present there is no access to components outside of the VPC. While this is extremely secure it does limit functionality. The easiest way to access AWS services is by using VPC Endpoints. These use the AWS network to connect to the services and are more secure than going over the internet. In addition endpoints have a security group and can have a resource policy to restrict access if required.</p>\n\n<p>If you want to understand more about the benefits of endpoints I did a blog post on the subject <a href="https://myaws.rocks/well-architecting-connectivity-to-aws-services/">here</a>.</p>\n\n<p>We will deploy all the VPC endpoints that would allow you to assign an IAM Role to an EC2 instance to interact with AWS if required, remote in to EC2 instances via Systems Manager - Session Manager, and use the CloudWatch Agent on EC2 instances to output OS metrics. Whilst there are over 170 service that support endpoints, these should give you enough to understand how they work and how you can provision them for your workloads.</p>\n\n<p>As these are Interface Endpoints we have to create the network interface in a subnet. For these interfaces I will create them in the Application Subnet as this is primarily where the workloads using them will be created. If you chose to create a public subnet this would also be an ideal place to put all VPC endpoints.</p>\n\n<p>Once the endpoints are created you can see them in the console and also the IP addresses of the interface within each subnet.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OpTXTaGJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qhann56rkpcpv5ltv25q.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OpTXTaGJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qhann56rkpcpv5ltv25q.png" alt="VPC Endpoints" loading="lazy" width="880" height="434"></a><br>\nNow, it might seem that this would then take a lot to be able to use these endpoints. However, if you take a look at the Details tab of the endpoint you will see DNS names for the endpoint.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--7cQAIbkA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p0121ajzik4nj8ptqprs.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--7cQAIbkA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p0121ajzik4nj8ptqprs.png" alt="VPC Endpoint DNS" loading="lazy" width="880" height="577"></a></p>\n\n<p>Again, the list of DNS looks daunting and while they can be used and will resolve to the endpoint IPs the item that is more critical is the Private DNS names. This will only resolve in the VPC but the name is the same as the public name for the service. So in this example the external resolution for the STS server sts.eu-west-2.amazonaws.com is 52.94.48.43. Within the VPC resources will use the private DNS resolution which would then resolve to the IPs in the VPC, in our case 172.16.4.206, 172.16.5.244, and 172.16.6.244.</p>\n\n<hr>\n<h3>\n  <a name="deploy-internet-access" href="#deploy-internet-access">\n  </a>\n  Deploy Internet Access\n</h3>\n<h5>\n  <a name="cloudformation-template-vpc7yaml" href="#cloudformation-template-vpc7yaml">\n  </a>\n  CloudFormation template: vpc_7.yaml\n</h5>\n\n<p>So we now have a VPC with Subnet and Routing along with access to AWS service that we might require and a way to remote in to EC2 instances. While this might be sufficient for some solutions such as data processing where the output is then in an S3 bucket or sent via SNS or some other servers it will not work for all workloads. In addition some workloads will deploy services that will need access to the internet to either download  and other workloads might need to be accessible in order to serve customers.</p>\n\n<p>To enable this and increase security we will create separate public subnets to host internet facing components. For these components we will deploy an Internet Gateway with direct access.</p>\n\n<p>For items in the private subnets that need internet access we will need to deploy a NAT Gateway for IPv4 traffic and an Egress Only Internet Gateway for IPv6 traffic. In addition we will need to create new route tables to allow subnets to access the relevant gateways. As NAT Gateways now support internet and private NAT options we have to specify that our gateway will be for public connectivity.</p>\n\n<p>As mentioned above we will also move the VPC Endpoints to the Public Subnet.</p>\n\n<hr>\n<h3>\n  <a name="reduce-nat-gateway-costs" href="#reduce-nat-gateway-costs">\n  </a>\n  Reduce NAT Gateway Costs\n</h3>\n<h5>\n  <a name="cloudformation-template-vpc8yaml" href="#cloudformation-template-vpc8yaml">\n  </a>\n  CloudFormation template: vpc_8.yaml\n</h5>\n\n<p>While most components have no charge NAT Gateways cost between 4¢ and 7¢ an hour dependent on the region you deploy to. While this might not seem much, as we are deploying in 3AZs (good practice) this is up to 21¢ and hour.<br>\nSo in a month with 31 days (744 hours) that equates to $157 just to have them provisioned.</p>\n\n<p>As such we will add an option to reduce this for workloads that do not need it. Using a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html">CloudFormation Conditions</a> we can decide which resources to build based on a input parameter. In our case we will have a parameter (ReducedNAT) that will then set whether we want a SingleNAT or MultiNAT solution. We have set the parameter input to only allow either Yes or No as an option to ensure that we always meet one of the 2 conditions.</p>\n\n<p>If we select Yes we then only create a single NAT Gateway and private route table with all private subnets using the same route table pointing to the single NAT Gateway.</p>\n\n<hr>\n<h3>\n  <a name="network-access-control-lists-nacls" href="#network-access-control-lists-nacls">\n  </a>\n  Network Access Control Lists (NACLs)\n</h3>\n<h3>\n  <a name="cloudformation-template-vpc9yaml" href="#cloudformation-template-vpc9yaml">\n  </a>\n  CloudFormation template: vpc_9.yaml\n</h3>\n\n<p>To improve security at the network level, we are going to create 4 NACLs to control traffic between the Subnets as well as in/out of the VPC. We will create NACLs as follows and associate to the relevant subnets:</p>\n\n<ol>\n<li>Public Subnets NACL</li>\n<li>Presentation Subnets NACL</li>\n<li>Application Subnets NACL</li>\n<li>Data Subnets NACL</li>\n</ol>\n\n<p>The diagram below shows the flows that will be enabled by the NACLs. I use common rule numbers across NACLs as I believe it is simpler to be able to match them up. For example rule 1xx is used for outbound internet IPv4 traffic and it\'s reply traffic in all NACLs. I also group IPv4 and IPv6 so NACL entries together. For example rule 200,201,202, all provide the same access between the presentation and applications subnets.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--YGHUNjo5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/511b1xfuuvn32pojy1k1.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YGHUNjo5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/511b1xfuuvn32pojy1k1.png" alt="NACLS" loading="lazy" width="596" height="495"></a></p>\n\n<p>In the <strong>Public Subnet NACL</strong> firstly we are going to create rules which will enable inbound traffic from the internet on port 443 (HTTPS) and its reply traffic on ports 1024 to 65535 (<a href="https://en.wikipedia.org/wiki/Ephemeral_port">Ephemeral Ports</a>) using IPv4 (<strong>rule10</strong>) or IPv6 (<strong>rule11</strong>). This will allow access to resources we might host in the public subnet such as load balancers or API Gateways, but only over the secure HTTPS protocol. Secondly we are going to create rules that allows all VPC components to access the public internet on port 443 (HTTPS) and the reply traffic on ports 1024 to 65535 using IPv4 (<strong>rule100</strong>) or IPv6 (<strong>rule105</strong>). This enables devices in any subnet to talk to the internet over HTTPS and the reply traffic. For those devices in the Private Subnets this is via the NAT devices.</p>\n\n<p>In the <strong>Presentation Subnet NACL</strong> firstly we are going create the inbound internet rules that will allow devices in the public subnets to talk to the presentations subnet on port 443 and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule10, 11, 12</strong>) or IPv6 (<strong>rule15, 16, 17</strong>). This will allow devices such as load balancers that are routing internet traffic to talk to components in the presentation subnet only over HTTPS matching rules 10 and 11 in the <strong>Public Subnet NACL</strong>. Secondly we are going to create rules that correspond to rules 100 and 105 in the <strong>Public Subnet NACL</strong> for outbound internet traffic. For IPv4 this is rules 100, 101, 102, and for IPv6 this is rules 105, 106, 107. Finally we are going to allow devices in the presentation subnets to talk to the application subnet on ports 1 to 1023 (<a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports">Common Ports</a>) and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule200, 201, 202</strong>) or IPv6 (<strong>rule205, 206, 207</strong>). This will allow components such as web servers to talk to components in the application subnet and the reply traffic.</p>\n\n<p>In the <strong>Application Subnet NACL</strong> firstly we are going to create the same outbound internet rules as in the presentation subnet (<strong>100, 101, 102, 105, 106, 107</strong>) that correspond to rules in the <strong>Public Subnet NACL</strong> for internet traffic. Secondly we are then going to create rules <strong>200, 201, 202, 205, 206, and 207</strong>, which correspond to the same rules in the <strong>Presentation Subnet NACL</strong> to allow traffic between the presentation and application subnets. Finally we are going to allow devices in the application subnets to talk to the data subnet on ports 1 to 1023 and the reply traffic on ports 1024  to 65535 using IPv4 (<strong>rule300, 301, 302</strong>) or IPv6 (<strong>rule305, 306, 307</strong>). This will allow components such as application servers to talk to components in the application subnet such as databased and the reply traffic.</p>\n\n<p>In the <strong>Data Subnet NACL</strong>, again we are firstly going to create rules <strong>100, 101, 102, 105, 106, 107</strong> for outbound internet traffic. that correspond to rules in the <strong>Public Subnet NACL</strong>. Secondly we are then going to create rules <strong>300, 301, 302, 305, 306, and 307</strong> that correspond to the same rules in the Application Subnet NACL to allow traffic between the application and data subnets.</p>\n\n<p>Once deployed take a look at the NACLs, you should have the following rules in each list. Note, this relatively open but we would further control access with Security Groups around resources.</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--W7W6eQbk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1n9o1rgokqdt1ptgpu2c.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--W7W6eQbk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1n9o1rgokqdt1ptgpu2c.png" alt="NACL Rules diagram" loading="lazy" width="868" height="557"></a></p>\n\n<hr>\n<h3>\n  <a name="whats-next" href="#whats-next">\n  </a>\n  What\'s Next?\n</h3>\n<h4>\n  <a name="clean-up" href="#clean-up">\n  </a>\n  Clean Up\n</h4>\n\n<p>The cost of this solution according to the AWS Pricing Calculator is $126 for the London Region (see estimate). While that\'s not much it would equate to about $1,500 for the year. The reduced NAT option\'s estimate for the same region is $54/month or $650 a year. So, unless you need to use it I\'d suggest deleting the stack once you\'ve had a look at how a VPC and it\'s components work.</p>\n<h4>\n  <a name="future-updates" href="#future-updates">\n  </a>\n  Future Updates\n</h4>\n\n<p>If you take a look at the Git repository for this post you can see the current roadmap. Once those items are created I will come back and update this post. At present the items I have plans for are:</p>\n\n<ul>\n<li>IPv6 only subnets and networking devices.</li>\n<li>Option for no NAT</li>\n</ul>\n\n<p>If you want to contribute or recommend updates on the solution please feel free to either leave a suggestion here or create a pull request on GitHub.</p>\n\n\n<div class="ltag-github-readme-tag">\n  <div class="readme-overview">\n    <h2>\n      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--566lAguM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev.to/assets/github-logo-5a155e1f9a670af7944dd5e12375bc76ed542ea80224905ecaf878b9157cdefc.svg" alt="GitHub logo" loading="lazy">\n      <a href="https://github.com/myawsrocks">\n        myawsrocks\n      </a> / <a style="font-weight: 600;" href="https://github.com/myawsrocks/vpc101">\n        vpc101\n      </a>\n    </h2>\n    <h3>\n      Code to create a Well-Architected VPC\n    </h3>\n  </div>\n  <div class="ltag-github-body">\n    \n<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://github.com/myawsrocks/vpc101/graphs/contributors"><img src="https://camo.githubusercontent.com/b3265f6e5c686cb876c99c8db249585e07462a4c5c6d80e848a8462857d35a09/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6e7472696275746f72732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Contributors" data-canonical-src="https://img.shields.io/github/contributors/myawsrocks/vpc101.svg?style=plastic&amp;logo=appveyor" style="max-width: 100%;"></a>\n<a href="https://github.com/myawsrocks/vpc101/network/members"><img src="https://camo.githubusercontent.com/8294e08be092126877924afc9904fcccd4fa49c0135f59770705ff31848deba8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f666f726b732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Forks" data-canonical-src="https://img.shields.io/github/forks/myawsrocks/vpc101.svg?style=plastic&amp;logo=appveyor" style="max-width: 100%;"></a>\n<a href="https://github.com/myawsrocks/vpc101/stargazers"><img src="https://camo.githubusercontent.com/077586eb91648d741ff91db647de4fd095b922feb742d031f67b0b3fa1d8420a/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Stargazers" data-canonical-src="https://img.shields.io/github/stars/myawsrocks/vpc101.svg?style=plastic&amp;logo=appveyor" style="max-width: 100%;"></a>\n<a href="https://github.com/myawsrocks/vpc101/issues"><img src="https://camo.githubusercontent.com/ab2f92430dd02817130b2caee486b8bcba8fb1d489293d679d09101ea20a770c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="Issues" data-canonical-src="https://img.shields.io/github/issues/myawsrocks/vpc101.svg?style=plastic&amp;logo=appveyor" style="max-width: 100%;"></a>\n<a href="https://github.com/myawsrocks/vpc101/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/36c2301b4ed0513d3b16001929bd07465b887d8151e1db9cd3d86105da8004e5/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6d79617773726f636b732f7670633130312e7376673f7374796c653d706c6173746963266c6f676f3d6170707665796f72" alt="License" data-canonical-src="https://img.shields.io/github/license/myawsrocks/vpc101.svg?style=plastic&amp;logo=appveyor" style="max-width: 100%;"></a>\n<br>\n<a href="https://myaws.rocks/aws-vpc-101" rel="nofollow"><img src="https://camo.githubusercontent.com/d6e783d4539fc19c473265f153679223aaa4a0fd18fbfdb3baa0602d9514f5bd/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f50726f6a6563742532304c696e6b2d6d796177732e726f636b732532305650433130312d79656c6c6f77677265656e3f7374796c653d736f6369616c" alt="VPC 101 on myaws.rocks" data-canonical-src="https://img.shields.io/badge/Project%20Link-myaws.rocks%20VPC101-yellowgreen?style=social" style="max-width: 100%;"></a>\n<a href="https://linkedin.com/in/robinwford/" rel="nofollow"><img src="https://camo.githubusercontent.com/2c36de0584a9ab3208c7ac55f34c467d29bd88008021090e0060e31f755a03dc/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d4c696e6b6564496e2d626c61636b2e7376673f7374796c653d736f6369616c266c6f676f3d6c696e6b6564696e26636f6c6f723d626c7565" alt="LinkedIn" data-canonical-src="https://img.shields.io/badge/-LinkedIn-black.svg?style=social&amp;logo=linkedin&amp;color=blue" style="max-width: 100%;"></a>\n<a href="https://twitter.com/robinwford" rel="nofollow"><img src="https://camo.githubusercontent.com/0b57477caf8fa22426b213b6cac1a3b2ea2134a4fb11a845c79443ce6aa75074/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f666f6c6c6f772f726f62696e77666f72643f636f6c6f723d626c7565266c6f676f3d74776974746572267374796c653d736f6369616c" alt="Twitter" data-canonical-src="https://img.shields.io/twitter/follow/robinwford?color=blue&amp;logo=twitter&amp;style=social" style="max-width: 100%;"></a></p>\n<br>\n<div align="center" dir="auto">\n  <a href="https://github.com/myawsrocks/vpc101">\n    <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jWOD8s70--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/myawsrocks/vpc101images/minifig.png" alt="Logo" width="80" height="80" style="max-width: 100%;" loading="lazy">\n  </a>\n<h3 align="center" dir="auto">\nmyaws.rocks vpc 101</h3>\n  <p align="center" dir="auto">\n    How to build a VPC demo\n    <br>\n    <br>\n    <a href="https://github.com/myawsrocks/vpc101/issues">Report Bug</a>\n    ·\n    <a href="https://github.com/myawsrocks/vpc101/issues">Request Feature</a>\n  </p>\n</div>\n<details>\n  <summary>Table of Contents</summary>\n  <ol dir="auto">\n    <li>\n      <a href="https://github.com/myawsrocks/vpc101#about-the-project">About The Project</a>\n    </li>\n    <li>\n      <a href="https://github.com/myawsrocks/vpc101#getting-started">Getting Started</a>\n      <ul dir="auto">\n        <li><a href="https://github.com/myawsrocks/vpc101#prerequisites">Prerequisites</a></li>\n        <li><a href="https://github.com/myawsrocks/vpc101#installation">Installation</a></li>\n      </ul>\n    </li>\n    <li><a href="https://github.com/myawsrocks/vpc101#usage">Usage</a></li>\n    <li><a href="https://github.com/myawsrocks/vpc101#roadmap">Roadmap</a></li>\n    <li><a href="https://github.com/myawsrocks/vpc101#contributing">Contributing</a></li>\n    <li><a href="https://github.com/myawsrocks/vpc101#license">License</a></li>\n    <li><a href="https://github.com/myawsrocks/vpc101#contact">Contact</a></li>\n  </ol>\n</details>\n<h2 dir="auto">\nAbout The Project</h2>\n<p dir="auto">This solution walks through the building and securing of the following VPC.<br>\nAt the end of the deployment you will have a VPC spanning multiple Availability Zones (AZ) with both IPv4 and IPv6 ranges.<br></p>\n<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/myawsrocks/vpc101images/VPC.jpg"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--bExAjOmq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/myawsrocks/vpc101images/VPC.jpg" alt="Product Name Screen Shot" style="max-width: 100%;" loading="lazy"></a></p>\n<p dir="auto">###Components built with the solution are:</p>\n<details>\n  <ol dir="auto">\n    <li>Create an empty VPC with an IPv4 CIDR range - vpc_1.yaml</li>\n    <li>Create an IPv6 CIDR range and associate to the VPC - vpc_2.yaml</li>\n    <li>Create 9 private subnets with IPv4 and IPv6 IP ranges allocated: - vpc_3.yaml\n      <ul dir="auto">\n        <li>3x Presentation</li>\n        <li>3x Application</li>\n        <li>3x Data</li>\n      </ul>\n    </li>\n<li>Create a private route tables and associate to the private subnets - vpc_4.yaml</li>\n    <li>Enable VPC Flow Logs and send to encrypted S3 Bucket and encrypted CloudWatch Log Group - vpc_5.yaml</li>\n    <li>Deploy VPC Endpoints for common AWS…</li>\n</ol></details></article></div>\n  </div>\n  <div class="gh-btn-container"><a class="gh-btn" href="https://github.com/myawsrocks/vpc101">View on GitHub</a></div>\n</div>\n\n\n',a.body_markdown="So this is the first in my posts walking through how to deploy a solution in AWS. Hopefully  you find it useful as VPCs are the foundation for private and secure networking in AWS and an area many struggle. This guide is designed to ensure that your VPC deployments can be Well-Architected and provide a base level of network security but is only one option for VPC layout. While it will meet a vast majority of workloads you might want to review the structure and reduce, or increase, the number of subnets as well as other components.\n\nI will not go into CloudFormation templates structure, unless required, or deployment method. However, all templates are designed to be able to manually uploaded via the console and applied consecutively or the individual template you wish to deploy.\n\n> All code for this project can be found at my git organisation under the VPC 101 repository [myawsrocks/vpc101](https://github.com/myawsrocks/vpc101).\n\n\n### What you'll create:\nThis solution will create the following topology with the option for a single (reduced redundancy) NAT Gateway. In addition we will enable encrypted VPC Flow logs that are stored in CloudWatch and S3. Generally the S3 bucket would be in a central security account but for our purpose we will create and secure it in the same account.\n\n\n![Complete VPC](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5bbpfi5cmgi5m1o22sw2.jpg)\n\nWell go through the each of the following steps with each step representing a unique CloudFormation template that you can deploy from my repo.\n\n1. Create an empty VPC with an IPv4 CIDR range.\n2. Create an IPv6 CIDR range and associate to the VPC.\n3. Create 9 private subnets with IPv4 and IPv6 IP ranges allocated.\n4. Create private route tables and associate to the private subnets.\n5. Enable VPC Flow Logs and send to encrypted S3 Bucket and CloudWatch Log Group:\n6. Deploy VPC Endpoints for common AWS Services.\n7. Create public subnets and internet access.\n8. Option for single NAT Gateway\n\n---\n\n###Creating the base VPC\n#####CloudFormation template: vpc_1.yaml\n\nUnlike with the VPC wizard in the console, creating a VPC in code or via CLI only creates an empty VPC with the IP4 range (CIDR) you provide. In my example we'll use the default in the template of 172.16.0.0/20 but you can replace this with any range. Unless you have a large public IP range you want to consume I'd suggest an RCF1918 range (Private IPv4) which only has minor AWS restrictions in relation to secondary IP ranges (see the docs - [working with vpcs](https://docs.aws.amazon.com/vpc/latest/userguide/working-with-vpcs.html)).\n\n>Remember: If you are going to be connecting to other VPC's via VPC Peering or a Transit Gateway you need to ensure you do not assign the same IP range to multiple VPCs.\n\nOnce the CloudFormation Stack has completed you will be able to view your VPC in the console and see the attached IPv4 range.\n\n\n![VPC with IPv4 range](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1vfqurpmxo2dz63zn45c.png)\n\n---\n###Creating an IPv6 range and associate to VPC\n#####CloudFormation template: vpc_2.yaml\n\nAlthough IPv6 adoption is low, I promote its use as it offers many benefits if you are able to adopt it. Assigning and using an IPv6 range is simple and most services in AWS are able to run IPv4 and IPv6 and some services can now run IPv6 only.\n\nAs with IPv4, while you can use your own public IPv6 range in AWS, unless you have requirements to advertise these internally or externally it is simpler to utilize an AWS IPv6 range. These are public ranges so globally unique both between VPCs and on the internet.\n\nUpdating the stack with IPv6 should only take a minute or two and once complete you will be able to see the assigned AWS IPv6 range in both the CloudFormation Stack outputs and in the VPC configuration in the console.\n\n\n![IPv6 range in outputs](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7foshh5219ig9g5ugpi.png)\n\n---\n###Creating private subnets\n#####CloudFormation template: vpc_3.yaml\n\nSo we now have our VPC with both an IPv4 and IPv6 CIDR attached. However we have no where to place resources. In order to that we need to create subnets within the VPC. Subnets are linked to Availability Zones and are a small segment of the larger VPC IP ranges. Take a look at the [VPC User Guide - Subnets](https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html) for more details on subnetting.\n\nAlthough there are many ways to create/design your subnets in a VPC, I tend to lean towards splitting in line with the three tier architecture model ([wiki article](https://en.wikipedia.org/wiki/Multitier_architecture#Three-tier_architecture)) as this tends to be the most common and flexible way of allocating space.\n\n>Note: It is not possible to resize a subnet one created. It has to be deleted and then recreated.\n\nBased on using 3 Availability Zones for resiliency we will create 3 subnets in each tier giving us a total of 9 private subnets. For each of these subnets we will allocate a IPv4 and IPv6 range.\n\nBelow are the IP allocations in the template ([available in excel in repo](https://github.com/myawsrocks/vpc101/blob/main/subnetting.xlsx)). Generally the application/logic tier tends to have more components so these subnets are sized larger that the presentation and data tiers. I have split across application layer first then allocated to each Availability Zone. This allows easier security for items such as Network Access Control Lists (NACLs) or on-premise firewalls as if required an individual tier can be allowed.\n\n![IPv4 Allocations](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ucgt0y7d4g81futf3qyq.png)\n\nFor IPv6 because this range is allocated by AWS we have to use calculation to allocate the subnet part of the IP range and add to the VPC allocation. In the IP allocation file I use a dummy IPv6 VPC range of `fc00:1234:5678:9a::/56` to show how the subnets ranges are allocated. As you can see we assign the last 2 digits of the subnet range (in bold) to the provided VPC CIDR.\n\n![IPv6 Allocations](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ra7muu2u3w98w37qvpvb.png)\n\n>Note: Apart from the US West (Northern California) region all regions have 3 AZs for new customers\n\nOnce complete you will be able to see all the subnets and their associated ranges in both the CloudFormation Stack outputs and in the console. You will notice in the CloudFormation Stack outputs there are also some extra keys. These are to enable easy reference via other stacks, if you use CloudFormation Nested Stack, or resources if you add to this template.\n\n---\n###Creating routing\n#####CloudFormation template: vpc_4.yaml\n\nSo we now have our VPC and Subnets and can start creating resources if we wish. The resources would be able to talk to each other using the \"Default Route Table\" that is created when creating a VPC. However, this route table can not then be manipulated in code if we wish to modify those routes. In order to be able to create and amend routes we need to define route tables in code and attach it to the subnets we have created.\n\nAt this point we will only create a single private route table as it will only define a \"local\" route that can be used by all subnet to communicate between themselves. As the need for different routes per subnet/AZ is required we will create separate route tables and attach to the subnets required replacing this single route table.\n\n\n![Route Table and Associations in AWS Console](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tbg57zbvbz852li8khe0.png)\n\nOne completed you will be able to see the new route table in the VPC console along with the attachments to our 9 subnets.\n\n---\n###Enable VPC Flow Logs\n#####CloudFormation template: vpc_5.yaml\n\nOne key item in becoming Well-Architected is ensuring security and operations are included in what we deploy. A key part for both of these items is knowing what is happening (observability) in the VPC. The first, and arguably most valuable, component in this is enabling VPC Flow Logs. Flow Logs can be enabled at the VPC, Subnet or Interface level but by enabling at the VPC level we ensure that logging is enabled on all traffic with out the need to be configured on subnets or components as they are deployed.\n\nWe will publish the logs to CloudWatch Logs, to enable easy analysis, as well as S3 for archive. Both CloudWatch Logs and S3 are encrypted using a Customer Managed Key (CMK) provided by KMS that we will create in the template.\n\nThe template defaults retention period for CloudWatch Log to 14 days and S3 to 365 days but as they are parameters these can easily be changed.\n\n>In an organization, I would expect the S3 bucket to be created in a separate account that is used purely for logging to ensure segregation of duties.\n\nFor more information on VPC Flow Logs take a look in the [VPC User Guide](https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html).\n\nOnce the stack update is complete you will be able to see the flow log configuration against the VPC in the console. Usefully it also links to the CloudWatch Log Group and the S3 bucket where the logs are stored.\n\n![VPC Flow Log configuration](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/78zpi5rpr6bjv9ts6x9r.png)\n\nIf you look at the CloudFormation Stack outputs you will also see details of the IAM role and Policy as well as the KMS key id.\n\n---\n###Deploy VPC Endpoints\n#####CloudFormation template: vpc_6.yaml\n\nAt present there is no access to components outside of the VPC. While this is extremely secure it does limit functionality. The easiest way to access AWS services is by using VPC Endpoints. These use the AWS network to connect to the services and are more secure than going over the internet. In addition endpoints have a security group and can have a resource policy to restrict access if required.\n\nIf you want to understand more about the benefits of endpoints I did a blog post on the subject [here](https://myaws.rocks/well-architecting-connectivity-to-aws-services/).\n\n\nWe will deploy all the VPC endpoints that would allow you to assign an IAM Role to an EC2 instance to interact with AWS if required, remote in to EC2 instances via Systems Manager - Session Manager, and use the CloudWatch Agent on EC2 instances to output OS metrics. Whilst there are over 170 service that support endpoints, these should give you enough to understand how they work and how you can provision them for your workloads.\n\nAs these are Interface Endpoints we have to create the network interface in a subnet. For these interfaces I will create them in the Application Subnet as this is primarily where the workloads using them will be created. If you chose to create a public subnet this would also be an ideal place to put all VPC endpoints.\n\nOnce the endpoints are created you can see them in the console and also the IP addresses of the interface within each subnet.\n\n![VPC Endpoints](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qhann56rkpcpv5ltv25q.png)\nNow, it might seem that this would then take a lot to be able to use these endpoints. However, if you take a look at the Details tab of the endpoint you will see DNS names for the endpoint.\n\n\n![VPC Endpoint DNS](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p0121ajzik4nj8ptqprs.png)\n\nAgain, the list of DNS looks daunting and while they can be used and will resolve to the endpoint IPs the item that is more critical is the Private DNS names. This will only resolve in the VPC but the name is the same as the public name for the service. So in this example the external resolution for the STS server sts.eu-west-2.amazonaws.com is 52.94.48.43. Within the VPC resources will use the private DNS resolution which would then resolve to the IPs in the VPC, in our case 172.16.4.206, 172.16.5.244, and 172.16.6.244.\n\n---\n###Deploy Internet Access\n#####CloudFormation template: vpc_7.yaml\n\nSo we now have a VPC with Subnet and Routing along with access to AWS service that we might require and a way to remote in to EC2 instances. While this might be sufficient for some solutions such as data processing where the output is then in an S3 bucket or sent via SNS or some other servers it will not work for all workloads. In addition some workloads will deploy services that will need access to the internet to either download  and other workloads might need to be accessible in order to serve customers.\n\nTo enable this and increase security we will create separate public subnets to host internet facing components. For these components we will deploy an Internet Gateway with direct access.\n\nFor items in the private subnets that need internet access we will need to deploy a NAT Gateway for IPv4 traffic and an Egress Only Internet Gateway for IPv6 traffic. In addition we will need to create new route tables to allow subnets to access the relevant gateways. As NAT Gateways now support internet and private NAT options we have to specify that our gateway will be for public connectivity.\n\nAs mentioned above we will also move the VPC Endpoints to the Public Subnet.\n\n---\n###Reduce NAT Gateway Costs\n#####CloudFormation template: vpc_8.yaml\n\nWhile most components have no charge NAT Gateways cost between 4¢ and 7¢ an hour dependent on the region you deploy to. While this might not seem much, as we are deploying in 3AZs (good practice) this is up to 21¢ and hour.\nSo in a month with 31 days (744 hours) that equates to $157 just to have them provisioned.\n\nAs such we will add an option to reduce this for workloads that do not need it. Using a [CloudFormation Conditions](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html) we can decide which resources to build based on a input parameter. In our case we will have a parameter (ReducedNAT) that will then set whether we want a SingleNAT or MultiNAT solution. We have set the parameter input to only allow either Yes or No as an option to ensure that we always meet one of the 2 conditions.\n\nIf we select Yes we then only create a single NAT Gateway and private route table with all private subnets using the same route table pointing to the single NAT Gateway.\n\n---\n###Network Access Control Lists (NACLs)\n###CloudFormation template: vpc_9.yaml\n\nTo improve security at the network level, we are going to create 4 NACLs to control traffic between the Subnets as well as in/out of the VPC. We will create NACLs as follows and associate to the relevant subnets:\n\n1. Public Subnets NACL\n2. Presentation Subnets NACL\n3. Application Subnets NACL\n4. Data Subnets NACL\n\nThe diagram below shows the flows that will be enabled by the NACLs. I use common rule numbers across NACLs as I believe it is simpler to be able to match them up. For example rule 1xx is used for outbound internet IPv4 traffic and it's reply traffic in all NACLs. I also group IPv4 and IPv6 so NACL entries together. For example rule 200,201,202, all provide the same access between the presentation and applications subnets.\n\n\n![NACLS](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/511b1xfuuvn32pojy1k1.png)\n\nIn the **Public Subnet NACL** firstly we are going to create rules which will enable inbound traffic from the internet on port 443 (HTTPS) and its reply traffic on ports 1024 to 65535 ([Ephemeral Ports](https://en.wikipedia.org/wiki/Ephemeral_port)) using IPv4 (**rule10**) or IPv6 (**rule11**). This will allow access to resources we might host in the public subnet such as load balancers or API Gateways, but only over the secure HTTPS protocol. Secondly we are going to create rules that allows all VPC components to access the public internet on port 443 (HTTPS) and the reply traffic on ports 1024 to 65535 using IPv4 (**rule100**) or IPv6 (**rule105**). This enables devices in any subnet to talk to the internet over HTTPS and the reply traffic. For those devices in the Private Subnets this is via the NAT devices.\n\nIn the **Presentation Subnet NACL** firstly we are going create the inbound internet rules that will allow devices in the public subnets to talk to the presentations subnet on port 443 and the reply traffic on ports 1024  to 65535 using IPv4 (**rule10, 11, 12**) or IPv6 (**rule15, 16, 17**). This will allow devices such as load balancers that are routing internet traffic to talk to components in the presentation subnet only over HTTPS matching rules 10 and 11 in the **Public Subnet NACL**. Secondly we are going to create rules that correspond to rules 100 and 105 in the **Public Subnet NACL** for outbound internet traffic. For IPv4 this is rules 100, 101, 102, and for IPv6 this is rules 105, 106, 107. Finally we are going to allow devices in the presentation subnets to talk to the application subnet on ports 1 to 1023 ([Common Ports](https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports)) and the reply traffic on ports 1024  to 65535 using IPv4 (**rule200, 201, 202**) or IPv6 (**rule205, 206, 207**). This will allow components such as web servers to talk to components in the application subnet and the reply traffic.\n\nIn the **Application Subnet NACL** firstly we are going to create the same outbound internet rules as in the presentation subnet (**100, 101, 102, 105, 106, 107**) that correspond to rules in the **Public Subnet NACL** for internet traffic. Secondly we are then going to create rules **200, 201, 202, 205, 206, and 207**, which correspond to the same rules in the **Presentation Subnet NACL** to allow traffic between the presentation and application subnets. Finally we are going to allow devices in the application subnets to talk to the data subnet on ports 1 to 1023 and the reply traffic on ports 1024  to 65535 using IPv4 (**rule300, 301, 302**) or IPv6 (**rule305, 306, 307**). This will allow components such as application servers to talk to components in the application subnet such as databased and the reply traffic.\n\nIn the **Data Subnet NACL**, again we are firstly going to create rules **100, 101, 102, 105, 106, 107** for outbound internet traffic. that correspond to rules in the **Public Subnet NACL**. Secondly we are then going to create rules **300, 301, 302, 305, 306, and 307** that correspond to the same rules in the Application Subnet NACL to allow traffic between the application and data subnets.\n\nOnce deployed take a look at the NACLs, you should have the following rules in each list. Note, this relatively open but we would further control access with Security Groups around resources.\n\n![NACL Rules diagram](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1n9o1rgokqdt1ptgpu2c.png)\n\n---\n###What's Next?\n\n####Clean Up\nThe cost of this solution according to the AWS Pricing Calculator is $126 for the London Region (see estimate). While that's not much it would equate to about $1,500 for the year. The reduced NAT option's estimate for the same region is $54/month or $650 a year. So, unless you need to use it I'd suggest deleting the stack once you've had a look at how a VPC and it's components work.\n\n####Future Updates\nIf you take a look at the Git repository for this post you can see the current roadmap. Once those items are created I will come back and update this post. At present the items I have plans for are:\n\n- IPv6 only subnets and networking devices.\n- Option for no NAT\n\nIf you want to contribute or recommend updates on the solution please feel free to either leave a suggestion here or create a pull request on GitHub.\n\n{% embed https://github.com/myawsrocks/vpc101 %}",a.user={name:"Robin Ford",username:n,twitter_username:n,github_username:e,website_url:"https://myaws.rocks",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s--UN2DHdXD--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/725125/68beae76-5d98-436e-bc71-43dc67d8a333.jpg",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s--Hmx9Qd7_--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/725125/68beae76-5d98-436e-bc71-43dc67d8a333.jpg"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:e,state:{currentArticle:a},serverRendered:!0,routePath:"/robinwford/1085519",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:e}}}}(null,"2022-05-14T21:53:04Z",{},"https://dev.to/robinwford/creating-a-well-architected-vpc-34o7","robinwford")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
