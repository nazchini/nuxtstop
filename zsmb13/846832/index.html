<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>All About Opt-In Annotations</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Using Nuxt.js fetch() hook to build dev.to with a new look"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/nuxtstop/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap"><link rel="preload" href="/nuxtstop/_nuxt/f6e87fb.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/6474719.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/9b75090.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/18df600.js" as="script"><link rel="preload" href="/nuxtstop/_nuxt/dc9ce94.js" as="script"><style data-vue-ssr-id="c650fd98:0 af4684f0:0 a9c71758:0 dcafa518:0 4b9cec49:0 b093d766:0 9d98bcb4:0 6b6a11ea:0 0248ed80:0 ea8e4264:0">html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{border:0 solid #e0e0e0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}button{background:0 0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}hr{border-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:inherit;opacity:.5}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:inherit;opacity:.5}input::placeholder,textarea::placeholder{color:inherit;opacity:.5}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;font-family:sans-serif}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;font-family:inherit;font-size:100%}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto;word-break:break-word;white-space:normal}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{height:100%;font-size:18px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}@media(min-width:640px){html{font-size:20px}}body{height:100%;min-width:320px;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:400;line-height:1.5;color:#000;background-color:#eff4f7;-webkit-text-rendering:optimizeLegibility;text-rendering:optimizeLegibility;font-synthesis:none;font-kerning:normal;font-feature-settings:"normal","kern";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-overflow-scrolling:touch;overflow-x:hidden;overflow-y:scroll}h1,h2,h3,h4,h5,h6{color:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;font-feature-settings:"normal";line-height:1.2}pre{background:#29292e;border-radius:2px;overflow:auto;padding:1rem;color:#eff1f9;line-height:1.42em;font-size:13px}@media screen and (min-width:380px){pre{font-size:15px}}pre code{background:#29292e;color:#eff0f9;white-space:pre}div.highlight pre.highlight code{font-size:inherit;padding:0}div.inner-comment div.body div.highlight pre.highlight{background:#29292e}div.inner-comment div.body div.highlight pre.highlight code{font-size:inherit;white-space:inherit;background:inherit;color:inherit}.highlight .hll{background-color:#49483e}.highlight{background:#29292e;color:#f8f8f2}.highlight .c{color:grey}.highlight .err{text-shadow:0 0 7px #f9690e}.highlight .k{color:#f39c12}.highlight .l{color:plum}.highlight .n{color:#f8f8f2}.highlight .o{color:#f9690e}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:grey}.highlight .gd{color:#f9690e}.highlight .ge{font-style:italic}.highlight .gi{color:#7ed07e}.highlight .gs{font-weight:700}.highlight .gu{color:grey}.highlight .kc,.highlight .kd{color:#f39c12}.highlight .kn{color:#f9690e}.highlight .kp,.highlight .kr,.highlight .kt{color:#f39c12}.highlight .ld{color:#f2ca27}.highlight .m{color:plum}.highlight .s{color:#f2ca27}.highlight .na{color:#7ed07e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#7ed07e}.highlight .no{color:#f39c12}.highlight .nd{color:#7ed07e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#7ed07e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#7ed07e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f9690e}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f9690e}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:plum}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#f2ca27}.highlight .se{color:plum}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#f2ca27}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#7ed07e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:plum}.vue-content-placeholders-heading__img,.vue-content-placeholders-heading__subtitle,.vue-content-placeholders-heading__title,.vue-content-placeholders-img,.vue-content-placeholders-text__line{background:#bfcdec!important}.vue-content-placeholders-is-animated .vue-content-placeholders-heading__img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__subtitle:before,.vue-content-placeholders-is-animated .vue-content-placeholders-heading__title:before,.vue-content-placeholders-is-animated .vue-content-placeholders-img:before,.vue-content-placeholders-is-animated .vue-content-placeholders-text__line:before{background:linear-gradient(90deg,transparent 0,#d3ddf9 15%,transparent 30%)!important}header[data-v-27046cca]{max-width:1280px;margin:auto;padding:1rem;height:6rem;border-bottom:1px solid rgba(0,0,0,.2)}header .logo-wrapper[data-v-27046cca],header[data-v-27046cca]{display:flex;align-items:center;justify-content:space-between}header .logo-wrapper[data-v-27046cca]{margin:0 .5rem}header .logo-wrapper svg[data-v-27046cca]{width:3rem;height:100%}header .logo-wrapper .name-wrapper[data-v-27046cca]{margin-left:.6em}header .logo-wrapper .name-wrapper .subtitle[data-v-27046cca]{font-size:1rem}header .logo-wrapper .name-wrapper .app-name[data-v-27046cca]{font-weight:700;font-size:2.25rem;line-height:1.25}header nav[data-v-27046cca]{letter-spacing:-.025rem;font-weight:600;text-transform:uppercase}header nav ul[data-v-27046cca]{display:flex}header nav ul li[data-v-27046cca]{margin:0 .5rem}header nav ul li a[data-v-27046cca]{box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;padding:.25rem 1rem;border-radius:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}header nav ul li a[data-v-27046cca]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header nav ul li a.nuxt-link-exact-active[data-v-27046cca]{cursor:default}header nav ul li a.nuxt-link-exact-active[data-v-27046cca],header nav ul li a[data-v-27046cca]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}.page-wrapper[data-v-10d06ee8]{max-width:1280px;margin:auto;padding:1rem}.article-content-wrapper[data-v-10d06ee8]{display:flex;flex-direction:column;align-items:center;margin:auto auto 2rem}@media(min-width:1024px){.article-content-wrapper[data-v-10d06ee8]{align-items:normal;flex-direction:row}}.article-content-wrapper .article-block[data-v-10d06ee8]{width:100%;max-width:880px}@media(min-width:1024px){.article-content-wrapper .article-block[data-v-10d06ee8]{margin-right:1rem;width:66.66666%;margin-bottom:2rem}}.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{max-width:880px;width:100%;position:relative}@media(min-width:1024px){.article-content-wrapper .aside-username-wrapper[data-v-10d06ee8]{display:block;width:33.33333%}}.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-10d06ee8]{position:-webkit-sticky;position:sticky;top:1rem}@media(min-width:1280px){.comments-block[data-v-10d06ee8]{margin:.5rem}}article[data-v-70afb46a]{padding:.5rem;border-radius:1rem}header h1[data-v-70afb46a],header[data-v-70afb46a]{margin-bottom:1rem}header h1[data-v-70afb46a]{font-size:2.25rem;letter-spacing:-.025rem}header .tags[data-v-70afb46a]{display:flex;flex-wrap:wrap;margin-bottom:1.5rem}header .tags .tag[data-v-70afb46a]{font-weight:500;line-height:1;padding:.5rem;margin:0 .5rem .5rem 0;border-radius:.25rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db}header .tags .tag[data-v-70afb46a]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}header .tags .tag[data-v-70afb46a]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}header .image-wrapper[data-v-70afb46a]{position:relative;padding-bottom:56.25%;background-color:#d4dfe8;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden}@media(min-width:834px){header .image-wrapper[data-v-70afb46a]{margin-bottom:1.5rem}}header .image-wrapper img[data-v-70afb46a]{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}header .meta[data-v-70afb46a]{line-height:1;font-size:.875rem;text-transform:uppercase;font-weight:500;letter-spacing:-.025rem;display:flex;align-items:center;justify-content:space-between}header .meta .scl[data-v-70afb46a]{display:flex}header .meta .scl span[data-v-70afb46a]{display:flex;align-items:center;margin-right:1rem}header .meta .scl span svg[data-v-70afb46a]{margin-right:.25rem}header .meta .scl .comments[data-v-70afb46a]{cursor:pointer}[data-v-70afb46a] .content .ltag__user{display:none}[data-v-70afb46a] .content iframe{max-width:100%}[data-v-70afb46a] .content h1{font-size:1.875rem}[data-v-70afb46a] .content h1,[data-v-70afb46a] .content h2{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h2{font-size:1.5rem}[data-v-70afb46a] .content h3{font-size:1.25rem}[data-v-70afb46a] .content h3,[data-v-70afb46a] .content h4{margin-top:2rem;margin-bottom:1rem;letter-spacing:-.025rem}[data-v-70afb46a] .content h4{font-size:1rem}[data-v-70afb46a] .content a{color:#6e87d2}[data-v-70afb46a] .content p{margin-bottom:1rem;line-height:1.4}[data-v-70afb46a] .content p code{background-color:#d2f3e1;border-radius:.25rem;padding:.25rem}[data-v-70afb46a] .content img{width:100%;border-radius:.5rem}[data-v-70afb46a] .content .highlight{margin-bottom:1rem;border-radius:.5rem}[data-v-70afb46a] .content ul{list-style:numeral;margin-bottom:1rem}[data-v-70afb46a] .content ul li p{margin-bottom:0}[data-v-70afb46a] .content ol{margin-bottom:1rem}aside[data-v-37984f8c]{padding:1rem;background-color:#dfe8ef;border-radius:1rem}aside .username-heading[data-v-37984f8c]{display:flex;margin-bottom:1rem}aside .username-heading[data-v-37984f8c]:hover{color:#6e87d2}aside .username-heading img[data-v-37984f8c]{width:3rem;height:3rem;border-radius:50%;margin-right:1rem}aside .username-heading .text[data-v-37984f8c]{display:flex;flex-direction:column;justify-content:center}aside .username-heading .text a[data-v-37984f8c]{line-height:1}aside .username-heading .text a[data-v-37984f8c]:first-child{font-size:1.25rem;font-weight:500;letter-spacing:-.025rem;margin-bottom:.25rem}aside .username-heading .text a[data-v-37984f8c]:last-child{color:#999;font-size:.875rem}aside .username-heading.loading[data-v-37984f8c]{display:block}aside .f-button[data-v-37984f8c]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}aside .f-button[data-v-37984f8c]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}aside .f-button[data-v-37984f8c]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}aside .info>div[data-v-37984f8c]{margin-bottom:.5rem}aside .info .title[data-v-37984f8c]{font-size:.666666rem;letter-spacing:-.0125rem;font-weight:500;color:#999;text-transform:uppercase;margin-bottom:.1rem}aside .info .content[data-v-37984f8c]{font-size:.875rem;line-height:1.4}.add-comment[data-v-8c4375bc]{display:block;width:100%;padding:.5rem;border-radius:.5rem;box-shadow:-4px -4px 8px #f8fafe,4px 4px 8px #ced2db;text-transform:uppercase;text-align:center;font-weight:600;letter-spacing:-.025rem;margin-bottom:1rem}.add-comment[data-v-8c4375bc]:hover{background:linear-gradient(135deg,rgba(0,0,0,.09),hsla(0,0%,100%,0))}.add-comment[data-v-8c4375bc]:active{background:0 0;box-shadow:inset -4px -4px 8px #f0f3f9,inset 4px 4px 8px #ced2db,inset -1px -1px 4px #8e8e8e}footer[data-v-22cb8fd0]{padding:2rem;text-align:center;display:flex;align-items:center;justify-content:center}footer span[data-v-22cb8fd0]{display:inline-block;line-height:1;text-transform:uppercase;letter-spacing:-.025rem;font-size:.75rem;font-weight:500}footer a svg[data-v-22cb8fd0]{width:3rem;height:3rem;margin:0 .5rem}footer a .nuxt-icon[data-v-22cb8fd0]{width:2.5rem;height:2.5rem;margin:0 .25rem}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div><header data-v-27046cca><a href="/nuxtstop/" class="logo-wrapper nuxt-link-active" data-v-27046cca><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-27046cca><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-27046cca></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-27046cca></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-27046cca></path></svg> <div class="name-wrapper" data-v-27046cca><span class="app-name" data-v-27046cca>Nuxtstop</span> <p class="subtitle" data-v-27046cca>For all things nuxt.js</p></div></a> <nav data-v-27046cca><ul data-v-27046cca><li data-v-27046cca><a href="/nuxtstop/" class="nuxt-link-active" data-v-27046cca>
          New
        </a></li><li data-v-27046cca><a href="/nuxtstop/top" data-v-27046cca>
          Top
        </a></li></ul></nav></header> <div class="page-wrapper" data-v-10d06ee8><div class="article-content-wrapper" data-v-10d06ee8><article data-fetch-key="data-v-70afb46a:0" class="article-block" data-v-70afb46a data-v-10d06ee8><header data-v-70afb46a><h1 data-v-70afb46a>All About Opt-In Annotations</h1> <div class="tags" data-v-70afb46a><a href="/nuxtstop/t/android" class="tag" data-v-70afb46a>
          #android
        </a><a href="/nuxtstop/t/kotlin" class="tag" data-v-70afb46a>
          #kotlin
        </a><a href="/nuxtstop/t/api" class="tag" data-v-70afb46a>
          #api
        </a><a href="/nuxtstop/t/library" class="tag" data-v-70afb46a>
          #library
        </a></div> <div class="image-wrapper" data-v-70afb46a><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--zbKifjEj--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9rjq4wtzbaztuuoqxkwi.jpg" alt="All About Opt-In Annotations" data-v-70afb46a></div> <div class="meta" data-v-70afb46a><div class="scl" data-v-70afb46a><span data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-70afb46a data-v-70afb46a></path></svg>
            21
          </span> <span class="comments" data-v-70afb46a><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-70afb46a data-v-70afb46a><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-70afb46a data-v-70afb46a></path></svg>
            0
          </span></div> <time data-v-70afb46a>Sep 30 '21</time></div></header> <div class="content" data-v-70afb46a><p>The <a href="https://kotlinlang.org/docs/opt-in-requirements.html">opt-in mechanism in Kotlin</a> allows you to mark APIs that should be used carefully -- or perhaps not at all. If you mark a declaration (a class, a function, a property, anything really) as <em>opt-in required</em>, using it will produce a warning or error in the code, prompting the user to explicitly opt in to using it. This can guarantee that there has been a conscious decision made about using the API on the use site.</p>

<blockquote>
<p>This is <em>very</em> similar to how you deprecate declarations to prevent people from using them. You can read more about deprecations in <a href="https://zsmb.co/maintaining-compatibility-in-kotlin-libraries/#deprecation">Maintaining Compatibility in Kotlin Libraries</a>.</p>
</blockquote>

<p>Opt-in APIs are really useful if you're building libraries, but it also applies if you want to control the visibility and usages of APIs within any multi-module project. You also have to know how to interact with opt-in APIs correctly as a user.</p>

<p>In this article, we'll look at everything you need to know about opt-in APIs:</p>

<ul>
<li><a href="#creating-opt-in-apis">How to create them</a></li>
<li><a href="#using-opt-in-apis">How to use them</a></li>
<li><a href="#use-cases-and-conventions">Real life use cases and useful conventions</a></li>
</ul>

<p>And we'll also touch on some auxiliary topics around opt-in:</p>

<ul>
<li><a href="#java-interop">Java interop</a></li>
<li><a href="#opt-in-on-android">Android usage</a></li>
<li><a href="#api-verification">API verification</a></li>
</ul>

<p>We have a lot of ground to cover, so let's get started. Feel free to use the links above to jump around to different parts of this guide!</p>

<h2>
  <a name="creating-optin-apis" href="#creating-optin-apis">
  </a>
  Creating Opt-In APIs
</h2>

<p>First, let's see how you can create APIs that will require their users to opt-in to using them. This is done in two steps:</p>

<ol>
<li>Creating an opt-in marker annotation</li>
<li>Marking APIs as opt-in required</li>
</ol>

<h4>
  <a name="creating-an-optin-marker-annotation" href="#creating-an-optin-marker-annotation">
  </a>
  Creating an Opt-in Marker Annotation
</h4>

<p>To create an opt-in marker annotation, create a new <code>annotation class</code> and annotate it with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-requires-opt-in/"><code>RequiresOptIn</code></a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="k">package</span> <span class="nn">com.example.lib.core</span>

<span class="nd">@RequiresOptIn</span><span class="p">(</span>
    <span class="n">level</span> <span class="p">=</span> <span class="nc">RequiresOptIn</span><span class="p">.</span><span class="nc">Level</span><span class="p">.</span><span class="nc">WARNING</span><span class="p">,</span>
    <span class="n">message</span> <span class="p">=</span> <span class="s">"This is an experimental API. It may be changed or removed in the future."</span>
<span class="p">)</span>
<span class="k">public</span> <span class="k">annotation</span> <span class="kd">class</span> <span class="nc">ExperimentalLibraryApi</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This annotation has very similar properties to the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-deprecated/"><code>@Deprecated</code></a> annotation. Let's review what they are.</p>

<p>First, you can set a severity <code>level</code>:</p>

<ul>
<li>
<code>WARNING</code> will show a yellow warning on the call site and a warning during compilation. This is a "soft" warning, as it can be ignored and the code will still compile.</li>
<li>
<code>ERROR</code> will cause a "hard" compilation error on the call site. Anyone using an API that has this opt-in level <em>must</em> explicitly opt-in to using it, otherwise their code won't compile.</li>
</ul>

<p>You can also set a <code>message</code> that describes what the given opt-in marker annotation indicates. For this example, we're creating an annotation to mark APIs that are still experimental in a library, but are expected to become stable in later versions.</p>

<blockquote>
<p>Note that marking experimental APIs is just one use case for opt-in annotations. See the <a href="#use-cases-and-conventions">Use Cases and Conventions</a> below for other examples.</p>
</blockquote>

<p>You'll notice that the usage of the <code>RequiresOptIn</code> annotation itself also produces the warning. This is because the opt-in system of the Kotlin Standard Library itself is still experimental. You can track the development progress <a href="https://youtrack.jetbrains.com/issue/KT-22956">on this YouTrack issue</a> -- it's currently expected to become stable in Kotlin 1.7. </p>

<blockquote>
<p>While this system might not be officially stable, it's already being widely used across popular Kotlin libraries.</p>
</blockquote>

<p>To make that warning go away, you'll have to <em>opt in to using Kotlin's opt-in system</em>. You can do so by adding the following code to your module's build configuration, which adds an argument to the Kotlin compiler doing exactly that: opting in to opt-in.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>
    <span class="n">kotlinOptions</span> <span class="o">{</span>
        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>
            <span class="s1">'-Xopt-in=kotlin.RequiresOptIn'</span><span class="o">,</span>
        <span class="o">]</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h4>
  <a name="marking-apis-as-optin-required" href="#marking-apis-as-optin-required">
  </a>
  Marking APIs as Opt-in Required
</h4>

<p>With the marker annotation created, you can now mark pieces of API as experimental! For example, you can annotate a function like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>
<span class="k">public</span> <span class="k">fun</span> <span class="nf">someExperimentalApi</span><span class="p">()</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Calling this function will now produce a warning on the call site:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--IgeasGRt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ht9koh4wo9ww1bck28xw.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--IgeasGRt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ht9koh4wo9ww1bck28xw.png" alt="Warning on the call site of the function" loading="lazy"></a></p>

<p>You can also place these markers on larger scopes. For example, you can mark an entire class:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>
<span class="kd">class</span> <span class="nc">Stack</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">push</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">pop</span><span class="p">():</span> <span class="nc">Int</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>With this in place, any usage of the class' APIs (as well as the usage of the type itself) will produce warnings:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--32BYPP4T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goyhvpk3wx0zrwydnaiu.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--32BYPP4T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goyhvpk3wx0zrwydnaiu.png" alt="Warnings on the call site of the class" loading="lazy"></a></p>

<p>Let's see how you can handle these on the call site.</p>

<h2>
  <a name="using-optin-apis" href="#using-optin-apis">
  </a>
  Using Opt-In APIs
</h2>

<p>There are several ways of making the warnings and errors produced by calling opt-in APIs go away. Let's see when you want to use each of them.</p>

<h4>
  <a name="propagating-the-optin-requirement" href="#propagating-the-optin-requirement">
  </a>
  Propagating the Opt-in Requirement
</h4>

<p>One way to use an opt-in API is to mark the code that's calling it with the same opt-in annotation, propagating the requirement further:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>
<span class="k">public</span> <span class="k">fun</span> <span class="nf">anotherExperimentalApi</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This allows you to use other APIs that are marked with the same annotation within the implementation of this function. However, anyone using <em>this</em> function will now have to deal with the opt-in requirement as well.</p>

<p>This is useful within your own code to make sure that you don't accidentally create stable APIs that rely on experimental APIs in their implementation. If something relies on an experimental declaration, it too should likely be experimental.</p>

<p>However, you shouldn't do this in client code, as that'd just be putting off the issue. Instead, you want to actually opt in there. We'll look at this next.</p>

<h4>
  <a name="opting-in-an-entire-module" href="#opting-in-an-entire-module">
  </a>
  Opting in an Entire Module
</h4>

<p>If you want to enable all usages of a certain kind of opt-in API in a module, you can use the same <code>-Xopt-in</code> compiler option that you used to opt in to using opt-in earlier, but provide the specific annotation as the value.</p>

<p>This configuration allows all usages of our experimental APIs within its module:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>
    <span class="n">kotlinOptions</span> <span class="o">{</span>
        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>
            <span class="s1">'-Xopt-in=com.example.lib.core.ExperimentalLibraryApi'</span><span class="o">,</span>
        <span class="o">]</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You should use this with care, as enabling a certain opt-in API module-wide can lead to creating lots of usages of that API accidentally. Since there are no warnings in the code this way, you can easily miss these usages.</p>

<p>On the other hand, this fits certain <a href="#use-cases-and-conventions">use cases</a> really well, such as opting in to using internal APIs that are shared between different modules of the same library.</p>

<h4>
  <a name="opting-in-locally" href="#opting-in-locally">
  </a>
  Opting in Locally
</h4>

<p>A more precise approach is opting in locally. You can do this for each usage of opt-in APIs, using the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-opt-in/"><code>OptIn</code></a> annotation:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="k">public</span> <span class="k">fun</span> <span class="nf">clientCode</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">@OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You'll notice that the usage of the <code>OptIn</code> annotation itself also produces the warning. This, again, is due to the system itself being experimental. Interestingly, you have to opt in to <code>kotlin.RequiresOptIn</code> in this case as well:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>
    <span class="n">kotlinOptions</span> <span class="o">{</span>
        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>
            <span class="s1">'-Xopt-in=kotlin.RequiresOptIn'</span><span class="o">,</span>
        <span class="o">]</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>With the configuration above, you can now freely use <code>OptIn</code> to suppress opt-in related warnings and errors. This comes with the benefit that each usage of opt-in APIs will be clearly visible in the code thanks to the <code>OptIn</code> annotation being present on the use site.</p>

<p>You can opt-in at the statement level, like seen above, but also in broader scopes, such as for an entire function:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="nd">@OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="k">public</span> <span class="k">fun</span> <span class="nf">clientCode</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Or even an entire file, using an <a href="https://kotlinlang.org/docs/annotations.html#annotation-use-site-targets">annotation use-site target</a>, <code>@file:</code> :<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="err">@</span><span class="n">file</span><span class="p">:</span><span class="nc">OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>

<span class="k">public</span> <span class="k">fun</span> <span class="nf">firstFunction</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">fun</span> <span class="nf">secondFunction</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">someExperimentalApi</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Next, let's expand beyond using these annotations to mark experimental APIs, and see what other scenarios they can be useful in.</p>

<h2>
  <a name="use-cases-and-conventions" href="#use-cases-and-conventions">
  </a>
  Use Cases and Conventions
</h2>

<p>Some of the best examples of opt-in APIs are in first-party Kotlin libraries. A great example is the <a href="https://github.com/Kotlin/kotlinx.coroutines">kotlinx.coroutines</a> library, which uses four different opt-in marker annotations across its API. </p>

<blockquote>
<p>The annotation naming conventions used in this library are also widely adopted in other libraries. You should consider aligning your own opt-in usages with this as well.</p>
</blockquote>

<p>These opt-in annotations all follow the <code>[Prefix][LibraryName]Api</code> pattern, and each prefix carries different semantics. Let's see what each of them mean:</p>

<ul>
<li>
<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-experimental-coroutines-api/"><code>ExperimentalCoroutinesApi</code></a>: Perhaps the most frequently used convention, it marks APIs that are not stable yet. These might have known issues or ongoing design discussions that can change the API or its behaviour in the future.</li>
<li>
<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-internal-coroutines-api/"><code>InternalCoroutinesApi</code></a>: Marks APIs that are only exposed for cross-module usage within a single library group, and should not be relied on by end users. They should be considered <code>internal</code> and can change or be removed at any time. See <a href="https://zsmb.co/talks/mastering-api-visibility/">Mastering API Visibility in Kotlin</a> for a detailed example of how to use these.</li>
<li>
<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-obsolete-coroutines-api/"><code>ObsoleteCoroutinesApi</code></a>: A more niche marker than previous ones, this marks APIs that should not be used anymore. However, they are not deprecated yet, as they don't have replacements ready that users could migrate to.</li>
<li>
<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-delicate-coroutines-api/"><code>DelicateCoroutinesApi</code></a>: Another niche convention, delicate APIs should only be used in very specific situations, and users should make sure they understand the implications of using such APIs.</li>
</ul>

<p>On Android, Google's own Jetpack libraries also make generous use of opt-in APIs. In the <a href="https://android.googlesource.com/platform/frameworks/support/+/androidx-main/docs/api_guidelines.md#experimental-api">API guidelines document for Jetpack</a>, using opt-in annotations is the recommended way of "annotating API surfaces as unstable".</p>

<p>As a result, you'll see lots of these annotations when interacting with Jetpack libraries. They are especially widespread in Jetpack Compose libraries, given that the framework is still very new. Some common examples of these:</p>

<ul>
<li>
<a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/InternalComposeApi"><code>InternalComposeApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/ExperimentalComposeApi"><code>ExperimentalComposeApi</code></a>
</li>
<li>
<a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/InternalFoundationApi"><code>InternalFoundationApi</code></a> and<a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/ExperimentalFoundationApi"><code>ExperimentalFoundationApi</code></a>
</li>
<li><a href="https://developer.android.com/reference/kotlin/androidx/compose/material/ExperimentalMaterialApi"><code>ExperimentalMaterialApi</code></a></li>
<li>
<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/text/InternalTextApi"><code>InternalTextApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/text/ExperimentalTextApi"><code>ExperimentalTextApi</code></a>
</li>
<li>
<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/InternalComposeUiApi"><code>InternalComposeUiApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/ExperimentalComposeUiApi"><code>ExperimentalComposeUiApi</code></a>
</li>
<li>
<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/InternalTestApi"><code>InternalTestApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/ExperimentalTestApi"><code>ExperimentalTestApi</code></a>
</li>
<li>... and more!</li>
</ul>

<p>As you can see, these usually come in pairs, and a separate pair is created for each of the different Compose packages.</p>

<p>They are generally not documented in Kdoc, but you can find out what their purpose is by reading the provided <code>message</code>. A good place to do this is on <a href="https://cs.android.com/">cs.android.com</a>. For example, you can find the sources of <code>InternalFoundationApi</code> <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/InternalFoundationApi.kt">here</a>, and the sources of <code>ExperimentalFoundationApi</code> <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/ExperimentalFoundationApi.kt">here</a>, in the same package.</p>

<p>They, of course, follow the conventions layed out by <em>kotlinx.coroutines</em> above.</p>

<h2>
  <a name="java-interop" href="#java-interop">
  </a>
  Java Interop
</h2>

<p>Until now, we've discussed using Kotlin's own opt-in annotations: <code>kotlin.RequiresOptIn</code> and <code>kotlin.OptIn</code>. Usages of these are verified by the Kotlin compiler, which produces warnings and errors around them as needed.</p>

<p>In most cases, the API marked with opt-in annotations is public, but the annotation being present deters clients from using it. However, when Java source code uses these APIs, they'll only see it as regular public API. The Java compiler does not understand or respect these opt-in requirements.</p>

<p>You can either ignore this and accept that Java users (if they exist) will be able to access these APIs freely, and not be warned at all, or you can take extra steps to make sure that Java clients don't access opt-in APIs accidentally.</p>

<p>One solution is to mark your opt-in declarations with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-synthetic/"><code>@JvmSynthetic</code></a> as well. Synthetic declarations are inaccessible from Java source code, preventing all Java usages of these APIs (with no way to opt-in).<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight kotlin"><code><span class="nd">@JvmSynthetic</span>
<span class="nd">@ExperimentalLibraryApi</span>
<span class="k">public</span> <span class="k">fun</span> <span class="nf">someExperimentalApi</span><span class="p">()</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>If you're on Android, keep reading for another one.</p>

<h2>
  <a name="optin-on-android" href="#optin-on-android">
  </a>
  Opt-In on Android
</h2>

<p>Android is now officially <a href="https://developer.android.com/kotlin/first">Kotlin-first</a>, but Java is also still a fully-supported language on the platform. To work around the Java compatibility issue described above, Android has its own set of opt-in annotations (<a href="https://developer.android.com/reference/kotlin/androidx/annotation/RequiresOptIn"><code>androidx.annotation.RequiresOptIn</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/annotation/OptIn"><code>androidx.annotation.OptIn</code></a>), which can be used the exact same way as described earlier for the Kotlin annotations.</p>

<p>The difference is in how these are verified. Instead of the Kotlin compiler performing the checks, verifying these Android-specific annotations is up to the <a href="https://developer.android.com/studio/write/lint">Android Lint tool</a>. As Lint checks are performed on the <a href="https://plugins.jetbrains.com/docs/intellij/uast.html">UAST (Unified Abstract Syntax Tree)</a>, these annotations are verified not only in Kotlin, but also in Java code. This means that the opt-in marker annotation, its usage, and the code using the opt-in APIs can all be in either language.</p>

<p>To use these annotations in your project, you need to add a dependency on the <a href="https://developer.android.com/jetpack/androidx/releases/annotation"><code>annotation-experimental</code> artifact</a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s2">"androidx.annotation:annotation-experimental:1.1.0"</span><span class="o">)</span>
<span class="o">}</span>   
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Note that you can still use the Kotlin opt-in system on Android, you'll just miss out on Java support.</p>

<h2>
  <a name="api-verification" href="#api-verification">
  </a>
  API Verification
</h2>

<p>If you mark some pieces of public API in your module as experimental or internal using Opt-In annotations, you will probably want to ignore them when checking for changes (especially breaking changes) in your public API.</p>

<p>A common tool you can use for Kotlin projects is the <a href="https://github.com/Kotlin/binary-compatibility-validator">Binary compatibility validator<br>
plugin</a>. This plugin calls annotations that mark API that shouldn't be considered public "non-public markers".</p>

<p>These can be configured in the plugin's configuration block by adding the fully qualified names of the marker annotations to <code>nonPublicMarkers</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight groovy"><code><span class="n">apiValidation</span> <span class="o">{</span>
    <span class="cm">/**
     * Set of annotations that exclude API from being public.
     * Typically, it is all kinds of `@InternalApi` annotations 
     * that mark effectively private API that cannot be actually 
     * private for technical reasons.
     */</span>
    <span class="n">nonPublicMarkers</span> <span class="o">+=</span> <span class="o">[</span>
        <span class="s2">"com.example.lib.core.ExperimentalLibraryApi"</span><span class="o">,</span>
        <span class="s2">"com.example.lib.core.InternalLibraryApi"</span><span class="o">,</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>APIs annotated with non-public markers will be excluded from the API dumps of the validator plugin (they won't show up in the generated <code>.api</code> files).</p>

<h2>
  <a name="conclusion" href="#conclusion">
  </a>
  Conclusion
</h2>

<p>That's -- hopefully -- everything you'd ever want to know about opt-in annotations, and more. With this, you should now be ready to use these annotations in your own library or multi-module projects as well, whether you just need to interact with experimental APIs while building your apps or create your own opt-in APIs.</p>

<p>Thanks to <a href="https://twitter.com/stewemetal">István Juhos</a>, <a href="https://twitter.com/arnogiu">Arnaud Giuliani</a>, <a href="https://twitter.com/tkuenneth">Thomas Künneth</a>, and <a href="https://twitter.com/brwngrldev">Annyce Davis</a> for taking an early look and reviewing this post :)</p>

<p>Follow me <a href="https://twitter.com/zsmb13">@zsmb13 on Twitter</a> to keep in touch and get notified of similar posts!</p>

</div></article> <div class="aside-username-wrapper" data-v-10d06ee8><aside class="aside-username-block" data-v-37984f8c data-v-10d06ee8><div class="username-heading loading" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-heading" data-v-37984f8c><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-37984f8c><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-37984f8c><div class="vue-content-placeholders-text" data-v-37984f8c><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-8c4375bc data-v-10d06ee8><!----> <a href="https://dev.to/zsmb13/all-about-opt-in-annotations-5h6c" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-8c4375bc>
    Add comment
  </a></div></div> <footer data-v-22cb8fd0><span data-v-22cb8fd0>Built with</span> <a href="https://nuxtjs.org" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="nuxt-icon" data-v-22cb8fd0 data-v-22cb8fd0><path d="M13.5599 8.54348L12.8055 9.87164L10.2257 5.3282L2.306 19.274H7.66815C7.66815 20.0075 8.25298 20.6021 8.97441 20.6021H2.306C1.83937 20.6021 1.40822 20.3489 1.17494 19.9379C0.941664 19.527 0.941687 19.0208 1.175 18.6099L9.09469 4.66412C9.32802 4.25316 9.75926 4 10.226 4C10.6926 4 11.1239 4.25316 11.3572 4.66412L13.5599 8.54348V8.54348Z" fill="#00C58E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M19.2769 18.6099L14.3143 9.87165L13.5599 8.54348L12.8055 9.87165L7.84343 18.6099C7.61011 19.0208 7.61009 19.527 7.84337 19.9379C8.07665 20.3489 8.50779 20.6021 8.97443 20.6021H18.1443C18.611 20.6021 19.0424 20.3491 19.2758 19.9382C19.5092 19.5272 19.5092 19.0209 19.2758 18.6099H19.2769ZM8.97443 19.274L13.5599 11.1998L18.1443 19.274H8.97443H8.97443Z" fill="#2F495E" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M22.825 19.938C22.5917 20.3489 22.1606 20.6021 21.694 20.6021H18.1443C18.8657 20.6021 19.4505 20.0075 19.4505 19.274H21.6913L15.3331 8.07696L14.3142 9.87164L13.5599 8.54348L14.2021 7.41287C14.4354 7.00192 14.8667 6.74875 15.3334 6.74875C15.8001 6.74875 16.2313 7.00192 16.4646 7.41287L22.825 18.6099C23.0583 19.0208 23.0583 19.5271 22.825 19.938V19.938Z" fill="#108775" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a> <span data-v-22cb8fd0>&</span> <a href="https://docs.dev.to/api" rel="nofollow noopener" target="_blank" data-v-22cb8fd0><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22cb8fd0 data-v-22cb8fd0><path d="M1.5726 5.13748C1.42945 5.20622 1.2411 5.36661 1.15822 5.48117C1 5.69503 1 5.74849 1 11.8739C1 17.9993 1 18.0528 1.15822 18.2667C1.2411 18.3812 1.42945 18.5416 1.5726 18.6104C1.8137 18.7402 2.46164 18.7478 12 18.7478C21.5384 18.7478 22.1863 18.7402 22.4274 18.6104C22.5706 18.5416 22.7589 18.3812 22.8418 18.2667C23 18.0528 23 17.9993 23 11.8739C23 5.74849 23 5.69503 22.8418 5.48117C22.7589 5.36661 22.5706 5.20622 22.4274 5.13748C22.1863 5.00764 21.5384 5 12 5C2.46164 5 1.8137 5.00764 1.5726 5.13748ZM7.7055 8.2613C8.0822 8.45989 8.59454 9.0098 8.77536 9.40694C8.89589 9.66664 8.91095 9.94922 8.91095 12.0649C8.91095 14.3104 8.90344 14.4478 8.75275 14.7839C8.51919 15.288 8.16506 15.6546 7.68288 15.899C7.26096 16.1052 7.22328 16.1128 5.7315 16.1358L4.20206 16.1663V12.1031V8.04744L5.80684 8.07035C7.27602 8.09327 7.42672 8.10854 7.7055 8.2613ZM13.6952 8.89521V9.73538H12.4521H11.2089V10.4991V11.2629H11.9623H12.7158V12.1031V12.9432H11.9623H11.2089V13.707V14.4708H12.4521H13.6952V15.3109V16.151H12C10.1315 16.151 10.0411 16.1358 9.67191 15.6928L9.47603 15.4484V12.1336C9.47603 8.46752 9.46851 8.49807 9.95069 8.20783C10.1692 8.07035 10.3425 8.05508 11.9473 8.05508H13.6952V8.89521ZM16.5658 10.3769C16.8897 11.6295 17.1685 12.6912 17.176 12.7293C17.1911 12.7675 17.4699 11.7441 17.8014 10.461C18.1254 9.17017 18.4343 8.1009 18.4795 8.08563C18.5247 8.06271 18.9541 8.06271 19.4288 8.07035L20.3028 8.09327L19.376 11.6219C18.8713 13.5542 18.4117 15.2269 18.3664 15.3261C18.0123 16.0135 17.274 16.3343 16.7164 16.0441C16.4528 15.899 16.0911 15.4865 15.9705 15.1887C15.9254 15.0665 15.4884 13.4549 15.0062 11.6142C14.524 9.76593 14.1171 8.20783 14.0945 8.15437C14.0644 8.07035 14.2301 8.05508 15.0212 8.07035L15.9856 8.09327L16.5658 10.3769Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path><path d="M5.93491 12.103V14.4707H6.27394C6.66574 14.4707 7.01983 14.3103 7.1404 14.0965C7.18559 14.0048 7.21575 13.2105 7.21575 12.0648V10.1783L6.99725 9.95683C6.80133 9.76591 6.71847 9.73535 6.35683 9.73535H5.93491V12.103Z" fill="black" data-v-22cb8fd0 data-v-22cb8fd0></path></svg></a></footer></div></div></div><script>window.__NUXT__=function(n,e,a,t){return a.type_of="article",a.id=846832,a.title="All About Opt-In Annotations",a.description="The opt-in mechanism in Kotlin allows you to mark APIs that should be used carefully -- or perhaps...",a.readable_publish_date="Sep 30 '21",a.slug="all-about-opt-in-annotations-5h6c",a.path="/zsmb13/all-about-opt-in-annotations-5h6c",a.url="https://dev.to/zsmb13/all-about-opt-in-annotations-5h6c",a.comments_count=0,a.public_reactions_count=21,a.collection_id=n,a.published_timestamp=e,a.positive_reactions_count=21,a.cover_image="https://res.cloudinary.com/practicaldev/image/fetch/s--zbKifjEj--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9rjq4wtzbaztuuoqxkwi.jpg",a.social_image="https://res.cloudinary.com/practicaldev/image/fetch/s--fjPdGLMm--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9rjq4wtzbaztuuoqxkwi.jpg",a.canonical_url="https://zsmb.co/opt-in-annotations/",a.created_at=e,a.edited_at=n,a.crossposted_at=n,a.published_at=e,a.last_comment_at=e,a.reading_time_minutes=11,a.tag_list="android, kotlin, api, library",a.tags=["android","kotlin","api","library"],a.body_html='<p>The <a href="https://kotlinlang.org/docs/opt-in-requirements.html">opt-in mechanism in Kotlin</a> allows you to mark APIs that should be used carefully -- or perhaps not at all. If you mark a declaration (a class, a function, a property, anything really) as <em>opt-in required</em>, using it will produce a warning or error in the code, prompting the user to explicitly opt in to using it. This can guarantee that there has been a conscious decision made about using the API on the use site.</p>\n\n<blockquote>\n<p>This is <em>very</em> similar to how you deprecate declarations to prevent people from using them. You can read more about deprecations in <a href="https://zsmb.co/maintaining-compatibility-in-kotlin-libraries/#deprecation">Maintaining Compatibility in Kotlin Libraries</a>.</p>\n</blockquote>\n\n<p>Opt-in APIs are really useful if you\'re building libraries, but it also applies if you want to control the visibility and usages of APIs within any multi-module project. You also have to know how to interact with opt-in APIs correctly as a user.</p>\n\n<p>In this article, we\'ll look at everything you need to know about opt-in APIs:</p>\n\n<ul>\n<li><a href="#creating-opt-in-apis">How to create them</a></li>\n<li><a href="#using-opt-in-apis">How to use them</a></li>\n<li><a href="#use-cases-and-conventions">Real life use cases and useful conventions</a></li>\n</ul>\n\n<p>And we\'ll also touch on some auxiliary topics around opt-in:</p>\n\n<ul>\n<li><a href="#java-interop">Java interop</a></li>\n<li><a href="#opt-in-on-android">Android usage</a></li>\n<li><a href="#api-verification">API verification</a></li>\n</ul>\n\n<p>We have a lot of ground to cover, so let\'s get started. Feel free to use the links above to jump around to different parts of this guide!</p>\n\n<h2>\n  <a name="creating-optin-apis" href="#creating-optin-apis">\n  </a>\n  Creating Opt-In APIs\n</h2>\n\n<p>First, let\'s see how you can create APIs that will require their users to opt-in to using them. This is done in two steps:</p>\n\n<ol>\n<li>Creating an opt-in marker annotation</li>\n<li>Marking APIs as opt-in required</li>\n</ol>\n\n<h4>\n  <a name="creating-an-optin-marker-annotation" href="#creating-an-optin-marker-annotation">\n  </a>\n  Creating an Opt-in Marker Annotation\n</h4>\n\n<p>To create an opt-in marker annotation, create a new <code>annotation class</code> and annotate it with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-requires-opt-in/"><code>RequiresOptIn</code></a>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="k">package</span> <span class="nn">com.example.lib.core</span>\n\n<span class="nd">@RequiresOptIn</span><span class="p">(</span>\n    <span class="n">level</span> <span class="p">=</span> <span class="nc">RequiresOptIn</span><span class="p">.</span><span class="nc">Level</span><span class="p">.</span><span class="nc">WARNING</span><span class="p">,</span>\n    <span class="n">message</span> <span class="p">=</span> <span class="s">"This is an experimental API. It may be changed or removed in the future."</span>\n<span class="p">)</span>\n<span class="k">public</span> <span class="k">annotation</span> <span class="kd">class</span> <span class="nc">ExperimentalLibraryApi</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This annotation has very similar properties to the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-deprecated/"><code>@Deprecated</code></a> annotation. Let\'s review what they are.</p>\n\n<p>First, you can set a severity <code>level</code>:</p>\n\n<ul>\n<li>\n<code>WARNING</code> will show a yellow warning on the call site and a warning during compilation. This is a "soft" warning, as it can be ignored and the code will still compile.</li>\n<li>\n<code>ERROR</code> will cause a "hard" compilation error on the call site. Anyone using an API that has this opt-in level <em>must</em> explicitly opt-in to using it, otherwise their code won\'t compile.</li>\n</ul>\n\n<p>You can also set a <code>message</code> that describes what the given opt-in marker annotation indicates. For this example, we\'re creating an annotation to mark APIs that are still experimental in a library, but are expected to become stable in later versions.</p>\n\n<blockquote>\n<p>Note that marking experimental APIs is just one use case for opt-in annotations. See the <a href="#use-cases-and-conventions">Use Cases and Conventions</a> below for other examples.</p>\n</blockquote>\n\n<p>You\'ll notice that the usage of the <code>RequiresOptIn</code> annotation itself also produces the warning. This is because the opt-in system of the Kotlin Standard Library itself is still experimental. You can track the development progress <a href="https://youtrack.jetbrains.com/issue/KT-22956">on this YouTrack issue</a> -- it\'s currently expected to become stable in Kotlin 1.7. </p>\n\n<blockquote>\n<p>While this system might not be officially stable, it\'s already being widely used across popular Kotlin libraries.</p>\n</blockquote>\n\n<p>To make that warning go away, you\'ll have to <em>opt in to using Kotlin\'s opt-in system</em>. You can do so by adding the following code to your module\'s build configuration, which adds an argument to the Kotlin compiler doing exactly that: opting in to opt-in.<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>\n    <span class="n">kotlinOptions</span> <span class="o">{</span>\n        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>\n            <span class="s1">\'-Xopt-in=kotlin.RequiresOptIn\'</span><span class="o">,</span>\n        <span class="o">]</span>\n    <span class="o">}</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h4>\n  <a name="marking-apis-as-optin-required" href="#marking-apis-as-optin-required">\n  </a>\n  Marking APIs as Opt-in Required\n</h4>\n\n<p>With the marker annotation created, you can now mark pieces of API as experimental! For example, you can annotate a function like this:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">someExperimentalApi</span><span class="p">()</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Calling this function will now produce a warning on the call site:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--IgeasGRt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ht9koh4wo9ww1bck28xw.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--IgeasGRt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ht9koh4wo9ww1bck28xw.png" alt="Warning on the call site of the function" loading="lazy"></a></p>\n\n<p>You can also place these markers on larger scopes. For example, you can mark an entire class:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>\n<span class="kd">class</span> <span class="nc">Stack</span> <span class="p">{</span>\n    <span class="k">fun</span> <span class="nf">push</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>\n    <span class="k">fun</span> <span class="nf">pop</span><span class="p">():</span> <span class="nc">Int</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>With this in place, any usage of the class\' APIs (as well as the usage of the type itself) will produce warnings:</p>\n\n<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--32BYPP4T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goyhvpk3wx0zrwydnaiu.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--32BYPP4T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goyhvpk3wx0zrwydnaiu.png" alt="Warnings on the call site of the class" loading="lazy"></a></p>\n\n<p>Let\'s see how you can handle these on the call site.</p>\n\n<h2>\n  <a name="using-optin-apis" href="#using-optin-apis">\n  </a>\n  Using Opt-In APIs\n</h2>\n\n<p>There are several ways of making the warnings and errors produced by calling opt-in APIs go away. Let\'s see when you want to use each of them.</p>\n\n<h4>\n  <a name="propagating-the-optin-requirement" href="#propagating-the-optin-requirement">\n  </a>\n  Propagating the Opt-in Requirement\n</h4>\n\n<p>One way to use an opt-in API is to mark the code that\'s calling it with the same opt-in annotation, propagating the requirement further:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="nd">@ExperimentalLibraryApi</span>\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">anotherExperimentalApi</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This allows you to use other APIs that are marked with the same annotation within the implementation of this function. However, anyone using <em>this</em> function will now have to deal with the opt-in requirement as well.</p>\n\n<p>This is useful within your own code to make sure that you don\'t accidentally create stable APIs that rely on experimental APIs in their implementation. If something relies on an experimental declaration, it too should likely be experimental.</p>\n\n<p>However, you shouldn\'t do this in client code, as that\'d just be putting off the issue. Instead, you want to actually opt in there. We\'ll look at this next.</p>\n\n<h4>\n  <a name="opting-in-an-entire-module" href="#opting-in-an-entire-module">\n  </a>\n  Opting in an Entire Module\n</h4>\n\n<p>If you want to enable all usages of a certain kind of opt-in API in a module, you can use the same <code>-Xopt-in</code> compiler option that you used to opt in to using opt-in earlier, but provide the specific annotation as the value.</p>\n\n<p>This configuration allows all usages of our experimental APIs within its module:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>\n    <span class="n">kotlinOptions</span> <span class="o">{</span>\n        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>\n            <span class="s1">\'-Xopt-in=com.example.lib.core.ExperimentalLibraryApi\'</span><span class="o">,</span>\n        <span class="o">]</span>\n    <span class="o">}</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You should use this with care, as enabling a certain opt-in API module-wide can lead to creating lots of usages of that API accidentally. Since there are no warnings in the code this way, you can easily miss these usages.</p>\n\n<p>On the other hand, this fits certain <a href="#use-cases-and-conventions">use cases</a> really well, such as opting in to using internal APIs that are shared between different modules of the same library.</p>\n\n<h4>\n  <a name="opting-in-locally" href="#opting-in-locally">\n  </a>\n  Opting in Locally\n</h4>\n\n<p>A more precise approach is opting in locally. You can do this for each usage of opt-in APIs, using the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-opt-in/"><code>OptIn</code></a> annotation:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="k">public</span> <span class="k">fun</span> <span class="nf">clientCode</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nd">@OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You\'ll notice that the usage of the <code>OptIn</code> annotation itself also produces the warning. This, again, is due to the system itself being experimental. Interestingly, you have to opt in to <code>kotlin.RequiresOptIn</code> in this case as well:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">all</span> <span class="o">{</span>\n    <span class="n">kotlinOptions</span> <span class="o">{</span>\n        <span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="o">[</span>\n            <span class="s1">\'-Xopt-in=kotlin.RequiresOptIn\'</span><span class="o">,</span>\n        <span class="o">]</span>\n    <span class="o">}</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>With the configuration above, you can now freely use <code>OptIn</code> to suppress opt-in related warnings and errors. This comes with the benefit that each usage of opt-in APIs will be clearly visible in the code thanks to the <code>OptIn</code> annotation being present on the use site.</p>\n\n<p>You can opt-in at the statement level, like seen above, but also in broader scopes, such as for an entire function:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="nd">@OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">clientCode</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Or even an entire file, using an <a href="https://kotlinlang.org/docs/annotations.html#annotation-use-site-targets">annotation use-site target</a>, <code>@file:</code> :<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="err">@</span><span class="n">file</span><span class="p">:</span><span class="nc">OptIn</span><span class="p">(</span><span class="nc">InternalMyLibraryApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>\n\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">firstFunction</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n<span class="p">}</span>\n\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">secondFunction</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nf">someExperimentalApi</span><span class="p">()</span>\n<span class="p">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Next, let\'s expand beyond using these annotations to mark experimental APIs, and see what other scenarios they can be useful in.</p>\n\n<h2>\n  <a name="use-cases-and-conventions" href="#use-cases-and-conventions">\n  </a>\n  Use Cases and Conventions\n</h2>\n\n<p>Some of the best examples of opt-in APIs are in first-party Kotlin libraries. A great example is the <a href="https://github.com/Kotlin/kotlinx.coroutines">kotlinx.coroutines</a> library, which uses four different opt-in marker annotations across its API. </p>\n\n<blockquote>\n<p>The annotation naming conventions used in this library are also widely adopted in other libraries. You should consider aligning your own opt-in usages with this as well.</p>\n</blockquote>\n\n<p>These opt-in annotations all follow the <code>[Prefix][LibraryName]Api</code> pattern, and each prefix carries different semantics. Let\'s see what each of them mean:</p>\n\n<ul>\n<li>\n<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-experimental-coroutines-api/"><code>ExperimentalCoroutinesApi</code></a>: Perhaps the most frequently used convention, it marks APIs that are not stable yet. These might have known issues or ongoing design discussions that can change the API or its behaviour in the future.</li>\n<li>\n<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-internal-coroutines-api/"><code>InternalCoroutinesApi</code></a>: Marks APIs that are only exposed for cross-module usage within a single library group, and should not be relied on by end users. They should be considered <code>internal</code> and can change or be removed at any time. See <a href="https://zsmb.co/talks/mastering-api-visibility/">Mastering API Visibility in Kotlin</a> for a detailed example of how to use these.</li>\n<li>\n<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-obsolete-coroutines-api/"><code>ObsoleteCoroutinesApi</code></a>: A more niche marker than previous ones, this marks APIs that should not be used anymore. However, they are not deprecated yet, as they don\'t have replacements ready that users could migrate to.</li>\n<li>\n<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-delicate-coroutines-api/"><code>DelicateCoroutinesApi</code></a>: Another niche convention, delicate APIs should only be used in very specific situations, and users should make sure they understand the implications of using such APIs.</li>\n</ul>\n\n<p>On Android, Google\'s own Jetpack libraries also make generous use of opt-in APIs. In the <a href="https://android.googlesource.com/platform/frameworks/support/+/androidx-main/docs/api_guidelines.md#experimental-api">API guidelines document for Jetpack</a>, using opt-in annotations is the recommended way of "annotating API surfaces as unstable".</p>\n\n<p>As a result, you\'ll see lots of these annotations when interacting with Jetpack libraries. They are especially widespread in Jetpack Compose libraries, given that the framework is still very new. Some common examples of these:</p>\n\n<ul>\n<li>\n<a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/InternalComposeApi"><code>InternalComposeApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/ExperimentalComposeApi"><code>ExperimentalComposeApi</code></a>\n</li>\n<li>\n<a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/InternalFoundationApi"><code>InternalFoundationApi</code></a> and<a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/ExperimentalFoundationApi"><code>ExperimentalFoundationApi</code></a>\n</li>\n<li><a href="https://developer.android.com/reference/kotlin/androidx/compose/material/ExperimentalMaterialApi"><code>ExperimentalMaterialApi</code></a></li>\n<li>\n<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/text/InternalTextApi"><code>InternalTextApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/text/ExperimentalTextApi"><code>ExperimentalTextApi</code></a>\n</li>\n<li>\n<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/InternalComposeUiApi"><code>InternalComposeUiApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/ExperimentalComposeUiApi"><code>ExperimentalComposeUiApi</code></a>\n</li>\n<li>\n<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/InternalTestApi"><code>InternalTestApi</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/ExperimentalTestApi"><code>ExperimentalTestApi</code></a>\n</li>\n<li>... and more!</li>\n</ul>\n\n<p>As you can see, these usually come in pairs, and a separate pair is created for each of the different Compose packages.</p>\n\n<p>They are generally not documented in Kdoc, but you can find out what their purpose is by reading the provided <code>message</code>. A good place to do this is on <a href="https://cs.android.com/">cs.android.com</a>. For example, you can find the sources of <code>InternalFoundationApi</code> <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/InternalFoundationApi.kt">here</a>, and the sources of <code>ExperimentalFoundationApi</code> <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/ExperimentalFoundationApi.kt">here</a>, in the same package.</p>\n\n<p>They, of course, follow the conventions layed out by <em>kotlinx.coroutines</em> above.</p>\n\n<h2>\n  <a name="java-interop" href="#java-interop">\n  </a>\n  Java Interop\n</h2>\n\n<p>Until now, we\'ve discussed using Kotlin\'s own opt-in annotations: <code>kotlin.RequiresOptIn</code> and <code>kotlin.OptIn</code>. Usages of these are verified by the Kotlin compiler, which produces warnings and errors around them as needed.</p>\n\n<p>In most cases, the API marked with opt-in annotations is public, but the annotation being present deters clients from using it. However, when Java source code uses these APIs, they\'ll only see it as regular public API. The Java compiler does not understand or respect these opt-in requirements.</p>\n\n<p>You can either ignore this and accept that Java users (if they exist) will be able to access these APIs freely, and not be warned at all, or you can take extra steps to make sure that Java clients don\'t access opt-in APIs accidentally.</p>\n\n<p>One solution is to mark your opt-in declarations with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-synthetic/"><code>@JvmSynthetic</code></a> as well. Synthetic declarations are inaccessible from Java source code, preventing all Java usages of these APIs (with no way to opt-in).<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight kotlin"><code><span class="nd">@JvmSynthetic</span>\n<span class="nd">@ExperimentalLibraryApi</span>\n<span class="k">public</span> <span class="k">fun</span> <span class="nf">someExperimentalApi</span><span class="p">()</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>If you\'re on Android, keep reading for another one.</p>\n\n<h2>\n  <a name="optin-on-android" href="#optin-on-android">\n  </a>\n  Opt-In on Android\n</h2>\n\n<p>Android is now officially <a href="https://developer.android.com/kotlin/first">Kotlin-first</a>, but Java is also still a fully-supported language on the platform. To work around the Java compatibility issue described above, Android has its own set of opt-in annotations (<a href="https://developer.android.com/reference/kotlin/androidx/annotation/RequiresOptIn"><code>androidx.annotation.RequiresOptIn</code></a> and <a href="https://developer.android.com/reference/kotlin/androidx/annotation/OptIn"><code>androidx.annotation.OptIn</code></a>), which can be used the exact same way as described earlier for the Kotlin annotations.</p>\n\n<p>The difference is in how these are verified. Instead of the Kotlin compiler performing the checks, verifying these Android-specific annotations is up to the <a href="https://developer.android.com/studio/write/lint">Android Lint tool</a>. As Lint checks are performed on the <a href="https://plugins.jetbrains.com/docs/intellij/uast.html">UAST (Unified Abstract Syntax Tree)</a>, these annotations are verified not only in Kotlin, but also in Java code. This means that the opt-in marker annotation, its usage, and the code using the opt-in APIs can all be in either language.</p>\n\n<p>To use these annotations in your project, you need to add a dependency on the <a href="https://developer.android.com/jetpack/androidx/releases/annotation"><code>annotation-experimental</code> artifact</a>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">dependencies</span> <span class="o">{</span>\n    <span class="n">implementation</span><span class="o">(</span><span class="s2">"androidx.annotation:annotation-experimental:1.1.0"</span><span class="o">)</span>\n<span class="o">}</span>   \n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Note that you can still use the Kotlin opt-in system on Android, you\'ll just miss out on Java support.</p>\n\n<h2>\n  <a name="api-verification" href="#api-verification">\n  </a>\n  API Verification\n</h2>\n\n<p>If you mark some pieces of public API in your module as experimental or internal using Opt-In annotations, you will probably want to ignore them when checking for changes (especially breaking changes) in your public API.</p>\n\n<p>A common tool you can use for Kotlin projects is the <a href="https://github.com/Kotlin/binary-compatibility-validator">Binary compatibility validator<br>\nplugin</a>. This plugin calls annotations that mark API that shouldn\'t be considered public "non-public markers".</p>\n\n<p>These can be configured in the plugin\'s configuration block by adding the fully qualified names of the marker annotations to <code>nonPublicMarkers</code>:<br>\n</p>\n\n<div class="highlight js-code-highlight">\n<pre class="highlight groovy"><code><span class="n">apiValidation</span> <span class="o">{</span>\n    <span class="cm">/**\n     * Set of annotations that exclude API from being public.\n     * Typically, it is all kinds of `@InternalApi` annotations \n     * that mark effectively private API that cannot be actually \n     * private for technical reasons.\n     */</span>\n    <span class="n">nonPublicMarkers</span> <span class="o">+=</span> <span class="o">[</span>\n        <span class="s2">"com.example.lib.core.ExperimentalLibraryApi"</span><span class="o">,</span>\n        <span class="s2">"com.example.lib.core.InternalLibraryApi"</span><span class="o">,</span>\n    <span class="o">]</span>\n<span class="o">}</span>\n</code></pre>\n<div class="highlight__panel js-actions-panel">\n<div class="highlight__panel-action js-fullscreen-code-action">\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>\n    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>\n</svg>\n\n    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>\n    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>APIs annotated with non-public markers will be excluded from the API dumps of the validator plugin (they won\'t show up in the generated <code>.api</code> files).</p>\n\n<h2>\n  <a name="conclusion" href="#conclusion">\n  </a>\n  Conclusion\n</h2>\n\n<p>That\'s -- hopefully -- everything you\'d ever want to know about opt-in annotations, and more. With this, you should now be ready to use these annotations in your own library or multi-module projects as well, whether you just need to interact with experimental APIs while building your apps or create your own opt-in APIs.</p>\n\n<p>Thanks to <a href="https://twitter.com/stewemetal">István Juhos</a>, <a href="https://twitter.com/arnogiu">Arnaud Giuliani</a>, <a href="https://twitter.com/tkuenneth">Thomas Künneth</a>, and <a href="https://twitter.com/brwngrldev">Annyce Davis</a> for taking an early look and reviewing this post :)</p>\n\n<p>Follow me <a href="https://twitter.com/zsmb13">@zsmb13 on Twitter</a> to keep in touch and get notified of similar posts!</p>\n\n',a.body_markdown="The [opt-in mechanism in Kotlin](https://kotlinlang.org/docs/opt-in-requirements.html) allows you to mark APIs that should be used carefully -- or perhaps not at all. If you mark a declaration (a class, a function, a property, anything really) as *opt-in required*, using it will produce a warning or error in the code, prompting the user to explicitly opt in to using it. This can guarantee that there has been a conscious decision made about using the API on the use site.\n\n> This is *very* similar to how you deprecate declarations to prevent people from using them. You can read more about deprecations in [Maintaining Compatibility in Kotlin Libraries](https://zsmb.co/maintaining-compatibility-in-kotlin-libraries/#deprecation).\n\nOpt-in APIs are really useful if you're building libraries, but it also applies if you want to control the visibility and usages of APIs within any multi-module project. You also have to know how to interact with opt-in APIs correctly as a user.\n\nIn this article, we'll look at everything you need to know about opt-in APIs:\n- [How to create them](#creating-opt-in-apis)\n- [How to use them](#using-opt-in-apis)\n- [Real life use cases and useful conventions](#use-cases-and-conventions)\n\nAnd we'll also touch on some auxiliary topics around opt-in:\n- [Java interop](#java-interop)\n- [Android usage](#opt-in-on-android)\n- [API verification](#api-verification)\n\nWe have a lot of ground to cover, so let's get started. Feel free to use the links above to jump around to different parts of this guide!\n\n## Creating Opt-In APIs\n\nFirst, let's see how you can create APIs that will require their users to opt-in to using them. This is done in two steps:\n\n1. Creating an opt-in marker annotation\n2. Marking APIs as opt-in required\n\n#### Creating an Opt-in Marker Annotation\n\nTo create an opt-in marker annotation, create a new `annotation class` and annotate it with [`RequiresOptIn`](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-requires-opt-in/):\n\n```kotlin\npackage com.example.lib.core\n\n@RequiresOptIn(\n    level = RequiresOptIn.Level.WARNING,\n    message = \"This is an experimental API. It may be changed or removed in the future.\"\n)\npublic annotation class ExperimentalLibraryApi\n```\n\nThis annotation has very similar properties to the [`@Deprecated`](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-deprecated/) annotation. Let's review what they are.\n\nFirst, you can set a severity `level`:\n- `WARNING` will show a yellow warning on the call site and a warning during compilation. This is a \"soft\" warning, as it can be ignored and the code will still compile.\n- `ERROR` will cause a \"hard\" compilation error on the call site. Anyone using an API that has this opt-in level *must* explicitly opt-in to using it, otherwise their code won't compile.\n\nYou can also set a `message` that describes what the given opt-in marker annotation indicates. For this example, we're creating an annotation to mark APIs that are still experimental in a library, but are expected to become stable in later versions.\n\n> Note that marking experimental APIs is just one use case for opt-in annotations. See the [Use Cases and Conventions](#use-cases-and-conventions) below for other examples.\n\nYou'll notice that the usage of the `RequiresOptIn` annotation itself also produces the warning. This is because the opt-in system of the Kotlin Standard Library itself is still experimental. You can track the development progress [on this YouTrack issue](https://youtrack.jetbrains.com/issue/KT-22956) -- it's currently expected to become stable in Kotlin 1.7. \n\n> While this system might not be officially stable, it's already being widely used across popular Kotlin libraries.\n\nTo make that warning go away, you'll have to *opt in to using Kotlin's opt-in system*. You can do so by adding the following code to your module's build configuration, which adds an argument to the Kotlin compiler doing exactly that: opting in to opt-in.\n\n```groovy\ntasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {\n    kotlinOptions {\n        freeCompilerArgs += [\n            '-Xopt-in=kotlin.RequiresOptIn',\n        ]\n    }\n}\n```\n\n\n#### Marking APIs as Opt-in Required\n\nWith the marker annotation created, you can now mark pieces of API as experimental! For example, you can annotate a function like this:\n\n```kotlin\n@ExperimentalLibraryApi\npublic fun someExperimentalApi()\n```\n\nCalling this function will now produce a warning on the call site:\n\n![Warning on the call site of the function](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ht9koh4wo9ww1bck28xw.png)\n\nYou can also place these markers on larger scopes. For example, you can mark an entire class:\n\n```kotlin\n@ExperimentalLibraryApi\nclass Stack {\n    fun push(data: Int)\n    fun pop(): Int\n}\n```\n\nWith this in place, any usage of the class' APIs (as well as the usage of the type itself) will produce warnings:\n\n![Warnings on the call site of the class](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goyhvpk3wx0zrwydnaiu.png)\n\nLet's see how you can handle these on the call site.\n\n## Using Opt-In APIs\n\nThere are several ways of making the warnings and errors produced by calling opt-in APIs go away. Let's see when you want to use each of them.\n\n#### Propagating the Opt-in Requirement\n\nOne way to use an opt-in API is to mark the code that's calling it with the same opt-in annotation, propagating the requirement further:\n\n```kotlin\n@ExperimentalLibraryApi\npublic fun anotherExperimentalApi() {\n    someExperimentalApi()\n}\n```\n\nThis allows you to use other APIs that are marked with the same annotation within the implementation of this function. However, anyone using _this_ function will now have to deal with the opt-in requirement as well.\n\nThis is useful within your own code to make sure that you don't accidentally create stable APIs that rely on experimental APIs in their implementation. If something relies on an experimental declaration, it too should likely be experimental.\n\nHowever, you shouldn't do this in client code, as that'd just be putting off the issue. Instead, you want to actually opt in there. We'll look at this next.\n\n#### Opting in an Entire Module\n  \nIf you want to enable all usages of a certain kind of opt-in API in a module, you can use the same `-Xopt-in` compiler option that you used to opt in to using opt-in earlier, but provide the specific annotation as the value.\n\nThis configuration allows all usages of our experimental APIs within its module:\n\n```groovy\ntasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {\n    kotlinOptions {\n        freeCompilerArgs += [\n            '-Xopt-in=com.example.lib.core.ExperimentalLibraryApi',\n        ]\n    }\n}\n```\n\nYou should use this with care, as enabling a certain opt-in API module-wide can lead to creating lots of usages of that API accidentally. Since there are no warnings in the code this way, you can easily miss these usages.\n\nOn the other hand, this fits certain [use cases](#use-cases-and-conventions) really well, such as opting in to using internal APIs that are shared between different modules of the same library.\n\n#### Opting in Locally\n\nA more precise approach is opting in locally. You can do this for each usage of opt-in APIs, using the [`OptIn`](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-opt-in/) annotation:\n\n```kotlin\npublic fun clientCode() {\n    @OptIn(InternalMyLibraryApi::class)\n    someExperimentalApi()\n}\n```\n\nYou'll notice that the usage of the `OptIn` annotation itself also produces the warning. This, again, is due to the system itself being experimental. Interestingly, you have to opt in to `kotlin.RequiresOptIn` in this case as well:\n\n```groovy\ntasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {\n    kotlinOptions {\n        freeCompilerArgs += [\n            '-Xopt-in=kotlin.RequiresOptIn',\n        ]\n    }\n}\n```\n\nWith the configuration above, you can now freely use `OptIn` to suppress opt-in related warnings and errors. This comes with the benefit that each usage of opt-in APIs will be clearly visible in the code thanks to the `OptIn` annotation being present on the use site.\n\nYou can opt-in at the statement level, like seen above, but also in broader scopes, such as for an entire function:\n\n```kotlin\n@OptIn(InternalMyLibraryApi::class)\npublic fun clientCode() {\n    someExperimentalApi()\n    someExperimentalApi()\n}\n```\n\nOr even an entire file, using an [annotation use-site target](https://kotlinlang.org/docs/annotations.html#annotation-use-site-targets), `@file:` :\n\n```kotlin\n@file:OptIn(InternalMyLibraryApi::class)\n\npublic fun firstFunction() {\n    someExperimentalApi()\n}\n\npublic fun secondFunction() {\n    someExperimentalApi()\n}\n```\n\nNext, let's expand beyond using these annotations to mark experimental APIs, and see what other scenarios they can be useful in.\n\n## Use Cases and Conventions\n\nSome of the best examples of opt-in APIs are in first-party Kotlin libraries. A great example is the [kotlinx.coroutines](https://github.com/Kotlin/kotlinx.coroutines) library, which uses four different opt-in marker annotations across its API. \n\n> The annotation naming conventions used in this library are also widely adopted in other libraries. You should consider aligning your own opt-in usages with this as well.\n\nThese opt-in annotations all follow the `[Prefix][LibraryName]Api` pattern, and each prefix carries different semantics. Let's see what each of them mean:\n\n- [`ExperimentalCoroutinesApi`](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-experimental-coroutines-api/): Perhaps the most frequently used convention, it marks APIs that are not stable yet. These might have known issues or ongoing design discussions that can change the API or its behaviour in the future.\n- [`InternalCoroutinesApi`](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-internal-coroutines-api/): Marks APIs that are only exposed for cross-module usage within a single library group, and should not be relied on by end users. They should be considered `internal` and can change or be removed at any time. See [Mastering API Visibility in Kotlin](https://zsmb.co/talks/mastering-api-visibility/) for a detailed example of how to use these.\n- [`ObsoleteCoroutinesApi`](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-obsolete-coroutines-api/): A more niche marker than previous ones, this marks APIs that should not be used anymore. However, they are not deprecated yet, as they don't have replacements ready that users could migrate to.\n- [`DelicateCoroutinesApi`](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-delicate-coroutines-api/): Another niche convention, delicate APIs should only be used in very specific situations, and users should make sure they understand the implications of using such APIs.\n\nOn Android, Google's own Jetpack libraries also make generous use of opt-in APIs. In the [API guidelines document for Jetpack](https://android.googlesource.com/platform/frameworks/support/+/androidx-main/docs/api_guidelines.md#experimental-api), using opt-in annotations is the recommended way of \"annotating API surfaces as unstable\".\n\nAs a result, you'll see lots of these annotations when interacting with Jetpack libraries. They are especially widespread in Jetpack Compose libraries, given that the framework is still very new. Some common examples of these:\n\n- [`InternalComposeApi`](https://developer.android.com/reference/kotlin/androidx/compose/runtime/InternalComposeApi) and [`ExperimentalComposeApi`](https://developer.android.com/reference/kotlin/androidx/compose/runtime/ExperimentalComposeApi)\n- [`InternalFoundationApi`](https://developer.android.com/reference/kotlin/androidx/compose/foundation/InternalFoundationApi) and[`ExperimentalFoundationApi`](https://developer.android.com/reference/kotlin/androidx/compose/foundation/ExperimentalFoundationApi)\n- [`ExperimentalMaterialApi`](https://developer.android.com/reference/kotlin/androidx/compose/material/ExperimentalMaterialApi)\n- [`InternalTextApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/text/InternalTextApi) and [`ExperimentalTextApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/text/ExperimentalTextApi)\n- [`InternalComposeUiApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/InternalComposeUiApi) and [`ExperimentalComposeUiApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/ExperimentalComposeUiApi)\n- [`InternalTestApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/test/InternalTestApi) and [`ExperimentalTestApi`](https://developer.android.com/reference/kotlin/androidx/compose/ui/test/ExperimentalTestApi)\n- ... and more!\n\nAs you can see, these usually come in pairs, and a separate pair is created for each of the different Compose packages.\n\nThey are generally not documented in Kdoc, but you can find out what their purpose is by reading the provided `message`. A good place to do this is on [cs.android.com](https://cs.android.com/). For example, you can find the sources of `InternalFoundationApi` [here](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/InternalFoundationApi.kt), and the sources of `ExperimentalFoundationApi` [here](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/ExperimentalFoundationApi.kt), in the same package.\n\nThey, of course, follow the conventions layed out by *kotlinx.coroutines* above.\n\n## Java Interop\n\nUntil now, we've discussed using Kotlin's own opt-in annotations: `kotlin.RequiresOptIn` and `kotlin.OptIn`. Usages of these are verified by the Kotlin compiler, which produces warnings and errors around them as needed.\n\nIn most cases, the API marked with opt-in annotations is public, but the annotation being present deters clients from using it. However, when Java source code uses these APIs, they'll only see it as regular public API. The Java compiler does not understand or respect these opt-in requirements.\n\nYou can either ignore this and accept that Java users (if they exist) will be able to access these APIs freely, and not be warned at all, or you can take extra steps to make sure that Java clients don't access opt-in APIs accidentally.\n\nOne solution is to mark your opt-in declarations with [`@JvmSynthetic`](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-synthetic/) as well. Synthetic declarations are inaccessible from Java source code, preventing all Java usages of these APIs (with no way to opt-in).\n\n```kotlin\n@JvmSynthetic\n@ExperimentalLibraryApi\npublic fun someExperimentalApi()\n```\n\nIf you're on Android, keep reading for another one.\n\n## Opt-In on Android\n\nAndroid is now officially [Kotlin-first](https://developer.android.com/kotlin/first), but Java is also still a fully-supported language on the platform. To work around the Java compatibility issue described above, Android has its own set of opt-in annotations ([`androidx.annotation.RequiresOptIn`](https://developer.android.com/reference/kotlin/androidx/annotation/RequiresOptIn) and [`androidx.annotation.OptIn`](https://developer.android.com/reference/kotlin/androidx/annotation/OptIn)), which can be used the exact same way as described earlier for the Kotlin annotations.\n\nThe difference is in how these are verified. Instead of the Kotlin compiler performing the checks, verifying these Android-specific annotations is up to the [Android Lint tool](https://developer.android.com/studio/write/lint). As Lint checks are performed on the [UAST (Unified Abstract Syntax Tree)](https://plugins.jetbrains.com/docs/intellij/uast.html), these annotations are verified not only in Kotlin, but also in Java code. This means that the opt-in marker annotation, its usage, and the code using the opt-in APIs can all be in either language.\n\nTo use these annotations in your project, you need to add a dependency on the [`annotation-experimental` artifact](https://developer.android.com/jetpack/androidx/releases/annotation):\n\n```groovy\ndependencies {\n    implementation(\"androidx.annotation:annotation-experimental:1.1.0\")\n}\t\n```\n\nNote that you can still use the Kotlin opt-in system on Android, you'll just miss out on Java support.\n\n## API Verification\n\nIf you mark some pieces of public API in your module as experimental or internal using Opt-In annotations, you will probably want to ignore them when checking for changes (especially breaking changes) in your public API.\n\nA common tool you can use for Kotlin projects is the [Binary compatibility validator\nplugin](https://github.com/Kotlin/binary-compatibility-validator). This plugin calls annotations that mark API that shouldn't be considered public \"non-public markers\".\n\nThese can be configured in the plugin's configuration block by adding the fully qualified names of the marker annotations to `nonPublicMarkers`:\n\n```groovy\napiValidation {\n    /**\n     * Set of annotations that exclude API from being public.\n     * Typically, it is all kinds of `@InternalApi` annotations \n     * that mark effectively private API that cannot be actually \n     * private for technical reasons.\n     */\n    nonPublicMarkers += [\n        \"com.example.lib.core.ExperimentalLibraryApi\",\n        \"com.example.lib.core.InternalLibraryApi\",\n    ]\n}\n```\n\nAPIs annotated with non-public markers will be excluded from the API dumps of the validator plugin (they won't show up in the generated `.api` files).\n\n## Conclusion\n\nThat's -- hopefully -- everything you'd ever want to know about opt-in annotations, and more. With this, you should now be ready to use these annotations in your own library or multi-module projects as well, whether you just need to interact with experimental APIs while building your apps or create your own opt-in APIs.\n\nThanks to [István Juhos](https://twitter.com/stewemetal), [Arnaud Giuliani](https://twitter.com/arnogiu), [Thomas Künneth](https://twitter.com/tkuenneth), and [Annyce Davis](https://twitter.com/brwngrldev) for taking an early look and reviewing this post :)\n\nFollow me [@zsmb13 on Twitter](https://twitter.com/zsmb13) to keep in touch and get notified of similar posts!\n\n",a.user={name:"Márton Braun",username:t,twitter_username:t,github_username:n,website_url:"https://zsmb.co/",profile_image:"https://res.cloudinary.com/practicaldev/image/fetch/s---cKEDUW6--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/573503/8c864b9c-99a5-441e-bb89-7612b1391357.png",profile_image_90:"https://res.cloudinary.com/practicaldev/image/fetch/s---S6YA-il--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/573503/8c864b9c-99a5-441e-bb89-7612b1391357.png"},{layout:"default",data:[{}],fetch:{"data-v-70afb46a:0":{article:a}},error:n,state:{currentArticle:a},serverRendered:!0,routePath:"/zsmb13/846832",config:{_app:{basePath:"/nuxtstop/",assetsPath:"/nuxtstop/_nuxt/",cdnURL:n}}}}(null,"2021-09-30T16:32:34Z",{},"zsmb13")</script><script src="/nuxtstop/_nuxt/f6e87fb.js" defer></script><script src="/nuxtstop/_nuxt/dc9ce94.js" defer></script><script src="/nuxtstop/_nuxt/6474719.js" defer></script><script src="/nuxtstop/_nuxt/9b75090.js" defer></script><script src="/nuxtstop/_nuxt/18df600.js" defer></script>
  </body>
</html>
